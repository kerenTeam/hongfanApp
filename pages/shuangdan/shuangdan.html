<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>双旦活动</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/reset.css"/>
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../js/app.js"></script>
		<script type="text/javascript" src="../../js/shuangdan.js"></script>
		<style type="text/css">
			.gitDiv{text-align: center;padding: 20px 0;}
			.gitDiv button{font-size: 16px;padding: 6px 20px;}
			.guize0{padding: 5px;color: #555;background-color: #e8e7e7;margin: 5px;border-radius: 5px;margin-top: 0;}
			.guize0 h4{font-size: 17px;line-height: 30px;}
			.guize0 p{line-height: 1.5;color: #777;}

			.formCon{margin-top: 60px;padding: 20px 10px;background-color: #fff;}
			.formItem, .formItem2{
				display: -webkit-flex;
	      		-webkit-flex-direction: row;
		      	display: flex;
	     		flex-direction: row;
			}
			.formItem span, .formItem2 span.span0{
				display: inline-flex;
				height:45px;
				line-height: 45px;
				width: 80px;
				font-size: 15px;
				color: #666;
			}
			.formItem input, .FItem2R input{
				 flex:1;
				 font-size: 15px;
				 border: none;
				 /*background: url(../../img/answer/ask/hiunchecked.png) 0 0 no-repeat ;*/
				 /*background-size: 100% 100%;*/
		     	border: 1px rgba(204, 204, 204, 0.59) solid;
				border-radius: 0;
				height:45px;
				line-height: 45px;
				padding: 10px 15px;
				color: #555;
			}
			.FItem2R{
				flex:1;
				position: relative;
			}
			.FItem2R div.img{
		        position: absolute;
			    right: 0px;
			    top: 0px;
			    height: 45px;
			    width: 50px;
		        line-height: 45px;
			    text-align: right;
			    padding-right: 10px;
			}
			.FItem2R div.img img{
				width: 20px;
    			vertical-align: middle;
			}
			.dropdown{
				width: 200px;
				position: absolute;
				z-index: 100;
				background-color: #fff;
				top: 46px;
				right: 1px;
				box-shadow: 0px 0 2px rgba(175, 166, 166, 0.85);
			}
			.dropdown li{
				font-size: 15px;
				color: #666;
				height: 40px;
				line-height: 40px;
				text-align: center;
			}
			.mui-btn-block{
				color: #fff;
			    background-color: #dd524d;
			    border: none;
			    font-size: 16px;
			    width: 90%;
			    margin: 0 auto;
			    padding: 12px 0;
			    margin-top: 45px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">领取奖励</h1>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="main">
			<div class="gitDiv">
				<button id="gitJiangli" type="button" class="mui-btn mui-btn-danger mui-btn-outlined">分享并领取奖励</button>
			</div>
			<div class="guize0">

				<iframe width="100%" id="iframeid" onload="Javascript:SetCwinHeight()"></iframe>
				<script type="text/javascript">
					mui('#iframeid')[0].src = "http://abcd.zlzmm.com:6789/bannerUrl/pages/shier17SD.html?S="+ Math.random().toString(36).substr(2);
				</script>
			</div>
			<div class="formCon" style="display: none;">
				<div class="formItem">
					<span>联系人: </span>
					<input class="air" id="lianxiren" type="text" placeholder="请输入您的姓名"/>
				</div>
				<div class="formItem">
					<span>手机号码: </span>
					<input class="air" id="phoneNum" type="number" placeholder="请输入手机号"/>
				</div>
				<div class="formItem">
					<span>收货地址: </span>
					<input class="air" id="dizhiStr" type="text" placeholder="请输入您的收货地址"/>
				</div>
				<button id='submitBtn' class="mui-btn-block">提交信息</button>
			</div>
		</div>
	</body>
	<script type="text/javascript">
		//iframe 显示本身高度
		function SetCwinHeight(){
		  var iframeid=document.getElementById("iframeid"); //iframe id
		  if (document.getElementById){
		   if (iframeid && !window.opera){
		    if (iframeid.contentDocument && iframeid.contentDocument.body.offsetHeight){
		     iframeid.height = iframeid.contentDocument.body.offsetHeight;
		    }else if(iframeid.Document && iframeid.Document.body.scrollHeight){
		     iframeid.height = iframeid.Document.body.scrollHeight;
		    }
		   }
		  }
		 }

		mui('#gitJiangli')[0].onclick = function(){

				var thumbs = '../img/logomifeng.png';
				var msg = {
					title:'年货节“晒单”祝福，拼手气领好礼。',
					content:'年货节“晒单”祝福，拼手气领好礼。',
					href:'http://abcd.zlzmm.com:6789/upApp/upgrade.html',
					thumbs:[thumbs],
					pictures:[thumbs]
				};
			showSfun1(msg,function(){
				mui('.gitDiv')[0].style.display = mui('.guize0')[0].style.display = 'none';
				mui('.formCon')[0].style.display = 'block';
			},function(){});
		}
//		mui('#gitJiangli')[0].onclick();
		mui('#submitBtn')[0].onclick = function(){
			mui.plusReady(function(){
				var oldToken = plus.storage.getItem('oldToken'),
		 			cityNum = plus.storage.getItem('cityNum'),
					myuserid = plus.storage.getItem('userid'),
					newId = plus.webview.currentWebview().newId;
				$('.air').each(function(indx,ele){
					if(!$(ele).val()){
						mui.toast($(ele).attr('placeholder'));
						return false;
					}
					if(indx == $('.air').length-1){
						plus.nativeUI.showWaiting();
						var dataObj = {
							userId:myuserid,
							newsId:newId,
							addresseeName:mui('#lianxiren')[0].value,
							phoneNumber:mui('#phoneNum')[0].value,
							address:mui('#dizhiStr')[0].value
						};
						console.log(dataObj);
						mui.ajax(serverUrl+'/api/index/newyeardaychristmasday',{
							data:dataObj,
							type:'post',
							timeout:30000,
							headers:{"token":oldToken,"city":cityNum},
							success: function(data) {
								console.log('领取奖励', data);
								if(data.errno == 0) {
									if(isOne2){//当前是那个节日
										plus.storage.setItem(isOne2,'yes');
									}
									mui.alert(data.data || '操作成功');
								}else{
									mui.alert(data.errmsg || '操作失败');
								}
								plus.nativeUI.closeWaiting();
								plus.webview.currentWebview().close();
							},
							error: function(xhr, type, errorThrown) {
								mui.toast("当前网络不好请重试");
							}
						});
					}
				});

			})

		}

	</script>
</html>