<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>为民服务-义工活动</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no"> 
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" /> 
		<link rel="stylesheet" type="text/css" href="../../css/common.css">  
		<link rel="stylesheet" href="../../css/reset.css">
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script> 
		<style type="text/css">
			p {
				color: #333;
			}
			
			img {
				width: 100%;
				display: block;
				margin: auto;
				text-align: center;
			}
			#ygcnt{
				line-height: 1.5;
			}
			.mui-bar-nav.mui-bar .mui-icon{margin-left: 0;}
			
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
			<h1 class="mui-title">义工活动</h1>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		
		<div class="mui-content" style="background-color: none;"> 
			<div id="teamInfo"></div>
			<script type="text/html" id="teamTpl">
				<div class="mui-card">
					<div class="mui-card-header">
						<div style="width: 100%;text-align: center;">
							<%= objData.title%>
						</div>
					</div>
					<div class="mui-card-content">
						<div class="mui-card-content-inner">
							<%if(objData.picImg){%>
							<img class="mui-col-sm-10" src="<%= url%><%=objData.picImg%>" />
							<%}%>
							<div>
								<p style="text-indent: 2em;" id="ygcnt">
									 
								</p>
							</div>

						</div>
					</div>
					<div class="mui-card-footer">
						<p class="gray smallSize">浏览量：
							<%=objData.read%>次</p>
						<small>发布时间：<%= objData.create_time%></small>
					</div>
				</div>
			</script>
			<div style="margin-bottom: 60px;padding: 10px;">报名即同意<span style="color: coral;" onclick="godate()">《邻水县义务工作联合会义工参加服务规范约定》</span></div>
			<div class="renting-footer renting-footertwo clearfloat">
				<ul>
					<li><a onclick="Signup()">志愿者活动报名</a></li>
				</ul>
			</div>
		</div>
	</body>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		function godate(){
			openview({
				view:"serviceDate.html",
				id:"serviceDate"
			})
		}
		mui.plusReady(function() {
			var oldtoken = plus.storage.getItem('oldToken');
			var activityId = plus.webview.currentWebview().activityId; 
			
			window.Signup = function(){ 
				if(plus.storage.getItem('myToken')){
					openview({
						view:"volunteerSign.html",
						id:"volunteerSign",
						extrasobj:{acid:activityId}
					})
				}else{
					mui.toast('请登录');
					openview({
						view:'../login.html'
					});
				}
			}
			
			plus.nativeUI.showWaiting('加载中 ...', {
				width: '100px',
				height: '80px'
			}); //显示等待框
			mui.ajax(serverUrl + '/api/localservice/activitieinfo', {
				type: 'post',
				data: {
					id: activityId
				},
				timeout: 10000,
				headers: {
					"token": oldtoken
				},
				success: function(data, type, xhr) {
					var teamObj = {};
					data.data.create_time = data.data.create_time.split('T')[0];
					teamObj.objData = data.data; 
					teamObj.url = serverimgUrl;
					mui('#teamInfo')[0].innerHTML = template('teamTpl', teamObj);
					if(data.data.content) {
						console.log('详情', data.data.content);
						var detailsdom = parseDom(data.data.content);
						var detailsimg = detailsdom.getElementsByTagName('img');
						mui.each(detailsimg, function(index, element) {
							console.log(element.src.split('serveForPeople')[1]);
							element.src = serverimgUrl + element.src.split('serveForPeople')[1];
							console.log(element.src);
							element.onerror = function() {
								element.src = '../img/market/nodata.svg';
							}
						})
						console.log('节点', detailsdom); 
					document.getElementById("ygcnt").appendChild(detailsdom);
					}  
					plus.nativeUI.closeWaiting(); //关闭等待框
				},
				error: function(xhr, type, errorThrown) {
					plus.nativeUI.closeWaiting(); //关闭等待框
					mui.toast('当前网络不好,请重试');
				}
			});
		});
		function parseDom(arg) { //节点转换方法
			　　
			var objE = document.createElement("div");　　
			objE.innerHTML = arg;　　
			return objE;
		};
	</script>

</html>