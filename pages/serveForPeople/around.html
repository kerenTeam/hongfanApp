<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>帮帮团地址搜索</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<!--<script src="../../js/hmt.js" type="text/javascript"></script>-->
		<script src="../../js/app.js" type="text/javascript"></script>
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js" type="text/javascript"></script>
		<style type="text/css">
			.data ul li i{
				position: absolute;
				right: 10px;
			}
			.data ul li .shuru{
				margin-bottom: 0;
			}
			.chooseAd{
				text-align: left !important;
			}
			.mui-bar-nav{
				box-shadow: none;
			}
			.mui-bar{
				height: 50px;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			.hasManyCitytwo .baocun{
				font-size: 0.12rem;
			}
			#main{
				margin-top: 50px;
			}
			.toggle--off{
				background-color: #f53c42 !important;
			}
			
			.mui-btn {
				font-size: 16px;
				padding: 8px;
				margin: 3px;
			}
			#showCityPicker3{
				position: absolute;
				right: 10px;
				line-height: 49px;
				border: none;
				padding: 0;
				text-align: right;
				width: 75%;
				background-color: rgba(0,0,0,0);
			}
			.data ul li span{
				line-height: 49px;
			}
			.ui-alert{
				padding: 0;
				line-height: 50px;
				text-align: left;
				text-indent: 20px;
				font-size: 16px;
			}
			.data ul li .shuru{
				line-height: 16px;
				text-align: left;
				width: 76%;
				height: 49px;
			}
			.plist ul li{
				border-bottom: 1px solid #efeff4;
			}
			
			.mui-bar-nav{
				box-shadow: none;
			}
			.price .tag{
				font-size: 10px!important;
			}
			.dealcard-brand .mui-pull-right{
				font-size: 10px;
				color: gray;
			}
			.dealcard .price span.tag {
				 background-color:white!important;
				color: #dd524d;
			}
			dl.list dd dl{
				padding-left: 0;
			}
			dl.list dt, dl.list dd{
				border-bottom: 1px solid #EFEFF4;
			}
			dl.list dd>.react{
				padding: 15px !important;
				height: 100px;
			}
			.dealcard, .cinemacard{
				margin: 0;
			}
			.dealcard .dealcard-img img{
				width: 66px;
				height: 66px;
				border-radius: 50%;
				margin-left: -10px;
			}
			.dealcard .dealcard-brand{
				font-size: 16px;
				line-height: 16px;
			}
			.dealcard .dealcard-block-right {
				margin-left: 85px;
			}
			dl.list{
				border-bottom: 1px solid #EFEFF4;
				border-top: 1px solid #EFEFF4;
				margin-top: 0;
			}
			.helpBtn{
				margin: 30px 20%;
				width: 60%;
			}
			.outP{
				line-height: 40px;
				text-indent: 15px;
			}
		</style>
	</head>

	<body>
		<!--header star-->
		<header class="mui-bar mui-bar-nav hasManyCity hasManyCitytwo">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize fl fanhui"></a>
		    <div class="header-tit">
				帮帮团
			</div>
			<a href="javascript:;" class="fr baocun" onclick="save()"></a>
		</header>
	    <div id="main" class="mui-clearfix add-address">
	    	<div id="thisAddLi"></div>
	    	<div class="plist clearfloat data">
				<ul>
					<li class="clearfloat">
						<a href="javascript:;" id="mapAddress">
							<p class="fl">所在地区</p>
							<button id='showCityPicker3' type='button'><span class="mui-icon mui-icon-arrowdown"></span></button>
							<div id='cityResult3' class="ui-alert"><span id="province"></span><span id="city"></span><span id="area"></span></div>
						</a>
					</li>
					<li class="clearfloat">
						<a>
							<p class="fl">所在街道</p>
							<input type="text" class="fr shuru" name="" id="jiedao" value="" placeholder="请输入所在街道" />
						</a>
					</li>
					<li class="clearfloat">
						<button type="button" class="mui-btn mui-btn-danger mui-btn-block helpBtn" onclick="helpBtn()">搜索附近帮帮团</button>
					</li>
				</ul>
			</div>
			<p class="outP">推荐帮帮团</p>
			<dl class="list" id="helper"></dl>
			<script type="text/html" id="helper-detail">
				<% for(var i = 0;i < helpLi.length;i++){ %>
					<dd>
						<a onclick="forHelp(<%= helpLi[i].helper_id %>)"class="react">
							<div class="dealcard">
								<div class="dealcard-img">
									<% if(helpLi[i].headPic == null || helpLi[i].headPic == ''){ %>
										<img src="../../img/10.png"/>
									<% }else{ %> 
										<img src="<%= helpLi[i].headPic %>"/>
									<% } %>
								</div>
								<div class="dealcard-block-right">
									<div class="dealcard-brand"><%= helpLi[i].name %></div>
									<div class="title text-block"><%= helpLi[i].occupation %></div>
									<div class="price">
										<% for(var j = 0;j < helpLi[i].competency.length;j++){ %>
											<span class="tag"><%= helpLi[i].competency[j] %></span>
										<% } %>
									</div>
								</div>
							</div>
						</a>
					</dd>
				<% } %>
			</script>
	    </div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.picker.min.js"></script>
		<script src="../../js/mui.poppicker.js"></script>
		<script src="../../js/city.data-3.js" type="text/javascript" charset="utf-8"></script>
		<script>
			//点击搜索进入帮帮团专家列表
			function helpBtn(){
				var area = mui('#area')[0].innerHTML;
				var jiedao = mui('#jiedao')[0].value;
				if(area && jiedao){
					openview({
						view:'lawyerList.html',
						extrasobj:{area:area,street:jiedao}
					})
				}else{
					mui.toast('请输入地区和街道');
				}
				
			}
			
			(function($, doc) {
				
				$.init();
				$.ready(function() {
					//地址选择三级联动
					var cityPicker3 = new $.PopPicker({
						layer: 3
					});
					cityPicker3.setData(cityData3);
					var showCityPickerButton = doc.getElementById('showCityPicker3');
					var cityResult3 = doc.getElementById('cityResult3');
					showCityPickerButton.addEventListener('tap', function(event) {
						cityPicker3.show(function(items) {
							doc.getElementById('province').innerText = (items[0] || {}).text + " ";
							doc.getElementById('city').innerText =  (items[1] || {}).text + " ";
							doc.getElementById('area').innerText = (items[2] || {}).text + " ";
							//返回 false 可以阻止选择框的关闭
							//return false;
						});
					}, false);
				});
			})(mui, document);
		</script>
		<!--默认按钮-->
		<script type="text/javascript">
		$('.toggle').click(function(e){
			var toggle = this;
			e.preventDefault();
			$(toggle).toggleClass('toggle--on').toggleClass('toggle--off').addClass('toggle--moving');
			setTimeout(function(){
				$(toggle).removeClass('toggle--moving');
			}, 200)
		});
		</script>
		<script type="text/javascript" charset="utf-8">
      	mui.init();
		mui.plusReady(function(){
			var oldToken = plus.storage.getItem('oldToken');
			
			//推荐帮帮团
			mui.ajax(serverUrl+'/api/localservice/recommendhelper',{
				dataType:'json',
				type:'post',
				timeout:1000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
//					alert(data.data[0].competency);
					for(var i = 0;i < data.data.length;i++ ){
						data.data[i].competency = eval("("+data.data[i].competency+")");
					}
					var helpObj = {};
						helpObj.helpLi = data.data;
					var html = template('helper-detail',helpObj);
					document.getElementById('helper').innerHTML = html; 
					
//					plus.webview.currentWebview().close();//关闭当前页面
//					mui.fire(plus.webview.getWebviewById('personal/address.html'),'refreshAd');//打开指定页面
				},
				error:function(xhr,type,errorThrown){
					alert('响应失败  !');
				}
			}); 
		})();
		//点击专家，进入问题发布
		function forHelp(helpId){
			if(plus.storage.getItem('myToken')){
				openview({
					view:"linshuiHelp.html",
					extrasobj:{helpId:helpId}
				})
			}else{
				mui.toast('请登录');
				openview({
					view:'../login.html'
				})
			}
		}
    </script>
	</body>

</html>