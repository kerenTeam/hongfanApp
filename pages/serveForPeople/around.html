<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>帮帮团地址搜索</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		<link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/>
	    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=8f29aefac8547821425571df8852f64b"></script>
	    <script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<!--<script src="../../js/hmt.js" type="text/javascript"></script>-->
		<script src="../../js/app.js" type="text/javascript"></script>
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js" type="text/javascript"></script>
		<style type="text/css">
			.data ul li i{
				position: absolute;
				right: 10px;
			}
			.data ul li .shuru{
				margin-bottom: 0;
			}
			.chooseAd{
				text-align: left !important;
			}
			.mui-bar-nav{
				box-shadow: none;
			}
			.mui-bar{
				height: 50px;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			.hasManyCitytwo .baocun{
				font-size: 0.12rem;
			}
			#main{
				margin-top: 50px;
			}
			.toggle--off{
				background-color: #f53c42 !important;
			}
			
			.mui-btn {
				font-size: 16px;
				padding: 8px;
				margin: 3px;
			}
			#showCityPicker3{
				position: absolute;
				right: 10px;
				line-height: 49px;
				border: none;
				padding: 0;
				text-align: right;
				width: 75%;
				background-color: rgba(0,0,0,0);
			}
			.data ul li span{
				line-height: 49px;
			}
			.ui-alert{
				padding: 0;
				line-height: 50px;
				text-align: left;
				text-indent: 20px;
				font-size: 16px;
			}
			.data ul li .shuru{
				line-height: 16px;
				text-align: left;
				width: 76%;
				height: 49px;
			}
			.plist ul li{
				border-bottom: 1px solid #efeff4;
			}
			
			.mui-bar-nav{
				box-shadow: none;
			}
			.price .tag{
				font-size: 10px!important;
			}
			.dealcard-brand .mui-pull-right{
				font-size: 10px;
				color: gray;
			}
			.dealcard .price span.tag {
				 background-color:white!important;
				color: #dd524d;
			}
			dl.list dd dl{
				padding-left: 0;
			}
			dl.list dt, dl.list dd{
				border-bottom: 1px solid #EFEFF4;
			}
			dl.list dd>.react{
				padding: 15px !important;
				height: 100px;
			}
			.dealcard, .cinemacard{
				margin: 0;
			}
			.dealcard .dealcard-img img{
				width: 66px;
				height: 66px;
				border-radius: 50%;
				margin-left: -10px;
			}
			.dealcard .dealcard-brand{
				font-size: 16px;
				line-height: 16px;
			}
			.dealcard .dealcard-block-right {
				margin-left: 85px;
			}
			dl.list{
				border-bottom: 1px solid #EFEFF4;
				border-top: 1px solid #EFEFF4;
				margin-top: 0;
			}
			.helpBtn{
				margin: 30px 20%;
				width: 60%;
			}
			.outP{
				line-height: 40px;
				text-indent: 15px;
			}
			.goto{
				position: absolute;
				right: 10px;
				top: 0;
				line-height: 68px;
				color: #999;
			}
			#container{
				width: 100%;
				height: 3rem;
			}
			.amap-logo{
				display: none;
			}
			.amap-copyright{
				display: none!important;
			}
			.amap-info-close{
				display: none;
			}
			.amap-info-sharp{
				height: 0;
				display: none;
			}
			.amap-info-content{
				padding: 0;
				border: 0;
				background: none!important;
				box-shadow: none;
			}
		</style>
	</head>

	<body>
		<!--header star-->
	  
			<header class="mui-bar mui-bar-nav">
			    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
			    <h1 class="mui-title">帮帮团</h1>  
			 
			</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="container" style="margin-top: 50px;"></div>
	    <div id="main" class="mui-clearfix add-address">
	    	<div id="thisAddLi"></div>
	    	<!--<div class="plist clearfloat data">
				<ul>
					<li class="clearfloat">
						<a>
							<p class="fl">所在地区</p>
							<input type="text" class="fr shuru" name="" id="jiedao" value="四川 广安 邻水" readonly/>
						</a>
					</li>
					<li class="clearfloat">
						<a href="javascript:;" id="mapAddress">
							<p class="fl">所在社区</p>
							<button id='showCityPicker3' type='button'><span class="mui-icon mui-icon-arrowdown"></span></button>
							<div id='cityResult3' class="ui-alert"><span id="area"></span></div>
						</a>
					</li>
					
					<li class="clearfloat">
						<button type="button" class="mui-btn mui-btn-danger mui-btn-block helpBtn" onclick="helpBtn()">搜索附近帮帮团</button>
					</li>
				</ul>
			</div>-->
		 
			<p class="outP" style="margin-top: 3rem;text-align: center;background: white;">推荐帮帮团</p>
			<dl class="list" id="helper"></dl>
			<script type="text/html" id="helper-detail">
				<% for(var i = 0;i < helpLi.length;i++){ %>
					<dd class="aClick">
						<a onclick="forHelp(<%= helpLi[i].helper_id %>,'<%= helpLi[i].area %>','<%= helpLi[i].address %>')"class="react">
							<div class="dealcard">
								<div class="dealcard-img">
									<% if(helpLi[i].headPic == null || helpLi[i].headPic == ''){ %>
										<img src="../../img/10.png"/>
									<% }else{ %> 
										<img src="<%=myUrl%><%= helpLi[i].headPic %>"/>
									<% } %>
								</div>
								<div class="dealcard-block-right">
									<div class="dealcard-brand"><%= helpLi[i].name %>  <sub style="color: #999;">服务社区：<%= helpLi[i].address %></sub></div>
									<div class="title text-block"><%= helpLi[i].occupation %></div>
									<div class="price">
										<% for(var j = 0;j < helpLi[i].competency.length;j++){ %>
											<span class="tag"><%= helpLi[i].competency[j] %></span>
										<% } %>
									</div>
									<span class="mui-icon mui-icon-arrowright goto"></span>
								</div>
							</div>
						</a>
					</dd>
				<% } %>
			</script>
	    </div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.picker.min.js"></script>
		<script src="../../js/mui.poppicker.js"></script>
		<script src="../../js/city.data.js" type="text/javascript" charset="utf-8"></script>
		<script>
			//点击搜索进入帮帮团专家列表
			function helpBtn(){
				var area = mui('#area')[0].innerHTML;
				var jiedao = mui('#jiedao')[0].value;
				if(area && jiedao){
					var longitude = document.getElementById('area').value;
					openview({
						view:'lawyerList.html',
						extrasobj:{area:area,street:jiedao,longitude:longitude}
					})
				}else{
					mui.toast('请选择所在社区');
				}
				
			}
			
			(function($, doc) {
				
				$.init();
				$.ready(function() {
					var cityPicker3 = new $.PopPicker({
						layer: 1
					});
					cityPicker3.setData(cityData3);
					var showCityPickerButton = doc.getElementById('showCityPicker3');
					var cityResult3 = doc.getElementById('cityResult3');
					showCityPickerButton.addEventListener('tap', function(event) {
						cityPicker3.show(function(items) {  
							doc.getElementById('area').innerText = (items[0] || {}).text + " ";
							doc.getElementById('area').value = (items[0] || {}).value;
						});
					}, false);
				});
			})(mui, document);
		</script>
		<!--默认按钮-->
		<script type="text/javascript">
		$('.toggle').click(function(e){
			var toggle = this;
			e.preventDefault();
			$(toggle).toggleClass('toggle--on').toggleClass('toggle--off').addClass('toggle--moving');
			setTimeout(function(){
				$(toggle).removeClass('toggle--moving');
			}, 200)
		});
		
		    
		  
		
		</script>
		<script type="text/javascript" charset="utf-8">
      	mui.init();
		mui.plusReady(function(){
			var oldToken = plus.storage.getItem('oldToken');
			plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
			
			//推荐帮帮团
			mui.ajax(serverUrl+'/api/localservice/recommendhelper',{
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
					//加载地图开始
	    			var map = new AMap.Map("container", {resizeEnable: true});
					console.log('列表',data);
					var data1 = [],data2 = [];
					mui.each(data.data,function (index,element) {
						if(element.x_y){
							console.log(element);
							data1 = [];
							data1.push(parseFloat(element.x_y.split(',')[1]));
							data1.push(parseFloat(element.x_y.split(',')[0]));
							data2.push(data1);
						}
					})
					console.log('位置',data2);
//				 	var lnglats = [
//				        [104.065335, 30.534753],
//				        [104.068335, 30.534753],
//				        [104.058375, 30.534873],
//				        [104.068335, 30.534753]
//				    ];
				    var lnglats = data2;
			    	console.log('位置1',lnglats);
				    var infoWindow = new AMap.InfoWindow({offset: new AMap.Pixel(0, -30)});
				    for (var i = 0, marker; i < lnglats.length; i++) {
				        var marker = new AMap.Marker({
				            position: lnglats[i],
				            map: map
				        });
				        //marker.content = '我是第' + (i + 1) + '个Marker';
				        var aaa = data.data[i].helper_id;
				        var bbb = "'"+data.data[i].area+"'";
				        var ccc = "'"+data.data[i].address+"'";
//				        var ccc = "'嘻嘻'";
				        if(data.data[i].headPic){
				        	marker.content = '<img src="'+serverimgUrl+data.data[i].headPic+'" onclick="forHelp('+aaa+','+"'"+data.data[i].area+"'"+','+ccc+')" style="width:40px;height:40px;border-radius:50%" />';
				        }else{
							marker.content = '<img src="../../img/end.png" onclick="forHelp('+aaa+','+bbb+','+ccc+')" style="width:40px;height:40px;border-radius:50%" />';

				        }
				        marker.on('click', markerClick);
				        marker.emit('click', {target: marker});
				    }
				    function markerClick(e) {
				        infoWindow.setContent(e.target.content);
				        infoWindow.open(map, e.target.getPosition());
				    }
				    map.setFitView();
					//加载地图结束
					
					for(var i = 0;i < data.data.length;i++ ){
						data.data[i].competency = eval("("+data.data[i].competency+")");
					}
					var helpObj = {};
					helpObj.myUrl = serverimgUrl;
						helpObj.helpLi = data.data;
					var html = template('helper-detail',helpObj);
					document.getElementById('helper').innerHTML = html; 
					plus.nativeUI.closeWaiting();//关闭等待框
					
					//点击专家，进入问题发布
					window.forHelp=function(helpId,address,street){
						if(plus.storage.getItem('myToken')){
							openview({
								view:"HelpDetail.html",
								extrasobj:{helpId:helpId,address:address,street:street}
							})
						}else{
							mui.toast('请登录');
							openview({
								view:'../login.html'
							})
						}
					}
				},
				error:function(xhr,type,errorThrown){
					mui.toast('当前网络不好,请重试');
				}
			}); 
		})();
		
    </script>
	</body>

</html>