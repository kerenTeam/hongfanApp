<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>个人中心</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../css/common.css">
		<link rel="stylesheet" type="text/css" href="../css/index.css">
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css"/> 
		<link rel="stylesheet" href="../css/reset.css">
		<link rel="stylesheet" href="../css/one.css">
		<script src="../js/app.js" type="text/javascript" charset="utf-8"></script>
		
		<style type="text/css">
			.muibackdrop{display: none;}
			.white{color:#FFFFFF !important;}
			.editImg{position: relative;}
			.editImg .onshow{
				position: absolute; 
				top:0;
				bottom:0;
				left:0;
				right: 0;
				font-style:normal;
				color:#333;
			}
			.myInfo{width: 80px;height:80px;margin: 0 6%;border-radius: 50%;border: 2px solid #fff;
			}
			.denlu{font-size: 17px;
			}
			.brief{margin-left: 38%;margin-top: -10%;
			}
			
			/*修改*/
			body{
			}
			.h-top{
				background-size: cover; 
				margin: 0;
			}
			.centerBack{
				position: absolute;
				bottom: 0;
				left: 0;
				width: 100%;
			}
			.white{
				width: 100%;
			}
			.denlu{
				padding-left: 20px;
				color: #fff;
				line-height: 25px;
			}
			.writing{
				padding: 25px 0;padding-bottom: 5px;
			}
			.h-bottom{ 
				position: absolute;
				bottom: 0;
			}
			.cash{
				background-color: #F53C42;
				margin-bottom: 15px;
			}
			#userBox{
				background-color: #F53C42;
				padding: 12px 0; position: relative;
			}
			.myInfo{
				width: 85px;
				height: 85px;
			}
			.cash .shang ul li span{
				color: #fff;
			}
			.cash .shang ul li img{
				width: 28%;
			}
			.cash .shang{
				border-bottom: none;
			}
			.cashlist ul li p img{
				width: 20%;
				margin-right: 10px;
			}
			.brief{
				display: block;
				text-align: center;
				width: 100%;
			}
			.box-s2{
				position: relative;
			}
			.box-s2 span{
				right: 40px;
				position: absolute;
				top: 16px;
			}
			.cashlist ul li{padding: 0 3%; 
			}
			.cashlist ul li{width: auto;}
			#userList li:last-child{border: none;}
			.shang ul{position: relative;background-color: #fff;}
			.cash .shang ul li {
				margin: 4% 0;
				padding: 2% 0;
			} 
			.cash .shang ul li span{
				margin-top: 5px;
				font-size: 12px;
				color: #333;
			}
			.dao{
				color: white!important;
				border-color:white ;
			    padding: 1px 7px;
				top: 10px;
				right: 10px;
				position: absolute;
				font-size: 12px;
			    border-radius: 2px;
			}
			.cashlist ul li{border-bottom: none;}
			 
			#userList ul li a:after{
				content: '';
				display: block;
				height: 1px;
				background-color: #eee;
				-webkit-transform: scaleY(.5);
			}
			#userList ul li a.xiaoxi:after{
				height: 0;
				
			}
			.cashlist{
				margin-bottom: 15px;
			}
			.centop span{display:inline-block;padding: 4px 0;}
			.centop:after{
				content: '';
				display: block;
				height: 1px;
				background-color: rgba(255, 255, 255, 0.56);
				-webkit-transform: scaleY(.5);
			}
			#beijing{position: absolute;z-index:10;width: 100%;height: 100%;top: 0;overflow: hidden; -webkit-filter: blur(5px);}
			#beijing img{width: 100%;position: relative;top: -40%;}
			#beijing2{position: absolute;z-index:20;width: 100%;height: 100%;top: 0;background-color: rgba(255, 0, 0, 0.67)}
			#userBox .content{position: relative; z-index: 30;}
			#numjifen{z-index: 99;font-weight: 500;padding: 0;line-height: 20px;font-size: 14px;}
			body{background-color: #f8f8f8 !important;} 
			#wodedin{background-color: #fff;margin-top: 10px;}
    		#wodedintop{padding: 16px 5px 14px;padding-left: 12px;font-size: 15px;color: #444;border-bottom: 1px solid #f8f8f8;}
    		#wodedintop .span1,#wodedintop .span2{float: right;color: #888;font-size: 14px;}
    		#wodedintop .span2{font-size: 20px;margin-top: -2px;}
    		#wodedintop .span2:before{color: #888;}
    		/*#wodedintop:after{content: '';display: block;height: 1px;background-color: #f8f8f8;-webkit-transform: scaleY(.5);}*/ 
    		.dindan{width: 18px; margin-top: -4px;margin-left: 2px;}
    		#wodedin table{width: 100%;text-align: center;color: #555;table-layout:fixed;}
    		#wodedin table img{display: block;margin: 0 auto;width: 23px;margin-bottom: 5px;}
    		#wodedin table td{padding: 10px 0;}
    		#column table{width: 100%;text-align: center;background-color: #fff;margin-top: 10px;table-layout:fixed;}
    		#column table img{width: 28px;display: block;margin: 0 auto;margin-bottom: 8px;}
    		#column table td{padding: 20px 0;}
    		#column table tr{border-bottom: 1px solid #f8f8f8;}
		</style>
		
	</head>
	<body>
    	<div class="clearfloat box-s box-ss" id="userBox">
    		<div id="beijing"><img id="mypic1" src="../img/morentouxiang.jpg"/></div>
    		<div id="beijing2"></div>
    		<div class="content clearfloat fl mui-row white">
			    <div class="mui-col-sm-4 mui-col-xs-4" style="padding-top: 18px;position: relative;left: 3px;"><img src="../img/morentouxiang.jpg" class="myInfo" id="mypic"/></div>
			    <div class="mui-col-sm-8 mui-col-xs-8 writing">
			    	<p class="centop">
			    		<span class="denlu denluzhuce" style="z-index: 99;">登录/注册</span> <br />
			    		<b class="denlu denluzhuce" style="display: inline-block;min-height: 20px;" id="numjifen"></b>
			    	</p>
			    	<!--<p></p>-->
			    	<div id="" style="margin-top: 30px;font-size: 13px;">
			    		<span id="">关注 100</span>
			    		<span id="" style="margin-left: 10px;">被关注 10</span>
			    	</div>
			    </div>
    			<button type="button" id="screeningdiv" style="top: 10px;" class="mui-btn mui-btn-danger mui-btn-outlined fr dao">签到</button>
    		</div>
    		
		    <!--这是单独加模拟状态栏的方法-->
			<div id="sBar" style="background-color: #f53c42;position: fixed;width:100%;top: 0;z-index: 9999"></div>
			<script type="text/javascript">
				var immersed = 0;
				var ms=(/Html5Plus\/.+\s\(.*(Immersed\/(\d+\.?\d*).*)\)/gi).exec(navigator.userAgent);
				if(ms&&ms.length>=3){ // 当前环境为沉浸式状态栏模式
				    immersed=parseFloat(ms[2]);// 获取状态栏的高度
				} 
				var statusBar = document.getElementById('sBar');//这是模拟状态栏
				var headdiv = document.getElementById('header');//这是现有的header
				var screeningdiv = document.getElementById('screeningdiv');//这是现有签到节点
				document.body.style.paddingTop =  immersed+'px';
				statusBar&&(statusBar.style.height = immersed+'px');
				headdiv&&(headdiv.style.top = immersed+'px');
				var oldtop = parseInt(screeningdiv.style.top);
				screeningdiv&&(screeningdiv.style.top = immersed + oldtop +'px');
			</script>
    	</div>
    	<!--我的订单-->
    	<div id="wodedin">
    		<div id="wodedintop" class="aClick group_Order">
    			<!--<img class="dindan" src="../img/dingdan.svg"/>--> 
    			我的订单
    			<span class="mui-icon mui-icon-arrowright span2"></span>
    			<span id="" class="span1">全部订单</span>
    		</div>
    		<table border="" cellspacing="" cellpadding="">
    			<tr> 
    				<td class="aClick"><img  src="../img/fukuan.svg"/>待付款</td> 
    				<td class="aClick"><img  src="../img/shouhuo.svg"/>待收货</td> 
    				<td class="aClick"><img  src="../img/pingjia.svg"/>待评价</td>
    			</tr>
    		</table>
    	</div>
    	<!--栏目-->
    	<div id="column">
    		<table border="" cellspacing="" cellpadding="">
    			<tr> 
    				<td class="aClick wmai-order"><img  src="../img/wodekuaidi.svg"/>我的快递</td> 
    				<td class="aClick member2"><img  src="../img/huiyuanka.svg"/>会员卡</td> 
    				<td class="aClick xiaoxi"><img style="width: 25px;padding-bottom: 3px;" src="../img/wodexiaoxi.svg"/>我的消息</td>
    				<td class="aClick myHelp"><img style="width: 26px;padding-bottom: 2px;" src="../img/bangbangtuan.svg"/>帮帮团</td>
    			</tr>
    			<tr> 
    				<td class="aClick wodefabu"><img  src="../img/fabu.svg"/>我的发布</td>  
    				<td class="aClick wodedizhi"><img style="width: 26px;padding-bottom: 2px;" src="../img/dizhi.svg"/>我的地址</td> 
    				<td class="aClick myCHAGE"><img style="width: 25px;padding-bottom: 3px;" src="../img/duihuan.svg"/>兑换</td>
    				<td class="aClick wodeyouhuijuan"><img  src="../img/youhuijuan.svg"/>优惠卷</td>
    			</tr>
    			<tr> 
    				<td class="aClick integral_oder"><img style="width: 25px;padding-bottom: 3px;" src="../img/jifen.svg"/>积分</td> 
    				<td class="aClick" id="writeOff1" style="display: none;"><img style="width: 26px;padding-bottom: 2px;" src="../img/hexiao1.svg"/>核销</td> 
    				<td class="aClick aboutUs"><img  src="../img/guanyu.svg"/>关于</td> 
    			</tr>
    		</table>
    	</div>
    	
		<script src="../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.plusReady(function(){
				 // 等待加载PhoneGap 
				//添加刷新监听
				document.addEventListener('refresh', function() {
					Refresh();
					console.log('刷新数据');
				})
				Refresh(); 
				function Refresh(){//刷新
					//获取缓存 
					var myuserid = plus.storage.getItem('userid');
					var oldtoken = plus.storage.getItem('oldToken');
					//取用户数据
					if(plus.storage.getItem('myToken')){
						mui.ajax(serverUrl+'/api/useraccount/userinfo',{
							data:{"userid":myuserid},
							type:'post',
							timeout:10000,
							headers:{"token":oldtoken},	              				
							success:function(data,type,xhr){
								console.log('获取用户数据返回'+JSON.stringify(data));
								if(data.errno == 0){
									//显示头像
									if(data.data[0].avatar){
										mui('#mypic1')[0].src = mui('#mypic')[0].src = serverimgUrl + JSON.parse(data.data[0].avatar)[0].picImg;
									}
									//显示昵称
									if(data.data[0].nickname != ' '){ 
										if(data.data[0].nickname.indexOf('null') == -1){
											mui('.denluzhuce')[0].innerHTML = data.data[0].nickname;
										}else{
											mui('.denluzhuce')[0].innerHTML = data.data[0].phone;
										}
									}else{
										mui('.denluzhuce')[0].innerHTML = data.data[0].phone;
									}
									//显示积分
									if(!data.data[0].intergral || data.data[0].intergral==undefined){
										mui('#numjifen')[0].innerHTML = '积分: '+0;
									}else{
										mui('#numjifen')[0].innerHTML = '积分: '+data.data[0].intergral;
									}
									
									//显示核销
									if(data.data[0].gid == 2){
										 mui('.writeOff1')[0].style.display = 'block';
										 mui('#writeOff1')[0].addEventListener('tap',function(){
											openview({
												view:'personal/barcode_scan.html' 
											});
										});
									}
									
								}else{
									mui.toast('获取用户信息失败'); 
									console.log(data.errmsg);
								}
							},
							error:function(xhr,type,errorThrown){
								console.log('获取用户数据,响应失败');
							}
						});
					}else{//退出登录还原
						mui('.denluzhuce')[0].innerHTML = '登录\注册';
						mui('#numjifen')[0].innerHTML = '';
						mui('.dao')[0].innerHTML = '签到';
						mui('#mypic')[0].src = mui('#mypic1')[0].src = '../img/morentouxiang.jpg';
					}
					//头像
					mui('.myInfo')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/setup.html' 
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//签到  
					mui('.dao')[0].onclick=function(){
						   
						if(plus.storage.getItem('myToken')){  
								//执行签到  
								mui.ajax(serverUrl+'/api/index/cheking',{
									data:{"userid":myuserid,"intergral_float":2050},
									type:'post',
									timeout:10000,
									headers:{"token":oldtoken},	              				
									success:function(data){ 
										plus.nativeUI.closeWaiting();
										console.log('签到返回'+JSON.stringify(data));
										if(data.errno == 0){
											mui.toast('签到成功');
										  
											Refresh();
										}else{
//											mui('.dao')[0].innerHTML = "已签到";
											mui.toast('每天只能签到一次');
										}
									},
									error:function(xhr,type,errorThrown){
										plus.nativeUI.closeWaiting();
										mui.toast('签到失败'); 
									}
								}); 
						}else{//没登陆直接打开登录页面 
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					};
					
					
					//登录注册
					mui('.denlu')[0].addEventListener('tap',function(){
						if(!plus.storage.getItem('myToken')){
							openview({
								view:'login.html'
							});
						}
					});
					//我的订单
					mui('.group_Order')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/sc-order.html',
								id:'sc-order'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的快递
					mui('.wmai-order')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/my-delivery.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的会员卡 
					mui('.member2')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/member.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的消息
					mui('.xiaoxi')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/my-info.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的帮帮团
					mui('.myHelp')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/my-help.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的发布
					mui('.wodefabu')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/my-publish.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的地址
					mui('.wodedizhi')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/address.html',
								extrasobj:{userId:myuserid}
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					
					//我的兑换
					mui('.myCHAGE')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'market/jifen-order.html',
								extrasobj:{userId:myuserid}
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
				
					//优惠券
					mui('.wodeyouhuijuan')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/coupon.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//积分
					mui('.integral_oder')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/jfguanli.html' 
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//关于我们
					mui('.aboutUs')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'end.html' 
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});	
					
				}//刷新	
			});
		</script>
		
	</body> 

</html>
