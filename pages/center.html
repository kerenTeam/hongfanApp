<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>个人中心</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../css/common.css">
		<link rel="stylesheet" type="text/css" href="../css/index.css">
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css"/> 
		<link rel="stylesheet" href="../css/reset.css">
		<link rel="stylesheet" href="../css/one.css">
		<script src="../js/app.js" type="text/javascript" charset="utf-8"></script>
		
		<style type="text/css">
			.muibackdrop{display: none;}
			.white{color:#FFFFFF !important;}
			.editImg{position: relative;}
			.editImg .onshow{
				position: absolute;
				top:0;
				bottom:0;
				left:0;
				right: 0;
				font-style:normal;
				color:#333;
			}
			.box-ss{text-align: center;margin:0 auto;padding-left:22%;}
			.h-top .content {width: 100%;margin-left: 0; 
			}
			.h-top {padding-left: 10%;padding-top: 2%;
			}
			.box-ss{text-align: left;
			}
			.myInfo{width: 80px;height:80px;margin: 0 6%;border-radius: 50%;
			}
			.denlu{font-size: 16px;
			}
			.brief{margin-left: 38%;margin-top: -10%;
			}
			
			/*修改*/
			body{
				/*background-color: #e6e6e6;*/ 
				
			}
			.h-top{
				/*background: red url(../img/center/bigCloud.png) no-repeat bottom;*/
				background-size: cover;
				margin: 0;
			}
			.centerBack{
				position: absolute;
				bottom: 0;
				left: 0;
				width: 100%;
			}
			.white{
				display: block;
				position: absolute;
				left: 49%;
				margin-left: -50px;
				top: 20px;
				width: 112px;
			}
			.denlu{
				display: block;
				width: 100%;
				text-align: center;
				margin-top: 15px;
			}
			.h-top .content{
				height: 100px;
			}
			.h-bottom{ 
				position: absolute;
				bottom: 0;
			}
			.cash{
				background-color: #fff;
				/*margin-top: -20px;*/
				padding-top: 10px;
			}
			.myInfo{
				width: 100px;
				height: 100px;
			}
			.cash .shang ul li span{
				color: #666;
			}
			.cash .shang ul li img{
				width: 28%;
			}
			.cash .shang{
				border-bottom: none;
				margin-bottom: 10px; 
			}
			.cashlist ul li p img{
				width: 20%;
				margin-right: 10px;
			}
			.brief{
				display: block;
				text-align: center;
				width: 100%;
			}
			.box-s2{
				position: relative;
			}
			.box-s2 span{
				right: 40px;
				position: absolute;
				top: 16px;
			}
			.cashlist ul li{padding: 0 3%; 
			}
			.cashlist ul li{width: auto;}
			#userList li:last-child{border: none;}
			.shang ul{position: relative;}
			.cash .shang ul li {
				padding: 0 0 4% 0;
			} 
			.dao{
				color: white!important;
				border-color:white ;
				padding: 3px 9px;
			}
			.cashlist ul li{border-bottom: none;}
			#userList ul li a:after{
				content: '';
				display: block;
				height: 1px;
				background-color: rgba(0,0,0,0.1);
				-webkit-transform: scaleY(.5);
			}
			#userList ul li a.xiaoxi:after{
				height: 0;
				
			}
		</style>
	</head>
	<body>
		<!--状态栏-->
		<div id="sBar" style="background-color: #f53c42;position: fixed;width:100%;top: 0;z-index: 9999"></div>
		<script type="text/javascript">
			var immersed = 0;
			var ms=(/Html5Plus\/.+\s\(.*(Immersed\/(\d+\.?\d*).*)\)/gi).exec(navigator.userAgent);
			if(ms&&ms.length>=3){ // 当前环境为沉浸式状态栏模式
			    immersed=parseFloat(ms[2]);// 获取状态栏的高度
			}
			var statusBar = document.getElementById('sBar');//这是模拟状态栏
			var headdiv = document.getElementById('header');//这是现有的header
			document.body.style.paddingTop =  immersed+'px';
			statusBar&&(statusBar.style.height = immersed+'px');
			headdiv&&(headdiv.style.top = immersed+'px');
		</script>
		<!--状态栏结束--> 
    	<div class="h-top clearfloat box-s box-ss" id="userBox">
    		<button type="button" class="mui-btn mui-btn-danger mui-btn-outlined fr dao">签到</button>
    		<img src="../img/center/bigCloud.png"/ class="centerBack">
    		<div class="content clearfloat fl">
    			<a class="white"><img src="../img/morentouxiang.jpg" class="myInfo" id="mypic"/>
    			<span class="denlu denluzhuce" style="z-index: 99;">
    				登录\注册
    			</span></a> 
    		</div>   
    	</div>
    	<div class="cash clearfloat">
    		<div class="shang ">
    			<ul class="clearfloat ">
    				<li>
    					<a class="group_Order">
    						<img src="../img/center/order.png"/>
    						<span>我的订单</span>
    					</a>
    				</li>
    				<li>
    					<a class="wmai-order">
    						<img src="../img/center/express.png"/>
    						<span>我的快递</span>
    					</a>
    				</li>
    				<li>
    					<a class="member2">
    						<img src="../img/center/member.png"/>
    						<span>会员卡</span>
    					</a>
    				</li>
    			</ul>
    		</div>
    	</div>
    	<div class="cashlist clearfloat" id="userList">
    		<ul>
    			<li class="box-s2">
    				<a class="fabu xiaoxi">
    					<p class="fl"><img src="../img/center/message.png"/>我的消息</p>
    				</a>
    			</li>
    			<li class="box-s2">
    				<a class="myHelp">
    					<p class="fl"><img style="width: 17%;" src="../img/center/help.png"/>我的帮帮团</p>
    				</a>
    			</li>
    			<li class="box-s2">
    				<a class="fabu wodefabu">
    					<p class="fl"><img src="../img/center/public.png"/>我的发布</p>
    				</a>
    			</li>
    			<li class="box-s2">
    				<a class="myAddress wodedizhi">
    					<p class="fl"><img src="../img/center/ad.png"/>我的地址</p>
    				</a>
    			</li>
    			<li class="box-s2">
					<a class="myAddress wodeyouhuijuan">
    					<p class="fl"><img style="margin-left: 2px;margin-right: 12px;" src="../img/center/sale.png"/>优惠券</p>
    				</a>
				</li>
				<li class="box-s2">
					<a class="integral_oder">
    					<p class="fl"><img style="width: 24%;margin-right: 13px;margin-left: 2px;" src="../img/center/score.png"/>积分</p>
    				</a>
				</li>
				<li class="box-s2">
					<a class="writeOff">
    					<p class="fl"><img style="width: 11%;margin-right: 10px;margin-left: 2px;" src="../img/hexiao.svg"/>商户核销</p>
    				</a>
				</li>
    		</ul>
    	</div>	
		<script src="../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.plusReady(function(){
				//添加刷新监听
				document.addEventListener('refresh', function() {
					Refresh();
					console.log('刷新数据');
				})
				Refresh();
				
				function Refresh(){//刷新
					//获取缓存
					var myuserid = plus.storage.getItem('userid');
					var oldtoken = plus.storage.getItem('oldToken');
					//取用户数据
					if(plus.storage.getItem('myToken')){
						mui.ajax(serverUrl+'/api/useraccount/userinfo',{
							data:{"userid":myuserid},
							type:'post',
							timeout:10000,
							headers:{"token":oldtoken},	              				
							success:function(data,type,xhr){
								console.log('获取用户数据返回'+JSON.stringify(data));
								if(data.errno == 0){
									//显示头像
									if(data.data[0].avatar){
										mui('#mypic')[0].src = pictarget+data.data[0].avatar;
									}
									//显示昵称
									if(data.data[0].nickname != ' '){ 
										if(data.data[0].nickname.indexOf('null') == -1){
											mui('.denluzhuce')[0].innerHTML = data.data[0].nickname;
										}else{
											mui('.denluzhuce')[0].innerHTML = data.data[0].phone;
										}
									}else{
										mui('.denluzhuce')[0].innerHTML = data.data[0].phone;
									}
								}else{
									mui.toast('获取用户信息失败');
									console.log(data.errmsg);
								}
							},
							error:function(xhr,type,errorThrown){
								alert('响应失败  !');
							}
						});
					}else{//退出登录还原
						mui('.denluzhuce')[0].innerHTML = '登录\注册';
						mui('.dao')[0].innerHTML = '签到';
						mui('#mypic')[0].src = '../img/morentouxiang.jpg';
					}
					
					//头像
					mui('.myInfo')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/setup.html' 
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//签到 
					document.getElementsByClassName('dao')[0].onclick=function(){
						if(plus.storage.getItem('myToken')){ 
							if(this.innerHTML = "已签到"){
//								mui.toast("不能重复签到哦")
							}else{ 
								//执行签到 
								this.innerHTM = "已签到";
							}
						}else{//没登陆直接打开登录页面 
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					};
					
					
					//登录注册
					mui('.denlu')[0].addEventListener('tap',function(){
						openview({
							view:'login.html'
						});
					});
					//我的订单
					mui('.group_Order')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/sc-order.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的快递
					mui('.wmai-order')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'localLife/deliveryCenter.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的会员卡 
					mui('.member2')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/member.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的消息
					mui('.xiaoxi')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/my-info.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的帮帮团
					mui('.myHelp')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/my-help.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的发布
					mui('.wodefabu')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/my-publish.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//我的地址
					mui('.wodedizhi')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/address.html',
								extrasobj:{userId:myuserid}
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//优惠券
					mui('.wodeyouhuijuan')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/coupon.html'
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//积分
					mui('.integral_oder')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
								view:'personal/jfguanli.html' 
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					//核销 
					mui('.writeOff')[0].addEventListener('tap',function(){
						if(plus.storage.getItem('myToken')){ 
							openview({
//								id:'barcode_scan',
								view:'personal/barcode_scan.html' 
							});
						}else{//没登陆直接打开登录页面
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
					});
					
				}//刷新	
			});
		</script>
		
	</body>

</html>
