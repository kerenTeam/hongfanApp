<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>家乡话</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/mui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/common.css"/>
		<!--<link rel="stylesheet" type="text/css" href="../../css/localHost.css"/>-->		
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css">
			/*banner底部导航*/
			.mui-slider-indicator .mui-indicator{
				width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			.mui-slider-indicator .mui-active.mui-indicator{
				background-color: rgba(245,60,66,0.8);
				box-shadow: none;
				opacity: 1;
				border: none;
			}
			
			.mui-slider{
				margin-top: 50px;
			}
			.mui-bar-nav{
				box-shadow: none;
			}
			
			.infolist div p{
				margin-top: 15px;
				line-height: 22px;
				margin-bottom: 10px;
			}
			.editbtn{
				background-color: #fff;
				position: absolute;
				left: 50%;
				bottom:0;
				margin-left: -7.5%;

				text-align: center;
				padding:5px 0;
				background: #EFEFF4;
			}
			.editbtn img{
				width:50px !important;
				height:50px !important;
				
			}
			.infolist{
				padding-bottom: 80px;
			}
			.mui-media-body{
				white-space: normal;
				color:#333;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">家乡话</h1>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<!--轮播图-->
		<div class="mui-slider" id="focusNews"></div>
		<!--轮播图结束-->
		<!--轮播图模版开始-->
		<script type="text/html" id="focusNewsModal">		
			<div class="mui-slider-group mui-slider-loop">
			    <!--支持循环，需要重复图片节点-->
			    
			    <div class="mui-slider-item mui-slider-item-duplicate"><a href="#"><img src="<%= banner[banner.length-1].url %>/<%= banner[banner.length-1].bannerPic %>" /></a></div>
			    <% for(var i=0;i<banner.length;i++){%>
			    <div class="mui-slider-item"><a href="#"><img src="<%= banner[banner.length-1].url %>/<%= banner[i].bannerPic %>" /></a></div>
			  	<%}%>
			    <!--支持循环，需要重复图片节点-->
			    <div class="mui-slider-item mui-slider-item-duplicate"><a href="#"><img src="<%= banner[0].bannerPic %>/<%=banner[0].bannerPic %>" /></a></div>
			</div>
			 <div class="mui-slider-indicator">
                <div class="mui-indicator"></div>
                <div class="mui-indicator"></div>
                <div class="mui-indicator"></div>
             </div> 			
		</script>
		<!--轮播图模版结束-->
		<!--图文列表开始-->
		<div class="infolist">
			<ul class="mui-table-view" id="news"></ul>
		</div>
		<!--图文列表结束-->
		<!--图文列表模板开始-->
		<script type="text/html" id="newsModal">
			<% for(var i=0;i<data.length;i++){%>
			<li class="mui-table-view-cell mui-media openDetail" data-id="<%=data[i].id%>">
				<a href="javascript:;">
					<img class="mui-media-object mui-pull-right" src="<%=data[i].pic%>">
					<div class="mui-media-body">
						<%= data[i].title %>
						<p class='mui-ellipsis'><%= data[i].create_time %></p>
					</div>
				</a>
			</li>
			<%}%>
		</script>
		<!--图文列表模板结束-->
		<div class="editbtn">
			<img src="../../img/bianjibtn.svg"/>
		</div>
		
		<script type="text/javascript">
			var infolist = mui('.infolist div');
			
			for(var i=0; i<infolist.length; i++ ){
				infolist[i].addEventListener('tap',function(){
					openview({
						view:'listinfo.html'
					});
				})
			}
			//发帖
			mui('.editbtn')[0].addEventListener('tap',function(){
				openview({
					view:'addpost.html'
				});
			});
			mui.plusReady(function(){
				var token=plus.storage.getItem("Token");
				//家乡报道的banner获取
				mui.ajax(serverUrl+'/api/localreport/localreportbanner',{
					data:{},
//					dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型
					timeout:10000,//超时时间设置为10秒；
					headers:{"token":token},	              					
					success:function(data,type,xhr){
						//获取并渲染焦点新闻信息
						var html=template("focusNewsModal",data.data[0]);
						document.getElementById("focusNews").innerHTML=html;
						mui(".mui-table-view").on("tap",'.openDetail',function(){
							var newsId=this.getAttribute("data-id");
							console.log(newsId);
							openview({
								view:'listinfo.html',
								extrasobj:{newsId:newsId}
							});
						})
					},
					error:function(xhr,type,errorThrown){
						console.log(type);
//						alert(type);
					}
				});
				//家乡报道的新闻获取
				mui.ajax(serverUrl+'/api/localreport/localreport',{
					data:{"currentPage":1,"endPage":3},
//					dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型
					timeout:10000,//超时时间设置为10秒；
					headers:{"token":token},	 
					success:function(data,type,xhr){
						//获取并渲染焦点热门信息
						for(var i=0;i<data.data.length;i++){
							data.data[i].create_time=data.data[i].create_time.split('.')[0].split('T')[0]+' '+data.data[i].create_time.split('.')[0].split('T')[1];
						}
//						console.log(JSON.stringify(data));
						var html=template("newsModal",data);
						
						document.getElementById("news").innerHTML=html;
						
					},
					error:function(xhr,type,errorThrown){
						console.log(type);
//						alert(type);
					}
				});
			});
			
			
			
		</script>
		
	</body>
	
</html>