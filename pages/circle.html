<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>HI友圈</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />   
		<link rel="stylesheet" type="text/css" href="../css/common.css"> 
		<link rel="stylesheet" type="text/css" href="../css/mui.css"/> 
		<link rel="stylesheet" type="text/css" href="../css/config.css"/> 
	</head>
	<style type="text/css">
		.felsr{display: flex;justify-content: space-around;align-items: center;background-color: white;padding: 10px 0;text-align: center;position: relative;}
		.felsr:after{position:absolute;content:'';height:1px;left:10px;right:10px;-webkit-transform:scaleY(.3);background:#CACACA;bottom:0}
		.felsr img{width: 40px;display: block;margin: auto;}
		.todayHOt{padding: 10px;}
		.ftr{display: flex;justify-content: space-between;align-items: center;}
		.ftr img{width: 10px;}
		.hiFriend .bigPic{display: block;}
		.avaPic{width: 20px;height:20px;border-radius: 30px;}
		.footFirend{height:26px;line-height: 28px;color: #666;font-size: 13px;}
		.lovePic{width: 18px;height:16px;float: right;margin-top: 6px;}
		.hiFriend{padding: 5px;}
		.paddDiv{padding: 5px;}
		.bigPic{width: 6em;height: 6em;border-radius: 3px;}
		.mui-row{padding-top: 5px;}
		.QAhead{background-color:#f3f3f3;text-align:center}
		.QAhead span{position:relative;display:inline-block;margin:0 10px;padding:0 15px;height:38px;color:#343434;font-size:15px;line-height:38px}
		.QAhead span.active{color:#f93a38}
		.QAhead span:after{position:absolute;bottom:0;left:50%;width:0;height:1px;background-color:#f31414;content:""}
		.QAhead span.active:after{left:0!important;width:100%!important;transition:all .3s}
		.listCon{border-bottom: 15px solid #F3F3F3;}
		.listCon p{padding:10px 0 0}
		.follow{position:relative;}
		.follow{background-color:#fff;padding:15px 10px;}
		.follow:after{position:absolute;right:10px;bottom:0;left:10px;height:1px;background:#cacaca;content:'';-webkit-transform:scaleY(.3);}
		.follow:last-child:after{height:0;}
		.fchidl{display:flex;align-items:center;justify-content:space-between;}
		.Avator,.userAvator{margin-right:15px;width:2.5rem;height:2.5rem;}
		.userAvator{border-radius:50%;}
		.fchidl>div{display:flex;vertical-align:middle;text-align:left;font-size:15px;align-items:center;}
		.text{color:#999;}
  		.flexrr{display: flex;justify-content: space-around;align-items: center;padding: 10px 0;}
  		.flexrr>div img{width: 25px;vertical-align: middle;}
  		.cmtall img{width: 25px;margin-right: 5px;}
  		.cmtflex{display: flex;justify-content: space-between;align-items: center;}
  		.ctc span{color: #fb7e23;}
  		.jubao{background-color: white;} 
		.jubao li a{padding: 18px;line-height: 15px;text-align: center;border-bottom: 1px solid #EEEEEE;display: block;color: black;}
		.jubao li:last-child a{color: rgb(153,153,153);}
		/*.QandA{min-height: 720px;}*/
		#upload{min-height: auto !important;padding-top: 5px;height: 37px;}
		#upload img{padding: 0 !important;margin: 0;width: 32px;}
		body{padding-bottom: 0;}
		.loadPics{max-width: 80%;}
		.DTcontent{overflow: hidden;}
		.dynamicPic{float: left;position: relative;overflow: hidden;border-right: 2px solid #fff;}
		.dynamicPic1{width: 70%;padding-top: 68%;}
		.dynamicPic2{width: 50%;padding-top: 48%;}
		.dynamicPic3{width: 33%;padding-top: 31%;}
		.dynamicPic img{width: 100%;}
		.dynamicPic span{display: inline-block;position: absolute;top: 2%;left: 2%;width: 96%;height: 96%;background-color: #F3F3F3;overflow: hidden;}
	</style>
	<body style="background-color: white;">
		<header class="mui-bar mui-bar-nav">
		    <h1 class="mui-title">HI友圈</h1>
		</header>
		<script src="../js/statusBar.js"></script><!--状态栏-->
		<div id="main">	
			<div class="felsr ft12"><!--分类-->
				<div class="goFeriend">
					<img src="../img/makeFriend/friend.png"/>
					<span>交友</span>
				</div>
				<div class="goCircle">
					<img src="../img/makeFriend/circle.png"/>
					<span>圈子</span>
				</div>
				<div class="goAround">
					<img src="../img/makeFriend/around.png"/>
					<span>附近</span>
				</div>
				<div class="goHot">
					<img src="../img/makeFriend/hotborad.png"/>
					<span>人气榜</span>
				</div>
			</div>
			
			<div class="todayHOt" style="background-color: white;"><!--今日热门-->
				<div class="ftr" id="todayHOt">
					<span class="ft14">今日热门</span>
					<img src="../img/localLife/righticon.png"/>
				</div> 
			    <div class="mui-row">
			        <div class="mui-col-sm-4 mui-col-xs-4 paddDiv">
			            <img class="bigPic" src="../img/makeFriend/jiaoyou.png"/>
			            <p class="footFirend">
			            	<img class="avaPic" src="../img/mainHtml/touxiang2.png"/>
			            	theFin
			            	<img class="lovePic" src="../img/mainHtml/weizan.png"/>
			            </p>
			        </div>
			        <div class="mui-col-sm-4 mui-col-xs-4 paddDiv">
			            <img class="bigPic" src="../img/makeFriend/jiaoyou.png"/>
			            <p class="footFirend">
			            	<img class="avaPic" src="../img/mainHtml/touxiang2.png"/>
			            	王菲
			            	<img class="lovePic" src="../img/mainHtml/weizan.png"/>
			            </p>
			        </div>
			        <div class="mui-col-sm-4 mui-col-xs-4 paddDiv">
			            <img class="bigPic" src="../img/makeFriend/jiaoyou.png"/>
			            <p class="footFirend">
			            	<img class="avaPic" src="../img/mainHtml/touxiang2.png"/>
			            	thefin
			            	<img class="lovePic" src="../img/mainHtml/yizan.png"/>
			            </p>
			        </div>
			    </div> 
			</div><!--今日热门结束-->
			
			<!--动态-->
			<div class="QandA">
				<div class="QAhead" style="position: -webkit-sticky; position:sticky; top: 70px;z-index: 99;display: block;width: 100%;">
					<span class="active aClick">最新动态</span> 
					<span class="aClick">好友动态</span> 
				</div>
				
				<div class="dyCon" id="dyCon0" style="display: block;"></div><!--最新动态-->
				<div class="dyCon" id="dyCon1" style="display: none;"></div><!--好友动态-->

				<script type="text/html" id="listDataS">
					<%for(var i=0;i<dataList.length;i++){%>
						<div class="listCon">
							<div class="follow">
								<div class="fchidl">
									<div>
										<img src="../img/mainHtml/touxiang2.png" class="userAvator mr25"/>
										<div>
											海洋 <div class="disablecl ft12"> 1分钟  <span style="color: #5d86b2;">21</span>阅读 </div>
										</div>
									</div>
									<div class="butright">
										<div class="goanswer"> <img src="../img/makeFriend/down.png" style="width:15px;"/> </div>
						           </div> 
								</div>
								<div class="DTcontent" onclick="DTdetail(<%=dataList[i].id%>)">
									<p  class="ft14 maincl overTwo"><%=dataList[i].content%> </p><!--文字内容-->
									
									<%for(var j=0;j<dataList[i].picS.length;j++){%>
										<%if(dataList[i].picS.length == 1){ %>
											<div class="dynamicPic dynamicPic1">
												<span><img onload="imgHeight(this)" class="loadPics" data-src="<%=dataList[i].picS[j]%>" /></span>
											</div>
										<%}else if(dataList[i].picS.length == 2){%>
											<div class="dynamicPic dynamicPic2">
												<span><img onload="imgHeight(this)" class="loadPics" data-src="<%=dataList[i].picS[j]%>" /></span>
											</div>
										<%}else{%>
											<div class="dynamicPic dynamicPic3">
												<span><img onload="imgHeight(this)" class="loadPics" data-src="<%=dataList[i].picS[j]%>" /></span>
											</div>
										<%}%>	
										
									<%}%>
								</div>
								<div class="flexrr">
									<div class="disablecl ft12"> <img src="../img/makeFriend/zan.png"/> 赞 </div> 
									<div class="disablecl ft12"> <img src="../img/makeFriend/message.png" alt="" /> 评论 </div>
									<div class="disablecl ft12"> <img src="../img/makeFriend/share.png"/> 转发 </div>
								</div>
								
								<div class="cmtflex" style="border-top:1px solid #DDDDDD ;border-bottom: 1px solid #DDDDDD;padding: 10px 5px;"><!--评论-->
									<div style="text-align: center;line-height: 0.8;"> 
										<div class="ft14">评论</div>
										<img style="width: 30px;margin: 0;" src="../img/makeFriend/cmt.png"/>
									</div>
									<div class="cmtflex cmtall ft12">
										<img src="../img/mainHtml/touxiang2.png"/>
										<img src="../img/mainHtml/touxiang2.png"/>
										<img src="../img/mainHtml/touxiang2.png"/>
										<img src="../img/mainHtml/touxiang2.png"/>
										<img src="../img/makeFriend/more.png"/>
										评论13
									</div>
								</div>
								<div class="follow ft12"> 
									<div class="fchidl">
										<div class="ctc"> <span>淘气的八爷</span>：xxxxxxxxx </div> 
										<div class="butright"> <div class="disablecl ft12"> 1分钟前 </div> </div> 
									</div>
								</div>
								<div class="follow ft12"> 
									<div class="fchidl">
										<div class="ctc"> <span>淘气的八爷</span>回复<span>小李子</span>:xxxxxxxxx </div> 
										<div class="butright"> <div class="disablecl ft12"> 1分钟前 </div> </div> 
									</div>
								</div>
							</div> 
						</div>
					<%}%>	
				</script>
				<div class="upload text-center text-xs gray" id="upload"><img src='../img/balls.svg' /></div>
			</div>
			<!--动态结束-->
			
			
			<!--操作表-->
			<div id="sheet1" class="mui-popover mui-popover-bottom mui-popover-action ">
			    <!-- 可选择菜单 -->
			    <ul class="jubao">
			      <li>
			        <a href="#">加入黑名单</a>
			      </li>
			      <li>
			        <a href="#">举报</a>
			      </li>
			      <li>
			        <a href="#sheet1">取消</a>
			      </li>
			    </ul>
			</div>
		</div>
		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/app.js"></script>
		<script src="../js/artTemplate-native.js"></script>
		<script type="text/javascript">
			function imgHeight(obj){
				if(obj.offsetHeight<obj.parentNode.offsetHeight){
					obj.style.height = '100%';
					obj.style.width = 'auto';
				}
			}
			
		</script>
		<script type="text/javascript">
			/*动态tab切换*/
			var flag0 = 0,flag1 = 0,//是否   第一次点击
		     	SH0 = 0,SH1  = 0;/*保存的状态栏高度*/
			var listCon = document.getElementsByClassName('QAhead')[0].getElementsByTagName('span');/*按钮*/
			var dyCon = document.getElementsByClassName('dyCon'); /*内容盒子*/
			[].forEach.call(listCon,function(ele,index){
				ele.onclick = function(){
					if(!ele.className.includes('active')){
						[].forEach.call(listCon,function(ele2){
							ele2.className = '';
						})
						ele.className = 'active aClick';
						
						[].forEach.call(dyCon,function(ele3){
							ele3.style.display = 'none';
						})
						dyCon[index].style.display = 'block';
						
						if(index == 0){
							if(flag0==0){
								shopData(index,0);
							}else{
								$(window).scrollTop(SH0);
							}
						}else if(index == 1){
							if(flag1==0){
								shopData(index,1);
							}else{
								$(window).scrollTop(SH1);
							}
						}
					}else{//点击active项    就刷新
						$(window).scrollTop(280);
						if(index == 0){
							flag0 = 0,SH0 = 0;
							shopData(index,0,true);
						}else if(index == 1){
							flag01 = 0,SH1 = 0;
							shopData(index,1,true);
						}					
					}
				}
			})
			
			/*铺数据*/
			shopData(0,0,false);//默认推荐
			
			function shopData(typeNum,gender,refresh){
				var Spagenum = 2; //实到页数
				var Ypagenum = 1; //应到页数
				if(refresh){
					document.getElementById('upload').innerHTML = "<img src='../img/balls.svg' />";
					document.getElementsByClassName("dyCon")[typeNum].innerHTML = '';
				}
				if(typeNum == 0){
					flag0++;
					if(flag0 == 2){
						$(window).scrollTop(280);
					}
				}else if(typeNum == 1){
					flag1++;
					if(flag1 == 1){
						$(window).scrollTop(280);
					}
				}
				mui("#upload")[0].innerHTML = "<img src='../img/balls.svg' />";
				mui.plusReady(function(){
					if(typeNum == 0){
						var dataJson = {
							'numsPerPage':6,
							'currentPage':1,
							'orderType':'DESC',
							'orderField':'create_time',
						}
					}else if(typeNum == 1){
						var myuserid = plus.storage.getItem('userid');
						var dataJson = {
							'userId':myuserid,
							'numsPerPage':6,
							'currentPage':1,
							'orderType':'DESC',
							'orderField':'create_time',
							'isFriends':1
						}
					}
					var cityNum = plus.storage.getItem('cityNum'),oldToken = plus.storage.getItem('oldToken');
					mui.ajax(serverUrl + '/api/friends/newslist', {
						data: dataJson,
						dataType: 'json',
						type: 'post',
						timeout: 8000,
						headers: {"token": oldToken,'city': cityNum},
						success: function(data, type, xhr) {
							console.error('交友列表'+typeNum, data);
							if(data.errno == 0) {
								var dataObj = {};
								var nowArray = data.data.data;

								for(var j = 0 ;j<nowArray.length;j++){//整理内容图片
									var nowArray2 = JSON.parse(JSON.parse(nowArray[j].pic));
									if(nowArray2.length){
										var picS = [];
										for(var k = 0 ;k<nowArray2.length;k++){
											picS.push(nowArray2[k].picImg);
										}
										nowArray[j].picS = picS;
									}
								}
								
								dataObj.dataList = data.data.data;
								document.getElementsByClassName("dyCon")[typeNum].innerHTML = template("listDataS", dataObj);
								mui("#upload")[0].innerHTML = "";
								lazyLoad(true,50);//懒加载
								
								$(window).scroll(function() {
									if(document.getElementsByClassName("dyCon")[typeNum].style.display == 'block'){//判断是否是 当前显示的盒子
											var scrollTop = $(this).scrollTop();　
											if(typeNum == 0){
												SH0 = $(this).scrollTop();
											}else if(typeNum == 1){
												SH1 = $(this).scrollTop();
											}
											var scrollHeight = $(document).height();
											var windowHeight = $(this).height();　　
											if(scrollTop + windowHeight == scrollHeight) {
												if(Spagenum <= data.data.totalPages && Spagenum == Ypagenum + 1) { //当前页小于等于总页数时请求下一页
													mui("#upload")[0].innerHTML = "<img src='../img/balls.svg' />";
													Ypagenum++; //满足加载情况,应到页数+1
													console.log('发起请求,实到' + Spagenum + '页');
													console.log('发起请求,应到' + Ypagenum + '页');
													if(typeNum == 0){
														var dataJson = {
															'numsPerPage':6,
															'currentPage':Spagenum,
															'orderType':'DESC',
															'orderField':'create_time',
														}
													}else if(typeNum == 1){
														var myuserid = plus.storage.getItem('userid');
														var dataJson = {
															'userId':myuserid,
															'numsPerPage':6,
															'currentPage':Spagenum,
															'orderType':'DESC',
															'orderField':'create_time',
															'isFriends':1
														}
													}
													
													mui.ajax(serverUrl + '/api/friends/newslist', {
														data: dataJson,
														dataType: 'json',
														type: 'post',
														timeout: 8000,
														headers: {"token": oldToken,'city': cityNum},
														success: function(data) {
															console.error('交友列表续'+typeNum, data);
															if(data.errno == 0) {
																var dataObj = {};
																var nowArray = data.data.data;
																for(var j = 0 ;j<nowArray.length;j++){//整理内容图片
																	var nowArray2 = JSON.parse(JSON.parse(nowArray[j].pic));
																	if(nowArray2.length){
																		var picS = [];
																		for(var k = 0 ;k<nowArray2.length;k++){
																			picS.push(nowArray2[k].picImg);
																		}
																		nowArray[j].picS = picS;
																	}
																}
																dataObj.dataList = data.data.data;
																document.getElementsByClassName("dyCon")[typeNum].innerHTML += template("listDataS", dataObj);
																lazyLoad(false,50);//懒加载
															}
															mui("#upload")[0].innerHTML = " ";
															Spagenum++; //加载成功,当前页+1
															console.log('成功+1,实到' + Spagenum);
															console.log('成功+1,应到' + Spagenum);
														},
														error: function(xhr, type, errorThrown) {
															Ypagenum--; //失败是应到-1
															mui.toast("当前网络不好请重试");
															mui("#upload")[0].innerHTML = "";
														}
													});
												} else if(Spagenum == data.data.totalPages + 1) { //当前页不小于等于总页数时请求下一页
													//mui.toast('没有更多了');
												}
											} 
									}
								});
								

							}else{
								mui.toast('当前网络不好,请重试');
							}
						},
						error: function(xhr, type, errorThrown) {
							console.error('交友列表,响应失败');
							mui.toast('当前网络不好,请重试');
						}
					});
				})
			}
		</script>
		<script type="text/javascript">
			//顶部栏目跳转
			$('.goFeriend').click(function(){
				openview({
					view:'socialCircle/make_friends.html'
				})
			})
			$('.goCircle').click(function(){
				openview({
					view:'socialCircle/circleAll.html'
				})
			})
			$('.goAround').click(function(){
				openview({
					view:'socialCircle/around.html'
				})
			})
			$('.goHot').click(function(){
				openview({
					view:'socialCircle/ranking.html'
				})
			})
			
			//操作表
			$('.goanswer').click(function(){
				event.stopPropagation();
 			 	mui('#sheet1').popover('toggle'); 
			})
			
			$('.jubao a').click(function(){
				event.preventDefault();
				event.stopPropagation(); 
			})
			 
 			 $(".mui-backdrop").unbind()
 			//关注
 			$('.lovePic').click(function(){
				event.stopPropagation()
				if($(this).attr('src') == '../img/mainHtml/weizan.png'){
					$(this).attr('src','../img/mainHtml/yizan.png')
					mui.toast('点赞成功')
				}else if($(this).attr('src') == '../img/mainHtml/yizan.png'){
					$(this).attr('src','../img/mainHtml/weizan.png') 
				}
			})
 			//动态详情
 			function DTdetail(id){
 				openview({
 					view:'socialCircle/circleListInfo.html',
 					extrasobj: {
						infoid: id,
					}
 				})
 			}
 			
 			//更多热门
 			$('#todayHOt').click(function(){
 				openview({
 					view:'socialCircle/make_friends.html'
 				})
 			})
 			$('.paddDiv').click(function(){
 				openview({
 					view:'socialCircle/elsecircleIndex.html'
 				})
 			})
		</script>
	</body>

</html>