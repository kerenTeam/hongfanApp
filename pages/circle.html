<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>HI友圈</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />   
		<link rel="stylesheet" type="text/css" href="../css/common.css"> 
		<link rel="stylesheet" type="text/css" href="../css/mui.css"/> 
		<link rel="stylesheet" type="text/css" href="../css/config.css"/> 
		<script src="../js/app.js"></script>

	</head>
	<style type="text/css">
		.felsr{display: flex;justify-content: space-around;align-items: center;background-color: white;padding: 10px 0;text-align: center;position: relative;}
		.felsr:after{position:absolute;content:'';height:1px;left:10px;right:10px;-webkit-transform:scaleY(.3);background:#CACACA;bottom:0}
		.felsr img{width: 40px;display: block;margin: auto;}
		.todayHOt{padding: 10px;}
		.ftr{display: flex;justify-content: space-between;align-items: center;}
		.ftr img{width: 10px;}
		.hiFriend .bigPic{display: block;}
		.avaPic{width: 20px;height:20px;border-radius: 30px;vertical-align: middle;}
		.footFirend{height:26px;line-height: 28px;color: #666;font-size: 13px;}
		.lovePic{width: 18px;height:16px;float: right;margin-top: 6px;}
		.hiFriend{padding: 5px;}
		.paddDiv{padding: 5px;}
		.bigPic{width: 6em;height: 6em;border-radius: 3px;}
		.mui-row{padding-top: 5px;}
		.QAhead{background-color:#f3f3f3;text-align:center;}
		.QAhead span{position:relative;display:inline-block;margin:0 10px;padding:0 15px;height:38px;color:#343434;font-size:15px;line-height:38px}
		.QAhead span.active{color:#f93a38}
		.QAhead span:after{position:absolute;bottom:0;left:50%;width:0;height:1px;background-color:#f31414;content:""}
		.QAhead span.active:after{left:0!important;width:100%!important;transition:all .3s}
		.listCon{border-bottom: 15px solid #F3F3F3;}
		.listCon p{padding:10px 0 0}
		.follow{position:relative;}
		.follow{background-color:#fff;padding:15px 10px;}
		.follow:after{position:absolute;right:5px;bottom:0;left:5px;height:1px;background:#cacaca;content:'';-webkit-transform:scaleY(.3);}
		.follow:last-child:after{height:0;}
		.fchidl{display:flex;align-items:center;justify-content:space-between;}
		.Avator,.userAvator{margin-right:15px;width:2.5rem;height:2.5rem;}
		.userAvator{border-radius:50%;}
		.fchidl>div{display:flex;vertical-align:middle;text-align:left;font-size:15px;align-items:center;justify-content: flex-end;}
		.text{color:#999;}
  		.flexrr{display: flex;justify-content: space-around;align-items: center;padding: 10px 0;}
  		.flexrr>div img{width: 25px;vertical-align: middle;}
  		.cmtall img{width: 25px;margin-right: 5px;}
  		.cmtflex{display: flex;justify-content: space-between;align-items: center;}
  		.ctc{font-size: 12px!important;}
  		.ctc span{color: #fb7e23;}
  		.jubao{background-color: white;bottom: 0!important;position: absolute;right: 0;left: 0;} 
		.jubao li a{padding: 18px;line-height: 15px;text-align: center;border-bottom: 1px solid #EEEEEE;display: block;color: black;}
		.jubao li:last-child a{color: rgb(153,153,153);}
		/*.QandA{min-height: 720px;}*/
		#upload{min-height: auto !important;padding-top: 5px;height: 37px;}
		#upload img{padding: 0 !important;margin: 0;width: 32px;}
		body{padding-bottom: 0;}
		.loadPics{max-width: 80%;}
		.DTcontent{overflow: hidden;}
		.dynamicPic{float: left;position: relative;overflow: hidden;border-right: 2px solid #fff;}
		.dynamicPic1{width: 70%;padding-top: 68%;}
		.dynamicPic2{width: 50%;padding-top: 48%;}
		.dynamicPic3{width: 33%;padding-top: 31%;}
		.dynamicPic img{width: 100%;}
		.dynamicPic span{display: inline-block;position: absolute;top: 2%;left: 2%;width: 96%;height: 96%;background-color: #F3F3F3;overflow: hidden;}
		.line2{text-overflow: ellipsis;overflow: hidden;white-space: nowrap;max-width: calc(100vw * 0.45);}	
		.maxwn{white-space: nowrap;}	
		.maxwt{flex-basis: 50px;white-space: nowrap;text-align: right;}
		#maskInfo{z-index:99999;position:fixed;top:0;left:0;width:100%;bottom:0;background-color:rgba(0,0,0,.5)}	
	 	.hiFdW{width: calc((100vw - 40px) / 3);width: -webkit-calc((100vw - 40px) / 3);width: -moz-calc((100vw - 40px) / 3);height: -moz-calc((100vw - 40px) / 3);height: -webkit-calc((100vw - 40px) / 3);height: calc((100vw - 40px) / 3);background: #f3f3f3;border-radius: 3px;overflow: hidden;}
		.hiFdW img{width: 100%;}
	</style>
	<body style="background-color: white;">
		<header class="mui-bar mui-bar-nav">
		    <h1 class="mui-title">HI友圈</h1>
		</header>
		<script src="../js/statusBar.js"></script><!--状态栏-->
		<div id="main">	
			<!--分类-->
			<div class="felsr ft12">
				<div class="goFeriend">
					<img src="../img/makeFriend/friend.png"/>
					<span>交友</span>
				</div>
				<div class="goCircle">
					<img src="../img/makeFriend/circle.png"/>
					<span>圈子</span>
				</div>
				<div class="goAround">
					<img src="../img/makeFriend/around.png"/>
					<span>附近</span>
				</div>
				<div class="goHot">
					<img src="../img/makeFriend/hotborad.png"/>
					<span>人气榜</span>
				</div>
			</div>
			
			<!--今日热门-->
			<div class="todayHOt" style="background-color: white;">
				<div class="ftr" id="todayHOt">
					<span class="ft14">今日热门</span>
					<img src="../img/localLife/righticon.png"/>
				</div>
				<div id="circleContain">
					<div class="mui-row">
						<div class="mui-col-sm-4 mui-col-xs-4 paddDiv">
				            <div class="hiFdW">
				            </div> 
				        </div>
				        <div class="mui-col-sm-4 mui-col-xs-4 paddDiv">
				            <div class="hiFdW">
				            </div> 
				        </div>
				        <div class="mui-col-sm-4 mui-col-xs-4 paddDiv">
				            <div class="hiFdW">
				            </div> 
				        </div>
			       </div>
				</div>
			    <script type="text/html" id="listDataH">
			    	<div class="mui-row">
						<%for(var i=0;i<dataList.length;i++){%>
							<div class="mui-col-sm-4 mui-col-xs-4 paddDiv" onclick="elseCircleIndex(<%=dataList[i].user_id%>)">
					            <div class="hiFdW">
					            	<%if(dataList[i].picS){%>
					            		<img class="bigPic loadPics picOp" onload="imgHeight(this)" data-src="<%=dataList[i].picS[0]%>"/>
					            	<%}else{%>
					            		<img class="bigPic loadPics picOp" onload="imgHeight(this)" data-src="<%=dataList[i].avatar%>"/>
					            	<%}%>

					            </div>
					            <p class="footFirend">
					            <img class="avaPic loadPics picOp" data-src="<%=dataList[i].avatar%>" />
					            	<%=dataList[i].nickname%>
					            	<%if(dataList[i].isfriend){%>
					            		<img class="lovePic" src="../img/mainHtml/yizan.png"/>
					            	<%}else{%>
					            		<img class="lovePic" src="../img/mainHtml/weizan.png"/>
					            	<%}%> 
					            </p>
					        </div>
						<%}%> 
				    </div> 
			    </script>
			</div>
			<!--今日热门结束-->
			
			<!--动态-->
			<div class="QandA">
				<div class="QAhead" style="position: -webkit-sticky; position:sticky; top: 70px;z-index: 99;display: block;width: 100%;">
					<span class="active aClick">最新动态</span> 
					<span class="aClick">好友动态</span> 
				</div>
				
				<div class="dyCon" id="dyCon0" style="display: none;"></div><!--最新动态-->
				<div class="dyCon" id="dyCon1" style="display: none;"></div><!--好友动态-->

				<script type="text/html" id="listDataS">
					<%for(var i=0;i<dataList.length;i++){%>
						<%if(dataList[i].user_id && dataList[i].user_id != 'null' && dataList[i].id){%>
							<div class="listCon">
								<div class="follow">
									<div class="fchidl">
										<div onclick="elseCircleIndex(<%=dataList[i].user_id%>)">
											<img data-src="<%=dataList[i].avatar%>" src="../img/morentouxiang.jpg" class="userAvator mr25 loadPics"/>
											<div>
												<%=dataList[i].nickname%> <div class="disablecl ft12"> <%=dataList[i].create_time%>  <span style="color: #5d86b2;"><%=dataList[i].read%></span>阅读 </div>
											</div>
										</div>
										<div class="butright">
											<div class="goanswer"> <img src="../img/makeFriend/down.png" style="width:15px;"/> </div>
							           </div>
									</div>
									<div class="DTcontent" onclick="DTdetail(<%=dataList[i].id%>,<%=dataList[i].user_id%>)">
										<p  class="ft14 maincl overTwo"><%=dataList[i].content%> </p><!--文字内容-->
										<%if(dataList[i].picS){%>
											<%for(var j=0;j<dataList[i].picS.length;j++){%>
												<%if(dataList[i].picS.length == 1){ %>
													<div class="dynamicPic dynamicPic1">
														<span><img onload="imgHeight(this)" class="loadPics picOp" data-src="<%=dataList[i].picS[j]%>" /></span>
													</div>
												<%}else if(dataList[i].picS.length == 2){%>
													<div class="dynamicPic dynamicPic2">
														<span><img onload="imgHeight(this)" class="loadPics picOp" data-src="<%=dataList[i].picS[j]%>" /></span>
													</div> 
												<%}else{%>
													<div class="dynamicPic dynamicPic3">
														<span><img onload="imgHeight(this)" class="loadPics picOp" data-src="<%=dataList[i].picS[j]%>" /></span>
													</div>
												<%}%>	
											<%}%>
										<%}%>	
										
									</div>
									<div class="flexrr">
										<div class="disablecl ft12" >
											<%if(dataList[i].likeUserId){%>
												<img src="../img/makeFriend/yizan.png" onclick="goZan(this,<%=dataList[i].id%>,<%=dataList[i].user_id%>)"/>
												<%}else{%>
													<img src="../img/makeFriend/zan.png" onclick="goZan(this,<%=dataList[i].id%>,<%=dataList[i].user_id%>)"/>
													<%}%>
											 
											 赞<span><%=dataList[i].likes%></span> </div> 
										<div class="disablecl ft12" onclick="goInfoCmt(<%=dataList[i].id%>,<%=dataList[i].user_id%>)"> <img src="../img/makeFriend/message.png" alt="" /> 评论 </div>
										<div class="disablecl ft12"> <img src="../img/makeFriend/share.png"/> 转发 </div>
									</div>
									
									<div class="commentsShow" data-id="<%=dataList[i].id%>"></div>
									 
								</div> 
							</div>
							<%}%>
						
					<%}%>	
				</script>
				
				<!--评论模板-->
				<script type="text/html" id="cmtTpl">
					<div class="cmtflex" style="border-top:1px solid #DDDDDD ;border-bottom: 1px solid #DDDDDD;padding: 10px 5px;"><!--评论-->
						<div style="text-align: center;line-height: 0.8;"> 
							<div class="ft14">评论</div>
							<img style="width: 30px;margin: 0;" src="../img/makeFriend/cmt.png"/>
						</div>
						<div class="cmtflex cmtall ft12">
							<img src="../img/makeFriend/more.png"/>
							评论<%=allL%>
						</div>
					</div>
					<%for(var i=0;i<list.length;i++){%>
						<%if(!list[i].commontid){%>
							<div class="follow ft12" style="padding: 5px;"> 
								<div class="fchidl">
									<div class="ctc"> <span data-id="<%=list[i].user_id%>" class="ft12 maxwn"><%=list[i].nickname%></span>：<div class="line2"><%=list[i].commont%></div></div> 
									<div class="butright maxwt"> <div class="disablecl ft12"> <%=list[i].create_time%> </div> </div> 
								</div>
							</div>
							<%}else{%>
								<div class="follow ft12" style="padding: 5px;"> 
									<div class="fchidl">
										<div class="ctc"> <span data-id="<%=list[i].user_id%>" class="ft12 maxwn"><%=list[i].nickname%></span>回复<span data-id="<%=list[i].touserid%>"class="ft12"><%=list[i].TO_nickname%></span>:<div class="line2"><%=list[i].commont%></div></div> 
										<div class="butright maxwt"> <div class="disablecl ft12"> <%=list[i].create_time%> </div> </div> 
									</div>
								</div> 
								<%}%>
						<%}%>
				
				
				</script>
				<div class="upload text-center text-xs gray" id="upload"><img src='../img/balls.svg' /></div>
			</div>
			<!--动态结束-->
			
			
			<!--操作表-->
			<div id="maskInfo" style="display: none;">
			    <!-- 可选择菜单 -->
			    <ul class="jubao">
			      <li>
			        <a href="#">加入黑名单</a>
			      </li>
			      <li>
			        <a href="#">举报</a>
			      </li>
			      <li>
			        <a href="javscript:;" class="closeMask" >取消</a>
			      </li>
			    </ul>
			</div>
			
			<!--发布-->
			<style type="text/css">
				.fabu1{position: fixed;bottom: 15px;right: 12px;width: 50px;height: 50px;background-color: #fff;border-radius: 50%;opacity: 1;}
				.fabu2{position: fixed;bottom: 40px;right: 37px;width: 0px;height: 0px;background-color: #fff;border-radius: 50%;opacity: 0;}
				#fabu img{width: 100%;height: 100%;}
				#fabu{transition: opacity .5s;}
			</style>
			<div id="fabu" class="fabu1">
				<img src="../img/makeFriend/fabu.svg"/>
			</div>
		</div>
		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/artTemplate-native.js"></script>
		<script type="text/javascript">
//			//打开他人主页

			
		</script>
		<script type="text/javascript">
			
			/*动态tab切换*/
			var flag0 = 0,flag1 = 0,//是否   第一次点击
		     	SH0 = 0,SH1  = 0;/*保存的状态栏高度*/
			var listCon = document.getElementsByClassName('QAhead')[0].getElementsByTagName('span');/*按钮*/
			var dyCon = document.getElementsByClassName('dyCon'); /*内容盒子*/
			[].forEach.call(listCon,function(ele,index){
				ele.onclick = function(){
					if(!ele.className.includes('active')){
						[].forEach.call(listCon,function(ele2){
							ele2.className = '';
						})
						ele.className = 'active aClick';
						
						[].forEach.call(dyCon,function(ele3){
							ele3.style.display = 'none';
						})
						dyCon[index].style.display = 'block';
						
						if(index == 0){
							if(flag0==0){
								shopData(index,0);
							}else{
								$(window).scrollTop(SH0);
							}
						}else if(index == 1){
							if(plus.storage.getItem('myToken')){
								if(flag1==0){
									shopData(index,1);
								}else{
									$(window).scrollTop(SH1);
								}
							}else{
								mui.toast('请登录');
								openview({
									view:'login.html'
								});
							}
							
						}
					}else{//点击active项    就刷新
						$(window).scrollTop(280);
						if(index == 0){
							flag0 = 0,SH0 = 0;
							shopData(index,0,true);
						}else if(index == 1){
							flag01 = 0,SH1 = 0;
							shopData(index,1,true);
						}					
					}
				}
			})
			document.addEventListener('refresh', function() {
				[].forEach.call(listCon,function(ele2){
					ele2.className = '';
				})
				listCon[0].className = 'active aClick';
				
				[].forEach.call(dyCon,function(ele3){
					ele3.style.display = 'none';
				})
				dyCon[0].style.display = 'block';
				shopData(0,0,false);//默认推荐
			})
			/*打开主页,包括判断 他人 或 个人 主页*/
			window.openDetail = function(id){
				mui.plusReady(function(){
					var myuserid = plus.storage.getItem('userid');
					if(plus.storage.getItem('myToken')){
					if(id == myuserid){
						openview({
				    		view:'socialCircle/mycircleIndex.html',
				    		id:'mycircleIndex' 
				    	})
						}else{
							openview({
					    		view:'socialCircle/elsecircleIndex.html',
					    		id:'elsecircleIndex',
					    		extrasobj:{userId:id}
					    	})
						} 
					}else{
						mui.toast('请登录');
						openview({
							view:'login.html'
						});
					}
				})
		    }
			/*铺数据*/
			
			
			todayHot();
			shopData(0,0,false);//默认推荐
			dyCon[0].style.display = 'block';
			//今日热门
			function todayHot(){
				mui.plusReady(function(){
					var cityNum = plus.storage.getItem('cityNum'),
					oldToken = plus.storage.getItem('oldToken');
					var myuserid = plus.storage.getItem('userid');
					window.elseCircleIndex = function(id){
						if(plus.storage.getItem('myToken')){
							if(id == myuserid){
								openview({
						    		view:'socialCircle/mycircleIndex.html',
						    		id:'mycircleIndex' 
						    	})
							}else{
								openview({
						    		view:'socialCircle/elsecircleIndex.html',
						    		id:'elsecircleIndex',
						    		extrasobj:{userId:id}
						    	})
							} 
						}else{
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						} 
				    }
					mui.ajax(serverUrl+'/api/friends/hot', {
						data:{numsPerPage:3,time:24},
						dataType: 'json',
						type: 'post',
						timeout: 8000,
						headers: {"token": oldToken,'city': cityNum},
						success: function(data, type, xhr) {
							console.log('remen ',data)
							if(data.errno == 0) { 
								if(data.data && data.data.length){
									var dataObj = {};
									for(var i = 0 ;i<data.data.length;i++){
										if(data.data[i].avatar){//整理头像格式
											if(data.data[i].avatar.indexOf("[")>-1){
												if(data.data[i].avatar.includes('http')){
													data.data[i].avatar =  JSON.parse(data.data[i].avatar)[0].picImg;
												}else{
													data.data[i].avatar = serverimgUrl + JSON.parse(data.data[i].avatar)[0].picImg;
												}
											}
										}else{
											data.data[i].avatar = '../img/morentouxiang.jpg';
										}
									 	
									 	if(data.data[i].photo && data.data[i].photo.length){//整理内容图片格式
									 		var nowArray2 = data.data[i].photo;
									 		var picS = [];
									 		for(var k = 0 ;k<nowArray2.length;k++){
									 			if(nowArray2[k].picImg.includes('picImg')){
									 				picS.push(JSON.parse(nowArray2[k].picImg)[0].picImg);
									 			}
											}
									 		data.data[i].picS = picS;
									 	}
										
									} 
									dataObj.dataList = data.data; 
									document.getElementById("circleContain").innerHTML = template("listDataH", dataObj);
									
									lazyLoad(true,10);//懒加载	
								}else{
									document.getElementById("circleContain").innerHTML ='<div style="text-align: center;font-size: 13px;">暂无数据</div>';
								}
								 
							}else{
								mui.toast('当前网络不好,请重试');
							}
						},
						error: function(xhr, type, errorThrown) {
							console.error('交友列表,响应失败');
							mui.toast('当前网络不好,请重试');
						}
					});
				})
			}
			
			function shopData(typeNum,gender,refresh){
				var Spagenum = 2; //实到页数
				var Ypagenum = 1; //应到页数
				if(refresh){
					document.getElementById('upload').innerHTML = "<img src='../img/balls.svg' />";
					document.getElementsByClassName("dyCon")[typeNum].innerHTML = '';
				}
				if(typeNum == 0){
					flag0++;
					if(flag0 == 2){
						$(window).scrollTop(280);
					}
				}else if(typeNum == 1){
					flag1++;
					if(flag1 == 1){
						$(window).scrollTop(280);
					}
				}
				mui("#upload")[0].innerHTML = "<img src='../img/balls.svg' />";
				mui.plusReady(function(){
					var myuserid = plus.storage.getItem('userid');
					//到主页
					window.elseCircleIndex = function(id){
						if(plus.storage.getItem('myToken')){
							if(id == myuserid){
								openview({
						    		view:'socialCircle/mycircleIndex.html',
						    		id:'mycircleIndex' 
						    	})
							}else{
								openview({
						    		view:'socialCircle/elsecircleIndex.html',
						    		id:'elsecircleIndex',
						    		extrasobj:{userId:id}
						    	})
							} 
						}else{
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						} 
				    }
					
					window.goZan = function(obj,id,toUserId){ 
						if(plus.storage.getItem('myToken')){
							var curThis = $(obj); 
							var likes = parseInt(curThis.siblings('span').html());
							
							if(curThis.attr('src') == '../img/makeFriend/zan.png'){
								likes = likes+1; 
								curThis.siblings('span').html(likes);
								likeThis(curThis,id,toUserId,cityNum,myuserid,oldToken,'POST','../img/makeFriend/yizan.png');
							}else{ 
								likes = likes-1; 
								curThis.siblings('span').html(likes);
								likeThis(curThis,id,toUserId,cityNum,myuserid,oldToken,'delete','../img/makeFriend/zan.png'); 
							}
						}else{
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
						
					}
					
					if(typeNum == 0){
						var dataJson = {
							'numsPerPage':6,
							'currentPage':1,
							'orderType':'DESC',
							'orderField':'create_time',
							'typeId':1
						}
					}else if(typeNum == 1){
						var dataJson = {
							'userId':myuserid,
							'numsPerPage':6,
							'currentPage':1,
							'orderType':'DESC',
							'orderField':'create_time',
							'isFriends':1,
							'typeId':1
						}
					}
					var cityNum = plus.storage.getItem('cityNum'),oldToken = plus.storage.getItem('oldToken');
					mui.ajax(serverUrl + '/api/friends/newslist', {
						data: dataJson,
						dataType: 'json',
						type: 'post',
						timeout: 8000,
						headers: {"token": oldToken,'city': cityNum},
						success: function(data, type, xhr) {
							console.error('交友列表'+typeNum, data);
							if(data.errno == 0) {
								var dataObj = {};
								var nowArray = data.data.data;

								for(var j = 0 ;j<nowArray.length;j++){
									//整理头像格式
									if(nowArray[j].avatar && nowArray[j].avatar!='null'){
										if(JSON.parse(nowArray[j].avatar)[0].picImg.indexOf('http') == -1){
											nowArray[j].avatar = serverimgUrl + JSON.parse(nowArray[j].avatar)[0].picImg;
										}else{
											nowArray[j].avatar = JSON.parse(nowArray[j].avatar)[0].picImg
										}
									}else{
										nowArray[j].avatar = '../img/10.png'
									}
									
									if(!nowArray[j].nickname){
										nowArray[j].nickname = '匿名'
									}
									if(!nowArray[j].read){
										nowArray[j].read = 0
									}else if((nowArray[j].read / 1000)>1){
										nowArray[j].read = parseInt(nowArray[j].read / 1000) +'K+'
									}
									if(!nowArray[j].likes){
										nowArray[j].likes = 0
									}
//									else if((nowArray[j].likes / 1000)>1){
//										nowArray[j].likes = parseInt(nowArray[j].likes / 1000) +'K+'
//									}
									var dt = new Date(nowArray[j].create_time).getTime(); 
									nowArray[j].create_time = getDateDiff(dt);
									//整理内容图片格式
 									var nowArray2 = JSON.parse(nowArray[j].pic);
									if(nowArray2.length){
										var picS = [];
										for(var k = 0 ;k<nowArray2.length;k++){
											picS.push(nowArray2[k].picImg);
										}
										nowArray[j].picS = picS;
									}
								}
								
								dataObj.dataList = data.data.data;
								document.getElementsByClassName("dyCon")[typeNum].innerHTML = template("listDataS", dataObj);
								mui("#upload")[0].innerHTML = "";
								
								lazyLoad(true,10);

								$(window).scroll(function() {
									if(document.getElementsByClassName("dyCon")[typeNum].style.display == 'block'){//判断是否是 当前显示的盒子
											var scrollTop = $(this).scrollTop();　
											if(typeNum == 0){
												SH0 = $(this).scrollTop();
											}else if(typeNum == 1){
												SH1 = $(this).scrollTop();
											}
											var scrollHeight = $(document).height();
											var windowHeight = $(this).height();　　
											if(scrollTop + windowHeight == scrollHeight) {
												if(Spagenum <= data.data.totalPages && Spagenum == Ypagenum + 1) { //当前页小于等于总页数时请求下一页
													mui("#upload")[0].innerHTML = "<img src='../img/balls.svg' />";
													Ypagenum++; //满足加载情况,应到页数+1
													console.log('发起请求,实到' + Spagenum + '页');
													console.log('发起请求,应到' + Ypagenum + '页');
													if(typeNum == 0){
														var dataJson = {
															'numsPerPage':6,
															'currentPage':Spagenum,
															'orderType':'DESC',
															'orderField':'create_time',
															'typeId':1
														}
													}else if(typeNum == 1){
														var myuserid = plus.storage.getItem('userid');
														var dataJson = {
															'userId':myuserid,
															'numsPerPage':6,
															'currentPage':Spagenum,
															'orderType':'DESC',
															'orderField':'create_time',
															'isFriends':1,
															'typeId':1
														}
													}
													
													mui.ajax(serverUrl + '/api/friends/newslist', {
														data: dataJson,
														dataType: 'json',
														type: 'post',
														timeout: 8000,
														headers: {"token": oldToken,'city': cityNum},
														success: function(data) {
															console.error('交友列表续'+typeNum, data);
															if(data.errno == 0) {
																var dataObj = {};
																var nowArray = data.data.data;
																for(var j = 0 ;j<nowArray.length;j++){
																	//整理头像格式
																	if(nowArray[j].avatar && nowArray[j].avatar!='null'){
																		if(JSON.parse(nowArray[j].avatar)[0].picImg.indexOf('http') == -1){
																			nowArray[j].avatar = serverimgUrl + JSON.parse(nowArray[j].avatar)[0].picImg;
																		}else{
																			nowArray[j].avatar = JSON.parse(nowArray[j].avatar)[0].picImg
																		}
																	}else{
																		nowArray[j].avatar = '../img/10.png'
																	}
																	
																	if(!nowArray[j].nickname){
																		nowArray[j].nickname = '匿名'
																	}
																	if(!nowArray[j].read){
																		nowArray[j].read = 0
																	}else if((nowArray[j].read / 1000)>1){
																		nowArray[j].read = parseInt(nowArray[j].read / 1000) +'K+'
																	}
																	if(!nowArray[j].likes){
																		nowArray[j].likes = 0
																	}
																	var dt = new Date(nowArray[j].create_time).getTime(); 
																	nowArray[j].create_time = getDateDiff(dt);
																	/*整理内容图片格式*/
																	var nowArray2 = JSON.parse(nowArray[j].pic);
																	if(nowArray2.length){
																		var picS = [];
																		for(var k = 0 ;k<nowArray2.length;k++){
																			picS.push(nowArray2[k].picImg);
																		}
																		nowArray[j].picS = picS;
																	}
																}
																dataObj.dataList = data.data.data;
																document.getElementsByClassName("dyCon")[typeNum].innerHTML += template("listDataS", dataObj);
																lazyLoad(false,10);//懒加载
															}
															mui("#upload")[0].innerHTML = " ";
															Spagenum++; //加载成功,当前页+1
															console.log('成功+1,实到' + Spagenum);
															console.log('成功+1,应到' + Spagenum);
														},
														error: function(xhr, type, errorThrown) {
															Ypagenum--; //失败是应到-1
															mui.toast("当前网络不好请重试");
															mui("#upload")[0].innerHTML = "";
														}
													});
												} else if(Spagenum == data.data.totalPages + 1) { //当前页不小于等于总页数时请求下一页
													//mui.toast('没有更多了');
												}
											} 
									}
								});
								
								//操作表
								$('.goanswer').click(function(){
									event.stopPropagation();
									$('#maskInfo').fadeIn(200); 
								})
								 
								$('#maskInfo li').click(function(){
									event.stopPropagation()
								})
								$('#maskInfo,.closeMask').click(function(){
									event.preventDefault()
									$('#maskInfo').fadeOut(200);
								})
								 
								//评论数据
								$('.commentsShow').each(function(){
									var newsId= $(this).attr('data-id');
									var curShow = $(this);
									mui.ajax(serverUrl + '/api/friends/newscomment/newsId/'+newsId, {
										dataType: 'json',
										type: 'get',
										timeout: 8000,
										headers: {"token": oldToken,'city': cityNum},
										success: function(data, type, xhr) {
											//console.error('评论详情', data);
											 
											if(data.errno == 0) {
												var cmtArray = data.data;
												var newCmt = []
												if(cmtArray && cmtArray.length>0){
													if(cmtArray.length >3){
														for(var i = 0;i<3;i++){
															if(!cmtArray[i].nickname){ 
																cmtArray[i].nickname =  '匿名'
															}
															if(!cmtArray[i].TO_nickname){ 
																cmtArray[i].TO_nickname =  '匿名'
															}
															var dt = new Date(cmtArray[i].create_time).getTime(); 
															cmtArray[i].create_time = getDateDiff(dt);
															newCmt.push(cmtArray[i])
														} 
													}else{
														for(var i = 0;i<cmtArray.length;i++){
															if(!cmtArray[i].nickname){ 
																cmtArray[i].nickname =  '匿名'
															}
															if(!cmtArray[i].TO_nickname){ 
																cmtArray[i].TO_nickname =  '匿名'
															}
															var dt = new Date(cmtArray[i].create_time).getTime(); 
															cmtArray[i].create_time = getDateDiff(dt);
															newCmt.push(cmtArray[i])
														} 
													}
													
													curShow.html(template('cmtTpl',{list:newCmt,allL:cmtArray.length}))
												}
												
											 
											}else{
												mui.toast('当前网络不好,请重试');
											}
										},
										error: function(xhr, type, errorThrown) {
											console.error('评论列表,响应失败');
											mui.toast('当前网络不好,请重试');
										}
									});
								}) 
								 
							}else{
								mui.toast('当前网络不好,请重试');
							}
						},
						error: function(xhr, type, errorThrown) {
							console.error('交友列表,响应失败');
							mui.toast('当前网络不好,请重试');
						}
					});
					
				})
			}
			
			//发布时间判断 
			var minute = 1000 * 60;
			var hour = minute * 60;
			var day = hour * 24;
			var halfamonth = day * 15;
			var month = day * 30;
			function getDateDiff(dateTimeStamp){ 
				var now = new Date().getTime(); 
				var diffValue = now - dateTimeStamp; 
				var monthC =diffValue/month;
				var weekC =diffValue/(7*day);
				var dayC =diffValue/day;
				var hourC =diffValue/hour;
				var minC =diffValue/minute;
				if(monthC>=1){
				 result=parseInt(monthC) + "月前";
				 }
				 else if(weekC>=1){
				 result=parseInt(weekC) + "周前";
				 }
				 else if(dayC>=1){
				 result=parseInt(dayC) +"天前";
				 }
				 else if(hourC>=1){
				 result=parseInt(hourC) +"小时前";
				 }
				 else if(minC>=1){
				 result=parseInt(minC) +"分钟前";
				 }else{ 
				 result="刚刚";
				 }
				return result;
			}
		</script>
		<script type="text/javascript">
			//顶部栏目跳转
			$('.goFeriend').click(function(){
				openview({
					view:'socialCircle/make_friends.html'
				})
			})
			$('.goCircle').click(function(){
				openview({
					view:'socialCircle/circleAll.html',
					id:'circleAll'
				})
			})
			$('.goAround').click(function(){
				openview({
					view:'socialCircle/around.html'
				})
			})
			$('.goHot').click(function(){
				openview({
					view:'socialCircle/ranking.html'
				})
			})
			 
			$('.jubao a').click(function(){
				event.preventDefault();
				event.stopPropagation(); 
			})
			 
 			 $(".mui-backdrop").unbind()
 			 
 			//更多热门
 			$('#todayHOt').click(function(){
 				openview({
 					view:'socialCircle/make_friends.html'
 				})
 			})
 			$('.paddDiv').click(function(){
 				openview({
 					view:'socialCircle/elsecircleIndex.html'
 				})
 			})
 			
 			
 			//动态详情1
 			function DTdetail(id,userid){
 				openview({
 					view:'socialCircle/circleListInfo.html',
 					extrasobj:{
						infoid: id,
						UserId:userid,
					}
 				})
 			}
 			//动态详情2
 			function goInfoCmt(id,userid){
 				openview({
 					view:'socialCircle/circleListInfo.html',
 					extrasobj: {
						infoid: id,
						UserId:userid,
						isCmt:true,
					}
 				})
 			}
 			/*滑动显示发布按钮*/
			var fangxiang;
			function scroll(fn) {
				var beforeScrollTop = document.body.scrollTop,
					fn = fn || function() {};
				window.addEventListener("scroll", function() {
					var afterScrollTop = document.body.scrollTop,
						delta = afterScrollTop - beforeScrollTop;
					if(delta === 0) return false;
					fn(delta > 0 ? "down" : "up");
					beforeScrollTop = afterScrollTop;
				}, false);
			}
			scroll(function(direction) {
				fangxiang = direction;
			});
		
			$(window).scroll(function() {
				if(fangxiang == 'up') {
					document.getElementById('fabu').className = 'fabu1';
				}else{
					document.getElementById('fabu').className = 'fabu2';
				}
			})
			$('#fabu').click(function(){
				if(plus.storage.getItem('myToken')){
					openview({
						view:'socialCircle/circlePublish.html',
						id:'circlePublish' 
					})
				}else{
					mui.toast('请登录');
					openview({
						view:'login.html'
					});
				} 
				
			})

		</script>
	</body>

</html>