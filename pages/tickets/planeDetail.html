<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>机票详情</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<!--<script type="text/javascript" src="../../js/jquery.flexslider-min.js"></script>-->
		<script src=" ../../js/hmt.js" type="text/javascript"></script>
		<script src="../../js/other.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/app.js" type="text/javascript" ></script>
		
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js" type="text/javascript" ></script>
		<style type="text/css">
			.mui-bar{
				height: 50px;
				box-shadow: none;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			#main{
				margin-top: 50px;
			}
			.guess-like,dl.list{
				border-bottom: 1px solid #eee;
				background-color: #fff;
			}
			.right{
				text-align: right;
			}
			.middle{
				text-align: center;
			}
			.strong-color{
				color: #f53c42 !important;
			}
			.Lgray{
				font-size: 12px !important;
				color: #999 !important;
				margin-top: 14px;
			}
			.mui-badge-blue, .mui-badge-primary{
				background-color: #fff;
				border: 1px solid #999;
				color: #999 !important;
			}
			
			.moreone{
				line-height: 50px;
			}
			dl.list .db>.react{
				padding: 0;
				margin: 0;
			}
			dl.list .db{
				height: 50px;
			}
			.grade-eject>ul>li, .Category-eject>ul>li, .Sort-eject>ul>li{
				line-height: 40px;
			}
			
			/*这一页*/
			.timeBox{
				position: relative;
			}
			.timeBox p{
				font-size: 24px;
				color: #333;
				line-height: 22px;
			}
			.timeBox .ad{
				font-size: 12px;
				color: #999;
				font-weight: normal;
				line-height: 24px;
			}
			.timeBox .bage{
				position: absolute;
				font-size: 12px;
				line-height: 10px;
				right: 15px;
				top: 10px;
				color: #666;
			}
			.price{
				text-align: right;
				font-size: 24px;
				color: #f53c42;
			}
			.airTip p{
				text-align: right;
				line-height: 40px !important;
			}
			.Achange {
				color: #333;
			}
			.Achange span{
				color: #ff5601;
				font-size: 14px !important;
			}
			.inputWrap{
				border: none;
				border-radius: 3px;
				color: #666;
				line-height: 50px;
				background-color: rgba(255,255,255,0.8);
				margin: 10px 0;
			}
			.ad img{
				width: 15%;
				margin-top: -3px;
			}
			.dot{
				background-color: #bfbfbf;
				width: 5px;
				height: 5px;
				padding: 4px;
				margin: 0 5px;
				border-radius: 50%;
				display: inline-block;
			}
			.line{
				width: 3px;
				height: 12px;
				position: absolute;
				left: 8px;
				top: 42px;
				background-color: #ddd;
			}
			.guess-like{
				padding-top:50px;
			}
			.react >div{
				line-height: 40px !important;
			}
			.airTip button{
				margin-left: 15px !important;
				background-color: #f53c42;
				color: #fff;
				border: none;
				margin-top: 10px;
			}
			/*.hLeft{
				text-align: right;
				padding-top: 10px;
			}
			.hMiddle{
				text-align: center;
				padding-top: 10px;
			}
			.hRight{
				text-align: left;
				padding: 10px;
			}*/
			.hLeft{
				text-align: right;
			}
			.hMiddle{
				text-align: center;
			}
			.hRight{
				text-align: left;
			}
			.head{
				background-color: #dcd5d5;
			}
			.arrows{
				height: 20px;
			}
			.arrows img{
				width: 60%;
				height: 10px;
			}
			dl.list {
				border-top: none;
				margin-top: 0; 
			}
			.toLine{
				width: 60%;
				height: 1px;
				margin: 10px 20%;
				background-color: #000;
			}
			.Atips{
				text-align: center;
				padding: 0 0 30px 0;
				font-size: 12px;
			}
			.Atips li{
				display: inline-block !important;
				width: 100%;
			}
			.liCenter{
				border-left: 1px solid #666;
				border-right: 1px solid #666;
			}
			.discount{
				font-size: 12px;
				line-height: 14px;
				color: #666;
			}
			dl.list dt, dl.list dd{
				border-bottom: 1px solid #EFEFF4;
			}
			.order{
				float: right;
			}
			/*header样式*/
			/*.mui-bar-nav {
				background-color: #FFF !important;
			}
			.hasManyCitytwo .header-tit{
				color: #333;
			}
			.hasManyCitytwo .fanhui{
				color: #333;
			}*/
			.mui-bar-nav.mui-bar .mui-icon, .mui-title, #theSearch{margin: 0;}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">机票详情</h1>  
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="container">		
				<div class="guess-like">
					<div class="head" id="airBase"></div>
					<!--机票基本信息渲染-->
					<script type="text/html" id="airBase-detail">
						<p class="hMiddle black" style="line-height: 20px;padding-top: 10px;"><%=fromTime %></p>
						<div class="mui-row">
						    <div class="mui-col-sm-4 mui-col-xs-4 hLeft">
								<div class="timeBox">
									<p class="ad black"><%=adLi.orgCityName.split('(')[0] %></p>
									<p><%=adLi.depTime %></p>
									<p class="ad black"><%=adLi.orgCityName.replace("航站楼:","") %></p>
								</div>
					       	</div>
					        <div class="mui-col-sm-4 mui-col-xs-4 hMiddle">
					        	<div class="timeBox">
									<p class="ad black"><%=adLi.flightCompanyName %></p>
									<div class="toLine"></div>
									<p class="ad black"><%=adLi.flightNo %></p>
								</div>
					        </div>
					         <div class="mui-col-sm-4 mui-col-xs-4 hRight">
								<div class="timeBox">
									<p class="ad black"><%=adLi.dstCityName.split('(')[0] %></p>
									<p><%=adLi.arriTime %></p>
									<p class="ad black"><%=adLi.dstCityName.replace("航站楼:","") %></p>
								</div>
					       	</div>
						</div>
						<dl class="list" id="goodsList"></dl>
					</script>
					<!--具体舱位详情数据渲染-->
					<script type="text/html" id="goodsList-detail">
						<% for(var i = 0;i<airSeatsLi.length;i++){ %>
							<dd class="goodsItem">
								<a class="react mui-row">
									<div class="mui-col-sm-3 mui-col-xs-3">
										<p><span class="price"><sub>￥</sub><%=airSeatsLi[i].settlePrice %></span></p>
										<!--<p class="discount"><%=airSeatsLi[i].seatMsg %></p>-->
										<p class="discount" style="display: none;"><%=airSeatsLi[i].discount %>折</p>
							      </div>
							        <div class="mui-col-sm-9 mui-col-xs-9 airTip">
							        	<button onclick="planeOrder('<%=airSeatsLi[i].seatCode %>','<%=airSeatsLi[i].seatMsg %>','<%=airSeatsLi[i].settlePrice %>','<%=airSeatsLi[i].changeStipulate %>','<%=airSeatsLi[i].refundStipulate %>')" class="price order">订</button>
							        </div>
								</a>
							</dd>
						<% } %>
					</script>
				</div>
			</div>
	</body>
	<!--数据渲染-->
	<script type="text/javascript">
		mui.plusReady(function(){
			var fromPlace = plus.webview.currentWebview().fromPlace;
			var arrivePlace = plus.webview.currentWebview().arrivePlace;
			var fromTime = plus.webview.currentWebview().fromTime;
			var itemId = plus.webview.currentWebview().itemId;
			var flightCompanyCode = plus.webview.currentWebview().flightCompanyCode;
			var flightNo = plus.webview.currentWebview().flightNo;
			var oldToken = plus.storage.getItem('oldToken');
			//获取航线列表
			plus.nativeUI.showWaiting("加载中...",{width:'100px',height:'80px'});
			mui.ajax(serverUrl +'/api/qianmi/airlineslist',{
				data:{from:fromPlace,itemId:itemId,date:fromTime,to:arrivePlace},
				dataType:'json',
				type:'post',
				timeout:30000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
					
					//航线基本信息
					var objData = data.data.airlines_list_response.airlines.airline;
					for(var i = 0;i<objData.length;i++){
						//循环获取当前航班号
						if(objData[i].flightNo == flightNo){
							var adObj = {};
							adObj.adLi = objData[i];
							console.log('详情',objData[i]);
							adObj.fromTime = fromTime;
							var html = template('airBase-detail',adObj);
							document.getElementById('airBase').innerHTML = html;
							var adultAirportTax = adObj.adLi.adultAirportTax;//基建费
							var adultFuelTax = adObj.adLi.adultFuelTax//基建费
							var depTime = adObj.adLi.depTime//起飞时间
							var arriTime = adObj.adLi.arriTime//降落时间
							var orgCityName = adObj.adLi.orgCityName//起飞地点
							var dstCityName = adObj.adLi.dstCityName//降落地点
							var flightCompanyName = adObj.adLi.flightCompanyName//航空公司名字
							//航线具体舱位信息
							var airSeatsObj = {};
							airSeatsObj.airSeatsLi = objData[i].airSeats.airSeat;
							for(var j = 0;j<airSeatsObj.airSeatsLi.length;j++){
								airSeatsObj.airSeatsLi[j].discount = airSeatsObj.airSeatsLi[j].discount.toFixed(2)*10;
								airSeatsObj.airSeatsLi[j].discount = airSeatsObj.airSeatsLi[j].discount.toFixed(1);
							}
							
							var html2 = template('goodsList-detail',airSeatsObj);
							document.getElementById('goodsList').innerHTML = html2;
							
							plus.nativeUI.closeWaiting();
							
							//点击订票
							window.planeOrder = function(seatCode,seatMsg,settlePrice,changeStipulate,refundStipulate){
								openview({ 
									view:'planeOrder.html',
									//票价，改签规则，退票规则，航班号，公司编码，舱位号，舱位信息，起飞地点，目的地，时间，标准商品编号，
									extrasobj:{flightCompanyName:flightCompanyName,dstCityName:dstCityName,orgCityName:orgCityName,arriTime:arriTime,depTime:depTime,adultFuelTax:adultFuelTax,adultAirportTax:adultAirportTax,settlePrice:settlePrice,changeStipulate:changeStipulate,refundStipulate:refundStipulate,flightNo:flightNo,flightCompanyCode:flightCompanyCode,seatCode:seatCode,seatMsg:seatMsg,fromPlace:fromPlace,arrivePlace:arrivePlace,fromTime:fromTime,itemId:itemId}
								})
							}
						}
					}
				},
				error:function(xhr,type,errorThrown){
					console.log('响应失败  !');
					mui.toast('请求超时，请重试!');
					plus.webview.currentWebview().close();
				}
			});
		})
	</script>

</html>