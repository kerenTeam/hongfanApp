<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>机票订单</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<!--<script type="text/javascript" src="../../js/jquery.flexslider-min.js"></script>-->
		<!--<script src=" ../../js/hmt.js" type="text/javascript"></script>-->
		<!--<script src="../../js/other.js" type="text/javascript" charset="utf-8"></script>-->
		<script src="../../js/app.js" type="text/javascript" ></script>
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js" type="text/javascript" ></script>
		<style type="text/css">
			.mui-bar{
				height: 50px;
				box-shadow: none;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			#main{
				margin-top: 50px;
			}
			
			.guess-like,dl.list{
				border-bottom: 1px solid #eee;
				background-color: #EFEFF4;
			}
			.right{
				text-align: right;
			}
			.middle{
				text-align: center;
			}
			.strong-color{
				color: #f53c42 !important;
			}
			.Lgray{
				font-size: 12px !important;
				color: #999 !important;
				margin-top: 14px;
			}
			.mui-badge-blue, .mui-badge-primary{
				background-color: #fff;
				border: 1px solid #999;
				color: #999 !important;
			}
			
			.moreone{
				line-height: 50px;
			}
			dl.list .db>.react{
				padding: 0;
				margin: 0;
			}
			dl.list .db{
				height: 50px;
			}
			.grade-eject>ul>li, .Category-eject>ul>li, .Sort-eject>ul>li{
				line-height: 40px;
			}
			
			/*这一页*/
			.timeBox{
				position: relative;
			}
			.timeBox p{
				font-size: 24px;
				color: #333;
				line-height: 22px;
			}
			.timeBox .ad{
				font-size: 12px;
				color: #999;
				font-weight: normal;
				line-height: 24px;
			}
			.timeBox .bage{
				position: absolute;
				font-size: 12px;
				line-height: 10px;
				right: 15px;
				top: 10px;
				color: #666;
			}
			.price{
				text-align: right;
				font-size: 24px;
				color: #f53c42;
			}
			.airTip p{
				text-align: right;
				line-height: 40px !important;
			}
			.Achange {
				color: #333;
			}
			.Achange span{
				color: #ff5601;
				font-size: 14px !important;
			}
			.inputWrap{
				border: none;
				border-radius: 3px;
				color: #666;
				line-height: 50px;
				background-color: rgba(255,255,255,0.8);
				margin: 10px 0;
			}
			.ad img{
				width: 15%;
				margin-top: -3px;
			}
			.dot{
				background-color: #bfbfbf;
				width: 5px;
				height: 5px;
				padding: 4px;
				margin: 0 5px;
				border-radius: 50%;
				display: inline-block;
			}
			.line{
				width: 3px;
				height: 12px;
				position: absolute;
				left: 8px;
				top: 42px;
				background-color: #ddd;
			}
			.guess-like{
				padding-top:50px;
			}
			.react >div{
				line-height: 40px !important;
			}
			.airTip button{
				margin-left: 15px !important;
				background-color: #f53c42;
				color: #fff;
				border: none;
			}
			dl.list {
				border-top: none;
				margin-top: 4%; 
			}
			.react{
				padding: 0 .15rem !important;
			}
			dl.list dt, dl.list dd{
				background-color: #fff;
			}
			.lineL{
				border-left: 1px solid #DDD8CE;
			}
			.phone{
				border: none;
			}
			.title{
				font-size:16px;
				font-weight: bold;
			}
			.tiny{
				font-size: 12px;
				line-height: 14px;
				margin-top: -5px;
				margin-bottom: 10px;
			}
			.bo{
				color: #ffc900;
			}
			.addMan{
				background-color: #ffc900;
				border: none;
				color: #fff;
				margin-top: 10%;
				line-height: 24px;
				font-size: 15px;
				margin-left: 15%;
			}
			dl.list dt, dl.list dd{
				border-bottom: 1px solid #EFEFF4;
			}
			.delete{
				width: 90%;
				margin-top: 15px;
			}
			/*header样式*/
			/*.mui-bar-nav {
				background-color: #FFF !important;
				border-bottom: 1px solid #EFEFF4;
			}
			.hasManyCitytwo .header-tit{
				color: #333;
			}
			.hasManyCitytwo .fanhui{
				color: #333;
			}*/
			.footerone .left{
				width: 60%;
			}
			.footerone p{
				text-align: left;
				font-size: 16px;
				text-indent: 15px;
				line-height: .5rem;
			}
			.red1{
				color: #f53c42;
			}
			.footerone .right{
				width: 40%;
			}
			.footerone .right .btn {
				 width: 100%; 
			}
			.gray{
				color: #999;
			}
			small{
				line-height: 12px !important;
				color: #666 !important;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav hasManyCity hasManyCitytwo">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize fl fanhui"></a>
		    <div class="header-tit">
				机票订单
			</div>
		</header>
		<div id="main">
			<dl class="list" id="goodsList">
				<dd class="goodsItem" id="order1">
					<!--<a class="react mui-row">
						<div class="mui-col-sm-9 mui-col-xs-9">
							<p class="black title">12-13&nbsp;周二&nbsp;20:10&nbsp;经济舱 </p>
							<p class="black tiny">双流机场T2&nbsp;-&nbsp;萧山机场</p>
				        </div>
				        <div class="mui-col-sm-3 mui-col-xs-3">
				        </div>
					</a>-->
				</dd>
				<!--订单第一部分数据渲染-->
				<script type="text/html" id="order1-detail">
					<a class="react mui-row">
						<div class="mui-col-sm-9 mui-col-xs-9">
							<p class="black title">12-13&nbsp;周二&nbsp;<%=seatMsg %>&nbsp; </p>
							<p class="black tiny"><%=adLi.orgCityName.replace("航站楼:","") %>&nbsp;-&nbsp;<%=adLi.dstCityName.replace("航站楼:","") %></p>
				        </div>
				        <div class="mui-col-sm-3 mui-col-xs-3">
				        </div>
					</a>
				</script>
				<dd class="goodsItem" id="order2">
					<a class="react mui-row">
						<div class="mui-col-sm-6 mui-col-xs-6">
							<p class="black">成人票￥<span id="settlePrice"></span></p>
				       	</div>
				        <div class="mui-col-sm-6 mui-col-xs-6">
				        	<p class="black">基建燃油￥<span id="adultAirportTax"></span>+￥<span id="adultFuelTax"></span></p>
				        </div>
					</a>
				</dd>
			</dl>
			<dl class="list" id="goodsList">
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-8 mui-col-xs-8">
							<p class="black">添加/修改乘机人 </p>
							<p class="tiny">请确保姓名证件填写正确</p>
				       </div>
				        <div class="mui-col-sm-4 mui-col-xs-4">
				        	<button class="addMan" onclick="addPerson()">添加乘机人</button>
				        </div>
					</a>
				</dd>
				<dd class="goodsItem" id="persons">
					<a class="react mui-row aPerson">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<img src="../../img/tickets/delete.png" class="delete" onclick="deletePerson(this)"/>
				       	</div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<p class="black">柯南</p>
				        	<p class="tiny black">身份证&nbsp;51245781466666666</p>
				        </div>
					</a>
				</dd>
			</dl>
			<dl class="list" id="goodsList">
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-3 mui-col-xs-3">
							<p class="black">联系人 </p>
				       </div>
				        <div class="mui-col-sm-9 mui-col-xs-9">
				        	<input type="" name="" id="" value="" class="phone" placeholder="联系人姓名"/>
				        </div>
					</a>
				</dd>
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-3 mui-col-xs-3">
							<p class="black">手机号码 </p>
				       	</div>
				        <div class="mui-col-sm-9 mui-col-xs-9">
				        	<input type="" name="" id="" value="" class="phone" placeholder="用于接收短信(必填)"/>
				        </div>
					</a>
				</dd>
			</dl>
			<dl class="list" id="goodsList">
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-3 mui-col-xs-3">
							<p class="black">改签规则</p>
				       </div>
				        <div class="mui-col-sm-9 mui-col-xs-9">
				        	<p id="changeStipulate" style="line-height: 20px;font-size: 12px;margin: 10px 0;"></p>
				        </div>
					</a>
				</dd>
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-3 mui-col-xs-3">
							<p class="black">退票规则</p>
				       	</div>
				        <div class="mui-col-sm-9 mui-col-xs-9">
				        	<p id="refundStipulate"></p>
				        </div>
					</a>
				</dd>
			</dl>
		</div>
		<!--footerone star-->
		<div class="footerone clearfloat">
			<div class="left">
				<p class="red1"><sub>￥</sub><span id="subPrice"></span><sub class="gray">（共<span id="subPerson"></span>人）</sub></p>
			</div>
			<div class="right ">
                <a onClick="toshare(2)" class="btn btnone fl">立即购买</a>
			</div>
		</div>
		<!--footerone end-->
	</body>
	<script type="text/javascript">
		window.addPerson = function(){
			openview({ 
				view:'planeAddPerson.html'
			})
		}
	</script>
	<!--数据渲染-->
	<script type="text/javascript">
		//点击删除，删除乘机人
		function deletePerson(thisP){
			mui.confirm('确认删除该乘机人？','',['取消','确认'],function (e) {
				if(e.index == 1) { 
					$(thisP).parents('.aPerson').remove();
				}
			})
		}
		mui.plusReady(function(){
			//从机票详情获取的数据
			var flightNo = plus.webview.currentWebview().flightNo;
			var fromPlace = plus.webview.currentWebview().fromPlace;
			var arrivePlace = plus.webview.currentWebview().arrivePlace;
			var fromTime = plus.webview.currentWebview().fromTime;
			var itemId = plus.webview.currentWebview().itemId;
			var seatCode = plus.webview.currentWebview().seatCode;
			var seatMsg = plus.webview.currentWebview().seatMsg;
			var flightCompanyCode = plus.webview.currentWebview().flightCompanyCode;
			
			var oldToken = plus.storage.getItem('oldToken');
			
			//从添加乘机人获取的详情
			document.addEventListener('refreshPerson', function(obj) {
				var newName=obj.detail.newName;
				var idNo=obj.detail.idNo;
//				alert(idNo+newName);
				var persons = document.getElementById('persons');
				persons.insertAdjacentHTML('beforebegin', '<dd class="goodsItem" id="persons"><a class="react mui-row aPerson"><div class="mui-col-sm-1 mui-col-xs-1"><img src="../../img/tickets/delete.png" class="delete" onclick="deletePerson(this)"/></div><div class="mui-col-sm-11 mui-col-xs-11"><p class="black">'+newName+'</p><p class="tiny black">身份证&nbsp;'+idNo+'</p></div></a></dd>'); 
			})
			
			//获取航线列表
			plus.nativeUI.showWaiting("加载中...",{width:'100px',height:'80px'});
			mui.ajax(serverUrl +'/api/qianmi/airlineslist',{
				data:{from:fromPlace,itemId:itemId,date:fromTime,to:arrivePlace},
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
//					alert(data)
					//航线基本信息
					var objData = data.data.airlines_list_response.airlines.airline;
					for(var i = 0;i<objData.length;i++){
						//循环获取当前航班号
						if(objData[i].flightNo == flightNo){
//							alert(JSON.stringify(objData[i].flightNo));
							var adObj = {};
							adObj.adLi = objData[i];
							adObj.seatMsg = seatMsg;
							var html = template('order1-detail',adObj);
							document.getElementById('order1').innerHTML = html;
							//其他数据渲染
							mui('#adultFuelTax')[0].innerHTML = objData[i].adultFuelTax;				
							mui('#adultAirportTax')[0].innerHTML = objData[i].adultAirportTax;				
							
							
							
							//航线具体舱位信息
							for(var k = 0; k<objData[i].airSeats.airSeat.length;k++){
								if( objData[i].airSeats.airSeat[k].seatCode == seatCode){
									airSeats = objData[i].airSeats.airSeat[k];
									//其他数据渲染
									mui('#settlePrice')[0].innerHTML = airSeats.settlePrice;//票价
									mui('#subPrice')[0].innerHTML = airSeats.settlePrice;//总票价
									mui('#changeStipulate')[0].innerHTML = airSeats.changeStipulate;			
									mui('#refundStipulate')[0].innerHTML = airSeats.refundStipulate;			
									plus.nativeUI.closeWaiting();
									
									//点击订票
//									window.planeOrder = function(seatCode){
//										openview({ 
//											view:'planeOrder.html',
//											extrasobj:{flightNo:'CZ6101',seatCode:seatCode,fromPlace:fromPlace,arrivePlace:arrivePlace,fromTime:fromTime,itemId:itemId}
//										})
//									}
//								plus.nativeUI.closeWaiting();
								}
							}
						}
					}
				},
				error:function(xhr,type,errorThrown){
					console.log('响应失败  !');
				}
			});
		})
	</script>

</html>