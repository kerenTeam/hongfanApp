<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>机构选择</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/reset.css"/>
		<!--<link rel="stylesheet" type="text/css" href="../../css/localHost.css"/>-->
		<link rel="stylesheet" type="text/css" href="../../css/one.css"/>
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/jquery.min.js"></script> 
		<style type="text/css">
			.mui-bar-nav{
				box-shadow: none;
			}
			.theSearch{
				width: 100%;
				background-color: #fff;
				margin-top: 50px;
			}
			.mui-input-row .mui-btn+input, .mui-input-row label+input, .mui-input-row:last-child{
				margin: 0 10px;
			}
			input[type=search]{
				margin: 10px 0;
			}
			.mui-search .mui-placeholder{
				top: 10px;
			}
			.show_arrive_date{
				display: none;
			}
			 
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">缴费机构</h1>  
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="container">		
			<div id="main">
				 
				<ul class="boxs self-paytop" id="listdata"></ul>
				<script type="text/html" id="listTpl">
					<%for(var i = 0 ;i<List.length;i++){%>
						<%if(List[i].itemtype=='electric'){%>
							<li class="show_arrive_date ll">
								<a id="<%=List[i].itemId%>" class="date">
									<strong><%=List[i].itemName%></strong>	
								</a>
							</li>
						<%}%>
						<%if(List[i].itemtype=='gas'){%>
							<li class="show_arrive_date gg">
								<a id="<%=List[i].itemId%>" class="date">
									<strong><%=List[i].itemName%></strong>	
								</a>
							</li>
						<%}%>
						<%if(List[i].itemtype=='water'){%>
							<li class="show_arrive_date ww">
								<a id="<%=List[i].itemId%>" class="date">
									<strong><%=List[i].itemName%></strong>	
								</a>
							</li>
						<%}%>
					<%}%>
				</script>
			</div>
		</div>
	</body>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		mui.plusReady(function(){
			var myuserid = plus.storage.getItem('userid'); 
			var oldtoken = plus.storage.getItem('oldToken');
			var typeCharge = plus.webview.currentWebview().typeCharge;
			plus.nativeUI.showWaiting();
			mui.ajax(serverUrl+'/api/banma/watercoalitemlist',{
				dataType:'json',
				data:{pageSize:100},
				type:'post',
				timeout:'10000',
				headers:{"token":oldtoken},
				success:function(data,type,xhr){ 
					console.log("watercoalitemlist",data)
					if(data.errno ==0 ){
						var List = data.data.admin_item_response.items.item;
						var dataList = {};
						
						if(List && List.length){
							for(var i= 0;i<List.length;i++){
								if(List[i].itemName.indexOf('水')>-1){
									List[i].itemtype = 'water';
								}
								if(List[i].itemName.indexOf('电')>-1){
									List[i].itemtype = 'electric';
								}
								if(List[i].itemName.indexOf('气')>-1){
									List[i].itemtype = 'gas';
								}
							}
							dataList.List = List;
							document.getElementById("listdata").innerHTML = template("listTpl",dataList);
							if(typeCharge==1){ 
								 $(".ww").css("display","block");
								 mui("#main").on('tap','.show_arrive_date',function(){ 
								  	var itemId = $(this).find("a").attr("id");
								  	var itemName = $(this).find("strong").html();
					            	 
					            	var list = plus.webview.getWebviewById('waterRecharge');
					            	mui.fire(list, 'refresh', {
											itemId: itemId,
											itemName:itemName
										});
									mui.back();
					            })
							}
							if(typeCharge==2){
								$(".ll").css("display","block");
								 mui("#main").on('tap','.show_arrive_date',function(){ 
								  	var itemId = $(this).find("a").attr("id");
								  	var itemName = $(this).find("strong").html();
					            	 
					            	var list = plus.webview.getWebviewById('eleRecharge');
					            	mui.fire(list, 'refresh', {
											itemId: itemId,
											itemName:itemName
										});
									mui.back();
					            })
							}
							if(typeCharge==3){
								$(".gg").css("display","block");
								 mui("#main").on('tap','.show_arrive_date',function(){ 
								  	var itemId = $(this).find("a").attr("id");
								  	var itemName = $(this).find("strong").html();
					            	 
					            	var list = plus.webview.getWebviewById('gasRecharge');
					            	mui.fire(list, 'refresh', {
											itemId: itemId,
											itemName:itemName
										});
									mui.back();
					            })
							}
							plus.nativeUI.closeWaiting();
						} 
					}
					plus.nativeUI.closeWaiting();
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();
					plus.nativeUI.alert('网络不好请重试！')
					console.log('响应失败  !');
				}
			})
			 
		})
	</script>
</html>