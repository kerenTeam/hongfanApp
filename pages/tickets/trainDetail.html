<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>火车票详情</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<!--<script type="text/javascript" src="../../js/jquery.min.js"></script>-->
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<!--<script type="text/javascript" src="../../js/jquery.flexslider-min.js"></script>-->
		<!--<script src=" ../../js/hmt.js" type="text/javascript"></script>-->
		<!--<script src="../../js/other.js" type="text/javascript" charset="utf-8"></script>-->
		<script src="../../js/app.js" type="text/javascript" ></script>
		
		<!--引入模板引擎--> 
		<script src="../../js/artTemplate-native.js" type="text/javascript" ></script>
		<style type="text/css">
			.mui-bar{
				height: 50px;
				box-shadow: none;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			#main{
				margin-top: 50px;
			}
			.guess-like,dl.list{
				border-bottom: 1px solid #eee;
				background-color: #fff;
			}
			.right{
				text-align: right;
			}
			.middle{
				text-align: center;
			}
			.strong-color{
				color: #f53c42 !important;
			}
			.Lgray{
				font-size: 12px !important;
				color: #999 !important;
				margin-top: 14px;
			}
			.mui-badge-blue, .mui-badge-primary{
				background-color: #fff;
				border: 1px solid #999;
				color: #999 !important;
			}
			
			.moreone{
				line-height: 50px;
			}
			dl.list .db>.react{
				padding: 0;
				margin: 0;
			}
			dl.list .db{
				height: 50px;
			}
			.grade-eject>ul>li, .Category-eject>ul>li, .Sort-eject>ul>li{
				line-height: 40px;
			}
			
			/*这一页*/
			.timeBox{
				position: relative;
			}
			.timeBox p{
				font-size: 24px;
				color: #333;
				line-height: 22px;
			}
			.timeBox .ad{
				font-size: 12px;
				color: #999;
				font-weight: normal;
				line-height: 24px;
			}
			.timeBox .bage{
				position: absolute;
				font-size: 12px;
				line-height: 10px;
				right: 15px;
				top: 10px;
				color: #666;
			}
			.price{
				text-align: right;
				font-size: 24px;
				color: #f53c42;
			}
			.airTip p{
				text-align: right;
				line-height: 40px !important;
			}
			.Achange {
				color: #333;
			}
			.Achange span{
				color: #ff5601;
				font-size: 14px !important;
			}
			.inputWrap{
				border: none;
				border-radius: 3px;
				color: #666;
				line-height: 50px;
				background-color: rgba(255,255,255,0.8);
				margin: 10px 0;
			}
			.ad img{
				width: 15%;
				margin-top: -3px;
			}
			.dot{
				background-color: #bfbfbf;
				width: 5px;
				height: 5px;
				padding: 4px;
				margin: 0 5px;
				border-radius: 50%;
				display: inline-block;
			}
			.line{
				width: 3px;
				height: 12px;
				position: absolute;
				left: 8px;
				top: 42px;
				background-color: #ddd;
			}
			.guess-like{
				padding-top:50px;
			}
			.react >div{
				line-height: 40px !important;
			}
			.airTip button{
				margin-left: 15px !important;
				background-color: #f53c42;
				color: #fff;
				border: none;
			}
			.hLeft{
				text-align: right;
				padding-top: 10px;
			}
			.hMiddle{
				text-align: center;
				padding-top: 10px;
			}
			.hRight{
				text-align: left;
				padding: 10px;
			}
			.head{
				background-color: #ffc900;
			}
			dl.list {
				border-top: none;
				margin-top: 0; 
			}
			dl.list dt, dl.list dd{
				border-bottom: 1px solid #EFEFF4;
			}
			.toLine{
				width: 60%;
				height: 1px;
				margin: 10px 20%;
				background-color: #666;
			}
			/*header样式*/
			.mui-bar-nav {
				background-color: #FFF !important;
			}
			.hasManyCitytwo .header-tit{
				color: #333;
			}
			.hasManyCitytwo .fanhui{
				color: #333;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav hasManyCity hasManyCitytwo">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize fl fanhui"></a>
		    <div class="header-tit">
				火车票详情
			</div>
		</header>
		<div id="container"></div>
			<script type="text/html" id="infolist">
				<div class="guess-like">
					<div class="head">
						<div class="mui-row">
						    <div class="mui-col-sm-4 mui-col-xs-4 hLeft">
								<div class="timeBox">
									<p class="ad black"><%= list.currentStartStationName%></p>
									<p><%= list.startTime%> </p>
									<p class="ad black"><%= list.Sdate%><%= list.Sweek%></p>
								</div>
					       	</div>
					        <div class="mui-col-sm-4 mui-col-xs-4 hMiddle">
					        	<div class="timeBox">
									<p class="ad black"><%= list.trainNumber%></p>
									<div class="toLine"></div>
									<p class="ad black"><%= list.runtime%></p>
								</div>
					        </div>
					         <div class="mui-col-sm-4 mui-col-xs-4 hRight">
								<div class="timeBox">
									<p class="ad black"><%= list.currentEndStationName%></p>
									<p><%= list.endTime%> </p>
									<p class="ad black"><%= list.Edate%><%= list.Eweek%></p>
								</div>
					       	</div>
						</div>
					</div>
					<dl class="list" id="goodsList">
						<% for(var i=0; i<list.trainSeats.trainSeat.length; i++){%>
							<dd class="goodsItem" onclick="trainOrder(this)">
								<a class="react mui-row">
									<div class="mui-col-sm-3 mui-col-xs-3">
										<p class="black typename"  id="typename"><%= list.trainSeats.trainSeat[i].seatName%> </p>
							       </div>
							        
							        <% if(list.trainSeats.trainSeat[i].remainderTrainTickets>0){%>
							        	<div class="mui-col-sm-3 mui-col-xs-3">
							        		<p class="black"><%= list.trainSeats.trainSeat[i].remainderTrainTickets%>张 </p>
							        	</div>
							        	<div class="mui-col-sm-6 mui-col-xs-6 airTip" >
								        	<p><span class="price Tprice"><sub>￥</sub><%= list.trainSeats.trainSeat[i].seatPrice%></span><button >预定</button></p>
								        </div>
							        <% }else{%>
							        	<div class="mui-col-sm-3 mui-col-xs-3">
							        		<p class="black">0张 </p>
							        	</div>
							        	<div class="mui-col-sm-6 mui-col-xs-6 airTip">
								        	<p><span class="price" style="color: #999;"><sub>￥</sub><%= list.trainSeats.trainSeat[i].seatPrice%></span><button style="background-color: #999;">预定</button></p>
								        </div>
							        <% }%>
								</a>
							</dd>
						<% }%>	
					</dl>
				</div>
			</script>	
		</div>
	</body>
    <script type="text/javascript">
    	function formatSeconds(value) {//秒转小时分钟
            var theTime = parseInt(value);// 秒
            var theTime1 = 0;// 分
            var theTime2 = 0;// 小时
            if(theTime > 60) {
                theTime1 = parseInt(theTime/60);
                theTime = parseInt(theTime%60);
                if(theTime1 > 60) {
                    theTime2 = parseInt(theTime1/60);
                    theTime1 = parseInt(theTime1%60);
                }
            }
            var result = "";
            if(theTime1 > 0) {
                result = ""+parseInt(theTime1)+"分"+result;
            }
            if(theTime2 > 0) {
                result = ""+parseInt(theTime2)+"小时"+result;
            }
            return result;
        }
	    
    	
    	mui.plusReady(function(){
    		plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});
			var details = plus.webview.currentWebview().details;
			var time = plus.webview.currentWebview().timeattr;
			var dataobj = {};
			var Aweek = ['周日','周一','周二','周三','周四','周五','周六'];
			details.Sdate = time.split('-')[1] + '-' + time.split('-')[2];//开始日期
			var Aweeknum = new Date(time).getDay();
			details.Sweek = Aweek[Aweeknum];//开始星期
			details.runtime = formatSeconds(details.runTime);//运行总时间
			console.log(time);
			
			var newtime = time.split('-')[1] + '-' + time.split('-')[2] + '-' + time.split('-')[0] + ' ' + details.startTime;
			var date = new Date(newtime);
			var jiange = formatSeconds(details.runTime);
			var runhour = parseInt(jiange.split('小时')[0]);//间隔小时
			var runmin = parseInt(jiange.split('小时')[1]);//间隔分钟
			date.setHours(date.getHours() + runhour);
			date.setMinutes(date.getMinutes() + runmin);
//			console.log(date.toLocaleDateString());
//			console.log(date.getMonth()+1 + '结束月');
//			console.log(date.getDate() + '结束天');
//			console.log(date.getHours() + '结束小时');
//			console.log(date.getMinutes() + '结束分钟');
//			console.log(date.getDay() + '结束周');
			
			var Emonth;//结束月
			if(JSON.stringify(date.getMonth()+1).length == 1){
				Emonth = '0'+ JSON.stringify(date.getMonth()+1);
			}else{
				Emonth = JSON.stringify(date.getMonth()+1);
			}
			var Eday;//结束天
			if(JSON.stringify(date.getDate()).length == 1){
				Eday = '0'+ JSON.stringify(date.getDate())
			}else{
				Eday = JSON.stringify(date.getDate())
			}
			details.Edate = Emonth + '-' + Eday;//结束日期
			details.Eweek = Aweek[date.getDay()];//结束星期
			
			dataobj.list = details;  
			var html=template("infolist",dataobj);
			document.getElementById("container").innerHTML = html;
			plus.nativeUI.closeWaiting();
			
			
			
			window.trainOrder = function(obj){//预定
	    		var that = obj;
    			var Sdate = time.split('-')[1] + '-' + time.split('-')[2];
    			var Aweeknum = new Date(time).getDay();
    			var Sweek = Aweek[Aweeknum];//开始星期
    			var type = that.getElementsByClassName('typename')[0].innerText;
    			var price = that.getElementsByClassName('Tprice')[0].innerText;
    			var Edate = Emonth + '-' + Eday;
    			var Eweek = Aweek[date.getDay()];
    			var detailsobj = {
    				from:details.currentStartStationName,
    				Stime:details.startTime,
    				Sdate:Sdate,
    				Sweek:Sweek,
    				name:details.trainNumber,
    				runtime:formatSeconds(details.runTime),
    				End:details.currentEndStationName,
    				Etime:details.endTime,
    				Edate:Edate,
    				Eweek:Eweek,
    				type:type,
    				Price:price
    			};
    			openview({ 
					view:'trainOrder.html',
					extrasobj:{details:detailsobj}
				})
			}
    	});
    </script>
</html>