<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>燃气费</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		
		
		<style type="text/css">
			/*banner底部导航*/
			.mui-slider-indicator .mui-indicator{
				width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			.mui-slider-indicator .mui-active.mui-indicator{
				background-color: rgba(245,60,66,0.8);
				box-shadow: none;
				opacity: 1;
				border: none;
			}
			.mui-bar{
				height: 50px;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			.mui-bar-nav.mui-bar .mui-icon,.mui-title,.mui-icon{
				color: #fff;
			}
			.mui-bar-nav{
				box-shadow: none;
			}
			.mui-icon{
				line-height: 50px;
			}	
			.mui-icon .iconfont{
				font-size: 18px;
			}
			.dealcard, .cinemacard{
				margin-top: 50px;
			}
			#main{
				margin-top: 50px;
			}
			
			.farm .bottom ul li{
				text-overflow: ellipsis;
				white-space: nowrap;
				overflow: hidden;
				display: block;
				width: 100%;
			}
			
			
			.fr{
				color: #fff !important;
				line-height: 50px;
			}
			.rentingtop{
				background-color: #fff;
			}
			.icon{
				background-color: #ec5340;
				display: inline-block;
				width: 60px;
				height: 60px;
				border-radius: 50%;
				margin: 15px 0;
			}
			.icon img{
				margin: 14px;
			}
			.chargeTitle{
				display: inline-block;
				font-size: 18px !important;
				line-height: 80px !important;
				margin-left: 5%;
			}
			.recharge .czhi,.btw{
				padding: 0 5%;
				margin: 0;
			}
			.clearfloat{
				border-bottom: 1px solid #eee;
				margin-bottom: 20px;
			}
			.farm, .farmtc{
				background-color: #fafafa;
			}
			.farm .top, .farm .bottom{
				border-bottom: 1px solid #eee !important;
			}
			.warpthree{
				border-top: 1px solid #eee;
			}
			.line{
				margin-bottom: 0;
				border-bottom: none;
			}
			.btw p{
				font-size: 13px;
				line-height: 15px;
				margin-top: -10px;
			}
			.agree p{
				color: #666;
				padding-top: 30px;
				font-size: 15px !important;
			}
			.textRed{
				color: #f56267;
			}
			button{
				margin: 50px 10%;
				width: 80% !important;
				line-height: 18px !important;
				background-color: #f53c42 !important; 
				color: #fff !important;
				border: none !important;
			}
			#Cchoose input{
				font-size: 0.13rem;
			}
		</style>
	</head>
	<body class="farm">
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">新增缴费账户</h1>
			<a onclick="phoneRe()" class="fr">缴费记录</a>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<!--详情内容-->
		<div id="main">
			<div class="deal">
				<div>
					<div class="top rentingtop box-s">
						<div class="icon">
							<img src="../../img/theList/hot.png"/>
						</div>
						<p class="chargeTitle">燃气费</p>
					</div>
					<div class="recharge clearfloat">
			    		<div class="czhi box-s">
							<p>家庭</p>
							<select class="mui-btn mui-btn-block" id="select" style="width: 78%;padding: 0;height: 0.5rem;font-size: 0.13rem;">
								<option value="我家">我家</option>
								<option value="父母">父母</option>
								<option value="房东">房东</option>
								<option value="朋友">朋友</option>
								<option value="其他">其他</option>
							</select>
			    		</div>
	    			</div>
					<div class="warpthree clearfloat line">
				    	<div class="recharge">
				    		<div class="czhi box-s">
				    			<p>缴费单位</p>
				    			<div id="Cchoose" onclick="unit()">
				    				<input type="text" id="cgunit" value="" placeholder="选择缴费单位" disabled="disabled"/>
				    				<span class="mui-icon mui-icon-arrowright"></span>
				    			</div>
				    		</div>
				    	</div>	 
				    </div>
				    <div class="warpthree clearfloat">
				    	<div class="recharge">
				    		<div class="czhi box-s">
				    			<p>户号</p>
				    			<input type="text" id="huhao" value="7109910181" placeholder="查看纸质账单" />
				    		</div>
				    	</div>	
				    </div>
					<div class="btw">
						<p>户号为10位数字。支持重庆主城区。</p>
					</div>
					<!--<div class="btw agree">
						<p>同意<span class="textRed"> 《自助缴费服务协议》</span></p>
					</div>-->
					<button type="button" class="mui-btn mui-btn-block" onclick="next()">下一步</button>
				</div>
			</div>
		</div>
	</body>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		(function(){
			
			//点击下一步跳转
			window.next = function(){
				openview({
					view:'gasPay.html',
				})
			}
			
			//点击缴费单位跳转
			window.unit = function(){
				openview({
					view:'rechargeList.html',
					extrasobj:{typeCharge:'3'}
				})
			}
			window.phoneRe = function(){
				openview({
					view:'record.html',
					extrasobj:{typeC:2}
				})
			}
			
				var itemid="";
			mui.plusReady(function(){
				window.addEventListener('refresh', function(event){ 
						var itemId = event.detail.itemId;
						itemid = itemId;
						var itemName = event.detail.itemName;
						 document.getElementById("cgunit").value = itemName;
					});	 
					//点击下一步跳转
			window.next = function(){
				
				var selectobj = document.getElementById("select"); //定位id 
				var index = selectobj.selectedIndex; // 选中索引 
				var cgunit = document.getElementById("cgunit")//缴费单位
				var selecttext = selectobj.options[index].text; // 选中文本 
				var zz = /^\d{10}$/;
				var hh = parseFloat(mui("#huhao")[0].value);
				if(!cgunit.value){
					mui.toast("还未选择缴费单位哦");
					mui("#cgunit")[0].focus();
				}else if(!zz.test(hh)){
					mui.toast("户号为10位数字哦");
					mui("#huhao")[0].focus();
				}else{
					plus.nativeUI.showWaiting('正在查询机构',{width:'110px',height:'80px'});
					var oldToken = plus.storage.getItem('oldToken');
					var myuserid = plus.storage.getItem('userid');
					mui.ajax(serverUrl+'/api/qianmi/watercoalitempropslist',{
								data:{itemId:itemid},
								dataType:'json',
								type:'post',
								timeout:10000,
								headers:{"token":oldToken},	 
								success:function(data,type,xhr){
									alert(itemid+" "+JSON.stringify(data))
									plus.nativeUI.closeWaiting()
									if(data.errno==0){
										alert(itemid)
										var projectId = data.data.item_props_list_response.cid;
										for(var i = 0;i<data.data.item_props_list_response.itemProps.itemProp.length;i++){
											if(data.data.item_props_list_response.itemProps.itemProp[i].type == 'BRAND'){
												var unitId = data.data.item_props_list_response.itemProps.itemProp[i].vid
											}
											if(data.data.item_props_list_response.itemProps.itemProp[i].type == 'PRVCIN'){
												var province = data.data.item_props_list_response.itemProps.itemProp[i].vname
											}
											if(data.data.item_props_list_response.itemProps.itemProp[i].type == 'CITYIN'){
												var city = data.data.item_props_list_response.itemProps.itemProp[i].vname
											}
											if(data.data.item_props_list_response.itemProps.itemProp[i].type == 'BRAND'){
												var unitName = data.data.item_props_list_response.itemProps.itemProp[i].vname
											}
											if(data.data.item_props_list_response.itemProps.itemProp[i].type == 'CITYIN'){
												var cityId = data.data.item_props_list_response.itemProps.itemProp[i].vid
											}
											if(data.data.item_props_list_response.itemProps.itemProp[i].type == 'BRAND'){
												var unitId = data.data.item_props_list_response.itemProps.itemProp[i].vid
											}
											if(data.data.item_props_list_response.itemProps.itemProp[i].type == 'SPECIAL'){
												var modeId = data.data.item_props_list_response.itemProps.itemProp[i].vid
											}
										}
										alert(itemid+"户号 "+mui("#huhao")[0].value+"projectId "+projectId+"unitId "+unitId+"province "+province+"city "+city+"unitName "+unitName+"cityId "+cityId+"modeId "+modeId+"modeType "+2)
										mui.ajax(serverUrl+'/api/qianmi/watercoalgetaccountinfo',{
											data:{itemId:itemid,account:mui("#huhao")[0].value,projectId:projectId,unitId:unitId,province:province,city:city,unitName:unitName,cityId:cityId,modeId:modeId,modeType:2},
											dataType:'json',
											type:'post',
											timeout:10000,
											headers:{"token":oldToken},	 
											success:function(data,type,xhr){
												alert(JSON.stringify(data))
												plus.nativeUI.closeWaiting()
												if(data.errno==0){
													  if(!data.data.water_coal_ubqs_response.waterCoalBills.waterCoalBill){
													  	mui.toast("该户号尚未出账，请等出账后在查询")
													  openview({
																view:'gasPay.html',
																id:'gasPay',
																extrasobj:{huhao:mui("#huhao")[0].value,itemId:itemid,unitName:unitName,balance:20,arrearage:0.00,accountName:"xxx",address:"xxx街xxxx号xxxx"}
															})
													  }else{
													  	openview({
																view:'gasPay.html',
																id:'gasPay',
																extrasobj:{huhao:mui("#huhao")[0].value,itemId:itemid,unitName:unitName,balance:20,arrearage:0.00,accountName:"xxx",address:"xxx街xxxx号xxxx"}
															})
													  }
												}
											},
											error:function(xhr,type,errorThrown){
												plus.nativeUI.closeWaiting()
											}
										});   
									}
								},
								error:function(xhr,type,errorThrown){
									plus.nativeUI.closeWaiting()
								}
							}); 
					
					 
				}
				 
				
			}
			})
			
		})();
	</script>
</html>