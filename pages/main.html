<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>封面首页 - main</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../css/common.css">
		<link rel="stylesheet" type="text/css" href="../css/index.css">
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css"/>
		<link rel="stylesheet" href="../css/reset.css">
		<link rel="stylesheet" href="../css/one.css">
		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script type="text/javascript" src="../js/jquery.flexslider-min.js"></script>
		<!--<script type="text/javascript" src="../js/iscroll.js"></script>--> 
		<script src="../js/swiper.min.js" type="text/javascript" ></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/app.js"></script>
		<!--<script type="text/javascript" src="../js/index.js"></script>-->
		
		<!--引入模板引擎-->
		<script src="../js/artTemplate-native.js"></script>
		<style type="text/css">
			/*banner底部导航*/
			.mui-slider-indicator .mui-indicator{
				width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			.mui-slider-indicator .mui-active.mui-indicator{
				background-color: rgba(245,60,66,0.8);
				box-shadow: none;
				opacity: 1;
				border: none;
			}
			.mui-slider{
				margin-top: 50px;
			}
			.onetable{
				margin-top: 0;
				background-color: #fff;
				padding-bottom: 10px;
			}
			.onetable p{
				margin-top: -10px;
				font-size: 11px;
				margin-bottom: 5px;
			}
			.fontcl2{
				font-size: 16px;
				line-height: 20px;
				width: 100%;
			}
			.fontcl2 span{
				display: inline-block;
				width: 40%;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}
			.sy_recmd_list .pub_wz{
				position: relative;
				padding: 0 5%;
			}
			sub{
				bottom: 0;
				font-size: 70%;
			}
			.fr {
				position: absolute;
				float: right;
				display: block;
				top: 12px;
				right: 5px;
				font-size: 10px;
			}
			.sy_recmd_list .pub_wz .nr_box{
				border-top: none;
			}
			.sy_recmd_list .pub_wz .nr_box{
				margin-top: 0;
			}
			.onetable p{
				font-size: 13px;
			}
			
			/*banner*/
			.mui-slider-item img{
				width: 100%;
				min-height: 144px;
				max-height: 200px;
				overflow: hidden;
			}
			
			.act_l img,.act_r img,.act_b_l img,.act_b_r img{
				height: 100%;
				overflow: hidden;
			}
			/*广告图片样式*/
			.activity{
				position: relative;
			}
			.act_l{
				height: 100%;
			}
			.act_r{
				height: 100%;
			}
			.act_top{
				height: 50%;
				overflow: hidden;
				top: 0;
				right: 0;
				position: absolute;
				width: 60%;
			}
			.act_l_b{
				position: absolute;
				bottom: 0;
				height: 50%;
				overflow: hidden;
			}
			.act_b_l, .act_b_r{
				width: 50%;
				height: 100%;
				overflow: hidden;
			}
			.hotImg{
				height: 170px;
				max-height: 170px;
				min-height: 170px;
				overflow: hidden;
			}
			
			.mb10{
				margin-top: 4%;
			}
			.left{
				border-left: 0.03rem solid #f53c42;
				padding-left: 10px;
			}
			.sy_title{
				border-bottom: none;
				border-top: none;
			}
			.sy_recmd_list .box{
				border: 1px solid #efeff4;
			}
			.saled{
				text-align: right;
			}
			.PriceB{
				text-align: left !important;
			}
			/*加载*/
			#upload{ 
				text-align: center;margin-bottom: 30px;font-size: 15px;
			}
			#upload img{width: 60px;margin-top: -15px;
			}
			
			.sy_recmd_list .pub_wz h3 a{
				color: #666;
				line-height: 0.3rem;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				width: 100%;
				display: block;
			}
		</style>
	</head>

	<body>
		<header class="hasManyCity mui-row" id="header">
			<div id="" class="cityBtn">邻水</div>
			<div id="locaitonBtn" class="link-url locaitonBtn"></div>
			<div id="" class="searchBox">
				<a class="openSearch">
					<i class="icon-search"></i>
					<span>请输入您想找的内容</span>
				</a>
			</div>
			<a href="market/storeList.html"><div id="" class="qrcodeBtn"></div></a>
		</header>
		
		<div id="container">		
			<div id="main">
				<div id="scroller">
					<!--轮播图-->
					<div class="mui-slider" id="banner"></div>
					<!--轮播图结束-->
					<div class="onetable">
						<table> 
							<tbody>
								<tr>
									<td class="market"><img src="../img/55cc6b1f816fd.png"/><br/><p>购物中心</p></td>
									<td class="locallife"><img src="../img/55cc69d15576b.png"/><br/><p>本地生活</p></td>
									<td class="ticket"> <img src="../img/55cc6aa7aee21.png"/><br /><p>充值缴费</p></td>
									<td><img src="../img/b3.png"/><br /><p>优品汇</p></td>
								</tr>
								<tr>
									<td class="server"><img src="../img/b5.png"/><br/><p>为民服务</p></td>
									<td><img src="../img/a1.png"/><br/><p>一键钟情</p></td>
									<td><img src="../img/b4.png"/><br/><p>游戏娱乐</p></td>
									<td class="h_report"><img src="../img/a6.png"/><br/><p>家乡报道</p></td>
								</tr>
							</tbody>
						</table>
					</div>
					<div class="bor"></div>	
					<div class="activity clearfix" id="recomment"></div>
					<!--推荐列表-->
					<div class="sy_recmd" style="background-color: #fff;">
						<!--推荐列表-->
						<div class="sy_title mb10">
							<span class="left">热门推荐</span>
							<a href="#" class="fr morethree">更多&gt;&gt;</a>
						</div> 
						<div class="sy_recmd_list_box">
							<ul>
								<div id="moll_recommend"></div>
							</ul>
							<div class="clear"></div>
						</div>
					<div class="upload text-center text-xs gray" id="upload"></div>
				</div>
			</div>
		</div>
		
		<!--模板引擎渲染数据-->
		<!--banner-->
		<script type="text/html" id="banner-detail">
			<div class="mui-slider-group mui-slider-loop">
			    <!--支持循环，需要重复图片节点-->
			    <div class="mui-slider-item mui-slider-item-duplicate"><a><img src="<%= url %><%= bannerLi[bannerLi.length-1].bannerPic %>" /></a></div>
				<% for(var i=0;i<bannerLi.length;i++){ %> 
			    	<div class="mui-slider-item"><a><img src="<%= url %><%= bannerLi[i].bannerPic %>" /></a></div>
			     <% } %>
			    <!--支持循环，需要重复图片节点-->
			    <div class="mui-slider-item mui-slider-item-duplicate"><a><img src="<%= url %><%= bannerLi[0].bannerPic %>" /></a></div>
			</div>
			<div class="mui-slider-indicator">
				<div class="mui-indicator mui-active"></div>
				<% for(var i=0;i<bannerLi.length-1;i++){ %>
			    	<div class="mui-indicator"></div>
			    <% } %>
            </div> 
		</script>
		
		<!--广告-->
		<script type="text/html" id="recomment-detail">
			<div class="act_l adGo" id="haha">
				<img src="<%= recommentLi[0].pic %>"/>
			</div>
			<div class="act_r">
				<div class="act_top adGo">
					<img src="<%= recommentLi[1].pic %>"/>
				</div>
				<div class="act_l_b clearfix">
					<div class="act_b_l adGo">
						<img src="<%= recommentLi[2].pic %>"/>
					</div>
					<div class="act_b_r adGo">
						<img src="../img/xingkuanr.png"/>
					</div>
				</div>
			</div>
		</script>
		
		<!--热门推荐-->
		<script type="text/html" id="recommendTpl">
			<%if(recommendData.length==0){%>
				暂无推荐商品
			<%}else{%>
				<%for(var i=0;i<recommendData.length;i++){%>
					<li class="sy_recmd_list">
						<div class="box">
							<div class="pub_img">
								<a class="rcdPadding imga" onclick="goInfo('<%=recommendData[i].goods_id%>')"><img src="<%=recommendData[i].thumb%>" width="145" height="145" class="hotImg"></a>
							</div>
							<div class="pub_wz">
								<h3 class="overflow_clear"><a onclick="goInfo('<%=recommendData[i].goods_id%>')"><%=recommendData[i].title%></a></h3>
								<div class="nr_box mui-row">
									<div class="mui-col-sm-5 mui-col-xs-5 ">
							        	<p class="fl fontcl2">¥<%=recommendData[i].price%></p>
							        </div>
							       	<div class="mui-col-sm-4 mui-col-xs-4 PriceB">
							        	<p class="fl fontcl2"><sub class="black9">[优惠]</sub>
							        </div>
							        <div class="mui-col-sm-3 mui-col-xs-3 saled"></p>
										<p class="fl fontcl2"><sub class="saled black9">已售<%=recommendData[i].sales%></sub></p>
							      	</div>
							     </div>
							</div>
						</div>
					</li> 
				<%}%>
			<%}%>
		</script>
	<script type="text/javascript">
	//跳转详情
			function goInfo(goodsId){
				 //alert(goodsId)
				 openview({
				 	view:"market/mall-detail.html",
				 	extrasobj:{goodsId:goodsId}
				 })
			}
			$(".adGo").each(function(){
				$(this).click(function(){
					alert(2)
				openview({
				 	view:"market/mall-detail.html",
				 	extrasobj:{goodsId:1}
				 })
				})
			}) 
		mui.plusReady(function(){
//			document.getElementById("haha").addEventListener('tap', function() {
//				mui.confirm('MUI是个好框架，确认？', 'Hello MUI', ['取消', '确定'], function(e) {
//					if (e.index == 1) {
//						alert('你确定了');
//					} else {
//						alert('取消le');
//					}
//				}) 
//			},'div');
			
			//跳转页面
			var locallife = document.getElementsByClassName('locallife')[0];
			var h_report = document.getElementsByClassName('h_report')[0];
			var server = document.getElementsByClassName('server')[0];
			var ticket = document.getElementsByClassName('ticket')[0];
			var market = document.getElementsByClassName('market')[0];
			locallife.addEventListener('tap', function(){
				openview({
					view:'localLife/localLifeIndex.html'
				});
			});
			h_report.addEventListener('tap', function(){
				openview({
					view:'Hreport/noticeList.html',
				});
			});
			server.addEventListener('tap', function(){
				openview({
					view:'serveForPeople/serveForIndex.html',
				});
			});
			ticket.addEventListener('tap', function(){
				openview({
					view:'piaowu.html',
				});
			});
			market.addEventListener('tap', function(){
				openview({
					view:'market/market-Center.html',
				});
			});
			
			//打开搜索页面
			mui('.openSearch')[0].addEventListener('tap',function(){
				openview({
						view:'localLife/theSearch.html'
				});
			});
			//数据渲染
			var oldToken = plus.storage.getItem('oldToken');
//			console.log(serverimgUrl);
			
//			console.log(oldToken);
			mui.ajax(serverUrl +'/api/index/indexheaderdata',{
//				data:{userid : 148},
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
					console.log('banner返回'+JSON.stringify(data));
					var bannerObj = {};
					var recommentObj = {};
					bannerObj.bannerLi = JSON.parse(data.data.banner[0].banner);
					recommentObj.recommentLi = eval("(" +data.data.recomment[0].content +")");
					
//					alert(JSON.parse(data.data.recomment[0]));
					bannerObj.url = serverimgUrl;
					var html = template('banner-detail',bannerObj);
					document.getElementById('banner').innerHTML = html;
					var html2 = template('recomment-detail',recommentObj);
					document.getElementById('recomment').innerHTML = html2;
					
					//轮播图
					//获得slider插件对象
					var gallery = mui('.mui-slider');
					gallery.slider({
					  	interval:5000//自动轮播周期，若为0则不自动播放，默认为0；
					});
				},
				error:function(xhr,type,errorThrown){
					alert('响应失败  !');
				}
			});
			
			
			//热门推荐 数据渲染 
			var currentPage =1, numsPerPage=4;
			mui.ajax(serverUrl+'/api/mall/mallgooodslist', {
				data: {currentPage:currentPage,numsPerPage:numsPerPage,recommend:1,storeId:'',brand:'',keyword:'',order_type: 'price',desc:''},
				dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型 
					timeout:10000,//超时时间设置为10秒；	
					headers:{"token":oldToken}, 
					success:function(data){
						console.log('热门返回'+JSON.stringify(data));
						//获取并渲染  eval("("+data1+")");
						//var dataobj= eval("("+data.data.banner+")"); 
						if(data.errno==0){
						plus.nativeUI.closeWaiting();//关闭等待框
						var dataobj = data.data.return.data
						var recommendObj = {}
							recommendObj.myUrl = serverimgUrl;
							recommendObj.recommendData = dataobj
	                    document.getElementById("moll_recommend").innerHTML+=template("recommendTpl",recommendObj);
	                    mui("#upload")[0].innerHTML = "加载更多";
	                   	//上滑加载
						$(window).scroll(function(){
						　　var scrollTop = $(this).scrollTop();
						　　var scrollHeight = $(document).height();
						　　var windowHeight = $(this).height();
						　　if(scrollTop + windowHeight == scrollHeight){
						var nowpage = ++currentPage;
						if(nowpage<=data.data.return.totalPages){//当前页小于等于总页数时请求下一页
							mui("#upload")[0].innerHTML = "<img src='../img/balls.svg' />";
							console.log('可以请求数据');
							mui.ajax(serverUrl+'/api/mall/mallgooodslist',{ 									
								data:{currentPage:nowpage,numsPerPage:numsPerPage,recommend:1,storeId:'',brand:'',keyword:'',order_type: 'price',desc:''}, 
								dataType:'json',//服务器返回json格式数据
								type:'post',//HTTP请求类型 
								timeout:10000,//超时时间设置为10秒；	
								headers:{"token":oldToken}, 
								success:function(data){
									if(data.errno == 0){
										var dataobj = data.data.return.data
										var recommendObj = {}
											recommendObj.myUrl = serverimgUrl;
											recommendObj.recommendData = dataobj
					                    document.getElementById("moll_recommend").innerHTML+=template("recommendTpl",recommendObj);
					                    mui("#upload")[0].innerHTML = "";
									}else{
										--currentPage;//请求失败,继续请求当前页
										plus.nativeUI.closeWaiting();
										mui.toast("获取数据失败");
									}
									plus.nativeUI.closeWaiting();//关闭等待框
								},
								error:function(xhr,type,errorThrown){
									--currentPage;//请求失败,继续请求当前页
									mui.toast("当前网络不好请重试");
								}
							});
						}else{
							mui("#upload")[0].innerHTML = "没有数据了";
						}
						//加载下一部分结束
							　　}
						});
						}else{
							plus.nativeUI.closeWaiting();
							mui.toast("获取数据失败");
						}
						
					}, 
					error:function(xhr,type,errorThrown){
						//异常处理；
						console.log("获取失败！");
						mui.toast("当前网络不好请重试");
					}
			}); 
			
		 
		 mui('#recomment').on('tap','.adGo',function(){
		 	alert(1)
//		  	openview({
//		  		view:"market"
//		  	})
		  })
		})();
		
		
	</script>	
	</body>
	
</html>