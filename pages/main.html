<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>封面首页 - main</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../css/common.css">
		<link rel="stylesheet" type="text/css" href="../css/index.css">
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css"/>
		<link rel="stylesheet" href="../css/reset.css">
		<link rel="stylesheet" href="../css/one.css">
		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script type="text/javascript" src="../js/jquery.flexslider-min.js"></script>
		<script src="../js/swiper.min.js" type="text/javascript" ></script>
		<script src="../js/mui.min.js"></script>
		
		<script src="../js/app.js"></script>
		<!--引入模板引擎-->
		<script src="../js/artTemplate-native.js"></script>
		<style type="text/css">
			.hasManyCity .searchBox{
				width: 65%;
			}

			/*banner底部导航*/
			.mui-slider-indicator .mui-indicator{
				width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			.mui-slider-indicator .mui-active.mui-indicator{
				background-color: rgba(245,60,66,0.8);
				box-shadow: none;
				opacity: 1;
				border: none;
			}
			.mui-slider-item{
				position: relative;
				width: 100%;
				padding-top: 42%; 
				overflow: hidden;
			}
			.mui-slider-item img{
				position: absolute;
				width: 100%; 
				height:100%;
				top: 0;
			}
			.mui-slider{
				margin-top: 50px;
			}
			.rcdPadding{
				position: relative;
				display: inline-block;
				padding-top: 100%;
				width: 100%;
				overflow: hidden;
			}
			.rcdPadding img{
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
			}
		 
			.onetable{
				margin-top: 0;
				background-color: #fff;
				padding-bottom: 10px;
				margin-bottom: 0;
				border-bottom: 1px solid #eee;
			}
			.onetable p{
				margin-top: -10px;
				font-size: 11px;
				margin-bottom: 5px;
			}
			.fontcl2{
				font-size: 14px;
				padding-top: 5px;
				line-height: 20px;
				width: 100%;
			}
			.fontcl2 span{
				display: inline-block;
				width: 40%;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}
			.sy_recmd_list .pub_wz{
				position: relative;
				padding: 0 5%;
			}
			sub{
				bottom: 0;
				font-size: 70%;
			}
			.fr {
				position: absolute;
				float: right;
				display: block;
				top: 12px;
				right: 5px;
				font-size: 10px;
			}
			.sy_recmd_list .pub_wz .nr_box{
				border-top: none;
			}
			.sy_recmd_list .pub_wz .nr_box{
				margin-top: 0;
			}
			.onetable p{
				font-size: 13px;
			}
			.act_l img,.act_r img,.act_b_l img,.act_b_r img{
				height: 100%;
				overflow: hidden;
			}
			/*广告图片样式*/
			.activity{
				position: relative;
			}
			.act_l{
				height: 100%;
			}
			.act_r{
				height: 100%;
			}
			.act_top{
				height: 50%;
				overflow: hidden;
				top: 0;
				right: 0;
				position: absolute;
				width: 60%;
			}
			.act_l_b{
				position: absolute;
				bottom: 0;
				height: 50%;
				overflow: hidden;
			}
			.act_b_l, .act_b_r{
				width: 100%;
				height: 100%;
				overflow: hidden;
			}
			.sy_recmd_list .pub_img img{
				height: 100%;
			}
			.hotImg{
				/*height: 170px;
				max-height: 170px;
				min-height: 170px;*/
				overflow: hidden;
			}
			.mb10{
				background-color: #EFEFF4;
				color: #666;
				margin-bottom: 0px;
			}
			.mb10 img{
				width: 18px;
				margin-right: 5px;
			}
			.left{
				padding-left: 10px;
				padding: 5px 0;
				text-align: center;
				width: 100%;
			}
			.sy_title{
				border-bottom: none;
				border-top: none;
			}
			 
			.sy_recmd_list .box{
				border: none;
				margin: 3px;
				box-shadow: 0px 0px 1px #ccc;
			}
			.saled{
				text-align: right;
			}
			.PriceB{
				text-align: left !important;
			}
			table{
				overflow: scroll;
			}
			/*加载*/
			#upload{ 
				text-align: center;margin-bottom: 18px;margin-top:15px;font-size: 12px;
			}
			#upload img{width: 60px;margin-top: -27px;}
			
			.sy_recmd_list .pub_wz h3 a{
				color: #333;
				line-height: 18px;
				font-size: 13px;
				overflow: hidden;
				text-overflow: ellipsis;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
				width: 100%;
				display: -webkit-box;
				height:33px;
			}
			.sy_recmd_list_box{
				padding-left: 0;
			}
		 
			.imgWrap{
				width: 56px;
				height: 56px;
				border-radius: 50%;
				margin: 13px auto 5px;
			}
			.imgWrap img{
				width: 30px !important;
				margin: 13px auto !important;
			}
			.date{
				margin-top: 18px !important;
			}
			.imgWrap1{background-color: #ef5958;}
			.imgWrap2{background-color: #77b95d;}
			.imgWrap3{background-color: #7ed2f3;}
			.imgWrap4{background-color: #f9c94e;}
			.imgWrap5{background-color: #8ea4ca;}
			.imgWrap6{background-color: #ef99be;}
			.imgWrap7{background-color: #a881be;}
			.imgWrap8{background-color: #d1d2d4;}
			.qrcodeBtn {
				background: url(../img/shouyexiaoxi.svg) no-repeat;
				position: absolute;
				width: 50px;
				height: 100%;
				top: 0;
				right: 7px;
				background-size: 22px 22px;
				background-position: 7px 15px;
			}
			.hasManyCity .qrcodeBtn{width: 32px;}
			/*#header{
				opacity: 0;
				-webkit-transition: opacity 0.2s linear;
			}*/
		</style>
	</head>

	<body>
		<header class="hasManyCity mui-row" id="header">
			<div id="" class="cityBtn">邻水</div>
			<!--<div id="locaitonBtn" class="link-url locaitonBtn"></div>-->
			<div id="" class="searchBox">
				<a class="openSearch">
					<i class="icon-search"></i>
					<span>请输入您想找的内容</span>
				</a>
			</div>
			<a style=""><div id="xiaoxi" class="qrcodeBtn"></div></a>
		</header>
		<script src="../js/statusBar.js"></script><!--状态栏-->
		<!--<div id="container">-->		
		<div id="main">
			<div id="scroller">
				<!--轮播图-->
				<div class="mui-slider" id="banner"></div>
				<!--轮播图结束-->
				<!--banner数据渲染-->
				<script type="text/html" id="banner-detail">
					<div class="mui-slider-group mui-slider-loop">
					    <!--支持循环，需要重复图片节点-->
					    <div class="mui-slider-item mui-slider-item-duplicate">
					    	<img src="<%= url %><%= bannerList[bannerList.length-1].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    </div>
						<% for(var i=0;i<bannerList.length;i++){ %> 
					    	<div class="mui-slider-item">
					    		<img src="<%= url %><%=bannerList[i].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    	</div>
					     <% } %>
					    <!--支持循环，需要重复图片节点-->
					    <div class="mui-slider-item mui-slider-item-duplicate">
					    	<img src="<%= url %><%= bannerList[0].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    </div>
					</div>
					<div class="mui-slider-indicator">
						<div class="mui-indicator mui-active"></div>
						<% for(var i=0;i<bannerList.length-1;i++){ %>
					    	<div class="mui-indicator"></div>
					    <% } %>
		            </div> 
				</script>
			</div>
			<div class="onetable">
				<table> 
					<tbody>
						<tr>
							<td class="market"><div class="imgWrap imgWrap1"><img src="../img/theList/shop.png"/></div><br/><p>购物中心</p></td>
							<td class="locallife"><div class="imgWrap imgWrap2"><img src="../img/theList/life.png"/></div><br/><p>本地生活</p></td>
							<td class="ticket"><div class="imgWrap imgWrap3"><img src="../img/theList/pay.png"/></div><br /><p>充值缴费</p></td>
							<td class="loveBuy"><div class="imgWrap imgWrap4"><img src="../img/theList/tax.png"/></div><br /><p>优品汇</p></td>
						</tr>
						<tr>
							<td class="server"><div class="imgWrap imgWrap5"><img src="../img/theList/ser.png"/></div><br/><p>为民服务</p></td>
							<td class="fil"><div class="imgWrap imgWrap6"><img src="../img/theList/date.png"/ style="margin-top: 20px !important;"></div><br/><p>一键钟情</p></td>
							<td class="gameList"><div class="imgWrap imgWrap7"><img src="../img/theList/game.png"/></div><br/><p>游戏娱乐</p></td>
							<td class="h_report"><div class="imgWrap imgWrap8"><img src="../img/theList/new.png"/></div><br/><p>家乡报道</p></td>
						</tr>
					</tbody>
				</table>
			</div>
			<!--<div class="bor"></div>-->	
			<!--广告-->
			<div class="mui-row" style="background-color: white;margin: 10px 0 0 0;" id="ad"></div> 
			<!--推荐列表-->
			<div class="sy_recmd">
				<!--推荐列表-->
				<div class="sy_title mb10">
					<span class="left"><img src="../img/center/hot.png"/>热门推荐</span>
					<!--<a href="#" class="fr morethree">更多&gt;&gt;</a>-->
				</div> 
				<div class="sy_recmd_list_box">
					<ul>
						<div id="moll_recommend"></div>
					</ul>
					<div class="clear"></div>
				</div> 
				<!--热门推荐-->
				<script type="text/html" id="recommendTpl">
					<%if(recommendData.length==0){%>
						暂无推荐商品
					<%}else{%>
						<%for(var i=0;i<recommendData.length;i++){%>
							<li class="sy_recmd_list">
								<div class="box">
									<div class="pub_img">
										<a class="rcdPadding" onclick="goInfo('<%=recommendData[i].goods_id%>','<%=recommendData[i].storeid%>')">
											<img src="<%=myUrl %><%=recommendData[i].thumb%>" onerror="javascript:this.src='../img/market/banner.png';" width="145" height="145" class="hotImg">
										</a>
									</div>
									<div class="pub_wz">
										<h3 class="overflow_clear"><a onclick="goInfo('<%=recommendData[i].goods_id%>','<%=recommendData[i].storeid%>')"><%=recommendData[i].title%></a></h3>
										<div class="nr_box mui-row">
											<div class="mui-col-sm-5 mui-col-xs-5 ">
									        	<p class="fl fontcl2"><sub>¥</sub>&nbsp;<%=recommendData[i].price%></p>
									       </div>
									        <div class="mui-col-sm-7 mui-col-xs-7 saled"></p>
												<p class="fl fontcl2"><sub class="saled black9">已售<%=recommendData[i].sales%></sub></p>
									      	</div>
									     </div>
									</div>
								</div>
							</li> 
						<%}%>
					<%}%>
				</script> 
				<div class="upload text-center text-xs gray" id="upload"></div>
			</div>
		</div>
		<!--</div>-->
		 
		
		<!--广告-->
		<script type="text/html" id="ad-detail">
			<div class="mui-col-xs-6 rowpad">
				 <img src="<%=myUrl %><%= adLi[0].pic %>" class="allimga" alt="" onclick="goAdv(<%= adLi[0].id %>)" onerror="javascript:this.src='../img/market/banner.png';"/>
			</div>
			<div class="mui-col-xs-6 rowpad">
				<div class="rpad clearfloat"> 
					<img src="<%=myUrl %><%= adLi[1].pic %>" class="allimga" alt="" onclick="goAdv(<%= adLi[0].id %>)" onerror="javascript:this.src='../img/market/banner.png';"/> 
				</div>
				<div class="rpad clearfloat"> 
					<img src="<%=myUrl %><%= adLi[2].pic %>" class="allimga" alt="" onclick="goAdv(<%= adLi[0].id %>)" onerror="javascript:this.src='../img/market/banner.png';"/> 
				</div>
			</div> 
		</script>
		
	
	<script type="text/javascript">
	//跳转详情
		function goInfo(goodsId,storeId){
			if(storeId==0){
				 openview({
				 	view:"market/yphDetail.html",
				 	extrasobj:{goodsId:goodsId}
				 })
			}else{
				 openview({
				 	view:"market/mall-detail.html",
				 	extrasobj:{goodsId:goodsId}
				 })
			}
 
		}
		
		//根据广告跳转到对应商店详情
		function goAdv(AdvId){
			openview({
				view:'Adv-detail.html',
				extrasobj:{AdvId:AdvId}
			})
		}
		//点击进入商品详情
		$(".adGo").each(function(){
			$(this).click(function(){
				openview({
				 	view:"market/mall-detail.html",
				 	extrasobj:{goodsId:1}
				 })
			})
		}) 
		mui.plusReady(function(){ 
			plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
			//跳转页面
			var Timetoken = null;
			var oldToken = null; 
			oldToken = plus.storage.getItem('oldToken');
			console.log(oldToken);
			clearInterval(Timetoken);
			againfun();
			Timetoken = setInterval(function(){//等待oldToken加载方法
				if(plus.storage.getItem('oldToken')){
					clearInterval(Timetoken);
					oldToken = plus.storage.getItem('oldToken');
					againfun();
				}
			},200)
			function againfun(){
				var locallife = document.getElementsByClassName('locallife')[0];
				var h_report = document.getElementsByClassName('h_report')[0];
				var server = document.getElementsByClassName('server')[0];
				var ticket = document.getElementsByClassName('ticket')[0];
				var market = document.getElementsByClassName('market')[0];
				var fil =  document.getElementsByClassName('fil')[0];
				var loveBuy = document.getElementsByClassName('loveBuy')[0];
				var gameList = document.getElementsByClassName('gameList')[0];
				locallife.addEventListener('tap', function(){
					openview({
						view:'localLife/localLifeIndex.html'
					});
				});
				h_report.addEventListener('tap', function(){
					openview({
						view:'Hreport/noticeList.html'
					});
				});
				server.addEventListener('tap', function(){
					openview({
						view:'serveForPeople/serveForIndex.html',
					});
				});
				ticket.addEventListener('tap', function(){
					openview({
						view:'piaowu.html',
					});
				});
				market.addEventListener('tap', function(){
					openview({
						view:'market/market.html',
						id:"market"
					});
				});
				fil.addEventListener('tap', function(){
					openview({
						view:'appriciate/apprenticeDetail.html',
						extrasobj:{activityId:1}
					});
				});
				loveBuy.addEventListener('tap', function(){
					openview({
						view:'market/youpinhui-Center.html',
					});
				});
				gameList.addEventListener('tap', function(){
					openview({
						view:'game/gameList.html',
						id:'gameList',
					});
				});
				//打开搜索页面
				mui('.openSearch')[0].addEventListener('tap',function(){
					openview({
						view:'localLife/theSearch.html'
					});
				});
				//打开消息
				mui('#xiaoxi')[0].onclick = function(){
					if(plus.storage.getItem('myToken')){ 
						openview({
							view:'personal/my-info.html'
						});
					}else{//没登陆直接打开登录页面
						mui.toast('请登录');
						openview({
							view:'login.html'
						});
					}
				};
			}//重载方法结束
			
			//广告 数据渲染
			mui.ajax(serverUrl +'/api/index/ads',{
				data:{ad_type:1},
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
//					alert(JSON.stringify(data.data)); 
					var adObj = {};
					adObj.adLi = data.data;
					adObj.myUrl = serverimgUrl;
					var html = template('ad-detail',adObj);
					document.getElementById('ad').innerHTML = html;
				},
				error:function(xhr,type,errorThrown){
					console.log('响应失败  !');
				}
			});
			//banner跳转
			window.bannerGo=function(url,name){ 
			  	openview({
				 	view:"bannerTpl.html",
				 	id:"bannerTpl",
				 	extrasobj:{bannerUrl:url,bannerName:name}
				})
			}
			var currentPage =1, numsPerPage=4;
 			//热门推荐 数据渲染 
			mui.ajax(serverUrl+'/api/mall/mallgooodslist', {
				data: {currentPage:currentPage,numsPerPage:numsPerPage,isRecommend:1,differentiate:1,storeId:'',brand:'',keyword:'',order_type: 'price',desc:''},
				dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型 
					timeout:10000,//超时时间设置为10秒；	
					headers:{"token":oldToken}, 
					success:function(data){
//							  alert(JSON.stringify(data))
						//获取并渲染  eval("("+data1+")");
						//var dataobj= eval("("+data.data.banner+")"); 
						if(data.errno==0){
						plus.nativeUI.closeWaiting();//关闭等待框
						var dataobj = data.data.return.data
						var recommendObj = {}
							recommendObj.myUrl = serverimgUrl;
							recommendObj.recommendData = dataobj
	                    document.getElementById("moll_recommend").innerHTML=template("recommendTpl",recommendObj);
	                    mui("#upload")[0].innerHTML = "加载更多";
	                    	//上滑加载
	                   $(window).scroll(function(){
						　　var scrollTop = $(this).scrollTop();
						　　var scrollHeight = $(document).height();
						　　var windowHeight = $(this).height();
						　　if(scrollTop + windowHeight == scrollHeight){
								var nowpage = ++currentPage;
								if(nowpage<=data.data.return.totalPages){//当前页小于等于总页数时请求下一页
									mui("#upload")[0].innerHTML = "<img src='../img/balls.svg'/>";
									console.log('可以请求数据');
									mui.ajax(serverUrl+'/api/mall/mallgooodslist',{ 									
										data:{currentPage:currentPage,numsPerPage:numsPerPage,isRecommend:1,differentiate:1,storeId:'',brand:'',keyword:'',order_type: 'price',desc:''}, 
										dataType:'json',//服务器返回json格式数据
										type:'post',//HTTP请求类型 
										timeout:10000,//超时时间设置为10秒；	
										headers:{"token":oldToken}, 
										success:function(data){
											if(data.errno == 0){
												var dataobj = data.data.return.data
												var recommendObj = {}
													recommendObj.myUrl = serverimgUrl;
													recommendObj.recommendData = dataobj
							                    document.getElementById("moll_recommend").innerHTML+=template("recommendTpl",recommendObj);
							                    mui("#upload")[0].innerHTML = "";
											}else{
												--currentPage;//请求失败,继续请求当前页
												plus.nativeUI.closeWaiting();
												mui.toast("获取数据失败");
											}
											plus.nativeUI.closeWaiting();//关闭等待框
										},
										error:function(xhr,type,errorThrown){
											--currentPage;//请求失败,继续请求当前页
											mui.toast("当前网络不好请重试");
										}
									});
								}else{
									mui("#upload")[0].innerHTML = "没有数据了";
								}
							}
						});
					}else{
						plus.nativeUI.closeWaiting();
						mui.toast("获取数据失败");
					}
					
				}, 
				error:function(xhr,type,errorThrown){
					//异常处理；
					console.log("获取失败！");
					plus.nativeUI.closeWaiting();
					mui.toast("当前网络不好请重试");
				}
			}); 
		})();
	</script>	
	</body>
	<!--banner-->
	<script type="text/javascript">
	mui.plusReady(function(){ 
		//获取缓存
		var oldToken = plus.storage.getItem('oldToken');
//		var userId = plus.storage.getItem("userid");
		plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
		
		mui.ajax(serverUrl+'/api/index/banner',{
			data:{banner_type:1},
			dataType:'json',
			type:'post',
			timeout:10000,
			headers:{"token":oldToken},	 
			success:function(data,type,xhr){
//				alert(JSON.stringify(data))
				bannerObj={};
				bannerObj.bannerList = eval("("+data.data.banner+")");
				bannerObj.url = serverimgUrl;
				var html = template('banner-detail',bannerObj);
				document.getElementById('banner').innerHTML = html;
				plus.nativeUI.closeWaiting();//关闭等待框
				//轮播图,获得slider插件对象
				var gallery = mui('.mui-slider');
				gallery.slider({
				  	interval:5000//自动轮播周期，若为0则不自动播放，默认为0；
				});
			},
			error:function(xhr,type,errorThrown){
				alert('响应失败  !');
			}
		}); 
	})
	</script>
	
</html>