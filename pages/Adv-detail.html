<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>广告详情</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../css/common.css">
		<link rel="stylesheet" type="text/css" href="../css/index.css">
		<link rel="stylesheet" type="text/css" href="../css/mui.css"/>
		<link rel="stylesheet" type="text/css" href="../css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="../css/one.css"/>
		<script src="../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script type="text/javascript" src="../js/app.js"></script>
		<script type="text/javascript" src="../js/artTemplate-native.js"></script>
		<style type="text/css">
			.infocon h4{
				padding: 20px 0;
			}
			.infomidd p {
				margin: 10px;
				/*text-indent: 30px;*/
				font-size: 15px;
				line-height: 20px;
			}
			
			.fixfoot{
				height: 50px;
				background-color: #F53C42;
				position: fixed;
				bottom: 0px;
			}
			.fixfoot_le p {
				background-color: rgba(255,255,255,0.3);
				border-radius: 20px;
				border: none;
				color: #fff;
			}
			.fixfoot_le{
				width: 70%;
			}
			.fixfoot_ri{
				width: 30%;
			}
			.fixfoot_ri span{
				color: #fff;
				font-size: 28px;
			}
			.ymt{
				padding: 0 15px 60px 15px;
			}
			
			.noticeFooter{
				float: right;
				margin: 50px;
			}
			.noticeFooter p{
				line-height: 30px;
				text-align: right;
			}
			.AdContent{
				width: 100%;
				overflow: hidden;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">广告详情</h1>
			<!--<a href="setup.html" class="fr shoucang sousuo mui-icon"><i class="iconfont icon-fenxiang"></i></a>-->
		</header>
		<script src="../js/statusBar.js"></script><!--状态栏-->
		<div class="infocon ymt ymb" id="ad"></div>
			
		<script type="text/html" id="ad-detail">
			<h4><%= adLi.title %></h4>
			<div class="infomidd">
				<img src="<%= myUrl %><%= adLi.pic %>"/>
				<div id="AdContent"></div>
			</div>
			<div class="noticeFooter">
				<p><%= adLi.create_time.split('T')[0] %></p>
			</div>
		</script>
		<script type="text/javascript">
			var infolist = mui('.infolist div');
			for(var i=0; i<infolist.length; i++ ){
				infolist[i].addEventListener('tap',function(){
					mui.openWindow({
						url:'listinfo.html',
					    styles:{
					      top:0,//新页面顶部位置 
					    },
					    waiting:{
					      autoShow:false,//自动显示等待框，默认为true
					    }
					})
				})
			}
			mui.plusReady(function(){ 
				var oldToken = plus.storage.getItem('oldToken');
				var AdvId = plus.webview.currentWebview().AdvId;
//				alert(AdvId)
				plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
				mui.ajax(serverUrl +'/api/index/adsinfo',{
					data:{id:AdvId},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"token":oldToken},	 
					success:function(data,type,xhr){
//						alert(JSON.stringify(data.data));
						var adObj = {};
						adObj.adLi = data.data;
						adObj.myUrl = serverimgUrl;
						var html = template('ad-detail',adObj);
						document.getElementById('ad').innerHTML = html;
						//详情
						if(data.data.content) {
							console.log('详情', data.data.content);
							var detailsdom = parseDom(data.data.content);
							var detailsimg = detailsdom.getElementsByTagName('img');
							mui.each(detailsimg, function(index, element) {
								console.log(element.src.split('pages')[1]);
								element.src = serverimgUrl + element.src.split('pages')[1];
								console.log(element.src);
								element.onerror = function() {
									element.src = '../img/market/nodata.svg';
								}
							})
							console.log('节点', detailsdom);
							//			                     	document.getElementById("textInfo").innerHTML=data.data.content;
//						document.getElementById('AdContent').innerHTML = data.data.content;
						document.getElementById("AdContent").appendChild(detailsdom);
						}  
						
						plus.nativeUI.closeWaiting();//关闭等待框
						
					},
					error:function(xhr,type,errorThrown){
						console.log('响应失败  !');
					}
				});
			})
			function parseDom(arg) { //节点转换方法
				　　
				var objE = document.createElement("div");　　
				objE.innerHTML = arg;　　
				return objE;
			};
		</script>
	</body>
	
</html>