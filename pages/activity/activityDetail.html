<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>活动详情</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<style type="text/css">
			.mui-bar{height: 50px;}
			.mui-title,.mui-icon{line-height: 50px;}
			.mui-bar .mui-icon{padding: 0;
			}
			.mui-bar-nav.mui-bar .mui-icon,.mui-title,.mui-icon{color: #fff;
			}
			.mui-bar-nav{box-shadow: none;
			}
			.mui-icon{line-height: 50px;
			}	
			.mui-icon .iconfont{font-size: 18px;
			}
			.dealcard, .cinemacard{margin-top: 50px;
			}
			.dealcard .dealcard-img img{height: 60px;
				overflow: hidden;
			}
		 	.shoucang .iconfont{font-size: 18px;
			}
			
			#main{margin-top: 50px;
			}
			.dealcard, .cinemacard{margin-top: 45px;
			}
			.dealcard, .cinemacard{margin-top: 45px;
			}
			/*banner图片固定高度比例*/
			.goodsImg{
				position: relative;
				display: inline-block;
				width: 100%;
				overflow: hidden;
			}
			.list,.bottom{
				border-bottom: 1px solid #EFEFF4 !important;
				border-top: 1px solid #EFEFF4 !important;
			}
			.top,.farm{
				border-bottom: none !important;
			}
			.farmtc .bt{
				border-top: 1px solid #EFEFF4 !important;
			} 
			.merchant .biz-call .phone{margin-top: -7px;}
			.rentingtopbot {padding-bottom: 40px !important;}
			
			.red1{
				color: #f53c42 !important;
				margin-bottom: 10px;
				font-size: 18px !important;
			}
			.time img{
				width: 15px;
				margin-right: 5px;
				margin-top: -2px;
			}
			.mui-btn-block {
				font-size: 14px;
				display: block;
				width: 90%;
				margin: 10px 5%;
				padding: 8px 0;
			}
			.farm{
				position: relative;
			}
			.biz-call img{
				width: 60%;
			}
			.biz-call p{
				line-height: 30px;
				float: right;
				font-size: 11px !important;
				width: 100%;
				text-align: center;
				color: #999 !important;
			}
			.merchant .biz-call{
				width: 20%;
				height: auto !important;
				line-height: inherit;
			}
			.biz-detail{
				margin-top: 10px;
			}
			.greencss{
				color: #32B16C !important;
			}
			#content img{
				max-width: 100%;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" id="header"> 
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">活动详情</h1>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<!--详情内容-->
		<div id="main"></div>
		<script type="text/html" id="details">
			<img src="<%=myUrl %><%= list.picImg%>" class="goodsImg">
			<div class="farm clearfloat">
				<div class="top rentingtop clearfloat box-s">
					<p class="red1"><%= list.title%></p>
					<div class="merchant">
						<div class="biz-detail">
							<p class="time">
								<img src="../../img/time.png"/>活动时间：<%= list.begin_time.split('T')[0]%>~<%= list.end_time.split('T')[0]%>
							</p>
							<p class="time greencss">
								<img src="../../img/add.png"/>活动地点：<%= list.site%>
							</p>
							<p class="time ">
								<img src="../../img/liulan.svg"/>浏览次数：<%= list.read%>  次
							</p>
						</div>
						<div class="biz-call" onclick="openMerchant(<%= list.storeid%>)">
							<img src="../../img/store.png"/>
							<p>查看商户</p>
						</div>
					</div>
				</div>
			</div>
			<div class="farmtc clearfloat mt10">
				<p class="bt box-s">活动详情</p>
			</div>
			<div class="farm clearfloat">
				<div id="content" class="top rentingtop rentingtopbot clearfloat box-s">
				</div>	
			</div>
		</script>
		
		
	</body>
	<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
	mui.plusReady(function(){ 
		plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});
		//获取数据
		var oldtoken = plus.storage.getItem('oldToken');
		var activityId = plus.webview.currentWebview().activityId;
		mui.ajax(serverUrl+'/api/index/couponoractivityinfo',{
			data:{"id":activityId},
			type:'post',
			timeout:10000,
			headers:{"token":oldtoken},	               				
			success:function(data){
				//alert(mytoken);
				console.log('活动详情返回',data); 
				if(data.errno == 0){
					var objdata = {};
					objdata.list = data.data.system_activity; 
					objdata.myUrl = serverimgUrl; 
					var html=template("details",objdata);
					document.getElementById("main").innerHTML=html;
					//详情
					if(objdata.list.content) {
						var detailsdom = parseDom(objdata.list.content);
						var detailsimg = detailsdom.getElementsByTagName('img');
						mui.each(detailsimg, function(index, element) {
							if(element.src.indexOf('pages/activity')>-1){
								element.src = serverimgUrl + element.src.split('pages/activity')[1];
								element.onerror = function() {
									element.src = '../../img/market/nodata.svg';
								}
							}
						})
						document.getElementById("content").appendChild(detailsdom);
					}else{
						document.getElementById("content").innerHTML = '<div style="font-size:0.12rem;color:gray;padding:5%;text-align: center;">暂无详情</div>'
					}
						
						
				}else{
					mui.toast('获取用户信息失败');
				}
				plus.nativeUI.closeWaiting();
			},
			error:function(xhr,type,errorThrown){
				plus.nativeUI.closeWaiting();
				alert('响应失败  !');
			}
		});
		function parseDom(arg) { //节点转换方法
			var objE = document.createElement("div");　　
			objE.innerHTML = arg;　　
			return objE;
		};
	});
	//打开商户详情
	function openMerchant(id){
		openview({
			view:'../market/shophome.html',
			extrasobj:{storeId:id}
		})
	}
	</script>
</html>