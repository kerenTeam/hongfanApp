<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>房产列表</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		
		<!--<script type="text/javascript" src="../../js/jquery.min.js"></script>-->
		<style type="text/css">
			.mui-bar{height: 50px;
			}
			.mui-title,.mui-icon{line-height: 50px;
			}
			.mui-bar .mui-icon{padding: 0;
			}
			.mui-bar-nav.mui-bar .mui-icon,.mui-title,.mui-icon{color: #fff;
			}
			.mui-bar-nav{box-shadow: none;
			}
			.mui-icon{line-height: 50px;
			}	
			.mui-icon .iconfont{font-size: 18px;
			}
			.dealcard, .cinemacard{margin-top: 50px;
			}
			.dealcard .dealcard-img img{height: 60px;overflow: hidden;
			}
			#upload{text-align: center;margin: 30px;font-size: 15px;
			}
			#upload img{width: 60px;margin-top: -15px;}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">房产列表</h1>
			<a class="fr mui-icon" id="theSearch" href="theSearch.html"><i class="iconfont icon-sousuo"></i></a>
		</header>	
		<!-- screening -->
		<div class="screening">
		    <ul>
		        <li class="Brand">全部分类</li>
		        <li class="Regional">全城</li>
		        <li class="Sort">智能排序</li>
		    </ul>
		</div>
		<!-- End screening -->		
		<!-- Category -->
		<div class="Category-eject">
		    <ul class="Category-w" id="Categorytw">
		        <li onclick="Categorytw(this)">全部商家</li>
		        <li onclick="Categorytw(this)">维修</li>
		        <li onclick="Categorytw(this)">保洁</li>
		        <li onclick="Categorytw(this)">开锁</li>
		        <li onclick="Categorytw(this)">保姆</li>
		    </ul>
		    <ul class="Category-t" id="Categoryt">
		        <li onclick="Categorytw(this)">维修</li>
		        <li onclick="Categorytw(this)">保洁</li>
		        <li onclick="Categorytw(this)">开锁</li>
		        <li onclick="Categorytw(this)">保姆</li>
		    </ul>
		</div>
		<!-- End Category -->
		<!-- grade -->
		<div class="grade-eject">
		    <ul class="grade-w" id="gradew">
		        <li onclick="gradet(this)">全重庆</li>
		        <li onclick="gradet(this)">主城九区</li>
		        <li onclick="gradet(this)">郊区</li>
		        <li onclick="gradet(this)">县（含自治县）</li>
		    </ul>
		    <ul class="grade-t" id="gradet">
		        <li onclick="gradet(this)">全重庆</li>
		        <li onclick="gradet(this)">主城九区</li>
		        <li onclick="gradet(this)">郊区</li>
		        <li onclick="gradet(this)">县（含自治县）</li>
		    </ul>
		    <ul class="grade-s" id="grades">
		        <li onclick="grades(this)">全主城九区</li>
		        <li onclick="grades(this)">渝中区</li>
		        <li onclick="grades(this)">大渡口区</li>
		        <li onclick="grades(this)">江北区</li>
		        <li onclick="grades(this)">沙坪坝区</li>
		        <li onclick="grades(this)">九龙坡区</li>
		        <li onclick="grades(this)">南岸区</li>
		        <li onclick="grades(this)">北碚区</li>
		        <li onclick="grades(this)">渝北区</li>
		        <li onclick="grades(this)">巴南区</li>
		        <li onclick="grades(this)">经济技术开发区</li>
		    </ul>
		</div>
		<!-- End grade -->
		<!-- Category -->
		<div class="Sort-eject Sort-height">
		    <ul class="Sort-Sort" id="Sort-Sort">
		        <li onclick="Sorts(this)">智能排序</li>
		        <li onclick="Sorts(this)">离我最近</li>
		        <li onclick="Sorts(this)">好评优先</li>
		        <li onclick="Sorts(this)">最新发布</li>
		        <li onclick="Sorts(this)">人气优先</li>
		        <li onclick="Sorts(this)">价格最低</li>
		        <li onclick="Sorts(this)">价格最高</li>
		    </ul>
		</div>
		<!-- End Category -->
		<div id="container">		
			<div id="main">
				<section class="dealcard-waimai">
					<dl class="dealcard" id="buildlistdiv">
						<!--<dd class="page-link">
							<a href="javascript:;">
								<div class="dealcard-img imgbox"> <img src="../../img/theList/build-detail.jpg" alt=""> </div>
								<div class="dealcard-block-right">
									<div class="brand">三室一厅</div>
									<div class="title ">
										<span class="star">
											<i class="full"></i>
											<i class="full"></i>
											<i class="full"></i>
											<i class="half"></i>
											<i></i>
										</span>
									</div>
									<div class="price"> 
										<span> 24小时 服务诚信商家</span>
									</div>
								</div>
							</a>
						</dd>-->
					</dl>
					<script type="text/html" id="buildlist">
						<% for(var i=0; i<list.length; i++){%>
							<dd class="page-link" onclick="opendetails(<%= list[i].house_id%>)">
							<a href="javascript:;">
								<div class="dealcard-img imgbox"> <img src="<%= list[i].list_pic%>" alt=""> </div>
								<div class="dealcard-block-right">
									<div class="brand"><%= list[i].name%></div>
									<div class="title ">
										<span class="star">
											<i class="full"></i>
											<i class="full"></i>
											<i class="full"></i>
											<i class="half"></i>
											<i></i>
										</span>
									</div>
									<div class="price"> 
										<span> <%= list[i].area_address%></span>
									</div>
								</div>
							</a>
						</dd>
						<%}%>	
					</script>
				</section>
				<div class="upload text-center text-xs gray" id="upload"></div>
			</div>
		</div>
	</body>
	<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
(function(){
mui.plusReady(function(){
	var oldtoken = plus.storage.getItem('oldToken');
	plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
	Loading(1,1,7);//加载数据,包括上滑加载
	//加载方法
	function Loading(Ctype_name,CcurrentPage,CnumsPerPage){
		mui.ajax(serverUrl+'/api/localservice/houselist',{ 									
			data:{currentPage:1,
				  numsPerPage:5,
				  house_type:1,
				  house_layout:'', 
				  avg_price:'',
				  house_area:300,
				  orderType:1,
				  descOrasc:''}, 
			dataType:'json',//服务器返回json格式数据
			type:'post',//HTTP请求类型 
			timeout:10000,//超时时间设置为10秒；	
			headers:{"token":oldtoken}, 
			success:function(data){
				if(data.errno == 0){
					console.log(data);
					var dataobj = {};
					dataobj.list = data.data.data; 
					//获取并渲染用户信息
					var html=template("buildlist",dataobj);
					document.getElementById("buildlistdiv").innerHTML += html;
					if(data.data.totalPages){
						mui("#upload")[0].innerHTML = " ";
					}else{
						mui("#upload")[0].innerHTML = "没有数据了 ";
					}
					
					//滚动到底部加载
					$(window).scroll(function(){
					　　var scrollTop = $(this).scrollTop();
					　　var scrollHeight = $(document).height();
					　　var windowHeight = $(this).height();
					　　if(scrollTop + windowHeight == scrollHeight){
						//加载下一部分
						var nowpage = ++CcurrentPage;
						if(nowpage<=data.data.totalPages){//当前页小于等于总页数时请求下一页
							mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg' />";
							console.log('可以请求数据');
							mui.ajax(serverUrl+'/api/localservice/houselist',{ 									
								data:{currentPage:1,
									  numsPerPage:5,
									  house_type:1,
									  house_layout:'',
									  avg_price:'',
									  house_area:300,
									  orderType:1,
									  descOrasc:''},  
								dataType:'json',//服务器返回json格式数据
								type:'post',//HTTP请求类型 
								timeout:10000,//超时时间设置为10秒；	
								headers:{"token":oldtoken}, 
								success:function(data){
									if(data.errno == 0){
										var dataobj = {};
										dataobj.list = data.data.data; 
										//获取并渲染用户信息
										var html=template("buildlist",dataobj);
										document.getElementById("buildlistdiv").innerHTML += html;
										mui("#upload")[0].innerHTML = "上滑加载 ";
									}else{
										--CcurrentPage;//请求失败,继续请求当前页
										mui.toast("获取数据失败");
									}
									plus.nativeUI.closeWaiting();//关闭等待框
								},
								error:function(xhr,type,errorThrown){
									--CcurrentPage;//请求失败,继续请求当前页
									mui.toast("当前网络不好请重试");
								}
							});
						}else{
							mui("#upload")[0].innerHTML = "没有数据了";
						}
						//加载下一部分结束
							　　}
						});
				}else{
					mui.toast("获取数据失败");
				}
				plus.nativeUI.closeWaiting();//关闭等待框
			},
			error:function(xhr,type,errorThrown){
				plus.nativeUI.closeWaiting();//关闭等待框
				mui.toast("当前网络不好请重试");
			}
		});
	}
});
	
	
	
	
	
	
	
//			var theDetail = document.getElementsByClassName('page-link')[0];
//			theDetail.addEventListener('tap', function(){
//				openview({
//					view:'build-detail.html',
//				})
//			});
})();
//跳转详情
function opendetails(id){
	openview({
		view:'build-detail.html', 
		extrasobj:{name:id}
	})
}
	</script>
</html>