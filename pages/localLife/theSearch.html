<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>搜索</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<style type="text/css">
		 .mui-search:before{
		 	top:58%;
		 }
			.mui-bar{
				height: 50px;
			}
			.mui-title,.mui-action-back{
				line-height: 50px !important;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			.mui-bar-nav.mui-bar .mui-icon,.mui-title,.mui-icon{
				color: #fff;
			}
			.mui-bar-nav{
				box-shadow: none;
			}
			.mui-icon .iconfont{
				font-size: 18px;
			}
		
			.theSearch{
				width: 100%;
				background-color: #fff;
				margin-top: 50px;
				padding-top: 1px;
			}
			.mui-input-row .mui-btn+input, .mui-input-row label+input, .mui-input-row:last-child{
				margin: 10px;
			}
			input[type=search]{
				margin-bottom: 10px;
			}
			.mui-icon-search,.mui-icon-arrowright{
				color: #ddd;
				vertical-align: middle;
			}
			 .searchOut{
			 	display: none;
			 	position: fixed;
			 	top: 0px;
			 	width: 100%; 
			 }
			 .mui-icon-back:before, .mui-icon-left-nav:before {
				margin-left: 10%;
			}
			 #searchdiv{width: 86%;float: left;border-bottom: 1px solid #fff;height: 45px;}
			 .mui-bar{padding: 0 1%;}
			 #words{height: 100%;background: none;border: none;padding: 0;margin: 0;padding-top: 8px;
    padding-left: 7px;padding-right: 8px;color: #fff;width: 100%;text-align: left;}
		    #words::-webkit-input-placeholder {color:rgba(255, 255, 255, 0.54);}
		#searchdiv img{width: 7%;margin-left: 9px;margin-bottom:7px;} 
		.historyBox{padding-top: 63px;}
		#searchf{display: inline-block;width: 87%;margin-top: 5px;}
		</style> 
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize" style="width: 12%;float: left;margin: 0;padding: 0;"></a>
		    <!--<h1 class="mui-title">搜索</h1>-->
		    <div id="searchdiv" >
		    	<form onsubmit="submitTest();return false;" id="searchf">
		    		<input type="search" id="words" class="" placeholder="请输入搜索内容">
				</form>
		    	
		    	<img src="../../img/sousuo.svg"/ onclick="submitTest();" >
		    </div>
		     
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<!--<div class="theSearch">
			<div class="mui-input-row mui-search">
			   
			</div>
		</div>-->
		<div id="container">
			<section class="hotBox" style="display: none;">
				<div class="title">热门搜索</div>
				<ul class="hotKeyUl">
					<li>
						<a href="#">酒店</a>
					</li>
					<li>
						<a href="#">火锅</a>
					</li>
					<li>
						<a href="#">料理</a>
					</li>
					<li>
						<a href="#">酒店</a>
					</li>
					<li>
						<a href="#">电影</a>
					</li>
					<li>
						<a href="#">家政</a>
					</li>
					<li>
						<a href="#">洗车</a>
					</li>
					<li>
						<a href="#">美妆</a>
					</li>
				</ul>
			</section>
			
			<!--搜索历史-->
			
			<div id="record">
				 
			</div>
				<script id="recordTpt2" type="text/html">
					<section class="historyBox" style="">
					<div class="title">搜索历史</div>
					<ul>
					 	<li class="clear clearStr">暂无搜索历史</li>
					</ul>
				</section>
				</script>	
				<script id="recordTpt" type="text/html">
					<%if(data.length==0){%>
						<!--<div class="searchRecord">
							&nbsp;&nbsp;搜索记录:无
						</div> -->
						<%}else{%>
							<section class="historyBox" style="">
								<div class="title">搜索历史</div>
								<ul>
									<%for(var i=data.length-1;i>=0;i--){%>
										<li class="link-url"><span class="mui-icon mui-icon-search"></span> <%=data[i]%><span class="mui-icon mui-icon-arrowright fr"></span></li>
									<%}%>
									 <li class="clear clearStr">清除搜索记录</li>
								</ul>
							</section> 
							<%}%>
					
				</script> 
		 </div>
		 <!--搜索结果-->
		    <section class="historyBox searchOut" style=""> 
				<ul>
					<li class="link-url"><span class="mui-icon mui-icon-search"></span> 食物<span class="mui-icon mui-icon-arrowright fr"></span></li>
					<li class="link-url"><span class="mui-icon mui-icon-search"></span> 食物<span class="mui-icon mui-icon-arrowright fr"></span></li>
					<li class="link-url"><span class="mui-icon mui-icon-search"></span> 食物<span class="mui-icon mui-icon-arrowright fr"></span></li>
				</ul>
			</section>
	</body>
	<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		mui.plusReady(function(){
			//自动弹出输入法
		  	var nativeWebview, imm, InputMethodManager;
			var initNativeObjects = function() {
			    if (mui.os.android) {
			        var main = plus.android.runtimeMainActivity();
			        var Context = plus.android.importClass("android.content.Context");
			        InputMethodManager = plus.android.importClass("android.view.inputmethod.InputMethodManager");
			        imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);
			    } else {
			        nativeWebview = plus.webview.currentWebview().nativeInstanceObject();
			    }
			};
			var showSoftInput = function() {
			    if (mui.os.android) {
			        imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);
			    } else {
			        nativeWebview.plusCallMethod({
			            "setKeyboardDisplayRequiresUserAction": false
			        });
			    }
		        //此处可写具体逻辑设置获取焦点的input
		        setTimeout(function() {
			       var inputElem = document.getElementById('words');
	               inputElem.focus(); 
                }, 200); 
			};
	    	initNativeObjects();
	    	showSoftInput();
			
			//缓存记录
			var searchStorage =JSON.parse(plus.storage.getItem("$searchStorage") || '[]');
			//搜索方法
			window.submitTest = function(){
				if($("input").val()!=''){ 
					var words=$("input").val();
					mui.toast("请输入搜索内容！");
					if(searchStorage.length != 0) {
						var flag = false;
						for(var i = 0; i < searchStorage.length; i++) {
							if(searchStorage[i] == words) {
								searchStorage[i] = words;
								flag = false;
								break;
							} else {
								flag = true;
							}
						}
						if(flag) {
							searchStorage.push(words);
						}
					} else { 
						searchStorage.push(words);
						
					} 
					plus.storage.setItem('$searchStorage', JSON.stringify(searchStorage)); 
					alert(JSON.stringify(searchStorage))
					$("#container").css("display","none");
					$(".searchOut").css("display","block");
				}else{
					$("#container").css("display","block");
					$(".searchOut").css("display","none");
				} 
			}
			
			var recordObj = {};
			recordObj.data= searchStorage;
			if(searchStorage.length){
				var htmlrecord = template('recordTpt', recordObj);
			}else{
				var htmlrecord = template('recordTpt2', recordObj);
			}
		    document.getElementById('record').innerHTML = htmlrecord;
		    //清除记录
		    mui('.clearStr')[0].addEventListener('tap',function(){
			 	//alert(22)
			 	plus.storage.removeItem("$searchStorage");
			 	$('.link-url').css("display","none");
			 	mui(".clearStr")[0].innerHTML="暂无搜索历史"; 
			})
			//搜索某一条 缓存 
			$('.searchli').click(function(e){
			    e.preventDefault();
			    alert("执行搜索")
			})
		})
			
			  
			//输入搜索
//			document.getElementById('words').addEventListener('change', function() {
//				$('.searchRecord').css('display','none');
//				var words = this.parentNode.getElementsByTagName('input')[0].value;
//				if(words == '') {
//					mui.toast("请输入食材或菜名");
//				} else {
//					
//				}
//			});
	</script>
</html>