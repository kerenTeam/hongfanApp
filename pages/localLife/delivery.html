<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>快递上门</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/mui.picker.min.js"></script>
		<script src="../../js/mui.poppicker.js"></script>
		<script src="../../js/app.js"></script>
		
		
		<script src="../../js/other.js" type="text/javascript" charset="utf-8"></script>
		
		<style type="text/css">
			.mui-bar{
				height: 50px;
				box-shadow: none;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			#main{
				margin-top: 50px;
			}
			
			.guess-like,dl.list{
				border-bottom: 1px solid #eee;
				background-color: #EFEFF4;
			}
			.right{
				text-align: right;
			}
			.middle{
				text-align: center;
			}
			.strong-color{
				color: #f53c42 !important;
			}
			.Lgray{
				font-size: 12px !important;
				color: #999 !important;
				margin-top: 14px;
			}
			.mui-badge-blue, .mui-badge-primary{
				background-color: #fff;
				border: 1px solid #999;
				color: #999 !important;
			}
			
			.moreone{
				line-height: 50px;
			}
			dl.list .db>.react{
				padding: 0;
				margin: 0;
			}
			dl.list .db{
				height: 50px;
			}
			.grade-eject>ul>li, .Category-eject>ul>li, .Sort-eject>ul>li{
				line-height: 40px;
			}
			
			/*这一页*/
			.guess-like{
				padding-top:50px;
				padding-bottom: 100px;
			}
			.react >div p{
				line-height: 50px !important;
			}
			dl.list {
				border-top: none;
				margin-top: 4%; 
			}
			.react{
				padding: 0 .15rem !important;
			}
			dl.list dt, dl.list dd{
				background-color: #fff;
			}
			.lineL{
				border-left: 1px solid #EFEFF4;
			}
			.phone{
				border: none;
			}
			dl.list dt, dl.list dd{
				border-bottom: 1px solid #EFEFF4;
			}
			.delete{
				width: 90%;
				margin-top: 10px;
			}
			#showCityPicker3,#showCityPicker,#showCityPicker2,#payWayPicker{
				position: absolute;
				right: 10px;
				line-height: 49px;
				border: none;
				padding: 0;
				text-align: right;
				width: 75%;
				color: #666;
				background-color: rgba(0,0,0,0);
			}
			.react input{
				height: 50px;
				font-size: 14px;
				width: 100%;
			}
			#cityResult3,#cityResult,#cityResult2,#payWay{
				line-height: 50px;
				font-size: 14px;
				display: inline-block;
				float: right;
				margin-right: 50px;
				color: #666;
			}
			.goods{
				display: inline-block;
			}
			
			button, input, optgroup, select, textarea {
			 font: inherit; 
			 color: inherit; 
			}
			
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav hasManyCity hasManyCitytwo">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize fl fanhui"></a>
		    <div class="header-tit">
				快递上门
			</div>
		</header>
		<div class="guess-like">
			<dl class="list" id="goodsList">
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<img src="../../img/tickets/post.png" class="delete"/>
				       	</div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<p class="black">寄件人信息</p>
				        </div>
					</a>
				</dd>
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<span class="mui-icon mui-icon-person"></span>
				       </div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<input id="sendName" class="phone" placeholder="请输入姓名" value=""/>
				        </div>
					</a>
				</dd>
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<span class="mui-icon mui-icon-phone"></span>
				       </div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<input id="sendMobile" class="phone" placeholder="请输入电话号码"/>
				        </div>
					</a>
				</dd>
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<span class="mui-icon mui-icon-location"></span>
				      	</div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<p style="display: inline-block;">选择地址</p>
				        	<button id='showCityPicker3' type='button'><span class="mui-icon mui-icon-arrowdown"></span></button>
							<div id='cityResult3' class="ui-alert"><span id="province"></span><span id="city"></span><span id="area"></span></div>
				        </div>
					</a>
				</dd>
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1"></div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<input id="sendAd" class="phone" placeholder="请输入详细地址"/>
				        </div>
					</a>
				</dd>
			</dl>
			<dl class="list" id="goodsList">
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<img src="../../img/tickets/put.png" class="delete"/>
				       	</div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<p class="black">收件人信息</p>
				        </div>
					</a>
				</dd>
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<span class="mui-icon mui-icon-person"></span>
				       </div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<input id="receiveName" class="phone" placeholder="请输入姓名"/>
				        </div>
					</a>
				</dd>
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<span class="mui-icon mui-icon-phone"></span>
				       </div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<input id="receiveMobile" class="phone" placeholder="请输入电话号码"/>
				        </div>
					</a>
				</dd>
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<span class="mui-icon mui-icon-location"></span>
				      	</div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<p style="display: inline-block;">选择地址</p>
				        	<button id='showCityPicker2' type='button'><span class="mui-icon mui-icon-arrowdown"></span></button>
							<div id='cityResult2' class="ui-alert"><span id="province2"></span><span id="city2"></span><span id="area2"></span></div>
				        </div>
					</a>
				</dd>
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1"></div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<input id="receiveAddress" class="phone" placeholder="请输入详细地址"/>
				        </div>
					</a>
				</dd>
			</dl>
			<dl class="list" id="goodsList">
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<img src="../../img/tickets/goods.png" class="delete"/>
				       	</div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<p class="black goods">物品</p>
				        	<button id='showCityPicker' type='button'><span class="mui-icon mui-icon-arrowdown"></span></button>
							<div id='cityResult' class="ui-alert"></div>
				        </div>
					</a>
				</dd>
			</dl>
			<dl class="list" id="goodsList">
				<dd class="goodsItem">
					<a class="react mui-row">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<img src="../../img/tickets/pay.png" class="delete"/>
				       	</div>
				        <div class="mui-col-sm-11 mui-col-xs-11">
				        	<p class="black goods">支付方式</p>
				        	<button id='payWayPicker' type='button'><span class="mui-icon mui-icon-arrowdown"></span></button>
							<div id='payWay' class="ui-alert"></div>
				        </div>
					</a>
				</dd>
			</dl>
		</div>
	    
	     <div class="renting-footer renting-footertwo clearfloat" id="footer" onclick="send()">
			<ul>
				<li>我要寄件</li>
			</ul>
		</div>
	</body>
	<script src="../../js/mui.picker.min.js"></script>
	<script src="../../js/mui.poppicker.js"></script>
	<script src="../../js/city.data-3.js" type="text/javascript" charset="utf-8"></script>
	<script>
		(function($, doc) {
			$.init();
			$.ready(function() {
				//地址选择三级联动
				var cityPicker3 = new $.PopPicker({
					layer: 3
				});
				cityPicker3.setData(cityData3);
				var showCityPickerButton = doc.getElementById('showCityPicker3');
				var cityResult3 = doc.getElementById('cityResult3');
				showCityPickerButton.addEventListener('tap', function(event) {
					cityPicker3.show(function(items) {
						doc.getElementById('province').innerText = (items[0] || {}).text + " ";
						doc.getElementById('city').innerText =  (items[1] || {}).text + " ";
						doc.getElementById('area').innerText = (items[2] || {}).text + " ";
						//返回 false 可以阻止选择框的关闭
						//return false;
					});
				}, false);
				var showCityPickerButton = doc.getElementById('showCityPicker2');
				var cityResult3 = doc.getElementById('cityResult2');
				showCityPickerButton.addEventListener('tap', function(event) {
					cityPicker3.show(function(items) {
						doc.getElementById('province2').innerText = (items[0] || {}).text + " ";
						doc.getElementById('city2').innerText =  (items[1] || {}).text + " ";
						doc.getElementById('area2').innerText = (items[2] || {}).text + " ";
						//返回 false 可以阻止选择框的关闭
						//return false;
					});
				}, false);
			});
		})(mui, document);
	</script>
	<script>
		(function($, doc) {
			$.init();
			$.ready(function() {
				//物品分类选择
				var userPicker = new $.PopPicker();
				userPicker.setData([{
					text: '日用品'
				}, {
					text: '数码产品'
				},{
					text: '衣物'
				},{
					text: '食物'
				},{
					text: '文件'
				},{
					text: '其他'
				}]);
				var showUserPickerButton = doc.getElementById('showCityPicker');
				var userResult = doc.getElementById('cityResult');
				showUserPickerButton.addEventListener('tap', function(event) {
					userPicker.show(function(items) {
						userResult.innerText = items[0].text;
						//返回 false 可以阻止选择框的关闭
						//return false;
					});
				}, false);
				
				//支付方式分类选择
				var payWayPicker = new $.PopPicker();
				payWayPicker.setData([{
					value: 1,
					text: '寄方付'
				}, {
					value: 2,
					text: '收方付'
				}]);
				var paywayPicker = doc.getElementById('payWayPicker');
				var payResult = doc.getElementById('payWay');
				paywayPicker.addEventListener('tap', function(event) {
					payWayPicker.show(function(items) {
						payResult.innerText = items[0].text;
						doc.getElementById('receiveAddress').name = items[0].value;
						//返回 false 可以阻止选择框的关闭
						//return false;
					});
				}, false);
			});
		})(mui, document);
	</script>
	<!--模板引擎获取数据-->
	<script type="text/javascript" charset="utf-8">
      	mui.init();
		mui.plusReady(function(){
			//获取缓存
			var oldToken = plus.storage.getItem('oldToken');
			var Shipper = plus.webview.currentWebview().ShipperCode;
			
			window.send = function(){
				//获取所需数据
				var GoodsName = $('#cityResult').text();
				var sendName = $('#sendName').val();
				var sendMobile = $('#sendMobile').val();
				var sendProvince = $('#province').text();
				var sendCity = $('#city').text();
				var sendArea = $('#area').text();
				var sendAd = document.getElementById('sendAd').value;
				var receiveName = document.getElementById('receiveName').value;
				var receiveMobile = document.getElementById('receiveMobile').value;
				var receiveProvince = $('#province2').text();
				var receiveCity = $('#city2').text();
				var receiveArea = $('#area2').text();
				var receiveAddress = $('#receiveAddress').val();
				var PayType = document.getElementById('receiveAddress').name;
//				alert(sendProvince+sendArea+sendCity+receiveProvince+receiveArea+receiveCity);
//				alert(GoodsName);
//				alert(sendAd+sendMobile+sendName+receiveMobile+receiveName+receiveAddress);
//				alert(PayType);
				
				//判断是否合法
				var reg_phone = /^1((3|4|5|8|7){1}\d{1}|70)\d{8}$/;//手机号正则
				if(GoodsName == ''){
					mui.toast('请选择物品分类!');
				}else if(sendName == ''){
					$('#sendName').focus(); 
					mui.toast('请输入寄件人姓名!');
				}else if(!reg_phone.test(sendMobile)){
					$('#sendMobile').focus(); 
					mui.toast('请输入正确的寄件人电话!');
				}else if(sendProvince == ''){
					mui.toast('请选择寄件人地址!');
				}else if(sendAd == ''){
					$('#sendAd').focus(); 
					mui.toast('请输入寄件人详细地址!');
				}else if(receiveName == ''){
					$('#receiveName').focus(); 
					mui.toast('请输入收件人姓名!');
				}else if(!reg_phone.test(receiveMobile)){
					$('#receiveMobile').focus(); 
					mui.toast('请输入正确的收件人电话!');
				}else if(receiveProvince == ''){
					mui.toast('请选择收件人地址!');
				}else if(receiveAddress == ''){
					$('#receiveAddress').focus(); 
					mui.toast('请输入收件人详细地址!');
				}else if(PayType == ''){
					mui.toast('请选择支付方式!');
				}else{
					mui.ajax(serverUrl+'/api/kdniao/postexpress',{
						data:{CallBack:'',GoodsCode:'',GoodsDesc:'',GoodsName:GoodsName ,GoodsPrice:'',Goodsquantity:'',GoodsVol:'',GoodsWeight:'',Cost:'',CustomerName:'',CustomerPwd:'',EndDate:'',ExpType:1,IsNotice:'',IsReturnPrintTemplate:'',LogisticCode:'',MemberID:'',MonthCode:'',OtherCost:'',PayType:PayType,Quantity:'',Receiver_Address:receiveAddress ,Receiver_CityName:receiveCity ,Receiver_ExpAreaName:receiveArea ,Receiver_Mobile:receiveMobile ,Receiver_Name:receiveName ,Receiver_ProvinceName:receiveProvince ,Remark:'',Sender_Address:sendArea ,Sender_CityName:sendCity ,Sender_ExpAreaName:'',Sender_Mobile:sendMobile ,Sender_Name:sendName ,Sender_ProvinceName:sendProvince,SendSite:'',ShipperCode:Shipper,StartDate:'',Volume:'',Weight:''},
						dataType:'json',
						type:'post',
						timeout:1000,
						headers:{"token":oldToken},	 
						success:function(data,type,xhr){
							alert(JSON.stringify(data))
						},
						error:function(xhr,type,errorThrown){
							alert('响应失败  !');
						}
					});
				}
			}
			
		})();
    </script>
</html>