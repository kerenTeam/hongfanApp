<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>超市特价</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../js/jquery.flexslider-min.js"></script>
		<script type="text/javascript" src="../../js/swiper.min.js"></script>
		<script src="../../js/mui.picker.min.js"></script>
		<script src="../../js/mui.poppicker.js"></script>
		<script src="../../js/app.js"></script>
		<script src="../../js/artTemplate-native.js"></script>
		
		
		<style type="text/css">
			/*banner样式*/
			.mui-slider-indicator .mui-indicator{
				width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			#banner{
				position: relative;
				width: 100%;
				padding-top: 50%; 
				overflow: hidden;
				background: url(../../img/bannerback.svg) 50% 50% no-repeat;
				background-size: 20%;
			}
			.mui-slider .mui-slider-group{
				position: absolute;
			    height: 100%;
			    width: 100%;
			    top: 0;
			}
			.mui-slider .mui-slider-group .mui-slider-item img{height: 100%;}
			/*banner样式结束*/
			
			.caiPrice{
				margin: 20px 0 10px;
			}
			.caiPrice .mui-col-xs-6{
				padding: 0 5px;
				float: left;
			}
			.caiPrice .mui-col-xs-6 button{
				border-radius: 0;
				padding-right: 15px;
				background-color: #f53c42;
				color: #FFFFFF;
				font-size: 14px;
				border: none;
				overflow: hidden;
				text-overflow: ellipsis;
				line-height: 14px;
				padding-top: 12px;
			}
			.caiPrice .mui-col-xs-6 button span{
				display: block;
				margin-right: 10px;
				overflow: hidden;
				text-overflow: ellipsis;
			}
			.caiPrice .mui-col-xs-6 button:after {
			    content: '';
			    position: absolute;
			    top: 50%;
			    right: 5px;
			    width: 0;
			    height: 0;
			    border: 5px solid transparent;
			    border-top: 5px solid #FFFFFF;
			    margin-top: -2px;
			}
			#today{
				padding-right: 0;
			}
			#today:after {
				display: none;
			}
			.pricetable{
				border-top: 2px solid #ddd;
			}
			.pricetable ul{
				margin: 0 10px;
			}
			.pricetable ul li.th{
				font-weight: 800;
			}
			.pricetable ul li.row{
				width: 100%;
				border-bottom: none;
				font-weight: 800;
			}
			.pricetable ul li{
				width: 33.33%;
				padding: 8px;
				float: left;
				border-bottom: 1px solid #ddd;
			}
			.pricetable ul li p{
				margin: 10px;
				color: #333;
			}
			
			.mui-btn-blue, .mui-btn-primary, input[type=submit]{
				border: 1px solid #f53c42;
				background-color: #f53c42;
			}
			.ui-alert {
				text-align: center;
				/*padding: 20px 10px;*/
				font-size: 16px;
			}
			#caiList{
				padding: 0 10px;
			}
			#caiList .caiLi{
				padding: 10px 10px;
			}
			.noOne{
				padding: 20px 0;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left normalSize"></a>
		    <h1 class="mui-title">超市特价</h1>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="main">
			<div id="scroller">
				<!--轮播图-->
				<div class="mui-slider" id="banner"></div>
				<!--banner数据渲染-->
				<script type="text/html" id="banner-detail">
					<div class="mui-slider-group mui-slider-loop">
					    <!--支持循环，需要重复图片节点-->
					    <div class="mui-slider-item mui-slider-item-duplicate">
					    	<img src="<%= url %><%= bannerList[bannerList.length-1].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    </div>
						<% for(var i=0;i<bannerList.length;i++){ %> 
					    	<div class="mui-slider-item">
					    		<img src="<%= url %><%=bannerList[i].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    	</div>
					     <% } %>
					    <!--支持循环，需要重复图片节点-->
					    <div class="mui-slider-item mui-slider-item-duplicate">
					    	<img src="<%= url %><%= bannerList[0].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    </div>
					</div>
					<div class="mui-slider-indicator">
						<div class="mui-indicator mui-active"></div>
						<% for(var i=0;i<bannerList.length-1;i++){ %>
					    	<div class="mui-indicator"></div>
					    <% } %>
		            </div> 
				</script>
			</div>
			<!--比较选项-->
			<div class="mui-table clear caiPrice">
				<div class="mui-col-xs-6">
					<button id='showUserPicker1' class="mui-btn mui-btn-block showUserPicker" type='button'>世纪隆超市</button>
					<div id='userResult1' class="ui-alert"></div>
				</div>
				<div class="mui-col-xs-6">
					<button  class="mui-btn mui-btn-block" type='button' id="today"></button>
					<!--<div  class="ui-alert"></div>-->
				</div>
			</div>	
			<div id="" style="text-align: center;margin-bottom:10px;font-weight:bold;border-top:2px solid #ddd;padding-top:10px;font-size: 14px;color: #666;">
				今日菜价
			</div>
			<div class="pricetable">
				<ul class="mui-row">
					<li class="th mui-col-sm-4 mui-col-xs-4 caiLi">商品</li>
					<li class="th mui-col-sm-4 mui-col-xs-4 caiLi">规格</li>
					<li class="th mui-col-sm-4 mui-col-xs-4 caiLi">价格/原价</li>
				</ul>
			<div id="caiList"></div>
			<script type="text/html" id="caiList-detail">
				<% for(var i = 0;i<li.length;i++){ %>
					<% if(!li.length || li.length==0){ %>
						<div class="noOne"><p>没有最新比价！换一个超市试试。</p></div>
					<% }else{ %>
						<div class="mui-row">
							<div class="mui-col-sm-4 mui-col-xs-4 caiLi"><%= li[i].goods_name %></div>
							<div class="mui-col-sm-4 mui-col-xs-4 caiLi"><%= li[i].unit %></div>
							<%if(!li[i].orginal_price || li[i].orginal_price==' '){%>
								<div class="mui-col-sm-4 mui-col-xs-4 caiLi"><span style="color: red;"><%= li[i].date_price %></span>/无<sub>（元）</sub></div>
							<%}else{%>
								<div class="mui-col-sm-4 mui-col-xs-4 caiLi"> <span style="color: red;"><%= li[i].date_price %></span>/<%= li[i].orginal_price %><sub>（元）</sub></div>
							<%}%>	
						</div>
					<% } %>
				<% } %>
			</script>
		</div>
	</body>
	<script type="text/javascript">
		
		mui.plusReady(function() {
//			//获取缓存
			var oldToken = plus.storage.getItem('oldToken');
			plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});
			//获取今天的时间
			var dd = new Date();
//			dd.setDate(dd.getDate()+AddDayCount);//获取AddDayCount天后的日期
			var y = dd.getFullYear();
			var m = dd.getMonth()+1;//获取当前月份的日期
			var d = dd.getDate();
			var today = y+"-"+m+"-"+d; 
			mui('#today')[0].innerHTML=today;
			
			//banner
			mui.ajax(serverUrl+'/api/index/banner',{
				data:{banner_type:4},
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
					bannerObj={};
					if(data.data.banner){
						bannerObj.bannerList = eval("("+data.data.banner+")");
					}
					bannerObj.url = serverimgUrl;
					var html=template('banner-detail',bannerObj);
					document.getElementById('banner').innerHTML = html;
					plus.nativeUI.closeWaiting();//关闭等待框
					//轮播图,获得slider插件对象
					var gallery = mui('.mui-slider');
					gallery.slider({
					  	interval:5000//自动轮播周期，若为0则不自动播放，默认为0；
					});
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();//关闭等待框
					mui.toast('响应失败  !');
				}
			}); 
			//获取超市名称
			var marketName;
			var userPicker1 = new mui.PopPicker();
			userPicker1.setData([{
				text: '世纪隆超市',
				value:'世纪隆超市'
			}, {
				text: '新世纪超市',
				value:'新世纪超市'
			}]);
			var showUserPickerButton1 = document.getElementById('showUserPicker1');
			var userResult1 = document.getElementById('userResult1');
			showUserPickerButton1.addEventListener('tap', function(event) {
				userPicker1.show(function(items) {
					showUserPicker1.innerText = items[0].text;
					showUserPicker1.value = items[0].value;
					marketName = showUserPicker1.value;
					getPrice(marketName);
				});
			})
			//时间
//	        var date = new Date();
//		    var month = date.getMonth() + 1;
//		    var strDate = date.getDate();
//		    if (month >= 1 && month <= 9) {
//		        month = "0" + month;
//		    }
//		    if (strDate >= 0 && strDate <= 9) {
//		        strDate = "0" + strDate;
//		    }
//		    var dateTime = date.getFullYear() + "-" + month + "-" + strDate;
			//查询菜价
			getPrice("世纪隆超市");
			function getPrice(marketName){
				console.log(marketName);
				mui.ajax(serverUrl+'/api/localservice/parity',{
					data:{marketName:marketName},
					dataType:'json',
					type:'post',
					timeout:1000,
					headers:{"token":oldToken},	 
					success:function(data,type,xhr){
						console.log('详情',data);
						if(!data.data || data.data.length==0){
							mui('#caiList')[0].innerHTML = '<div class="noOne"><p>没有最新比价！换一个超市试试。</p></div>';
						}else{
							for(var i = 0;i<data.data.length;i++){
								data.data[i].date_price = data.data[i].date_price.toFixed(2);
							}
							//超市名数据
							dataObj={};
							dataObj.li=data.data;
							var html=template('caiList-detail',dataObj);
							document.getElementById('caiList').innerHTML = html;
						}
					},
					error:function(xhr,type,errorThrown){
						mui.toast('当前网络不好请重试');
					}
				}); 
			}
		})
</script>
	
</html>