<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>本地生活</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css"> 
		<link rel="stylesheet" type="text/css" href="../../css/mui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/localHost.css"/>

		<style type="text/css">
			.sy_limit_buy {border-bottom: none;}
			.mui-bar-nav.mui-bar .mui-icon,.mui-title,.mui-icon{color: #fff;}
			.mui-bar .mui-icon{font-size: 24px !important;}
			.mui-bar-nav{box-shadow: none;}
			.mui-icon{line-height: 50px;}	
			.mui-icon .iconfont{font-size: 18px;} 
 			.tuangouwidth{height: 195px;} 
			.icon-list .icon{margin-bottom: 10px;} 
			.icon-list .icon-circle{width: 50px;height: 50px;margin-bottom: 5px;}
			.swiper-pagination-bullet-active{background-color: rgba(245,60,66,0.6);}
			.sy_limit_buy .locatLabel_switch .box{width: 29% !important;}
			.mui-table-view-cell p{font-size: 12px;line-height: 16px;margin-top: 7px;}
			.overyou{width: auto !important;overflow-x: scroll !important;min-height: 100px;} 
			.txt_center{color: #555;}
			.sy_title{border: none;padding-top: 0;padding-left: 0;} 
			.caini{border-bottom: 1px solid rgba(0,0,0,0.1);}
			.left{border-left: 0.03rem solid #f53c42;padding-left: 10px;}
			.slider{margin-bottom: 0;}
			.mb10{margin-bottom: 10px;}
			.mui-table-view:before{display: none;}
			.mui-table-view li{padding-left: 0;padding-right: 10px;}
			.mui-table-view-cell:after{left: 0;}
			.icon-list .icon-circle{border-radius: 50%;}
			#more{background-color:#fff;text-align: center;height: 40px;line-height: 30px;font-size: 14px; }
			#more img{margin-left:5px;width: 16px;margin-top: -3px;}
			.null{text-align: center;}
			.null img{margin-top: 7%;width: 30%;margin-bottom: 3%;}
			.icon-list .icon-circle {
			    width:54px;
			    height: 54px; 
			    margin-bottom: 10px;
			    padding: 15%;
			}
			
			.slider, .mb10{
				/*margin-bottom: 10px;*/
				border-bottom: none !important;
			}
			/*.slider:after, .caini:after, .mui-table-view-cell:after,.mui-table-view:after{
				content: '';
				display: block;
				height: 1px;
				background-color: rgba(0,0,0,0.1);
				-webkit-transform: scaleY(.5);
			}*/
			p{color: #5d5d61;}
			.r_p{display: -webkit-box;
			-webkit-box-orient: vertical;
			-webkit-line-clamp: 2;
			overflow: hidden;}
			.sy_limit_buy .locatLabel_switch .box{line-height: 1.2;}
			.sy_limit_buy .locatLabel_switch .box p{padding: 3px 0;text-align: left;font-size: 13px;}
			#main{
				margin-top: 50px;
			}
		</style>    
	</head>
	<body>
		<header class="mui-bar mui-bar-nav" id="header"> 
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">本地生活</h1>
		    <!--<a class="fr shoucang mui-icon mui-icon-bars" id="theSearch" href="javascript:;"></a>-->
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="Mask" style="position: absolute;width: 100%;height: 100%;background-color: #fff;z-index: 100;"></div>
		<div id="main">
			<div id="scroller">			
				<section class="slider">
					<div class="swiper-container swiper-container2">
						<div class="swiper-wrapper tuangouwidth">
							<div class="swiper-slide">
								<ul class="icon-list" id="columndiv"></ul>
								<!--有数据显示-->
								<script type="text/html" id="column">
									<% for(var i=0; i<list.length; i++){%>
										<li class="icon">
											<a class="<%= classnames[i]%>">
												<span class="icon-circle bluegray" style="background-color:<%= list[i].icon_color%>;">
													<img src="<%= myUrl%><%= list[i].icon%>" onerror="javascript:this.src='../../img/market/banner.png';">
												</span>
												<span class="icon-desc"><%= list[i].name%></span>
											</a>
										</li>
									<% }%>	
								</script>
							</div>
							<div class="swiper-slide swiper_part2" >
								<ul class="icon-list" id="columndiv2">
									<!--没有数据显示--> 
									<img src="../../img/nullinfo.svg" id="kuimg" style="display: none;" onerror="javascript:this.src='../../img/market/banner.png';">
									<p>没有了</p>	
								</ul>
								<!--有数据显示-->
								<script type="text/html" id="column2">
									<% for(var i=8; i<list.length; i++){%>
										<li class="icon">
											<a class="supermarket">
												<span class="icon-circle bluegray">
													<img src="../../img/localLife/chaoshi.svg" onerror="javascript:this.src='../../img/market/banner.png';">
												</span>
												<span class="icon-desc">超市比价</span>
											</a>
										</li>
									<% }%>	
								</script>
							</div>
						</div>
						<div class="swiper-pagination swiper-pagination2 diandian">
						</div>
					</div>
				</section>
			</div>
			
			<!--广告-->
			<div class="mui-row" style="background-color: white;margin: 10px 0;" id="ad"></div> 
			<!--广告 数据渲染-->
			<script type="text/html" id="ad-detail">
				<div class="mui-col-xs-6 rowpad">
					 <img src="<%= myUrl %><%= adLi[0].pic %>" class="allimga" alt="" onclick="goAdv(<%= adLi[1].id %>)" onerror="javascript:this.src='../../img/market/banner.png';"/>
				</div>
				<div class="mui-col-xs-6 rowpad">
					<div class="rpad clearfloat"> 
						<img src="<%= myUrl %><%= adLi[1].pic %>" class="allimga" alt="" onclick="goAdv(<%= adLi[1].id %>)" onerror="javascript:this.src='../../img/market/banner.png';"/> 
					</div>
					<div class="rpad clearfloat"> 
						<img src="<%= myUrl %><%= adLi[2].pic %>" class="allimga" alt="" onclick="goAdv(<%= adLi[1].id %>)" onerror="javascript:this.src='../../img/market/banner.png';"/> 
					</div>
				</div> 
			</script>
			
			
			<div id="index" class="page-center-box">
				<div>				
					<!--猜你喜欢-->
					<div class="sy_limit_buy mb10 caini">
						<div class="sy_title">
						<span class="left">猜你喜欢&nbsp;&nbsp;&nbsp;&nbsp;</span>
					</div>
						<div class="overyou locatLabel_switch swiper-container5 swiper-container-horizontal swiper-container-free-mode swiper-container-android">
							<!--广告数据-->
							<div class="swiper-wrapper" id="Advdiv"></div> 
							<script type="text/html" id="Adv">
								<% for(var i=0; i<list.length; i++){%>
									<div class="box swiper-slide">
										<a href="javascript:;" onclick="opendetails(<%= list[i].id%>)">
											<img src="<%= list[i].logo%>" onerror="javascript:this.src='../../img/market/banner.png';">
											<p class="txt_center overflow_clear"><%= list[i].name%></p>
										</a>
									</div>
								<% }%>	
							</script>
						</div>
					</div>
					<!--首页限时抢购结束-->
					<!--热门推荐 -->	
					<div class="jinengxueyuan">
						<div class="sy_limit_buy mb10">
							<div class="sy_title">
							<span class="left">热门推荐&nbsp;&nbsp;&nbsp;&nbsp;</span>
						</div>
						<ul class="mui-table-view" id="recommendsdiv">
							<div id="tuijiannull" style="padding: 20px;text-align: center;display: none;">暂时没有了</div>
						</ul>
						<!--猜你喜欢-->
						<script type="text/html" id="recommends">
							<% if(list.length >= 3){%>
								<% for(var i=0; i<3; i++){%>
									<li class="mui-table-view-cell mui-media" onclick="opendetails(<%= list[i].id%>)">
										<a href="javascript:;">
											<img class="mui-media-object mui-pull-left" src="<%=myUrl %><%= list[i].logo%>" onerror="javascript:this.src='../../img/market/banner.png';">
											<div class="mui-media-body">
												<%= list[i].name%>
												<p class='mui-wrap r_p'><%= list[i].content%></p>
											</div>
										</a>
									</li>
								<% }%>
							<% }else{%>
								<% for(var i=0; i<list.length; i++){%>
									<li class="mui-table-view-cell mui-media" onclick="opendetails(<%= list[i].id%>)">
										<a href="javascript:;">
											<img class="mui-media-object mui-pull-left" src="<%=myUrl %><%= list[i].logo%>" onerror="javascript:this.src='../../img/market/banner.png';">
											<div class="mui-media-body">
												<%= list[i].name%>
												<p class='mui-wrap r_p'><%= list[i].content%></p>
											</div>
										</a>
									</li>
								<% }%>
							<% }%>	
						</script>
						<script type="text/html" id="recommends2">
							<% for(var i=0; i<list.length; i++){%>
								<li class="mui-table-view-cell mui-media" onclick="opendetails(<%= list[i].id%>)">
									<a href="javascript:;">
										<img class="mui-media-object mui-pull-left" src="<%=myUrl %><%= list[i].logo%>" onerror="javascript:this.src='../../img/market/banner.png';">
										<div class="mui-media-body">
											<%= list[i].name%>
											<p class='mui-wrap r_p'><%= list[i].content%></p>
										</div>
									</a>
								</li>
							<% }%>
						</script>
						<div id="more">
							更多推荐 <img src="../../img/more.svg"/> 
						</div>
					</div>
					
				</div>
			</div>
		</div>
	</body>
	<script src="../../js/swiper.min.js" type="text/javascript" ></script>
	<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
	<script> 
		//广告跳转到服务详情
		function goAdv(AdvId){
			openview({
				view:'../Adv-detail.html',
				extrasobj:{AdvId:AdvId}
			})
		}
		
		//滑动栏目的轮播
		var mySwiper = new Swiper('.swiper-container',{
			pagination : '.swiper-pagination'
		});
		
		mui.plusReady(function(){
		plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});
		mui('#kuimg')[0].style.display = 'inline-block';
		var oldtoken = plus.storage.getItem('oldToken');
			//栏目数据
			mui.ajax(serverUrl+'/api/localservice/localservicecates',{
				type:'post',
				timeout:10000,
				headers:{"token":oldtoken},	              				
				success:function(data){
//					alert(JSON.stringify(data.data));
					console.log('获取栏目返回'+JSON.stringify(data));
					if(data.errno == 0){ 
						var objdata = {};
						objdata.list = data.data;
						objdata.classnames = ['repair','cleaning','babysister','house','tiaozao','openclock','express','supermarket']
						objdata.myUrl = serverimgUrl;
//						console.log(objdata.list);
						var html = template("column",objdata);
						document.getElementById("columndiv").innerHTML=html;
						if(data.data.length > 8){//显示下一轮数据
							var html2 = template("column2",objdata);
							document.getElementById("columndiv2").innerHTML=html2; 
						}else{
							mui('#columndiv2')[0].className = 'null';
							mui('.diandian')[0].style.display = 'none';
						}
						
						plus.nativeUI.closeWaiting();
						mui('#Mask')[0].style.display = 'none';
						//添加监听
						Monitor();
					}else{
						mui.toast('获取用户信息失败');
						plus.nativeUI.closeWaiting();
						console.log(data.errmsg);
						mui('#columndiv2')[0].className = 'null';
						mui('.diandian')[0].style.display = 'none';
					}
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();
					mui('#columndiv2')[0].className = 'null';
					mui('.diandian')[0].style.display = 'none';
					mui.toast('响应失败  !');
				}
			});
			//广告
			//广告 数据渲染
			mui.ajax(serverUrl +'/api/index/ads',{
				data:{ad_type:3},
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldtoken},	 
				success:function(data,type,xhr){
//					alert(JSON.stringify(data.data));
					var adObj = {};
					adObj.myUrl = serverimgUrl;
					adObj.adLi = data.data;
					var html = template('ad-detail',adObj);
					document.getElementById('ad').innerHTML = html;
				},
				error:function(xhr,type,errorThrown){
					console.log('响应失败  !');
				}
			});
			//猜你喜欢
			mui.ajax(serverUrl+'/api/localservice/localserviceads',{
				type:'post',
				timeout:10000,
				headers:{"token":oldtoken},	              				
				success:function(data){
					console.log('猜你喜欢返回'+JSON.stringify(data));
					if(data.errno == 0){ 
						var objdata = {};
						mui.each(data.data,function (index,ele) {
							data.data[index].logo = serverimgUrl + eval("("+ele.logo+")")[0].picImg;
						})
						objdata.myUrl = serverimgUrl;
						objdata.list = data.data;
						var html = template("Adv",objdata);
						document.getElementById("Advdiv").innerHTML=html;
						plus.nativeUI.closeWaiting();
						mui('#Mask')[0].style.display = 'none';
					}else{
						mui.toast('获取用户信息失败');
						plus.nativeUI.closeWaiting();
						console.log(data.errmsg);
					}
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();
					mui.toast('响应失败  !');
				}
			});
			//热门推荐
			mui.ajax(serverUrl+'/api/localservice/localservicecommend',{
				type:'post',
				timeout:10000,
				headers:{"token":oldtoken},	              				
				success:function(data){
					console.log('热门推荐返回'+JSON.stringify(data));
					if(data.errno == 0){ 
						if(data.data.length){
							mui('#Mask')[0].style.display = 'none';
							var objdata = {};
							mui.each(data.data,function (index,ele) {
								data.data[index].logo = eval("("+ele.logo+")")[0].picImg;
							})
							objdata.list = data.data;
							objdata.myUrl = serverimgUrl;
							var html = template("recommends",objdata);
							document.getElementById("recommendsdiv").innerHTML = html;
							if(data.data.length>=3){//大于三条点击更多继续加载;
								mui('#more')[0].onclick = function(){
									mui('#more')[0].innerHTML = '<img style="width: 13%;margin-top: -10px;" src="../../img/balls.svg"/>';
									var Tjiazai = setTimeout(function(){
										document.getElementById("recommendsdiv").innerHTML = html;
										mui('#more')[0].style.display = 'none';
										document.getElementById("recommendsdiv").innerHTML += '<div id="tuijiannull" style="padding: 20px;text-align: center;position: relative;top: 10px;z-index: 1;background-color: #fff;padding-top: 10px;">暂时没有了</div>'
										
									},500)
									var html = template("recommends2",objdata);

								}
							}else{
								mui('#more')[0].style.display = 'none';
								document.getElementById("recommendsdiv").innerHTML += '<div id="tuijiannull" style="padding: 20px;text-align: center;">暂时没有了</div>'
							}
							
							
						}else{
							mui('#tuijiannull')[0].style.display = 'block';
							mui('#more')[0].style.display = 'none';
						}
						plus.nativeUI.closeWaiting();
					}else{
						mui('#tuijiannull')[0].style.display = 'block';
						mui('#more')[0].style.display = 'none';
						mui.toast('获取用户信息失败');
						plus.nativeUI.closeWaiting();
						console.log(data.errmsg);
					}
				},
				error:function(xhr,type,errorThrown){
					mui('#tuijiannull')[0].style.display = 'block';
					mui('#more')[0].style.display = 'none';
					plus.nativeUI.closeWaiting();
					mui.toast('响应失败  !');
				}
			});
		})//plusready
		Monitor();
		function Monitor(){
			//打开维修页面
			mui('.repair')[0].addEventListener('tap',function(){
				openview({ 
					view:'theList.html',
					extrasobj:{name:'Repair'}
				})
			});
			//打开保洁页面
			mui('.cleaning')[0].addEventListener('tap',function(){
				openview({ 
					view:'theList.html',
					extrasobj:{name:'Clean'}
				})
			});
			//打开保姆月嫂页面
			mui('.babysister')[0].addEventListener('tap',function(){
				openview({ 
					view:'theList.html',
					extrasobj:{name:'Babysister'}
				})
			});
			//打开开锁页面
			mui('.openclock')[0].addEventListener('tap',function(){
				openview({ 
					view:'theList.html',
					extrasobj:{name:'Openclock'}
				})
			});
			
			//打开房产资讯页面
			mui('.house')[0].addEventListener('tap',function(){
				openview({ 
					view:'buildList.html',
				})
			});
			//打开跳蚤市场页面
			mui('.tiaozao')[0].addEventListener('tap',function(){
				openview({ 
					view:'2edMarket.html',
				})
			});
			//打开快递上门页面
			mui('.express')[0].addEventListener('tap',function(){
				openview({ 
					view:'deliveryCenter.html',
				})
			});
			//打开超市比价页面
			mui('.supermarket')[0].addEventListener('tap',function(){
				openview({ 
					view:'marketPrice.html',
				})
			});
		}
		//打开律师咨询页面
		mui('.laywer')[0].addEventListener('tap',function(){
			alert(1);
			openview({ 
				view:'lawyerList.html',
			})
		});
		//打开更多的页面
		mui('.morepart')[0].addEventListener('tap',function(){
			openview({ 
				view:'../jindaikaifa.html',
			})
		});
		
		
		//猜你喜欢,热门推荐 的 跳转详情
		function opendetails(id){
			openview({
				view:'theDetail.html',
				extrasobj:{name:id}
			})
		}
		
		
	</script>
</html>