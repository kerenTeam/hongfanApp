<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>本地生活</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css"> 
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/reset.css"/>
		<style type="text/css">
			/*banner样式*/
			.mui-slider-indicator .mui-indicator{
				width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			#banner{
				position: relative;
				width: 100%;
				padding-top: 42%; 
				overflow: hidden;
				background: url(../../img/bannerback.svg) 50% 50% no-repeat;
				background-size: 20%;
			}
			.mui-slider .mui-slider-group{
				position: absolute;
			    height: 100%;
			    width: 100%;
			    top: 0;
			}
			.mui-slider .mui-slider-group .mui-slider-item img{height: 100%;}
			/*banner样式结束*/
			.sy_limit_buy {border-bottom: none;}
			.mui-bar-nav.mui-bar .mui-icon,.mui-title,.mui-icon{color: #fff;}
			.mui-bar .mui-icon{font-size: 24px !important;}
			.mui-bar-nav{box-shadow: none;}
			.mui-icon{line-height: 50px;}	
			.mui-icon .iconfont{font-size: 18px;} 
 			.tuangouwidth{height: 150px;} 
			.swiper-pagination-bullet-active{background-color: rgba(245,60,66,0.6);}
			.sy_limit_buy .locatLabel_switch .box{width: 29% !important;}
			.mui-table-view-cell p{font-size: 12px;line-height: 16px;margin-top: 10px;}
			.overyou{width: auto !important;overflow-x: scroll !important;min-height: 100px;} 
			.txt_center{color: #555;font-size: 13px;white-space: nowrap;text-overflow: ellipsis;margin-bottom: 15px;padding: 0 5px;margin-top: 5px;}
			.sy_title{border: none;padding-top: 0;padding-left: 0;} 
			.caini{border-bottom: 1px solid #EFEFF4;}
			.left{border-left: 0.03rem solid #f53c42;padding-left: 10px;}
			.slider{margin-bottom: 0;}
			.mb10{margin-bottom: 10px;}
			.mui-table-view:before{display: none;}
			.mui-table-view li{padding-left: 0;padding-right: 10px;}
			.mui-table-view-cell:after{left: 0;}
			.icon-list .icon-circle{border-radius: 50%;}
			#more{background-color:#fff;text-align: center;height: 40px;line-height: 30px;font-size: 14px; }
			#more img{margin-left:5px;width: 16px;margin-top: -3px;}
			.null{text-align: center;}
			.null img{margin-top: 7%;width: 30%;margin-bottom: 3%;}
			.icon-list .icon-circle {
			    width:40px;
			    height: 40px; 
			}
			.icon-list .icon-circle img{
			    width:25px;
			    height: 25px; 
			}
			.icon-desc{
				font-size: 12px !important;
			}
			.slider, .mb10{
				border-bottom: none !important;
			}
			p{color: #5d5d61;}
			.r_p{display: -webkit-box;
			-webkit-box-orient: vertical;
			-webkit-line-clamp: 2;
			overflow: hidden;}
			.sy_limit_buy .locatLabel_switch .box{line-height: 1.2;}
			.sy_limit_buy .locatLabel_switch .box p{padding: 3px 0;text-align: left;font-size: 13px;}
			#Adv .swiper-slide{
				padding-bottom: 20px !important;
				margin-bottom: 20px !important;
			}
			#recommendsdiv:after{display: none;}
			.pagebottom {
			    color: darkgray;
			    position: relative;
			    text-align: center;
			    margin-bottom: 20px;
			    margin-top: 10px;
			}
			.pagebottom:before {
			    position: absolute;
			    content: '';
			    width: 1rem;
			    right: 15%;
			    top: 7px;
			    border-bottom: 1px solid #ddd;
			}
			.pagebottom:after {
			    position: absolute;
			    content: '';
			    width: 1rem;
			    left: 15%;
			    top: 7px;
			    border-bottom: 1px solid #ddd;
			}
			.icon-list .icon> a{padding-top: 9px;}
		</style>    
	</head>
	<body>
		<header class="mui-bar mui-bar-nav" id="header"> 
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">本地生活</h1>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="Mask" style="position: fixed; width: 100%;height: 100%;background-color: #fff;z-index: 100;"></div>
		<div id="main">
			<div id="scroller">
				<!--轮播图-->
				<div class="mui-slider" id="banner"></div>
				<!--轮播图结束-->
				<!--banner数据渲染-->
				<script type="text/html" id="banner-detail">
					<div class="mui-slider-group mui-slider-loop">
					    <!--支持循环，需要重复图片节点-->
					    <div class="mui-slider-item mui-slider-item-duplicate">
					    	<img src="<%= url %><%= bannerList[bannerList.length-1].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    </div>
						<% for(var i=0;i<bannerList.length;i++){ %> 
					    	<div class="mui-slider-item">
					    		<img src="<%= url %><%=bannerList[i].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    	</div>
					     <% } %>
					    <!--支持循环，需要重复图片节点-->
					    <div class="mui-slider-item mui-slider-item-duplicate">
					    	<img src="<%= url %><%= bannerList[0].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    </div>
					</div>
					<div class="mui-slider-indicator">
						<div class="mui-indicator mui-active"></div>
						<% for(var i=0;i<bannerList.length-1;i++){ %>
					    	<div class="mui-indicator"></div>
					    <% } %>
		            </div> 
				</script>
			</div>
			<!--分类选择-->	
			<div class="swiper-container swiper-container2" style="background-color: #fff;">
				<div class="swiper-wrapper tuangouwidth">
					<div class="swiper-slide">
						<ul class="icon-list" id="columndiv"></ul>
						<!--有数据显示-->
						<script type="text/html" id="column">
							<% for(var i=0; i<list.length; i++){%>
								<li class="icon">
									<a class="<%= classnames[i]%>">
										<span class="icon-circle bluegray" style="background-color:<%= list[i].icon_color%>;">
											<img src="<%= list[i].iconpic%>">
										</span>
										<span class="icon-desc"><%= list[i].name%></span>
									</a>
								</li>
							<% }%>	
						</script>
					</div>
					<div class="swiper-slide swiper_part2" >
						<ul class="icon-list" id="columndiv2">
							<!--没有数据显示--> 
							<img src="../../img/nullinfo.svg" id="kuimg" style="display: none;" >
							<p>没有了</p>	
						</ul>
						<!--有数据显示-->
						<script type="text/html" id="column2">
							<% for(var i=8; i<list.length; i++){%>
								<li class="icon">
									<a class="supermarket">
										<span class="icon-circle bluegray">
											<img src="<%= list[i].iconpic%>" >
										</span>
										<span class="icon-desc"><%= list[i].name%></span>
									</a>
								</li>
							<% }%>	
						</script>
					</div>
				</div>
				<div class="swiper-slide swiper_part2" >
					<ul class="icon-list" id="columndiv2">
						<!--没有数据显示--> 
						<img src="../../img/nullinfo.svg" id="kuimg" style="display: none;" onerror="javascript:this.src='../../img/market/banner.png';">
						<!--<p>没有了</p>-->	
					</ul>
					<!--有数据显示-->
					<script type="text/html" id="column2">
						<% for(var i=8; i<list.length; i++){%>
							<li class="icon">
								<a class="supermarket">
									<span class="icon-circle bluegray">
										<img src="../../img/localLife/chaoshi.svg" onerror="javascript:this.src='../../img/market/banner.png';">
									</span>
									<span class="icon-desc">超市特价</span>
								</a>
							</li>
						<% }%>	
					</script>
				</div>
			</div> 
			<div class="swiper-pagination swiper-pagination2 diandian"></div>
		</div>
		<!--维修推荐-->
		<style type="text/css">
			.wrapdiv{margin: 7px 0;background-color: #fff;}
			.headdivdiv{height: 40px;line-height: 40px;background-color: #fff;padding: 0 10px;border-bottom: 1px solid #F8F8F8;overflow: hidden;}
			.headdivdiv{font-size: 14px;color: #444;}
			.headdivdiv span{float: right;font-size: 13px;color: #777;}
			.headdivdiv span.span2{font-size: 17px;margin-top: -5px;}
			.npbk{
		 	    overflow-x: scroll; 
			  	width: 100vw; 
			    white-space: nowrap;
			 	position: relative;
			 	left: 50%;
			 	right: 50%;
			 	margin-left: -50vw; 
			 	margin-right: -50vw;
			 	padding-right: 5px;
			 	min-height: 100px;
			}
			.nplist {
			    width: 1rem;
			    text-align: center;
			    display: inline-block;
			    box-shadow: 0px 0 5px 0px rgba(0,0,0,0.1);
			    margin-left: 5px;
			}
			.npimg {
			    position: relative;
			    width: 100%;
			    padding-top: 100%;
			    overflow: hidden;
			}
			.nplist h4 {
			    color: #666;
			    font-size: 12px;
			    width: 1rem;
			    line-height: 2;
			    text-overflow: ellipsis;
			    white-space: nowrap;
			    overflow: hidden;
			    margin: auto;
			    
			}
			.nprice {
			    font-size: 0.12rem;
			    color: #f53c42;
			    line-height: 1.5;
			}
			.npimg img {
			    position: absolute;
			    top: 0;
			    left: 0;
			    width: 100%;
			    height: 100%;
			}
		</style>
		
		<div class="wrapdiv">
			<div class="headdivdiv aClick servicemore">
				维修服务推荐  <span class="mui-icon mui-icon-arrowright span2"></span><span>更多</span>
			</div>
			<div class="npbk" id="recodiv1"></div>
			<script type="text/html" id="reco1">
				<% if(list.length > 10){%>
					<% list.length = 10%>
				<% }%>	
				<% for(var i=0; i<list.length; i++){%>
					<div class="nplist" onclick="opendetails2(<%= list[i].id%>)">
						<div class="npimg">
							<img src="<%= url%><%= list[i].logo%>"/>
						</div>
						<h4><%= list[i].name%></h4>
					</div>
				<% }%>
			</script>
		</div>
		<div class="wrapdiv">
			<div class="headdivdiv aClick Housekeepingmore">
				家政服务推荐  <span class="mui-icon mui-icon-arrowright span2"></span><span>更多</span>
			</div>
			<div class="npbk" id="recodiv2"></div>
			<script type="text/html" id="reco2">
				<% if(list.length > 10){%>
					<% list.length = 10%>
				<% }%>	
				<% for(var i=0; i<list.length; i++){%>
					<div class="nplist" onclick="opendetails2(<%= list[i].id%>)">
						<div class="npimg">
							<img src="<%= url%><%= list[i].logo%>"/>
						</div>
						<h4><%= list[i].name%></h4>
					</div>
				<% }%>
			</script>
		</div>
		<div class="wrapdiv">
			<div class="headdivdiv aClick Propertymore">
				房产资讯推荐 <span class="mui-icon mui-icon-arrowright span2"></span><span>更多</span>
			</div>
			<div class="npbk" id="recodiv3"></div>
			<script type="text/html" id="reco3">
				<% if(list.length > 10){%>
					<% list.length = 10%>
				<% }%>	
				<% for(var i=0; i<list.length; i++){%>
					<div class="nplist" onclick="opendetails3(<%= list[i].house_id%>)">
						<div class="npimg">
							<img src="<%= url%><%= list[i].logo%>"/>
						</div>
						<h4><%= list[i].name%></h4>  
					</div>
				<% }%>
			</script>
		</div>
		<div class="wrapdiv">
			<div class="headdivdiv aClick secondhandmore" >
				跳蚤市场推荐 <span class="mui-icon mui-icon-arrowright span2"></span><span>更多</span>
			</div>
			<div class="npbk" id="recodiv4"></div>
			<script type="text/html" id="reco4">
				<% if(list.length > 10){%>
					<% list.length = 10%>
				<% }%>	
				<% for(var i=0; i<list.length; i++){%>
					<div class="nplist" onclick="opendetails4(<%= list[i].id%>)">
						<div class="npimg">
							<img src="<%= url%><%= list[i].logo%>"/>
						</div>
						<h4><%= list[i].title%></h4>
						<!--<div class="nprice">￥338</div>-->
					</div>
				<% }%>
			</script>
		</div>
		<div class="pagebottom" style="padding-bottom: 10px;">到底了</div>
					
	</body>
	<script src="../../js/swiper.min.js" type="text/javascript" ></script>
	<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
	<script>
		statisticsfun('本地生活主页');//统计代码
		
		//广告跳转到服务详情
		function goAdv(AdvId){
			openview({
				view:'../Adv-detail.html',
				extrasobj:{AdvId:AdvId}
			})
		}
		
		//滑动栏目的轮播
		var mySwiper = new Swiper('.swiper-container',{
			pagination : '.swiper-pagination'
		});
		
		mui.plusReady(function(){
			//李洁要求
			if(!mui.os.ios){
				mainActivity = plus.android.runtimeMainActivity();
				MobclickAgent = plus.android.importClass("com.umeng.analytics.MobclickAgent");
				MobclickAgent.onPageStart("localLifeIndex");
			}
			//李洁要求结束
		//plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});
		mui('#kuimg')[0].style.display = 'inline-block';
		var oldtoken = plus.storage.getItem('oldToken');
			//栏目数据
			mui.ajax(serverUrl+'/api/localservice/localservicecates',{
				type:'post',
				timeout:10000,
				headers:{"token":oldtoken},
				success:function(data){
//					console.log('获取栏目返回'+JSON.stringify(data));
					console.log('获取栏目返回',data);
					if(data.errno == 0){ 
						var objdata = {};
						mui.each(data.data,function (index,ele) {
							data.data[index].iconpic = serverimgUrl + JSON.parse(ele.icon)[0].picImg;
						})
						objdata.list = data.data; 
						objdata.classnames = ['repair','cleaning','babysister','openclock','tiaozao','house','express','supermarket']
						objdata.myUrl = serverimgUrl;
//						console.log(objdata.list);
 
						var html = template("column",objdata);
						document.getElementById("columndiv").innerHTML=html;
						if(data.data.length > 8){//显示下一轮数据
							var html2 = template("column2",objdata);
							document.getElementById("columndiv2").innerHTML=html2; 
						}else{
							mui('#columndiv2')[0].className = 'null';
							mui('.diandian')[0].style.display = 'none';
						}
						
						plus.nativeUI.closeWaiting();
						mui('#Mask')[0].style.display = 'none';
						//添加监听
						Monitor();
					}else{
						mui.toast('获取用户信息失败');
						plus.nativeUI.closeWaiting();
						console.log(data.errmsg);
						mui('#columndiv2')[0].className = 'null';
						mui('.diandian')[0].style.display = 'none';
					}
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();
					mui('#columndiv2')[0].className = 'null';
					mui('.diandian')[0].style.display = 'none';
				}
			});
			//banner
			mui.ajax(serverUrl+'/api/index/banner',{
				data:{banner_type:9},
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldtoken},	 
				success:function(data,type,xhr){
					bannerObj={};
					bannerObj.bannerList = eval("("+data.data.banner+")");
					bannerObj.url = serverimgUrl;
					var html = template('banner-detail',bannerObj);
					document.getElementById('banner').innerHTML = html;
					//轮播图,获得slider插件对象
					var gallery = mui('.mui-slider');
					gallery.slider({
					  	interval:5000//自动轮播周期，若为0则不自动播放，默认为0；
					});
				},
				error:function(xhr,type,errorThrown){
					console.log('响应失败  !');
				}
			}); 
				
			recommendfun(1,1,1);//维修推荐
			recommendfun(2,2,2);//维修推荐
			recommendfun(3,3,3);//房产推荐
			recommendfun(4,4,4);//跳蚤推荐
			function recommendfun(type,script,div){//推荐方法
				var dataobj = {};
				if(type == 1 || type == 2){
					dataobj = {type_name:type,service_name:'local_service'}
				}else if(type == 3){
					dataobj = {service_name:'local_house'}
				}else{
					dataobj = {service_name:'local_used_market'}
				}
				var nullstr = '<div id="nomore" style="text-align: center;line-height: 100px;font-size: 14px;color: #888;"><img style="width: 50px;" src="../../img/unllfabu.svg"/> &nbsp; 暂时没有推荐</div>';
				mui.ajax(serverUrl+'/api/localservice/localservicecommend',{ 
					data:dataobj, 
					type:'post',
					timeout:10000,
					headers:{"token":oldtoken},	              				
					success:function(data){
						console.log('热门'+type,data);
						if(data.errno == 0){ 
							if(data.data.length){
								var objdata = {};
								mui.each(data.data,function (index,element) {
									if (element.logo) {
										element.logo = JSON.parse(element.logo)[0].picImg; 
									} else{ 
										element.logo = JSON.parse(element.list_pic)[0].picImg;
									}
									
								})
								objdata.list = data.data;
								objdata.url = serverimgUrl;
								var html = template("reco"+script,objdata); 
								document.getElementById("recodiv"+div).innerHTML = html;
							}else{
								document.getElementById("recodiv"+div).innerHTML = nullstr;
							}
							plus.nativeUI.closeWaiting();
						}else{
							document.getElementById("recodiv"+div).innerHTML = nullstr;
							plus.nativeUI.closeWaiting();
							console.log(data.errmsg);
						}
					},
					error:function(xhr,type,errorThrown){
						document.getElementById("recodiv"+div).innerHTML = nullstr;
						plus.nativeUI.closeWaiting();
						mui.toast('当前网络不好,请重试');
					}
				});
			}
			
			
		})//plusready
		Monitor();
		function Monitor(){
			//打开维修
			mui('.servicemore')[0].onclick = function(){
				if(!mui.os.ios){
				 MobclickAgent.onPageEnd("localLifeIndex");
				}
				openview({ 
					view:'theList.html',
					extrasobj:{name:'Repair'}
				})
			}
			mui('.repair')[0].addEventListener('tap',function(){
				openview({ 
					view:'theList.html',
					extrasobj:{name:'Repair'}
				})
			});
			//打开家政
			mui('.Housekeepingmore')[0].onclick = function(){
				openview({ 
					view:'theList.html',
					extrasobj:{name:'Clean'}
				})
			}
			mui('.cleaning')[0].addEventListener('tap',function(){
				openview({ 
					view:'theList.html',
					extrasobj:{name:'Clean'}
				})
			});
			//打开家乡话
			mui('.babysister')[0].addEventListener('tap',function(){
				openview({ 
					view:'../Hreport/h_report.html',
					extrasobj:{name:'h_report'}
				})
			});
			//打开开锁页面（弃用）
			mui('.openclock')[0].addEventListener('tap',function(){
				openview({ 
					view:'recruitList.html',
//					extrasobj:{name:'Openclock'}
				})
			});
			
			//打开房产
			mui('.Propertymore')[0].onclick = function(){
				openview({ 
					view:'buildList.html',
				})
			}
			mui('.house')[0].addEventListener('tap',function(){
				openview({ 
					view:'buildList.html',
				})
			});
			//打开跳蚤市场页面
			mui('.secondhandmore')[0].onclick = function(){
				openview({ 
					view:'2edMarket.html',
				})
			}
			mui('.tiaozao')[0].addEventListener('tap',function(){
				openview({ 
					view:'2edMarket.html',
				})
			});
			//打开快递上门页面
			mui('.express')[0].addEventListener('tap',function(){
				openview({ 
					view:'deliveryCenter.html',
				})
			});
			//打开超市特价页面
			mui('.supermarket')[0].addEventListener('tap',function(){
				openview({ 
					view:'marketPrice.html',
				})
			});
		}
		//打开律师咨询页面 
		mui('.laywer')[0].addEventListener('tap',function(){
			openview({ 
				view:'lawyerList.html',
			})
		});
		
		//维修详情 //家政详情 
		function opendetails2(id){
			openview({
				view:'theDetail.html',
				extrasobj:{name:id}
			})
		}
		//房产
		function opendetails3(id){
			openview({
				view:'build-detail.html', 
				extrasobj:{name:id}
			})
		}
		//跳蚤
		function opendetails4(id){
			openview({
				view:'Fleadetails.html',
				extrasobj:{name:id} 
			})
		}
	</script>
</html>