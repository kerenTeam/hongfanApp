<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>快递上门</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/app.js"></script>
		<script src="../../js/artTemplate-native.js"></script>
		<script src="../../js/other.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css">
			.hasManyCitytwo .header-tit{
				font-size: 16px;
				font-weight: bold;
			}
			/*banner样式*/
			.mui-slider-indicator .mui-indicator{
				width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			#banner{
				position: relative;
				width: 100%;
				padding-top: 50%; 
				overflow: hidden;
				background: url(../../img/bannerback.svg) 50% 50% no-repeat;
				background-size: 20%;
			}
			.mui-slider .mui-slider-group{
				position: absolute;
			    height: 100%;
			    width: 100%;
			    top: 0;
			}
			.mui-slider .mui-slider-group .mui-slider-item img{height: 100%;}
			/*banner样式结束*/

			/*下面的我的快递*/
			dl.list dt, dl.list dd{
				border-bottom: 1px solid #eee;
				background-color: #fff;
				margin-bottom: 4%;
				box-shadow: 0px 0px 6px #ccc;
				margin: 10px;
			}
			.guess-like,dl.list{
				border-bottom: 1px solid #eee;
				background-color: #EFEFF4;
			}
			.right{
				text-align: right;
			}
			.middle{
				text-align: center;
			}
			.guess-like{
				padding-top: 0;
			}
			.goods img{
				width: 60px;
				height: 60px;
				overflow: hidden;
				margin: 0 auto 10px;
				display: block;
				border: 1px solid #EFEFF4;
			}
			.goodsInfo p{
				text-overflow: ellipsis;
				line-height: 20px;
				overflow: hidden;
				white-space: nowrap;
				width: 95%;
			}
			.tiny{
				font-size: 12px;
			}
			.stateD{
				color: #2ACB7B;
				font-size: 16px;
				float: right;
			}
			header{
				background-image: none;
			}
			.btn{
				display: block;
				width: 90%;
				margin-left: 5%;
				/*margin-bottom: 10px;*/
				margin-top: 10px;
				background-color: #f53c42 !important;
			}
			.btn img{
				/*padding: 40px 20%;*/
				margin: 15px;
				margin-left: 30%;
				width: 60px;
			}
			.btn p{
				color: #fff;
				line-height: 70px;
				font-size: 20px;
				display: inline-block;
				/*text-align: center;*/
				/*margin-top: -30px;*/
				/*margin-bottom: 20px;*/
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
			<h1 class="mui-title">快递上门</h1>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div class="mui-row" id="main">
			<img src="../../img/dBack.jpg" style="width: 100%;position: absolute;bottom: 0;z-index: -1;"/>
			<div id="scroller">
				<!--轮播图-->
				<div class="mui-slider" id="banner"></div>
				<!--banner数据渲染-->
				<script type="text/html" id="banner-detail">
					<div class="mui-slider-group mui-slider-loop">
					    <!--支持循环，需要重复图片节点-->
					    <div class="mui-slider-item mui-slider-item-duplicate">
					    	<img src="<%= url %><%= bannerList[bannerList.length-1].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    </div>
						<% for(var i=0;i<bannerList.length;i++){ %> 
					    	<div class="mui-slider-item">
					    		<img src="<%= url %><%=bannerList[i].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    	</div>
					     <% } %>
					    <!--支持循环，需要重复图片节点-->
					    <div class="mui-slider-item mui-slider-item-duplicate">
					    	<img src="<%= url %><%= bannerList[0].bannerPic %>" onerror="javascript:this.src='../img/market/nodata.svg';" />
					    </div>
					</div>
					<div class="mui-slider-indicator">
						<div class="mui-indicator mui-active"></div>
						<% for(var i=0;i<bannerList.length-1;i++){ %>
					    	<div class="mui-indicator"></div>
					    <% } %>
		            </div> 
				</script>
			</div>
		    <div class="mui-col-sm-6 mui-col-xs-6 btn" onclick="searchD()" style="margin-top: 30px;">
		    	<img src="../../img/tickets/cearchD.png"/>
		    	<p>查快递</p>
		    </div>
		    <div class="mui-col-sm-6 mui-col-xs-6 btn" onclick="sendD()">
		    	<img src="../../img/tickets/sendD.png"/>
		    	<p>寄快递</p>
		    	
		    </div>
		</div>
		<div>
		<div class="guess-like">
				<dl class="list" id="goodsList"></dl>
			</div>
			<script type="text/html" id="goodsList-detail">
				<% for(var i=0;i<li.length;i++){ %>
					<% if(li[i].order_status==3){ %>
						<dd class="goodsItem" onclick="deliveryDetail('<%= li[i].shipper_code %>','<%= li[i].logistic_code %>')">
							<a class="react">
								<p class="tiny">订单号：<%= li[i].logistic_code %>
									<span class="stateD">已发货</span>
								</p>
							</a>
							<% for(var j=0;j<li[i].goods_data.goodsData.length;j++){ %>
								<div class="mui-row">
								    <div class="mui-col-sm-3 mui-col-xs-3 goods">
								    	<img src="<%= url %><%= li[i].goods_data.goodsData[j].goodsImg %>"/>
								    </div>
								    <div class="mui-col-sm-9 mui-col-xs-9 goodsInfo">
								    	<p class="black"><%= li[i].goods_data.goodsData[j].goodsName %></p>
								    	<p class="tiny">快递已发出</p>
								    	<p class="tiny"><%= li[i].create_time %></p>
								    </div>
								</div>
							<% } %>
						</dd>
					<% }else if(!li[i].order_status==3){ %>
						<div class="nothing"><img src="../../img/theList/del.png"/><p>你没有快递消息哟！</p></div>
					<% } %>
				<% } %>
			</script>
	</body>
	<script type="text/javascript">
		(function(){
			//查快递
			window.searchD = function(){
				openview({ 
					view:'searchD.html'
				})
			}
			//寄快递
			window.sendD = function(){
				openview({ 
					view:'deliveryList.html'
				})
			}
			function deliveryDetail(){
				openview({
					view:'deliveryTrace.html',
	//				extrasobj:{};//快递公司，订单号
				})
			}
		})();
		function deliveryDetail(shipper,deliveryNo){
//			var shipper = "HTKY";
//			var deliveryNo = "70272900063489";
			openview({
				view:'../localLife/deliveryTrace.html',
				extrasobj:{shipper:shipper,deliveryNo:deliveryNo}//快递公司，订单号
			})
		}
		mui.plusReady(function(){
			//获取缓存
			var oldToken = plus.storage.getItem('oldToken');
			console.log(oldToken);
			var userId = plus.storage.getItem("userid");
			mui.ajax(serverUrl+'/api/mall/orderlist',{
				data:{userid:userId},
				dataType:'json',
				type:'post',
				timeout:1000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
//					alert(JSON.stringify(data.data))
//					var data.data=[];
					for(var i=0;i<data.data.length;i++){
						if(data.data[i].order_status==3){
							data.data[i].goods_data=JSON.parse(data.data[i].goods_data);
						}
					}
					orderObj={};
					orderObj.url = serverimgUrl;
					orderObj.li = data.data;
					var html = template('goodsList-detail',orderObj);
					document.getElementById('goodsList').innerHTML = html;
//					
				},
				error:function(xhr,type,errorThrown){
					alert('响应失败  !');
				}
			}); 
			//banner
			mui.ajax(serverUrl+'/api/index/banner',{
				data:{banner_type:7},
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
//					alert(JSON.stringify(data))
					bannerObj={};
					if(data.data.banner){
						bannerObj.bannerList = eval("("+data.data.banner+")");
					}
					bannerObj.url = serverimgUrl;
					var html=template('banner-detail',bannerObj);
					document.getElementById('banner').innerHTML = html;
					plus.nativeUI.closeWaiting();//关闭等待框
					//轮播图,获得slider插件对象
					var gallery = mui('.mui-slider');
					gallery.slider({
					  	interval:5000//自动轮播周期，若为0则不自动播放，默认为0；
					});
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();//关闭等待框
					mui.toast('响应失败  !');
				}
			}); 
		})
	</script>

</html>