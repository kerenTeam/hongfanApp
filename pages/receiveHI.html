<!DOCTYPE html>
<html class="ui-page-login">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>领HI豆</title>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/common.css"/>
		<link rel="stylesheet" type="text/css" href="../css/mui.css"/>
		<link rel="stylesheet" type="text/css" href="../css/index.css"/>
		<link rel="stylesheet" type="text/css" href="../css/reset.css"/>
	</head> 
	<style type="text/css">
		body{height: 50%;background: url(../img/receiveHI.png) 0 0 no-repeat;background-size: 100% 100%;overflow: hidden;}
		.mui-bar-nav.mui-bar .mui-icon{padding: 0px;} 
		#Clickon{height: 20%;width: 100%;position: absolute;left: 0;bottom: 32%;}
		.divdiv{height: 100px;padding: 12% 8% 0;}
		.divdiv img{width: 70px;height: 70px;border-radius: 50%;float: left;margin-left: -80px;border: 1px solid #f5eeee;}
		.indiv{padding-left: 90px;}
		.indiv h3{font-size: 17px;color: #666;padding-top: 10px;}
		.indiv p{font-size: 10px;padding-top: 16px;}
		.in2div{float: right;margin-top: -52px;text-align: center;padding-right: 6%;}
		.in2div p{padding-top: 10px;}
		.in2div h2{font-size: 30px;font-weight: bold;color: #f9676e;}
	</style>
	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="headbar mui-action-back mui-icon mui-icon-left-nav mui-pull-left normalSize" style="margin-left: 0;"></a>
		    <h1 class="mui-title" id="confirmbtn1">领HI豆</h1>
			<span class="mui-pull-right fenlei"><!--<img src="../img/localLife/fenlei.svg"/>--></span>
		</header>
		<script src="../js/statusBar.js"></script><!--状态栏-->
		<div id="main">
			<div class="divdiv">
				<div class="indiv clearfix">
					<img src="../img/10.png"/ id="mypic">
					<h3 class="denluzhuce"> - - - </h3>
					<p>会员等级 <br /> 暂未开放</p>
					<div class="in2div">
						<h2 id="numjifen">- - - </h2>
						<p>当前HI豆</p>
					</div>
				</div>
			</div>
		</div>
		<div id="Clickon"></div>
	<script src="../js/mui.min.js"></script>
	<script src="../js/app.js"></script>
	<script type="text/javascript">
		mui.plusReady(function(){
			var myuserid = plus.storage.getItem('userid');
			var oldtoken = plus.storage.getItem('oldToken');
			mui('#Clickon')[0].onclick=function(){
				//执行领取  
				mui.ajax(serverUrl+'/api/index/cheking',{
					data:{"userid":myuserid,"intergral_float":2050},
					type:'post',
					timeout:10000, 
					headers:{"token":oldtoken},	              				
					success:function(data){ 
						plus.nativeUI.closeWaiting();
						console.log('领取返回'+JSON.stringify(data));
						if(data.errno == 0){
							mui.toast('领取成功,HI豆加3个');
							Refresh();  
						}else{
							mui.toast('距离上次签到还不到一天哦!'); 
						}
					},
					error:function(xhr,type,errorThrown){
						plus.nativeUI.closeWaiting();
						mui.toast('领取失败'); 
					}
				}); 
			};
			//显示信息
			Refresh();
			function Refresh(){
				mui.ajax(serverUrl+'/api/useraccount/userinfo',{
					data:{"userid":myuserid},
					type:'post',
					timeout:10000,
					headers:{"token":oldtoken},	              				
					success:function(data,type,xhr){
						console.log('获取用户数据返回'+JSON.stringify(data));
						if(data.errno == 0){
							if(data.data[0].avatar){//显示头像
								mui('#mypic')[0].src = serverimgUrl + JSON.parse(data.data[0].avatar)[0].picImg;
							}
							if(data.data[0].nickname != ' '){//显示昵称
								if(data.data[0].nickname.indexOf('null') == -1){
									mui('.denluzhuce')[0].innerHTML = data.data[0].nickname;
								}else{
									mui('.denluzhuce')[0].innerHTML = data.data[0].phone;
								}
							}else{
								mui('.denluzhuce')[0].innerHTML = data.data[0].phone;
							}
							if(!data.data[0].intergral || data.data[0].intergral==undefined){//显示HI豆
								mui('#numjifen')[0].innerHTML = 0;
							}else{
								mui('#numjifen')[0].innerHTML = data.data[0].intergral;
							}
						}else{
							mui.toast('获取用户信息失败'); 
							console.log(data.errmsg);
						}
					},
					error:function(xhr,type,errorThrown){
						console.log('获取用户数据,响应失败');
					}
				});
			}
			
		})
		
	</script>
	</body>

</html>