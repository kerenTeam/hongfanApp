<!DOCTYPE html>
<html class="ui-page-login">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>领HI豆</title>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/common.css"/>
		<link rel="stylesheet" type="text/css" href="../css/mui.css"/>
		<link rel="stylesheet" type="text/css" href="../css/index.css"/>
		<link rel="stylesheet" type="text/css" href="../css/reset.css"/>
	</head> 
	<style type="text/css">
		body{height: 50%;background: url(../img/receiveHI.png) 0 0 no-repeat;background-size: 100% 100%;overflow: hidden;}
		.mui-bar-nav.mui-bar .mui-icon{padding: 0px;} 
		#Clickon{height: 20%;width: 100%;position: absolute;left: 0;bottom: 32%;}
		.divdiv{height: 100px;padding: 12% 5% 0;padding-right: 22%;position: relative;}
		.divdiv img#mypic{width: 55px;height: 55px;border-radius: 50%;float: left;margin-left: -66px;border: 1px solid #f5eeee;margin-top: 8px;}
		.indiv{padding-left: 72px;}
		.indiv h3{font-size: 17px;color: #666;padding-top: 10px;font-size: 16px;}
		.indiv p{font-size: 10px;padding-top: 16px;}
		.in2div{float: right;margin-top: -52px;text-align: center;padding-right: 6%;}
		.in2div p{padding-top: 10px;}
		.in2div h2{font-size: 30px;font-weight: bold;color: #f9676e;}
		.erweimapic{position: absolute;width: 53px;right: 6%; top: 52%;}
		.cmquan{
			
			background: rgba(255,255,255,0.8);
			padding: 15px;
			position: fixed; 
			bottom: 0;
			left: 0;
			right: 0;
			display: -webkit-flex;
			align-content: space-around; 
			align-items: center; 
		}
		.cmquan>h5{
			text-align: center;
			flex-basis:50%;
			color: coral;
			font-weight: 400; 
		}
		.cmquan div{
			flex-basis:50%;
			text-align: center;
		}
		.cmquan button{
			border: 1px solid coral;
			color: coral;
			width: 30%;
			margin:  auto;
		}
	</style>
	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="headbar mui-action-back mui-icon mui-icon-left-nav mui-pull-left normalSize" style="margin-left: 0;"></a>
		    <h1 class="mui-title" id="confirmbtn1">领HI豆</h1>
			<a href="javascript:;" style="line-height: 50px;color:white;" class="fr baocun">我要吐槽</a>
		</header>
		<script src="../js/statusBar.js"></script><!--状态栏-->
		<div id="main">
			<div class="divdiv">
				<div class="indiv clearfix">
					<img src="../img/10.png"/ id="mypic">
					<h3 class="denluzhuce"> - - - </h3> 
					<p>会员等级 <br /> 暂未开放</p>
					<div class="in2div"> 
						<h2 id="numjifen">- - - </h2>
						<p>当前HI豆</p>
					</div>
				</div>
				<img class="erweimapic" src="../img/erweima.svg"/> 
			</div> 
		</div>
		<div id="Clickon"></div>
		<div class="cmquan">
			<h5>新用户领取电商通用券</h5>
			<div>
				<button>领券</button> 
			</div>
		</div>
	<script src="../js/mui.min.js"></script>
	<script src="../js/app.js"></script>
	<script type="text/javascript">
		mui.plusReady(function(){
			var myuserid = plus.storage.getItem('userid');
			var oldtoken = plus.storage.getItem('oldToken');
			var clicked = false;
			mui('#Clickon')[0].onclick=function(){ 
				if(!clicked){
					//执行领取  
					mui.ajax(serverUrl+'/api/index/cheking',{  
						data:{"userid":myuserid,"intergral_float":2050},
						type:'post',
						timeout:10000,  
						headers:{"token":oldtoken},	              				
						success:function(data){
							clicked = true;
							plus.nativeUI.closeWaiting();
							console.log('领取返回'+JSON.stringify(data));
							if(data.errno == 0){
								mui.toast('领取成功,HI豆加5个');
								Refresh();  
							}else{
								mui.toast('明天再来领吧!'); 
							}
							
						},
						error:function(xhr,type,errorThrown){
							plus.nativeUI.closeWaiting();
							mui.toast('领取失败'); 
						}
					});
				}else{
					mui.toast('明天再来领吧!'); 
				}
				 
			};
			
			//吐槽
			mui('.baocun')[0].onclick = function(){
				openview({
					view: "teasing.html",
					id: "teasing",
					extrasobj: {
						userId: myuserid,
						page:"hidou"
					}
				})
			}
			mui('.erweimapic')[0].onclick = function(){
				openview({ 
					view:'personal/barcode_scan.html',
					extrasobj:{statestr:'hi'}
				});
			}
			
			
			document.addEventListener('refresh',function(){
				Refresh();
			})
			//显示信息
			Refresh();
			function Refresh(){
				mui.ajax(serverUrl+'/api/useraccount/userinfo',{
					data:{"userid":myuserid},
					type:'post',
					timeout:10000,
					headers:{"token":oldtoken},	              				
					success:function(data,type,xhr){
						console.log('获取用户数据返回'+JSON.stringify(data));
						if(data.errno == 0){
							if(data.data[0].avatar){//显示头像
								mui('#mypic')[0].src = serverimgUrl + JSON.parse(data.data[0].avatar)[0].picImg;
							}
							if(data.data[0].nickname != ' '){//显示昵称
								if(data.data[0].nickname.indexOf('null') == -1){
									mui('.denluzhuce')[0].innerHTML = data.data[0].nickname;
								}else{
									mui('.denluzhuce')[0].innerHTML = data.data[0].phone;
								}
							}else{
								mui('.denluzhuce')[0].innerHTML = data.data[0].phone;
							}
							if(!data.data[0].intergral || data.data[0].intergral==undefined){//显示HI豆
								mui('#numjifen')[0].innerHTML = 0;
							}else{
								mui('#numjifen')[0].innerHTML = data.data[0].intergral;
							}
						}else{
							mui.toast('获取用户信息失败'); 
							console.log(data.errmsg);
						}
					},
					error:function(xhr,type,errorThrown){
						console.log('获取用户数据,响应失败');
					}
				});
			}
			
		})
		
	</script>
	<script type="text/javascript">
	//天天特价  discountGoods, 领嗨豆  getHIdou, 团购  groupBuying, 本地生活 localLife, 跨境优品   loveToGogoods, 电影 movie,
	//充值缴费   payment,  为民服务  serveForPeople,  购物中心 shopCenter, 注册  signUp, 特色馆 specialBar
	mui.plusReady(function () {
		var startTime, endTime, stayTime, flagback = 0;
		startTime = new Date().getTime();
		var old_back = mui.back;
		//改写返回键返回的函数，返回时传页面停留时间 
		mui.back = function(){
			endTime = new Date().getTime();//返回时间
			stayTime = Math.ceil((endTime - startTime) / 1000);  
			console.log('领嗨豆'+stayTime); 
			plus.statistic.eventDuration( "getHIdou", stayTime);
			//计算事件，计算出返回时在该页面停留的时间差值，除以六万获得停留分钟数，发送给友盟后台
			old_back(); 
		}
		plus.webview.currentWebview().addEventListener( "popGesture", function(){
			flagback++;
			if(flagback == 1){
				endTime = new Date().getTime();
				stayTime = Math.ceil((endTime - startTime) / 1000);   
				plus.statistic.eventDuration( "getHIdou", stayTime);
				//计算事件，计算出苹果右滑返回后在该页面停留的时间差值，除以六万获得停留分钟数，发送给友盟后台
			}
		}, false );
	});
</script> 
	</body>

</html>