<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>商家列表</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href=" ../../css/common.css">
		<link rel="stylesheet" type="text/css" href=" ../../css/index.css">
		<link rel="stylesheet" type="text/css" href=" ../../css/mui.min.css"/>
		<link rel="stylesheet" href=" ../../css/reset.css">
		<script type="text/javascript" src=" ../../js/jquery.min.js"></script>
		<!--<script type="text/javascript" src=" ../../js/iscroll.js"></script>-->
		<!--<script type="text/javascript" src=" ../../js/jquery.flexslider-min.js"></script>-->
		<!--<script src=" ../../js/hmt.js" type="text/javascript"></script>-->
		<!--<script type="text/javascript" src=" ../../js/index.js"></script>-->
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<!--<script src=" ../../js/swiper.min.js" type="text/javascript" ></script>-->
		<script type="text/javascript" src="../../js/app.js"></script>
		
		<!--引用模板引擎-->
		<script type="text/javascript" src="../../js/artTemplate-native.js"></script>
		
		
		<style type="text/css">
			.mui-bar{
				height: 50px;
				box-shadow: none;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			#storeItem{
				margin-top: 60px;
			}
			
			/*这一页*/
			.mui-card-header.mui-card-media{
				display: inline-block;
			}
			.banch{
				line-height: 50px;
				font-size: 20px;
				display: inline-block;
			}
			.mui-card-footer img{
				border-radius: 50%;
				width: 30px;
				height: 30px;
				border: 1px solid #fff;
				margin: 7px 7px 7px 20px;
				margin-top: -2px;
			}
			.mui-card-footer {
				padding: 15px;
			}
			.mui-card-footer, .mui-card-header{
				padding: 0;
			}
			.mui-card-footer button{
				position: absolute;
				right: 10px;
				top: 10px;
				border: 1px solid #ddd;
				color: #999;
			}
			.imgItem{
				width: 100% !important; 
				padding: 6px 2%;
				max-height: 160px;
				overflow: hidden;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav hasManyCity hasManyCitytwo">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize fl fanhui"></a>
		    <div class="header-tit">
				商家列表
			</div>
		</header>
		
		<div id="storeItem"></div>
		
		<script type="text/html" id="storeItem-detail">
			<% for(var i=0;i<recommentLi.length;i++){ %>
				<div class="mui-card">
					<img class="imgItem" src="<%= recommentImg[i] %>"/>
					<div class="mui-card-footer">
						<p>
							<img src="<%= recommentLi[i].logo %>"/>
							<span class="banch"><%= recommentLi[i].barnd_name %></span>
						</p>
						<button onclick="openStore(<%= recommentLi[i].store_id %>)">查看详情</button>
					</div>
				</div>
			<% } %>
		</script>
		
	</body>
	<!--<script src="../../js/other.js" type="text/javascript" charset="utf-8"></script>-->
	<script type="text/javascript">
		mui.init();
		mui.plusReady(function(){
			
			//数据渲染
			var oldToken = plus.storage.getItem('oldToken');

			console.log(oldToken);
			plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
			mui.ajax(serverUrl +'/api/mall/storelist',{
				data:{currentPage:1,numsPerPage:2,commercial_type_name:0,subcommercial_type_name:0},
				dataType:'json',
				type:'post',
				timeout:1000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
					plus.nativeUI.closeWaiting()
					var img = [];
					for (var i=0;i<data.data.length;i++) {
						var imgItem = JSON.parse(data.data[i].pic)[0].picImg;
						img.push(imgItem);
					}
//					alert(JSON.parse(data.data[0]));
					var recommentObj = {};
					recommentObj.recommentLi = data.data;
					recommentObj.recommentImg = img;
					var html2 = template('storeItem-detail',recommentObj);
					document.getElementById('storeItem').innerHTML = html2;
					
					//点击进入详情
					window.openStore = function(store_id){
//						alert(store_id);
						openview({
							view:'shophome.html',
//							alert(store_id),
							extrasobj:{storeId:store_id}
						})
					}
				},
				error:function(xhr,type,errorThrown){
					//alert('响应失败  !');
					plus.nativeUI.closeWaiting();
					mui.toast("网络不好请重试")
				}
			});
			
		})();
	</script>
</html>