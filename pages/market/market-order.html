<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text￼ml; charset=UTF-8">
		<title>商品订单确认</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<body>
		<ul class="mui-table-view waypay">
			<li class="mui-table-view-cell">
				<a href="#" id="alipay" data-pay="alipay" onclick="pay()"><img src="../../img/alipay2-2.png" />支付宝</a>
			</li>
			<li class="mui-table-view-cell">
				<a href="#" id="wxpay" data-pay="wxpay" onclick="pay()"><img src="../../img/weixin2-2.png" />微信 </a>
			</li>
		</ul>

		</body>
		<script src="../../js/app.js"></script>
		<script src="../../js/artTemplate-native.js"></script>
		<script type="text/javascript">
			var channel = null;
			var a
			// 1. 获取支付通道
			function plusReady() {
				// 获取支付通道
				plus.payment.getChannels(function(channels) {
					channel = channels[1];
					alert(JSON.stringify(channel))
				}, function(e) {
					alert("获取支付通道失败：" + e.message);
				});
			}

			document.addEventListener('plusready', plusReady, true);

			// 2. 发起支付请求
			function pay() {
//				a = {
//					"retcode": 0,
//					"retmsg": "ok",
//					"appid": "wx779a1427b1aaeb10",
//					"partnerid": "1438641502",
//					"prepayid": "wx201704062118018ec3f644500733411934",
//					"package": "Sign=WXPay",
//					"noncestr": "h5M3TR7KeNcKKRGs",
//					"timestamp": 1491484681,
//					"sign": "3FB919264F55CDD8504E1FAAF140B540"
//				}
				varpay = {
					    "retcode": 0,
					    "retmsg": "ok",
					    "appid": "wx779a1427b1aaeb10",
					    "noncestr": "15mx7e1lla6xy7ip",
					    "package": "Sign=WXPay",
					    "partnerid": "1438641502",
					    "prepayid": "wx20170407113843df9c4809df0616281832",
					    "timestamp": 1491536323,
					    "sign": "3ec176593c0bbaefc418df16a1458703" 
				}  

				plus.payment.request(channel, varpay, function(result) {
					plus.nativeUI.alert("支付成功！", function() {
						back();
					});
				}, function(error) {
					plus.nativeUI.alert("支付失败：" + JSON.stringify(error));
				});
			}
		</script>

<html>