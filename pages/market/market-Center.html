<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>购物中心</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<link rel="stylesheet" href="../../css/one.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script> 
		<style type="text/css">
			/*banner底部导航*/
			.mui-slider-indicator .mui-indicator{
				width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			.mui-slider-indicator .mui-active.mui-indicator{
				background-color: rgba(245,60,66,0.8);
				box-shadow: none;
				opacity: 1;
				border: none;
			}
			.mui-slider{
				margin-top: 50px;
			}
			.onetable{
				margin-top: 5px;
			}
			.onetable p{
				margin-top: -10px;
				font-size: 11px;
				margin-bottom: 5px;
			}
			.fontcl2{ 
				font-size: 16px;
				line-height: 18px;
			} 
			.sy_recmd_list .pub_wz{
				position: relative;
			}
			sub{
				bottom: 0;
				font-size: 50%;
				margin-left: 5px;
			}
			.fr {
				position: absolute;
				float: right;
				display: block;
				top: 12px;
				right: 5px;
				font-size: 10px;
			}
			.sy_recmd_list .pub_wz .nr_box{
				border-top: none;
				margin-top: 0;
			}
			.mui-bar{
				height: 50px;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			
			/*这一页*/
			.onetable{
				border-bottom: 0rem solid #e6e6e6;
				padding-bottom: 10px;
				background-color: #fff;
				box-shadow: 0px 0px 1px 0px rgba(0,0,0,0.1);
			}
		 
			.onetable .table{
				text-align: center;
			}
			.onetable .table img {
				text-align: center;
				width: 45%;
				margin: 0.15rem 0;
			}
			.onetable p {
				margin-top: -16px;
				font-size: 12px;
			}
			.market-icon{
				border-radius: 50%;
				width: 0.55rem;
				height: 0.55rem;
				display: block;
				margin: 10px auto;
			}
			.left{
				border-left: 0.03rem solid #f53c42;
				padding-left: 10px;
			}
			/*精选频道*/
			.choiceness {
				margin-top: 10px;
				padding-bottom: 5px;
			}
			.choiceness p{
				text-align: center;
				color: #333;
				line-height: 20px;
			}
			.choiceness .gray{
				color: #666;
				font-size: 11px;
			}
			.choiceness img{
				width: 16px;
				margin-top: -2px;
				margin-right: 2px;
			}
			.choicenessWrap .pub_img img {
				height: 100px;
				min-height: 1rem;
				overflow: hidden;
			}
			.box{
				/*border: 1px solid #efefef;*/
				box-shadow: 0px 0 1px 0px rgba(0,0,0,0.1);
			}
			.sy_recmd{
				background-color: #fff;box-shadow: 0px 0px -1px 0px rgba(0,0,0,0.1); 
    			margin-bottom: 10px !important; 
			}
			.sy_recmd:last-child{
				margin-bottom: 0%!important; 
			}
			.sy_title{
				border-bottom: none;
			}
			.mui-bar-nav{
				box-shadow: none;
			}
			.rcdPadding{
				position: relative;
				display: inline-block;
				padding-top: 100%;
				width: 100%;
				overflow: hidden;
			}
			.rcdPadding img{
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
			}
			#upload{ 
				text-align: center;padding-bottom: 10px;font-size: 12px;
			}
			#upload img{width: 60px;margin-top: -27px;
			}
			.gocart{
				position: fixed;
				right: 0.2rem;
				bottom: 0.2rem;
				height: 0.5rem;
				width: 0.5rem;
				background-color: #f53c42;
				border-radius: 50%;
				border: 0;
				box-sizing: border-box;
				z-index: 999;
				padding: 0;
				text-align: center;
				line-height: 0.5rem;
				box-shadow: 0px 0px 2px 2px rgba(208, 145, 145, 0.4);
			}
			.gocart img{
				width: 60%;
			} 
			.sy_recmd_list .pub_wz h3 a{
				color: #666;
				line-height: 0.2rem;
				font-size: 12px;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				width: 100%;
				display: block;
			}
		 .mui-slider-item a{
				position: relative;
				width: 100%;
				padding-top: 42%; 
				overflow: hidden;
			}
			.mui-slider-item img{
				position: absolute;
				width: 100%; 
				height:100%;
				top: 0;
			}
			.mb10{
				border-top: none !important;
			}
			.table{
				border-bottom: none !important;
			}
			
			/*广告*/
			.adbox{line-height: 30px;width: 18% !important;}
			.adbox p{padding: 10px 0;text-align: left !important;font-size: 12px !important;}
			/*.adbox img{width: 30% !important;}*/
			.overyou{width: auto !important;overflow-x: scroll !important;padding: 0 10px 10px 10px;} 
			.swiper-slide{
				width: 50%;
				border-radius: 3px !important;
			}
			.sy_limit_buy{
				border-bottom: none;
				padding: 0;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav hasManyCity hasManyCitytwo">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize fl fanhui"></a>
		    <div class="header-tit">
				购物中心
			</div>
		</header> 
		<script src="../../js/statusBar.js"></script><!--状态栏-->
			<div class="gocart"><img src="../../img/center/gocart.svg" alt="" /></div> 
		<!--<div id="container">-->
			<div id="main">
				<!--<div id="scroller">-->
					<div id="banner"></div>
						<script type="text/html" id="bannerModal">
							<!--轮播图-->
							<div class="mui-slider">
								<div class="mui-slider-group mui-slider-loop">
									<!--支持循环，需要重复图片节点-->
									<div class="mui-slider-item">
										<a onclick="bannerGo('<%=bannerData[bannerData.length-1].url%>')" data-url="<%=bannerData[bannerData.length-1].url%>" data-id = "<%=bannerData.length-1%>">
											<img src="<%=bannerData[bannerData.length-1].bannerPic%>" />
										</a>
									</div>
									<% for(var i=0;i<bannerData.length;i++){ %>
										<div class="mui-slider-item">
											<a onclick="bannerGo('<%=bannerData[i].url%>')" data-url="<%=bannerData[i].url%>" data-id = "<%=i%>">
												<img src="<%=bannerData[i].bannerPic%>" />
											</a>
										</div>
									<% } %>
									<!--支持循环，需要重复图片节点-->
									<div class="mui-slider-item mui-slider-item-duplicate">
										<a onclick="bannerGo('<%=bannerData[0].url%>')" data-url="<%=bannerData[0].url%>" data-id = "0">
											<img src="<%=bannerData[0].bannerPic%>" />
										</a>
									</div>
								</div>
								<div class="mui-slider-indicator">
									<div class="mui-indicator mui-active"></div>
									<% for(var i=0;i<bannerData.length-1;i++){ %>
								    	<div class="mui-indicator"></div>
								    <% } %>
					            </div>
					        </div>
					    </div>
						<!--轮播图结束-->
					</script>
					 
					<!--商品分类-->
					<div id="moll_type"></div>
					<script type="text/html" id="typeTpl">
						<div class="onetable" style="margin-bottom: 0;">
							<div class="table mui-row">
								<%for(var i=0;i<typeData.length;i++){%>
									<div class="mui-col-xs-3" onclick="goList('<%=typeData[i].catid%>')">
									<div class="market-icon" style="background-color:<%=typeData[i].icon_color%>;" id="<%=typeData[i].catid%>">
										<img src="<%=myUrl%><%=typeData[i].icon%>" />
									</div>
									<br/>
									<p><%=typeData[i].catname%></p>
								</div>
									<%}%>
							</div>
						</div>
					</script>
					
					<!--模块选择-->
					<div class="mui-row" style="background-color: white;margin: 10px 0;">
						<div class="mui-col-xs-6 rowpad">
							<div class="moviepad">
								<h4 style="color: #F94A1F;"><span style="font-size:0.4rem;vertical-align: middle;">·</span> <span style="vertical-align: middle;">热映电影</span>  <span style="font-size:0.4rem;vertical-align: middle;">·</span></h4>
								<div class="gomovie">立即购票</div>
								<img src="../../img/market/movie.svg" alt="" />
							</div>
						</div>
						<div class="mui-col-xs-6 rowpad">
							<div class="rpad clearfloat" onclick="coupon()">
								<div class="up">
									<div class="rapr">
										<h4>优惠</h4>
										<br />
										<p class="gray"><small>每日超值好物</small></p>
									</div>
									<img src="../../img/market/noodle.jpg" class="fr" alt="" />
								</div>
							</div> 
							<div class="rpad clearfloat" onclick="activity()">
								<div class="up">
									<div class="rapr">
										<h4>活动</h4>
										<br />
										<p class="gray"><small>万千商家等你逛</small></p>
									</div>
									<img src="../../img/market/atcenter.jpg" class="fr" alt="" />
								</div>
							</div>
						</div> 
					</div>
					
					<!--广告-->
					<div class="sy_limit_buy mb10 sy_recmd">
						<div class="sy_title mb10">
							<span class="left">HOT</span>
							<!--<a href="#" class="fr morethree">更多&gt;&gt;</a>-->
						</div>
						<div class="overyou locatLabel_switch swiper-container5 swiper-container-horizontal swiper-container-free-mode swiper-container-android">
							<div class="swiper-wrapper" id="Advdiv"></div> 
							<script type="text/html" id="Adv">
								<% for(var i=0; i<list.length; i++){%>
									<div class="box swiper-slide" onclick="goAdv(<%= list[i].id %>)">
										<p class="overflow_clear"><img src="<%= list[i].pic %>"/><%= list[i].title%></p>
									</div>
								<% }%>	
							</script>
						</div>
					</div>
					
					<div class="sy_recmd">
						<!--精选频道-->
						<div class="sy_title mb10">
							<span class="left">精选频道</span>
							<a href="#" class="fr morethree">更多&gt;&gt;</a>
						</div>
						<div class="sy_recmd_list_box choicenessWrap">
							<ul>
								<li class="sy_recmd_list" id="storeRcmd">
									<div class="box">
										<div class="pub_img">
											<a href="javascript:;"><img src="../../img/market/market-cloth.jpg" width="145" height="145"></a>
										</div>
										<div class="choiceness">
											<p class="overflow_clear"><img src="../../img/market/store.png"/>达人探店</p>
											<p class="gray">达人为你推荐好店</p>
										</div>
									</div>
								</li>
								<li class="sy_recmd_list">
									<div class="box">
										<div class="pub_img">
											<a><img src="../../img/market/market-food.jpg" width="145" height="145"></a>
										</div>
										<div class="choiceness">
											<p class="overflow_clear"><img src="../../img/market/breakfast.png"/>元气早餐</p>
											<p class="gray">附近人气餐厅选择</p>
										</div>
									</div>
								</li>
							</ul>
							<div class="clear"></div>
						</div>
						
					</div>
					<div class="sy_recmd" style="background-color: #fff;">
						
						<!--推荐列表-->
						<div class="sy_title mb10">
							<span class="left">热门推荐</span>
							<a href="#" class="fr morethree">更多&gt;&gt;</a>
						</div> 
						<div class="sy_recmd_list_box">
							<ul>
						<div id="moll_recommend"></div>
						
							</ul>
							<div class="clear"></div>
						</div>
						<script type="text/html" id="recommendTpl">
								<%if(recommendData.length==0){%>
									暂无推荐商品
								<%}else{%>
									<%for(var i=0;i<recommendData.length;i++){%>
										<li class="sy_recmd_list">
											<div class="box">
												<div class="pub_img">
													<a class="rcdPadding" onclick="goInfo('<%=recommendData[i].goods_id%>')"><img src="<%=recommendData[i].thumb%>" width="145" height="145"></a>
												</div>
												<div class="pub_wz">
													<h3 class="overflow_clear"><a onclick="goInfo('<%=recommendData[i].goods_id%>')"><%=recommendData[i].title%></a></h3>
													<div class="nr_box mui-row">
														<div class="mui-col-sm-6 mui-col-xs-6">
												        	<p class="fl fontcl2">¥<%=recommendData[i].price%></p>
												      	</div>
												        <div class="mui-col-sm-6 mui-col-xs-6 saled">
															<p class="fl fontcl2" style="float: right;"><sub class=" black9" style="text-align: right;">已售<%=recommendData[i].sales%></sub></p>
												      	</div>
												     </div>
												</div>
											</div>
										</li> 
									<%}%>
								<%}%>
						</script>
						<div class="upload text-center text-xs gray" id="upload"></div>
					</div>
					
				</div>
			<!--</div>-->
		<!--</div>-->
		 
		<script src="../../js/mui.min.js"></script> 
	<script type="text/javascript" src="../../js/artTemplate-native.js"></script>
	<script src="../../js/app.js"></script>	
	<script type="text/javascript">
 
		//分类跳转详情
		function goList(catId){
			 openview({
				 	view:"goodsList.html",
				 	extrasobj:{goodscatId:catId}
				 })
		}
		
		//跳转详情
		function goInfo(goodsId){
			 //alert(goodsId)
			 openview({
			 	view:"mall-detail.html",
			 	extrasobj:{goodsId:goodsId}
			 })
		}
		
		//跳转优惠
		function coupon(){
			openview({
				view:"../activity/coupon.html"
			})
		}
		
		//跳转活动
		function activity(){
			openview({
				view:"../activity/activity.html"
			})
		}
			 
		mui("#storeRcmd")[0].addEventListener('tap',function(){
			openview({
				 	view:"storeList.html"
				 })
		})
		
		//点击广告跳转到商品详情
		function goAdv(AdvId){
//			alert(goodsId)
			openview({
				view:'../Adv-detail.html',
				extrasobj:{AdvId:AdvId}
			})
		}
		
		mui.plusReady(function(){
			//去购物车
			document.getElementsByClassName("gocart")[0].addEventListener('tap',function () {
			//当前页
	 		     plus.webview.getWebviewById('market/market-Center.html').close();
					  
			    //获得主页面的webview
			    var main = plus.webview.getLaunchWebview();
			    //触发主页面的gohome事件
			    mui.fire(main,'gohome',{hrefid:'cart'}); 
			    setTimeout(function(){
			    	main.show();
			    	mui.back();
			    	plus.webview.currentWebview().close();
			    },200);
			});
			
			
			//获取token
			var token=plus.storage.getItem("oldToken");
			plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
				mui.ajax(serverUrl+'/api/mall/mallbanner',{
					dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型 
					timeout:10000,//超时时间设置为10秒；	
					headers:{"token":token}, 
					success:function(data){ 
						//获取并渲染  eval("("+data1+")");
						console.log(data.data.banner)
						if(data.errno==0){
							var dataobj= eval("("+data.data.banner+")");
						var bannerObj = {}
							bannerObj.myUrl = serverimgUrl;
							bannerObj.bannerData = dataobj
	                    document.getElementById("banner").innerHTML=template("bannerModal",bannerObj);
	                    var gallery = mui(".mui-slider");
						gallery.slider({
							interval: 3000 //设置自动轮播周期为3s
						});
										
						//banner跳转
						window.bannerGo=function(url){
//						  	alert(url)
						  	openview({
										 	view:url,
										 })
						  }
						}else{
							mui.toast("网络不好请重试！");
						}
						
					},
					error:function(xhr,type,errorThrown){
						//异常处理；
						console.log("获取失败！");
						mui.toast("当前网络不好请重试");
					}
				}); 
				//商城分类 数据渲染
				mui.ajax(serverUrl+'/api/mall/mallcategory',{
					dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型 
					timeout:10000,//超时时间设置为10秒；	
					headers:{"token":token}, 
					success:function(data){
						//获取并渲染  eval("("+data1+")");
						//var dataobj= eval("("+data.data.banner+")"); 
						if(data.errno==0){
							var dataobj = data.data
							var typeObj = {}
								typeObj.myUrl = serverimgUrl;
								typeObj.typeData = dataobj
		                    document.getElementById("moll_type").innerHTML=template("typeTpl",typeObj);
						}else{
							mui.toast("网络不好请重试！");
						}
					},
					error:function(xhr,type,errorThrown){
						//异常处理；
						console.log("获取失败！");
						mui.toast("当前网络不好请重试");
					}
				}); 
				
				//广告
				mui.ajax(serverUrl+'/api/index/ads',{
					data:{ad_type:2},
					type:'post',
					timeout:10000,
					headers:{"token":token},	              				
					success:function(data){
						var objdata = {};
						objdata.list = data.data;
						var html2 = template("Adv",objdata);
						document.getElementById("Advdiv").innerHTML=html2;
					},
					error:function(xhr,type,errorThrown){
						plus.nativeUI.closeWaiting();
						mui.toast('响应失败  !');
					}
				});
			
				var currentPage =1, numsPerPage=4;
 			//热门推荐 数据渲染 
				mui.ajax(serverUrl+'/api/mall/mallgooodslist', {
					data: {currentPage:currentPage,numsPerPage:numsPerPage,recommend:1,storeId:'',brand:'',keyword:'',order_type: 'price',desc:''},
					dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型 
						timeout:10000,//超时时间设置为10秒；	
						headers:{"token":token}, 
						success:function(data){
							 //alert(JSON.stringify(data))
							//获取并渲染  eval("("+data1+")");
							//var dataobj= eval("("+data.data.banner+")"); 
							if(data.errno==0){
							plus.nativeUI.closeWaiting();//关闭等待框
							var dataobj = data.data.return.data
							var recommendObj = {}
								recommendObj.myUrl = serverimgUrl;
								recommendObj.recommendData = dataobj
		                    document.getElementById("moll_recommend").innerHTML+=template("recommendTpl",recommendObj);
		                    mui("#upload")[0].innerHTML = "加载更多";
		                    	//上滑加载
		                   $(window).scroll(function(){
						　　var scrollTop = $(this).scrollTop();
						　　var scrollHeight = $(document).height();
						　　var windowHeight = $(this).height();
						　　if(scrollTop + windowHeight == scrollHeight){
							var nowpage = ++currentPage;
							if(nowpage<=data.data.return.totalPages){//当前页小于等于总页数时请求下一页
								mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg' />";
								console.log('可以请求数据');
								mui.ajax(serverUrl+'/api/mall/mallgooodslist',{ 									
									data:{currentPage:nowpage,numsPerPage:numsPerPage,recommend:1,storeId:'',brand:'',keyword:'',order_type: 'price',desc:''}, 
									dataType:'json',//服务器返回json格式数据
									type:'post',//HTTP请求类型 
									timeout:10000,//超时时间设置为10秒；	
									headers:{"token":token}, 
									success:function(data){
										if(data.errno == 0){
											var dataobj = data.data.return.data
											var recommendObj = {}
												recommendObj.myUrl = serverimgUrl;
												recommendObj.recommendData = dataobj
						                    document.getElementById("moll_recommend").innerHTML+=template("recommendTpl",recommendObj);
						                    mui("#upload")[0].innerHTML = "";
										}else{
											--currentPage;//请求失败,继续请求当前页
											plus.nativeUI.closeWaiting();
											mui.toast("获取数据失败");
										}
										plus.nativeUI.closeWaiting();//关闭等待框
									},
									error:function(xhr,type,errorThrown){
										--currentPage;//请求失败,继续请求当前页
										mui.toast("当前网络不好请重试");
									}
								});
							}else{
								mui("#upload")[0].innerHTML = "没有数据了";
							}
							//加载下一部分结束
							　　}
						});
							}else{
								plus.nativeUI.closeWaiting();
								mui.toast("获取数据失败");
							}
							
						}, 
						error:function(xhr,type,errorThrown){
							//异常处理；
							console.log("获取失败！");
							plus.nativeUI.closeWaiting();
							mui.toast("当前网络不好请重试");
						}
				}); 
		


	});
	</script>	
	</body>
	
</html>