<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>天天特价</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<style type="text/css">
			.special{padding: 15px 5px 15px 35%;padding-left: 32%;position: relative;background-color: #fff;overflow: hidden;min-height: 125px;}
			.special p{font-size: 15px; color: #555; line-height: 1.3;}
			.special p span{font-size: 12px;color: #ef2b2b;}
			.special img{width: 40%;float: left;margin-left: -44%;border-radius: 2px;}
			.S_bottom{position: absolute;left: 32%;bottom: 12px;width: 66%;} 
			.S_bottom1{margin-bottom: 5px;} 
			.S_bottom1 span{font-size: 17px; color: #ef2b2b;position: relative;top: 9px;left: -2px;font-weight: 800;letter-spacing: .5px;}
			.S_bottom1 span b{font-size: 13px; color: #999;text-decoration: line-through;font-weight: 500;}
			.S_bottom1 a{padding: 7px 9px;  color: #fff; font-size: 14px;background-color: #ef2b2b;float: right; border-radius: 2px;position: relative;top: -3px;}
			.S_bottom2 span{text-decoration: line-through;margin-left: 1px;}
			.S_bottom2 span, .S_bottom2 a{font-size: 13px; color: #999;}
			.S_bottom2 a{float: right;font-size: 12px;}
			.schedule{display: inline-block;width: 74px;height:10px;float: right;border: 1px solid #f58e90;border-radius: 30px;position: relative;top: 1.5px; margin-left: 5px;}
			.schedule div{background-color: #fda19f;height: 100%;border-top-left-radius: 3px;border-bottom-left-radius: 3px;}
		</style>
	</head>
	<body style="background-color: #fff !important;"> 
		<header class="mui-bar mui-bar-nav" id="header">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title" id="headtitle">天天特价</h1>
		</header>	
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="main">
			<!--<div class="special clearfix fineB aClick">
				<img src="../../img/special.jpg"/>
				<p class="overTwo">
					<%= recommendData[i].title%>
					<br/> <span>限时抢购</span>
				</p>
				<div class="S_bottom">
					<div class="S_bottom1 clearfix">
						<span>￥999</span> 
						<a>立即抢购</a>
					</div>
					<div class="S_bottom2">
						<span>￥1299</span>
						<div class="schedule"><div style="width:50%;"></div></div>
						<a>已售50% </a>
					</div>
				</div>
			</div>-->
			<!--<div class="special clearfix fineB aClick">
				<img src="../../img/special.jpg"/>
				<p class="overTwo">
					<%= recommendData[i].title%>
					<br/> <span>限时抢购</span>
				</p>
				<div class="S_bottom">
					<div class="S_bottom1 clearfix">
						<span>￥999 <b>￥1299</b></span> 
						<a>立即抢购</a>
					</div>
				</div>
			</div>-->
		</div>
		<script type="text/html" id="recommendTpl">
			<% for(var i=0;i<recommendData.length;i++){%>
				<div class="special clearfix fineB aClick" onclick="goInfo(<%= recommendData[i].goods_id%>)">
					<!--<img src="../../img/special.jpg"/>-->
					<img src="<%= myUrl%><%= recommendData[i].thumb%>" alt="<%= myUrl%>+<%= recommendData[i].thumb%>" onerror="this.src = '../../img/nopic.svg'"/>
					<p class="overTwo">
						<%= recommendData[i].title%>
						<br/> <span>限时抢购</span>
					</p>
					<div class="S_bottom">
						<div class="S_bottom1 clearfix">
							<span>￥999</span> 
							<a>立即抢购</a>
						</div>
						<div class="S_bottom2">
							<span>￥1299</span>
							<div class="schedule"><div style="width:50%;"></div></div>
							<a>已售50% </a>
						</div>
					</div>
				</div>
			<% }%>	
		</script>
		<div class="upload text-center text-xs gray" id="upload"></div>
		<div id="nulldiv" style="text-align:center;margin-top: 40%;font-size: 14px;color: #999;display: none;">
			<img style="width: 30%;margin-bottom: 5%; " src="../../img/unllfabu.svg"/>
			<br />
			没有相关信息
		</div>
	</body>
<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/app.js"></script>	
<script src="../../js/jquery.min.js"></script>	
<script type="text/javascript">
	statisticsfun('天天特价主页');//统计代码
	var Spagenum = 2; //实到页数
	var Ypagenum = 1; //应到页数 
	mui.plusReady(function() {
		var oldToken = plus.storage.getItem('oldToken');
		plus.nativeUI.showWaiting(); //显示等待框
		//热门推荐 数据渲染  
		var currentPage = 1,
			numsPerPage = 10;
		mui.ajax(serverUrl + '/api/mall/mallgooodslist', {
			data: {
				currentPage: currentPage,
				numsPerPage: numsPerPage,
				recommend: 1,
				differentiate: 1,
				storeId: '',
				brand: '',
				keyword: '',
				order_type: 'price',
				desc: ''
			},
			dataType: 'json', //服务器返回json格式数据
			type: 'post', //HTTP请求类型 
			timeout: 10000, //超时时间设置为10秒；	
			headers: {
				"token": oldToken
			},
			success: function(data) {
				console.log('数据',data);	
				if(data.errno == 0) {
					var dataobj = data.data.return.data
					var recommendObj = {}
					recommendObj.myUrl = serverimgUrl;
					recommendObj.recommendData = dataobj
					document.getElementById("main").innerHTML = template("recommendTpl", recommendObj);
					mui("#upload")[0].innerHTML = "";
					//上滑加载
					$(window).scroll(function() {　　
						var scrollTop = $(this).scrollTop();　　
						var scrollHeight = $(document).height();　　
						var windowHeight = $(this).height();　　
						if(scrollTop + windowHeight == scrollHeight) {
							if(Spagenum <= data.data.return.totalPages && Spagenum == Ypagenum + 1) { //当前页小于等于总页数时请求下一页
								mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg' />";
								Ypagenum++; //满足加载情况,应到页数+1
								console.log('发起请求,实到' + Spagenum + '页');
								console.log('发起请求,应到' + Ypagenum + '页');
								mui.ajax(serverUrl + '/api/mall/mallgooodslist', {
									data: {
										currentPage: Spagenum,
										numsPerPage: numsPerPage,
										recommend: 1,
										differentiate: 1,
										storeId: '',
										brand: '',
										keyword: '',
										order_type: 'price',
										desc: ''
									},
									dataType: 'json', //服务器返回json格式数据
									type: 'post', //HTTP请求类型 
									timeout: 10000, //超时时间设置为10秒；	
									headers: {
										"token": oldToken
									},
									success: function(data) {
										console.log('数据1',data);
										if(data.errno == 0) {
											var dataobj = data.data.return.data
											var recommendObj = {}
											recommendObj.myUrl = serverimgUrl;
											recommendObj.recommendData = dataobj
											document.getElementById("main").innerHTML += template("recommendTpl", recommendObj);
										}
										mui("#upload")[0].innerHTML = " ";
										Spagenum++; //加载成功,当前页+1
										console.log('成功+1,实到' + Spagenum);
										console.log('成功+1,应到' + Spagenum);
									},
									error: function(xhr, type, errorThrown) {
										Ypagenum--; //失败是应到-1
										mui.toast("当前网络不好请重试");
										mui("#upload")[0].innerHTML = "";
									}
								});
							} else if(Spagenum == data.data.return.totalPages + 1) { //当前页不小于等于总页数时请求下一页
								mui("#upload")[0].innerHTML = "到底了";
							}
						}
					});
				} else {
					mui("#upload")[0].innerHTML = "";
				}
				plus.nativeUI.closeWaiting(); //关闭等待框
			},
			error: function(xhr, type, errorThrown) {
				plus.nativeUI.closeWaiting(); //关闭等待框
				mui("#upload")[0].innerHTML = "";
			}
		});
		//跳转详情
		window.goInfo =  function(goodsId){ 
			 openview({
			 	view:"mall-detail.html",
			 	extrasobj:{goodsId:goodsId} 
			 })
		}
	})
		
</script>
</html>