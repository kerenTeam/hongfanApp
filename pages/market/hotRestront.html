<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>商家列表</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href=" ../../css/common.css">
		<link rel="stylesheet" type="text/css" href=" ../../css/index.css">
		<link rel="stylesheet" type="text/css" href=" ../../css/mui.min.css"/>
		<link rel="stylesheet" href=" ../../css/reset.css">
		<script type="text/javascript" src=" ../../js/jquery.min.js"></script>
		<!--<script type="text/javascript" src=" ../../js/iscroll.js"></script>-->
		<!--<script type="text/javascript" src=" ../../js/jquery.flexslider-min.js"></script>-->
		<!--<script src=" ../../js/hmt.js" type="text/javascript"></script>-->
		<!--<script type="text/javascript" src=" ../../js/index.js"></script>-->
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<!--<script src=" ../../js/swiper.min.js" type="text/javascript" ></script>-->
		<script type="text/javascript" src="../../js/app.js"></script>
		
		<!--引用模板引擎-->
		<script type="text/javascript" src="../../js/artTemplate-native.js"></script>
		
		
		<style type="text/css">
			.mui-bar{
				height: 50px;
				box-shadow: none;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			#storeItem{
				margin-top: 50px;
			}
			#upload{ 
				text-align: center;padding-bottom: 10px;font-size: 12px;
			}
			#upload img{width: 60px;margin-top: -20px;
			}
			/*这一页*/
			.mui-card-header.mui-card-media{
				display: inline-block;
			}
			.banch{
				line-height: 50px;
				font-size:0.16rem;
				color: black;
				display: inline-block;
			}
			.mui-card-footer img{
				border-radius: 50%;
				width: 30px;
				height: 30px;
				border: 1px solid #fff;
				margin: 7px 7px 7px 20px;
				margin-top: -2px;
			}
			.mui-card-footer {
				padding: 15px;
			}
			.mui-card-footer, .mui-card-header{
				padding: 0;
			}
			.mui-card-footer button{
				position: absolute;
				right: 10px;
				top: 10px;
				border: 1px solid #ddd;
				color: #999;
			}
			.imgItem{
				/*width: 40% !important; 
				position: relative;
				padding-top: 40%;*/
				overflow: hidden;
				/*border: 1px solid;*/
			}
			.imgItem img{
				/*position: absolute;*/
				width: 100%;
				/*top: 0;
				left: 0;*/
			}
			.msTOP{
				position: relative;
				width: 100%;
				padding-top: 62.5%;
				overflow: hidden;
				color: white;
			}
			.msTOP img{
				position: absolute;
				top: 0;
				left: 0;
			}
			.brtit{
				color: black;
				 text-align: center;
				line-height: 1.5;
				margin: 0.2rem;
			}
			.brtit div{
				font-size: 0.2rem;
			} 
			small{
				font-size: 0.13rem;
				color: gray;
			}
			article{
				background: #eee;
				padding: 0.1rem;
				width: 90%;
				border-radius: 5px;
				margin: auto;
				position: relative;
			}
			article p{
				font-size: 0.13rem;
				text-indent: 2em;
				white-space: normal;
				word-break: break-all;
				line-height: 1.4;
				color: #333;
			}
			.trangle{
				position: absolute;
			    top: -20px;
			    left: 50%; 
			    width: 0px;
			    height: 0px;
			    border-top: 11px solid transparent;
			    border-right: 11px solid transparent;
			    border-bottom: 11px solid #eee;
			    border-left: 11px solid transparent;
			}
			.drs{
				   border-radius: 2px;
				   margin: 0.1rem 5%;
				    box-shadow: 0 0 1px rgba(0,0,0,0.3);
				    border: 0px solid #eee!important; 
			}
		 button{
		 	background: #F0AD4E;
		 	border: 0!important; 
		 	color: white!important;
		 }
		</style>
	</head>
	<body style="background: white;">
		<header class="mui-bar mui-bar-nav hasManyCity hasManyCitytwo">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize fl fanhui"></a>
		    <div class="header-tit">
				商家列表
			</div>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		
		
		
		
		<div id="storeItem">
			<div class="msTOP">
				<img src="../../img/market/dr.jpeg" class="responsive" alt="" />
				
			</div>
			<div class="brtit">
				<div>开吃吧！美好的一天从吃开始</div>
				<small>hi集达人 | 2017年01月07日</small>
			</div>
			<article>
				<div class="trangle"></div>
				<p>相信很多吃货们，每天早上都会花大量时间纠结xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
				xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
				xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
				xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
				xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx,下面这些都会hiji
				的达人们热情推荐的美食好店！</p>
			</article>
		</div>
		
		<script type="text/html" id="storeItem-detail">
				<div>
			<% for(var i=0;i<recommentLi.length;i++){ %>
				<div class="mui-card drs">
					<div class="imgItem">
					<%if(!recommentLi[i].pic){%>
							<img src="../../img/market/nodata.svg"/>
						<%}else{%>
						<img src="<%=myurl%><%=recommentLi[i].pic%>"/>
							<%}%>
					</div>
					<div class="mui-card-footer">
						<p>
							<%if(!recommentLi[i].logo){%>
									<img src="../../img/market/shop.png"/>
								<%}else{%>
								<img src="<%=myurl%><%=recommentLi[i].logo%>"/>
									<%}%>
							
							<span class="banch"><%= recommentLi[i].barnd_name %></span>
						</p>
						<button onclick="openStore(<%= recommentLi[i].store_id %>)">进入好店</button>
					</div>
				</div> 
			<% } %>
			 </div>
		</script>
		<div class="upload text-center text-xs gray" id="upload"></div>
	</body>
	<!--<script src="../../js/other.js" type="text/javascript" charset="utf-8"></script>-->
	<script type="text/javascript">
		mui.init();
		mui.plusReady(function(){
			
			//数据渲染
			var oldToken = plus.storage.getItem('oldToken');

			console.log(oldToken);
			plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
			var currentPage =1, numsPerPage=4;
			
			
			mui.ajax(serverUrl +'/api/mall/storelist',{
				data:{currentPage:currentPage,numsPerPage:numsPerPage,commercial_type_name:'',subcommercial_type_name:'',store_distinction:4},//以及业态
				dataType:'json',
				type:'post',
				timeout:1000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
					plus.nativeUI.closeWaiting();    
					alert(JSON.stringify(data)) 
					var recommentObj = {};  
					recommentObj.myurl = serverimgUrl;
					recommentObj.recommentLi = data.data.data;
//					recommentObj.recommentImg = img;
					var html2 = template('storeItem-detail',recommentObj);
					document.getElementById('storeItem').innerHTML+= html2;
					mui("#upload")[0].innerHTML = "加载更多";
		                    	//上滑加载
		                   $(window).scroll(function(){
						　　var scrollTop = $(this).scrollTop();
						　　var scrollHeight = $(document).height();
						　　var windowHeight = $(this).height();
						　　if(scrollTop + windowHeight == scrollHeight){
							var nowpage = ++currentPage;
							if(nowpage<=data.data.totalPages){//当前页小于等于总页数时请求下一页
								mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg' />";
								console.log('可以请求数据');
									mui.ajax(serverUrl +'/api/mall/storelist',{
										data:{currentPage:currentPage,numsPerPage:numsPerPage,commercial_type_name:'',subcommercial_type_name:'',store_distinction:4},
										dataType:'json',
										type:'post',
										timeout:1000,
										headers:{"token":oldToken},	 
										success:function(data,type,xhr){
											plus.nativeUI.closeWaiting();
											var recommentObj = {};  
											recommentObj.myurl = serverimgUrl;
											recommentObj.recommentLi = data.data.data;
						//					recommentObj.recommentImg = img;
											var html2 = template('storeItem-detail',recommentObj);
											document.getElementById('storeItem').innerHTML+= html2;
											 
										},
										error:function(xhr,type,errorThrown){
												--currentPage;//请求失败,继续请求当前页
												mui.toast("当前网络不好请重试");
											}
									});
							}else{
								mui("#upload")[0].innerHTML = "到底了";
							}
							//加载下一部分结束
							　　}
						});
					//点击进入详情
					window.openStore = function(store_id){
//						alert(store_id);
						openview({
							view:'shophome.html',
//							alert(store_id),
							extrasobj:{storeId:store_id}
						})
					}
				},
				error:function(xhr,type,errorThrown){
					//alert('响应失败  !');
					plus.nativeUI.closeWaiting();
					mui.toast("网络不好请重试")
				}
			});
			
		})();
	</script>
</html>