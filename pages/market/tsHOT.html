<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>特色馆HOT</title> 
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href=" ../../css/common.css">
		<link rel="stylesheet" type="text/css" href=" ../../css/index.css">
		<link rel="stylesheet" type="text/css" href=" ../../css/mui.min.css"/>
		<link rel="stylesheet" href=" ../../css/reset.css">
		<script type="text/javascript" src=" ../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/app.js"></script>
		<script type="text/javascript" src="../../js/artTemplate-native.js"></script>
		<style type="text/css">
			#storeItem{
				margin-top: 50px;
			}
			/*这一页*/
			.mui-card-header.mui-card-media{
				display: inline-block;
			}
			p img{
				width: 85%;
			}
			.banch{
				line-height: 30px;
				font-size:0.16rem;
				color: black;
				display: inline-block;
			}
			.mui-card-footer img{
				border-radius: 50%;
				width: 30px;
				height: 30px;
				border: 1px solid #fff;
				margin: 7px 7px 7px 20px;
				margin-top: -2px;
			}
			.mui-card-footer {
				padding: 15px;
			}
			.mui-card-footer, .mui-card-header{
				padding: 0;
			}
			.mui-card-footer button{
				position: absolute;
				right: 10px;
				top: 10px;
				border: 1px solid #ddd;
				color: #999;
			}
			.imgItem{
				overflow: hidden;
			}
			.imgItem img{
				width: 100%;
			}
			.msTOP{
				overflow: hidden;
				color: white;
				text-align: center;
			}
			.msTOP img{
				max-width: 100%;
				top: 0;
				left: 0;
			}
			.responsive{width: auto;}
			.brtit{
				color: black;
				 text-align: center;
				line-height: 1.5;
				margin: 0.2rem;
			}
			.brtit div{
				font-size: 0.2rem;
			} 
			small{
				font-size: 0.13rem;
				color: gray;
			}
			article{
				background: #eee;
				padding: 0.1rem;
				width: 90%;
				border-radius: 5px;
				margin: auto;
				position: relative;
			}
			article p{
				font-size: 0.13rem;
				text-indent: 2em;
				white-space: normal;
				word-break: break-all;
				line-height: 1.4;
				color: #333;
			}
			.trangle{
				position: absolute;
			    top: -20px;
			    left: 50%; 
			    width: 0px;
			    height: 0px;
			    border-top: 11px solid transparent;
			    border-right: 11px solid transparent;
			    border-bottom: 11px solid #eee;
			    border-left: 11px solid transparent;
			}
			.drs{
				    width: 46%;
				    margin: 2%;
				    padding: 10px;
				    padding-bottom: 0;
				    float: left;
				    border-radius: 2px;
				    /* margin: 0.1rem 5%; */
				    box-shadow: 0 0 1px rgba(0,0,0,0.3);
				    border: 0px solid #eee!important;
			}
			 button{
			 	background: #F0AD4E;
			 	border: 0!important; 
			 	color: white!important;
			 }
			 .banchww{
			 	display: inline-block;
			 	overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				font-size: 12px;
				color: #666;
			 }
			.rcdPadding {
			    position: relative;
			    display: inline-block;
			    padding-top: 100%;
			    width: 100%;
			    overflow: hidden;
			}
			.rcdPadding img {
			    position: absolute;
			    top: 0;
			    left: 0;
			    width: 100%;
			}
			.mui-card-footer, .mui-card-header{
				min-height: 30px; 
			}
		</style>
	</head>
	<body style="background: white;">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
			<h1 class="mui-title">- - - -</h1> 
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="storeItem" style="background-color: white;">
			<div class="msTOP">
				<img src="../../img/nodata.svg" onerror="javascript:this.src='../../img/market/nodata.svg';"   id="pic1" class="responsive" alt="">
			</div>
			<div class="brtit">
				<div></div>
				<small id="titlediv"> - - - | - - - -</small>
			</div>
			<article>
				<div class="trangle"></div>
				<p id="yqContent">- - - - - - - - - - - - - - - - </p>
			</article>
			<div id="shanglist">
				<div class="mui-card drs">
					<div class="imgItem">
						<img src="../../img/market/nodata.svg" onerror="javascript:this.src='../../img/market/nodata.svg';">
					</div>
					<div class="mui-card-footer">
						<span class="banch banchww">御邻飘乡</span>
					</div>
				</div> 
				
			 </div>
			 <script type="text/html" id="Slist">
			 	<% for(var i=0;i<list.length;i++){ %> 
					<div class="mui-card drs" onclick="openShang(<%= list[i].goods_id%>)">
						<div class="imgItem rcdPadding">
							<img src="<%= url%><%= list[i].thumb%>" dataurl='<%= serverimgUrl%><%= list[i].thumb%>' onerror="javascript:this.src='../../img/market/nodata.svg';">
						</div>
						<div class="mui-card-footer">
							<span class="banch banchww" ><%= list[i].title%></span>
						</div>
					</div> 
				<%}%>
		 	</script>
		</div>
		
		
		<div class="upload text-center text-xs gray" id="upload"></div>
	</body>
	<script type="text/javascript">
		mui.init();
		mui.plusReady(function(){
			//数据渲染
			var oldToken = plus.storage.getItem('oldToken');
			var nowindex = plus.webview.currentWebview().index;
			console.log(oldToken); 
			//plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框 
			mui.ajax(serverUrl +'/api/mall/shopactivestoreorgoods',{
				data:{type:4,isVenue:""},   
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
					var dataobj = data.data[nowindex];
					console.log(dataobj);
					//文章部分
					mui('.mui-title')[0].innerHTML = dataobj.main.title;
					mui('#pic1')[0].src = serverimgUrl + JSON.parse(dataobj.main.picImg)[0].picImg; 
					mui('#titlediv')[0].innerHTML = dataobj.main.title + " | " + dataobj.main.create_time.split('T')[0];
					//详情
					if(dataobj.main.content) {
						var detailsdom = parseDom(dataobj.main.content);
						var detailsimg = detailsdom.getElementsByTagName('img');
						mui.each(detailsimg, function(index, element) {
							console.log(element.src.split('market')[1]);
							element.src = serverimgUrl + element.src.split('market')[1];
							console.log(element.src); 
//							element.onerror = function() {
//								element.src = '../img/market/nodata.svg';
//							}
						})
						document.getElementById("yqContent").innerHTML = '';	
						document.getElementById("yqContent").appendChild(detailsdom);
					}  
					//遍历商品
					var dataobj3 = {};
					dataobj3.url = serverimgUrl;
					dataobj3.list = dataobj.minor;
 					var html3 = template('Slist',dataobj3);
					document.getElementById('shanglist').innerHTML= html3;
					
					
//					data.data[0].main.picImg = eval("("+data.data[0].main.picImg+")")
//					data.data[0].main.create_time=data.data[0].main.create_time.substring(0,10);
//					var recommentObj = {};  
//					recommentObj.myurl = serverimgUrl;
//					recommentObj.recommentLi = data.data;
//					var html2 = template('storeItem-detail',recommentObj);
//					document.getElementById('storeItem').innerHTML= html2;
//					mui('#yqContent')[0].innerHTML=data.data[0].main.content;
					plus.nativeUI.closeWaiting();  
					//点击进入详情
					window.openStore = function(store_id){
						openview({
							view:'shophome.html',
							extrasobj:{storeId:store_id}
						})
					}
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();
					mui.toast("网络不好请重试")
				}
			});
		})();
		function parseDom(arg) { //节点转换方法
			var objE = document.createElement("div");　　
			objE.innerHTML = arg;　　
			return objE;
		};
		function openShang(argu){
			openview({
			 	view:"mall-detail.html",
			 	extrasobj:{goodsId:argu}
			 })
		}
	</script>
</html>