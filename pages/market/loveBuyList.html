<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>爱 购 列 表 </title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/jquery.flexslider-min.js"></script>
		<script src=" ../../js/hmt.js" type="text/javascript"></script>
		<script src="../../js/other.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/app.js" type="text/javascript" ></script>
		
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js" type="text/javascript" ></script>
		<style type="text/css">
			/*这一页*/
			 .grade-w-roll{
			 	top: 50px!important;
			 }
			div.screening>ul>li{
				border-left: 1px solid #eee !important;
			}
			div.screening>ul{
				border-bottom:1px solid #eee; 
			}
			dl.list dt, dl.list dd,dl.list{
				border-bottom: 0;
				margin: 0 5px;
				position: relative;
			}
				.gocart{
				position: fixed;
				right: 0.2rem;
				bottom: 0.2rem;
				height: 0.5rem;
				width: 0.5rem;
				background-color: #f53c42;
				border-radius: 50%;
				border: 0;
				box-sizing: border-box;
				z-index: 999;
				padding: 0;
				text-align: center;
				line-height: 0.5rem;
				box-shadow: 0px 0px 2px 2px rgba(208, 145, 145, 0.4);
			}
			.gocart img{
				width: 60%;
			} 
			dl.list dt:not(:last-child):after, dl.list dd:not(:last-child):after,dl.list:not(:last-child):after{
				content: '';
				position: absolute;
				bottom: 0;
				left: 0;
				width: 100%;
				display: block;
				height: 1px;
				background-color: rgba(0,0,0,0.1);
				-webkit-transform: scaleY(0.5);
			}
			.dealcard .dealcard-block-right:after{
				content: '';
				position: absolute;
				bottom: 0;
				display: none;
				height: 1px;
				background-color: rgba(0,0,0,0.1);
				-webkit-transform: scaleY(0.5);
			}
			.dealcard .title, .cinemacard .title{
				color: #999;
				font-size: 12px !important;
			}
			.dealcard .strong, .dealcard .strong{
				color: #999;
				font-size: 20px !important;
				line-height: 30px;
			}
			.dealcard .title, .dealcard .price{
				height: 30px;
				margin: 5px 0;
			}
			.right{
				text-align: right;
			}
			.middle{
				text-align: center;
			}
			.strong-color{
				color: #f53c42 !important;
			}
			.Lgray{
				font-size: 12px !important;
				color: #999 !important;
				margin-top: 14px;
			}
			.mui-badge-blue, .mui-badge-primary{
				background-color: #fff;
				border: 1px solid #999;
				color: #999 !important;
			}
			.dealcard .title span{
				top: 0;
				left: 0;
				position: relative;
			}
			.bage{
				width: 100%;
			}
			dl.list .dd-padding, dl.list dt, dl.list dd>.react {
				padding: 10px;
				margin: 10px 0;
			}
			.dealcard .dealcard-brand, .cinemacard .cinemacard-brand{
				font-size: 16px;
			}
			.dealcard .dealcard-brand{
				width: 100%; 
				display: -webkit-box;
				-webkit-box-orient: vertical;
				-webkit-line-clamp: 2;
				overflow: hidden;
				min-height: 40px; 
				line-height: 20px;
				
			}
			.dealcard .title span, .dealcard .price span {
				font-size: .12rem;
			}
			.dealcard .dealcard-img{
				width: 30%;
				height: auto !important;
				max-height: 106px !important;
				margin-top: -10px;
				border-radius: 0 !important;
			}
			.dealcard .dealcard-block-right {
				padding-left: 10px;
				float: right;
				width: 70%;
				max-height: 106px;
				overflow: hidden;
			}
			.imgbox{
				background-image: none;
			}
			.dealcard-img img {
				max-width: 100%;
				max-height: 106px;
			}
			.moreone{
				line-height: 50px;
			}
			dl.list .db>.react{
				padding: 0;
				margin: 0;
			}
			dl.list .db{
				height: 50px;
			}
			.grade-eject>ul>li, .Category-eject>ul>li, .Sort-eject>ul>li{
				line-height: 40px;
			}
			.Regional{
				background-image: none !important; 
			}
			.guess-like{
				padding-top: 0;
			}
			.mui-bar-nav.mui-bar .mui-icon{margin-left: 0 !important;}
			
		</style>
	</head>
	<body>
		 
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
			<h1 class="mui-title">跨境优品</h1>
			<a href="javascript:;" style="line-height: 50px;color:white;" class="fr brand">分类</a>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		
		<div class="gocart"><img src="../../img/center/gocart.svg" alt="" /></div> 
		<div id="container">
			<div id="main">
				  
			    <!-- Category -->
				<div class="Category-eject">
				    <ul class="Category-w" id="Categorytw">
				         
				    </ul>
				    <script type="text/html" id="fcid">
				    	<li onclick="Categorytw(this)">全部品牌</li>
				    	<%for(var i=0;i< list.length;i++){%>
				    		 <li onclick="Categorytw(this)" data-id = "<%= list[i].catid%>"><%= list[i].catname%></li>
				    		<%}%>
				       
				         
				    </script>
				    <ul class="Category-t" id="Categoryt">
				      
				    </ul>
				    <script type="text/html" id="scid"> 
				    	<%for(var i=0;i< list.length;i++){%>
				    		 <li onclick="Categoryt(this)" data-id = "<%= list[i].catid%>"><%= list[i].catname%></li>
				    		<%}%>
				       
				         
				    </script>
				    <ul class="Category-s" id="Categorys">
				        
				    </ul>
				    <script type="text/html" id="tcid"> 
				    	<%for(var i=0;i< list.length;i++){%>
				    		 <li onclick="Categorys(this)" data-id = "<%= list[i].catid%>"><%= list[i].catname%></li>
				    		<%}%>
				       <li onclick="Categorys(this)">其他</li>
				         
				    </script> 
				</div>
				
				
				<script type="text/javascript">
						var immersed = 20;
					 
						var ms=(/Html5Plus\/.+\s\(.*(Immersed\/(\d+\.?\d*).*)\)/gi).exec(navigator.userAgent);
						if(ms&&ms.length>=3){ // 当前环境为沉浸式状态栏模式
						    immersed=parseFloat(ms[2]);// 获取状态栏的高度
						}  
						$(".Category-eject").css("margin-top",immersed+"px"); 
				</script>
				 
				</div>  
				 <!--滚动条-->
				<div class="adNews" style="background-color: #fff;border-bottom: 1px solid #EFEFF4;padding: 0 20px;">
					<div class="mui-row">
						<div class="mui-col-sm-2 mui-col-xs-2" style="color: #ec523e !important;line-height: 40px;font-weight: bold;">
							<!--温馨提示:-->
						</div>
						<div class="mui-col-sm-10 mui-col-xs-10">
							<!--<marquee style="line-height: 40px;color: #666;">春节期间因海关休假，跨境优品1月27日至2月2日停止发货，敬请谅解。</marquee>-->
						</div>
					</div>
				</div>
				<div class="guess-like">
					<dl class="list" id="goodsList">
						 
					</dl>
				</div>
			</div>
		</div>
		<!--模板渲染数据-->
		<script id="goodsList-detail" type="text/html">
			<%if(list.length==0){%>
				<!--<div style="font-size:14px;color:gray;padding: 10px;text-align: center;">暂无数据,看看别的吧</div>-->
			<%}else{%>
				<% for(var i=0;i<list.length;i++){ %>
				<dd class="goodsItem">
					<a class="react" onclick="goInfo(<%= list[i].open_iid%>,3)">
						<div class="dealcard">
							<div class="dealcard-img imgbox">
 
								<img src="<%= list[i].pic_url.pic_url[0]%>" onerror="javascript:this.src='../../img/zhaoxiangji.svg';"/>

							</div>
							<div class="dealcard-block-right">
								<div class="dealcard-brand single-line"><%= list[i].title %></div>
								 
								<div class="price mui-row">
									<div class="mui-col-sm-4 mui-col-xs-4">
										<span class="strong-color">￥</span><span class="strong"><%= list[i].price %></span>
									</div>
								</div>
							</div>
						</div>
					</a>
				</dd>
			<% } %>
			<%}%>
			
		</script>
		<div class="upload text-center text-xs gray" id="upload"></div>
		<div id="nulldiv" style="text-align:center;margin-top: 40%;font-size: 14px;color: #999;display: none;">
			<img style="width: 30%;margin-bottom: 5%; " src="../../img/unllfabu.svg"/>
			<br />
			没有相关信息
		</div>
	</body>
	<script src="../../js/other.js" type="text/javascript" charset="utf-8"></script>
	 
	<script type="text/javascript"> 
		mui.plusReady(function(){
			//去购物车
			document.getElementsByClassName("gocart")[0].addEventListener('tap',function () {
				//当前页 
	 		    plus.webview.getWebviewById('youpinhui-Center').close();
	 
				//获得主页面的webview
			    var main = plus.webview.getLaunchWebview();
			    //触发主页面的gohome事件
			    mui.fire(main,'gohome',{hrefid:'cart'}); 
		    	main.show();
		    	mui.back();
		    	plus.webview.currentWebview().close(); 
			});
			//获取缓存
			var oldToken = plus.storage.getItem('oldToken'); 
		 		plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
			
			//切换分类
			var pid = 0;
			$(".brand").on("tap",function(){ 
				$(".Category-eject").toggleClass("grade-w-roll");
				if($(".Category-eject").hasClass("grade-w-roll")){
					mui.ajax(serverUrl+'/api/mall/igocategory',{
						data:{pid:pid},
						dataType:'json',
						type:'post',
						timeout:10000,
						headers:{"token":oldToken},	 
						success:function(data,type,xhr){
							  
							if(data.errno == 0){
								if(data.data.length != 0){
									var tyepdata ={};
									tyepdata.list = data.data;
									var html=template("fcid",tyepdata);
									document.getElementById("Categorytw").innerHTML=html;
								}  
								
								//点击一级分类
								 $(".Category-w>li").click(function(){
							        $(".Category-t").css("left","33.48%");
							           //获取二级分类
								        mui.ajax(serverUrl+'/api/mall/igocategory',{
											data:{pid:$(this).attr("data-id")},
											dataType:'json',
											type:'post',
											timeout:10000,
											headers:{"token":oldToken},	 
											success:function(data,type,xhr){ 
												if(data.errno == 0){
													if(data.data.length != 0){
														var tyepdata ={};
														tyepdata.list = data.data;
														var html=template("scid",tyepdata);
														document.getElementById("Categoryt").innerHTML=html;
														
														//点击二级分类
														 	$(document).ready(function(){
															  $(".Category-t>li").click(function(){
															      $(".Category-s").css("left","66.96%");
															      //获取三级分类
															       mui.ajax(serverUrl+'/api/mall/igocategory',{
																		data:{pid:$(this).attr("data-id")},
																		dataType:'json',
																		type:'post',
																		timeout:10000,
																		headers:{"token":oldToken},	 
																		success:function(data,type,xhr){ 
																			if(data.errno == 0){
																				if(data.data.length != 0){
																					var tyepdata ={};
																					tyepdata.list = data.data;
																					var html=template("tcid",tyepdata);
																					document.getElementById("Categorys").innerHTML=html;
																				}
																			}
																		},
																		error:function(xhr,type,errorThrown){
																				plus.nativeUI.closeWaiting();//关闭等待框 
																			}
																		})
															  });
															  
															  
															});
															window.Categoryt = function(tbj){
															    var arr = document.getElementById("Categoryt").getElementsByTagName("li");
															    for (var i = 0; i < arr.length; i++){
															        var a = arr[i];
															        a.style.background = "";
															    };
															    tbj.style.background = "#fff"
															}
													}
												}
											},
											error:function(xhr,type,errorThrown){
												plus.nativeUI.closeWaiting();//关闭等待框 
											}
										})
							    });
								window.Categorytw = function(wbj){
									 
								    var arr = document.getElementById("Categorytw").getElementsByTagName("li");
								    for (var i = 0; i < arr.length; i++){
								        var a = arr[i];
								        a.style.background = "";
								    };
								    wbj.style.background = "#eee";
								   
								}
								
								
							}
							
						},
						error:function(xhr,type,errorThrown){
							plus.nativeUI.closeWaiting();//关闭等待框
							mui("#upload")[0].innerHTML = ""; 
							mui('#nulldiv')[0].style.display = 'block';
						}
					});
				}
			})
			var category = plus.webview.currentWebview().pid;
	 		getList(category);
			function getList(category_id){
				//数据渲染
				var currentPage =1, numsPerPage=10;
				mui.ajax('http://api.igetmall.net/DRP_getProList',{
					data:{appkey:'6458153266',appsecret:'2a1cc0c25a60e8c394e5a822936df862',category_id:category_id,page_no:currentPage,page_size:numsPerPage},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"token":oldToken},	 
					success:function(data,type,xhr){
						console.log("是第三方的",JSON.stringify(data))
						plus.nativeUI.closeWaiting() 
						if(data.status=="success"){
								var d = data.data.lists;//{img1:dd,img2:aa,img3,cc} 
								var bannerArray = [];
								if(d){
									for(var t=0;t<Object.keys(d).length;t++){ 
										var vae = Object.keys(d)[t] ;
										bannerArray.push(d[vae]);
									} 
								} 
								for(var i in bannerArray){
									bannerArray[i].pic_url.pic_url = bannerArray[i].pic_url.pic_url.split(',')
								}
								var objdata = {}; 
								objdata.list = bannerArray;
								console.log("bannerArray"+JSON.stringify(bannerArray));
								
								var html=template("goodsList-detail",objdata);
								document.getElementById("goodsList").innerHTML=html;
								mui("#upload")[0].innerHTML = "";
			                    //上滑加载
			                   	$(window).scroll(function(){
									　　var scrollTop = $(this).scrollTop();
									　　var scrollHeight = $(document).height();
									　　var windowHeight = $(this).height();
									　　if(scrollTop + windowHeight == scrollHeight){ 
											mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg' />";  
											currentPage++;
											mui.ajax('http://api.igetmall.net/DRP_getProList',{ 									
												data:{appkey:'6458153266',appsecret:'2a1cc0c25a60e8c394e5a822936df862',category_id:category_id,page_no:currentPage,page_size:numsPerPage},
												dataType:'json',//服务器返回json格式数据
												type:'post',//HTTP请求类型 
												timeout:10000,//超时时间设置为10秒；	
												headers:{"token":oldToken}, 
												success:function(data){
													if(data.status=="success"){
														var d = data.data.lists;//{img1:dd,img2:aa,img3,cc} 
														var bannerArray = [];
														if(d){
															for(var t=0;t<Object.keys(d).length;t++){ 
																var vae = Object.keys(d)[t] ;
																bannerArray.push(d[vae]);
															} 
														}
														for(var i in bannerArray){
															bannerArray[i].pic_url.pic_url = bannerArray[i].pic_url.pic_url.split(',')
														}
														var objdata = {}; 
														objdata.list = bannerArray;
														var html=template("goodsList-detail",objdata);
														document.getElementById("goodsList").innerHTML+=html;
													}
													mui("#upload")[0].innerHTML = " "; 
												},
												error:function(xhr,type,errorThrown){ 
													mui.toast("当前网络不好请重试");
													mui("#upload")[0].innerHTML = "";
												}
											});
									 
									  }
									});//加载下一部分结束
							 
						}
					},
					error:function(xhr,type,errorThrown){
						plus.nativeUI.closeWaiting();//关闭等待框
						mui("#upload")[0].innerHTML = ""; 
						mui('#nulldiv')[0].style.display = 'block';
					}
				});
				 
			}
			
			//点击三级分类
			window.Categorys = function(sbj){
			    var arr = document.getElementById("Categorys").getElementsByTagName("li");
			    for (var i = 0; i < arr.length; i++){
			        var a = arr[i];
			        a.style.borderBottom = "";
			    };
			    sbj.style.borderBottom = "solid 1px #ff7c08";
			    $(".Category-eject").removeClass("grade-w-roll");
			    getList(sbj.getAttribute("data-id"));
			}
			//跳转详情
			window.goInfo =  function(goodsId,differentiate){ 
				 openview({
				 	view:"yphDetail.html",
				 	id:"yphDetail",
				 	extrasobj:{goodsId:goodsId,differentiate:differentiate}
				 })
			}
			
		})();
		
		
	</script>

</html>