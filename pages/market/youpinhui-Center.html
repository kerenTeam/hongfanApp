<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>跨境优品</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" href="../../css/reset.css">
		<link rel="stylesheet" href="../../css/one.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<style type="text/css">
			/*banner样式*/
			
			.mui-slider-indicator .mui-indicator {
				width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			
			#banner {
				position: relative;
				width: 100%;
				padding-top: 42%;
				overflow: hidden;
				background: url(../../img/bannerback.svg) 50% 50% no-repeat;
				background-size: 20%;
			}
			
			.mui-slider .mui-slider-group {
				position: absolute;
				height: 100%;
				width: 100%;
				top: 0;
			}
			
			.mui-slider .mui-slider-group .mui-slider-item img {
				height: 100%;
			}
			/*banner样式结束*/
			
			.onetable {
				margin-top: 5px;
			}
			
			.onetable p {
				margin-top: -10px;
				font-size: 11px;
				margin-bottom: 5px;
			}
			
			.fontcl2 {
				font-size: 16px;
				line-height: 18px;
			}
			
			.sy_recmd_list .pub_wz {
				position: relative;
			}
			
			.relist .box {
				border: none;
				margin: 3px;
				box-shadow: 0px 0px 1px #ccc;
			}
			
			.relist .box img {
				width: 100% !important;
				margin: 0 !important;
				height: 100%;
			}
			
			.fr {
				position: absolute;
				float: right;
				display: block;
				top: 12px;
				right: 5px;
				font-size: 10px;
			}
			
			.sy_recmd_list .pub_wz .nr_box {
				border-top: none;
				margin-top: 0;
			}
			
			.mui-bar {
				height: 50px;
			}
			
			.mui-title,
			.mui-icon {
				line-height: 50px;
			}
			
			.mui-bar .mui-icon {
				padding: 0;
			}
			/*这一页*/
			
			.onetable {
				border-bottom: 0rem solid #e6e6e6;
				padding-bottom: 10px;
				background-color: #fff;
				box-shadow: 0px 0px 1px 0px rgba(0, 0, 0, 0.1);
			}
			
			.onetable .table {
				text-align: center;
			}
			
			.onetable .table img {
				text-align: center;
				width: 45%;
				margin: 0.15rem 0;
			}
			
			.onetable p {
				margin-top: -16px;
				font-size: 12px;
			}
			
			.market-icon {
				border-radius: 50%;
				width: 0.55rem;
				height: 0.55rem;
				display: block;
				margin: 10px auto;
			}
			
			.left {
				border-left: 0.03rem solid #f53c42;
				padding-left: 10px;
			}
			/*精选频道*/
			
			.choiceness {
				margin-top: 5px;
				padding-bottom: 5px;
			}
			
			.choiceness p {
				text-align: center;
				color: #333;
				line-height: 20px;
			}
			
			.choiceness .gray {
				color: #666;
				font-size: 11px;
			}
			
			.choiceness img {
				width: 16px;
				margin-top: -2px;
				margin-right: 5px;
			}
			
			.choicenessWrap .pub_img img {
				height: 125px;
				min-height: 1rem;
				overflow: hidden;
				border-radius: 5px;
			}
			
			.box {
				/*border: 1px solid #efefef;*/
				/*box-shadow: 0px 0 1px 0px rgba(0,0,0,0.1);*/
			}
			
			.sy_recmd_list .pub_img img {
				width: 88%;
				margin: 0 6%;
			}
			
			.sy_recmd {
				background-color: #fff;
				box-shadow: 0px 0px -1px 0px rgba(0, 0, 0, 0.1);
				margin-bottom: 10px !important;
			}
			
			.sy_recmd:last-child {
				margin-bottom: 0%!important;
			}
			
			.sy_title {
				border-bottom: none;
			}
			
			.mui-bar-nav {
				box-shadow: none;
			}
			
			.rcdPadding {
				position: relative;
				display: inline-block;
				padding-top: 100%;
				width: 100%;
				overflow: hidden;
			}
			
			.rcdPadding img {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
			}
			
			#upload {
				text-align: center;
				font-size: 15px;
				line-height: 30px;
				min-height: 40px;
			}
			
			#upload img {
				width: 60px;
				margin-top: -10px;
			}
			
			#classify .mui-icon {
				overflow: hidden;
				height: 0.4rem;
				width: 0.4rem;
			}
			
			.mui-table-view.mui-grid-view .mui-table-view-cell .mui-icon img {
				width: 60%;
			}
			
			.mui-table-view.mui-grid-view .mui-table-view-cell .mui-media-body {
				color: #555;
			}
			
			.sy_recmd_list .pub_wz h3 a {
				color: #666;
				line-height: 0.2rem;
				font-size: 0.14rem;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				width: 100%;
				display: block;
			}
			
			.mb10 {
				border-top: none !important;
				margin: 0 10px;
			}
			
			.table {
				border-bottom: none !important;
			}
			
			.hot {
				padding: 0 5px;
				border-right: 1px solid #EFEFF4;
				font-weight: bold;
				font-size: 20px;
			}
			
			.hot img {
				width: 8%;
			}
			
			.choicenessWrap {
				padding-top: 10px;
			}
			
			.hotContent {
				font-size: 14px;
				padding-left: 10px;
			}
			
			.hot_info {
				width: 33% !important;
			}
			
			.sy_recmd_list_box {
				padding-top: 10px;
			}
			
			.sy_title {
				padding: 0.05rem 0;
			}
			
			.imgpt img {
				/*position: absolute;*/
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
			}
			
			.clasfyItem {
				/*position: absolute;*/
				top: 50%;
				-webkit-transform: translateY(-50%);
				left: 0;
				right: 0;
				text-align: center;
				line-height: 3;
			}
			
			.clasfyItem .itemName {
				color: white;
				font-size: 0.2rem;
				font-weight: 400;
			}
			
			.mui-table-view.mui-grid-view .mui-table-view-cell .mui-media-body {
				margin-top: 0;
			}
			
			.mui-grid-6:after {
				height: 0 !important;
				background-color: #fff !important;
				margin-bottom: 5px;
			}
			
			#classify {
				margin-bottom: 5px !important;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
			<h1 class="mui-title">跨境优品</h1>
		</header>
		<script src="../../js/statusBar.js"></script>
		<!--状态栏-->

		<div id="main">
			<div id="scroller">
				<!--轮播图-->
				<div class="mui-slider" id="banner"></div>
				<!--轮播图结束-->
				<!--banner数据渲染-->
				<script type="text/html" id="banner-detail">
					<div class="mui-slider-group mui-slider-loop">
						<!--支持循环，需要重复图片节点-->
						<div class="mui-slider-item mui-slider-item-duplicate" onclick="bannerGo('<%=bannerList[bannerList.length-1].url%>','<%=bannerList[bannerList.length-1].name%>')">
							<img src="<%= url %><%= bannerList[bannerList.length-1].bannerPic %>" onerror="javascript:this.src='../../img/market/nodata.svg';" />
						</div>
						<% for(var i=0;i<bannerList.length;i++){ %>
						<div class="mui-slider-item" onclick="bannerGo('<%=bannerList[i].url%>','<%=bannerList[i].name%>')">
							<img src="<%= url %><%=bannerList[i].bannerPic %>" onerror="javascript:this.src='../../img/market/nodata.svg';" />
						</div>
						<% } %>
						<!--支持循环，需要重复图片节点-->
						<div class="mui-slider-item mui-slider-item-duplicate" onclick="bannerGo('<%=bannerList[0].url%>','<%=bannerList[0].name%>')">
							<img src="<%= url %><%= bannerList[0].bannerPic %>" onerror="javascript:this.src='../../img/market/nodata.svg';" />
						</div>
					</div>
					<div class="mui-slider-indicator">
						<div class="mui-indicator mui-active"></div>
						<% for(var i=0;i<bannerList.length-1;i++){ %>
						<div class="mui-indicator"></div>
						<% } %>
					</div>
				</script>
			</div>

			<div id="classify"></div>
			<script type="text/html" id="classifyTpl">
				<ul class="mui-table-view mui-grid-view mui-grid-6">
					<%for(var i=0;i<list.length;i++){%>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-4" onclick="goList(<%=list[i].catid%>)">
						<%if(list[i].icon){%>
						<span class="mui-icon"><img src="<%=myUrl+list[i].icon%>"/></span>
						<%}else{%>
						<span class="mui-icon mui-icon-flag"></span>
						<%}%>
						<div class="mui-media-body" style="font-size: 0.12rem!important;">
							<%=list[i].catname%>
						</div>
					</li>
					<%}%>
				</ul>
			</script>

			<!--推荐列表-->
			<div class="sy_recmd">
				<!--推荐列表-->
				<div class="sy_title mb10">
					<span class="left">热门推荐</span>
					<!--<a href="#" class="fr morethree">更多&gt;&gt;</a>-->
				</div>
				<div class="sy_recmd_list_box">
					<ul>
						<div id="moll_recommend"></div>
					</ul>
					<div class="clear"></div>
				</div>
				<!--热门推荐-->
				<script type="text/html" id="recommendTpl">
					<%if(list.length==0){%>
					<%}else{%>
					<%for(var i=0;i<list.length;i++){%>
						<%if(list[i].num>30){%>
							<li class="sy_recmd_list relist">
								<div class="box">
									<div class="pub_img">
										<a class="rcdPadding" onclick="goInfo('<%=list[i].open_iid%>',3,'<%= list[i].pic_url.pic_url[0]%>')">
											<img src="<%= list[i].pic_url.pic_url[0]%>" onerror="javascript:this.src='../../img/zhaoxiangji.svg';" width="145" height="145" class="hotImg">
		
										</a>
									</div>
									<div class="pub_wz">
										<h3 class="overflow_clear"><a onclick="goInfo('<%=list[i].open_iid%>',3,'<%= list[i].pic_url.pic_url[0]%>')"><%=list[i].title%></a></h3>
										<div class="nr_box mui-row">
											<div class="mui-col-sm-5 mui-col-xs-5 ">
												<p class="fl fontcl2"><sub>￥</sub>
													<%=list[i].price%>
												</p>
											</div>
											<div class="mui-col-sm-7 mui-col-xs-7 saled">
												</p>
											</div>
										</div>
									</div>
								</div>
							</li>
						<%}%>
					<%}%>
					<%}%>
				</script>
				<div class="upload text-center text-xs gray" id="upload"></div>
				<div id="nulldiv" style="text-align:center;margin-top: 2%;padding-bottom:15%;font-size: 14px;color: #999;display: none;">
					<img style="width: 7%;margin-bottom: 1%; " src="../../img/unllfabu.svg" /> 暂无推荐
				</div>
			</div>
		</div>

		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/artTemplate-native.js"></script>
		<script src="../../js/app.js"></script>
		<script type="text/javascript">
			//跳转详情
			function goInfo(goodsId, differentiate, img) {
				openview({
					view: "yphDetail.html",
					id: "yphDetail",
					extrasobj: {
						goodsId: goodsId,
						differentiate: differentiate
					}
				})
			}
			//获得slider插件对象
			var gallery = mui('.mui-slider');
			gallery.slider({
				interval: 5000 //自动轮播周期
			});
			mui.plusReady(function() {
				//plus.nativeUI.showWaiting('加载中 ...', { width: '100px', height: '80px' }); //显示等待框
				var oldToken = plus.storage.getItem('oldToken');

				//获取 一级分类
				mui.ajax(serverUrl + '/api/mall/igocategory', {
					data: {
						pid: 0
					},
					dataType: 'json',
					type: 'post',
					timeout: 10000,
					headers: {
						"token": oldToken
					},
					success: function(data, type, xhr) {
						console.log("一级分类", data);
						if(data.errno == 0) {
							if(data.data.length != 0) {
								var tyepdata = {};
								tyepdata.myUrl = serverimgUrl;
								tyepdata.list = data.data;
								var html = template("classifyTpl", tyepdata);
								document.getElementById("classify").innerHTML = html;
							}
						}
					},
					error: function(xhr, type, errorThrown) {
						mui("#upload")[0].innerHTML = "";
						mui('#nulldiv')[0].style.display = 'block';
					}
				});
				//获取推荐类别
				mui.ajax(serverUrl + '/api/mall/recommendforigo', {
					dataType: 'json', //服务器返回json格式数据
					type: 'post', //HTTP请求类型 
					timeout: 10000, //超时时间设置为10秒；	
					headers: {
						"token": oldToken
					},
					success: function(data) {
						console.log("catid " + JSON.stringify(data));
						//一级分类
						var catid = data.data.catid;
						//获取二级分类
						mui.ajax(serverUrl + '/api/mall/igocategory', {
							data: {
								pid: catid
							},
							dataType: 'json',
							type: 'post',
							timeout: 10000,
							headers: {
								"token": oldToken
							},
							success: function(data, type, xhr) {
								console.log(data)
								if(data.errno == 0) {
									if(data.data.length != 0) {
										//请求三级分类 
										for(var j = 0; j < data.data.length; j++) {
											getthird(data.data[j].catid)
										}
									}
								}
							},
							error: function(xhr, type, errorThrown) {
								plus.nativeUI.closeWaiting(); //关闭等待框 
							}
						})
					},
					error: function(xhr, type, errorThrown) {

					}
				})

				//三级分类
				function getthird(catid) {
					mui.ajax(serverUrl + '/api/mall/igocategory', {
						data: {
							pid: catid
						},
						dataType: 'json',
						type: 'post',
						timeout: 10000,
						headers: {
							"token": oldToken
						},
						success: function(data, type, xhr) {
							if(data.errno == 0) {
								if(data.data.length != 0) {
									//渲染列表
									for(var j = 0; j < data.data.length; j++) {
										getrecommendList(data.data[j].catid)
									}
								}
							}
						},
						error: function(xhr, type, errorThrown) {
							plus.nativeUI.closeWaiting(); //关闭等待框 
						}
					})
				}
				var catgid;
				function getrecommendList(catid) {
					plus.nativeUI.showWaiting();
					catgid = catid;
					//推荐数据渲染
					var currentPage = 1,
						numsPerPage = 10;
					//热门推荐 数据渲染 
					mui.ajax('http://api.igetmall.net/DRP_getProList', {
						data: {
							appkey: '2184365138',
							appsecret: '47accd33cafb73548e135bb3bec6c290',
							category_id: catgid,
							page_no: currentPage,
							page_size: numsPerPage
						},
						dataType: 'json', //服务器返回json格式数据
						type: 'post', //HTTP请求类型 
						timeout: 10000, //超时时间设置为10秒；	
						headers: {
							"token": oldToken
						},
						success: function(data) {
							console.log('推荐', data);
							if(data.status == "success") {

								var d = data.data.lists; //{img1:dd,img2:aa,img3,cc} 
								var bannerArray = [];
								if(d) {
									for(var t = 0; t < Object.keys(d).length; t++) {
										var vae = Object.keys(d)[t];
										bannerArray.push(d[vae]);
									}
								}
								for(var i in bannerArray) {
									bannerArray[i].pic_url.pic_url = bannerArray[i].pic_url.pic_url.split(',');
									for(var j in bannerArray[i].pic_url.pic_url) {
										if(bannerArray[i].pic_url.pic_url[j].indexOf('net.') > -1) {
											bannerArray[i].pic_url.pic_url[j] = bannerArray[i].pic_url.pic_url[j].replace(/net./g, 'net')
										}
									}
								}
								var objdata = {};
								objdata.list = bannerArray;
								var html = template("recommendTpl", objdata);
								document.getElementById("moll_recommend").innerHTML += html;
								plus.nativeUI.closeWaiting(); //关闭等待框
								mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg'/>";

								$(window).scroll(function() {
									var scrollTop = $(this).scrollTop();　　
									var scrollHeight = $(document).height();　　
									var windowHeight = $(this).height();　　
									if(scrollTop + windowHeight == scrollHeight) {

										if(scrollTop + windowHeight == scrollHeight) {
											mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg' />";
											currentPage++;
											var requestfun = function() {
												mui.ajax('http://api.igetmall.net/DRP_getProList', {
													data: {
														appkey: '2184365138',
														appsecret: '47accd33cafb73548e135bb3bec6c290',
														category_id: catgid,
														page_no: currentPage,
														page_size: numsPerPage
													},
													dataType: 'json', //服务器返回json格式数据
													type: 'post', //HTTP请求类型 
													timeout: 5000, //超时时间设置为10秒；	
													headers: {
														"token": oldToken
													},
													success: function(data) {
														if(data.status == "success") {
															var d = data.data.lists; //{img1:dd,img2:aa,img3,cc} 
															var bannerArray = [];
															if(d) {
																for(var t = 0; t < Object.keys(d).length; t++) {
																	var vae = Object.keys(d)[t];
																	bannerArray.push(d[vae]);
																}
															}
															for(var i in bannerArray) {
																bannerArray[i].pic_url.pic_url = bannerArray[i].pic_url.pic_url.split(',');
																for(var j in bannerArray[i].pic_url.pic_url) {
																	if(bannerArray[i].pic_url.pic_url[j].indexOf('net.') > -1) {
																		bannerArray[i].pic_url.pic_url[j] = bannerArray[i].pic_url.pic_url[j].replace(/net./g, 'net')
																	}
																}
															}

															var objdata = {};
															objdata.list = bannerArray;
															var html = template("recommendTpl", objdata);
															document.getElementById("moll_recommend").innerHTML += html;
														}
														mui("#upload")[0].innerHTML = " ";
													},
													error: function(xhr, type, errorThrown) {
														//Ypagenum;//失败是应到-1
														console.log("当前网络不好请重试");
														requestfun(); //失败继续加载
														mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg' />";
													}
												});
											}
											requestfun();

										} else if(Spagenum == data.data.return.totalPages + 1) { //当前页不小于等于总页数时请求下一页
											mui("#upload")[0].innerHTML = "到底了";
										}
									}
								});

							} else {
								mui("#upload")[0].innerHTML = "到底了";
//								mui('#nulldiv')[0].style.display = 'block';
							}

						},
						error: function(xhr, type, errorThrown) {
							plus.nativeUI.closeWaiting(); //关闭等待框
							mui("#upload")[0].innerHTML = "";
//							mui('#nulldiv')[0].style.display = 'block';
						}
					});

				}
				//banner
				mui.ajax(serverUrl + '/api/index/banner', {
					data: {
						banner_type: 6
					},
					dataType: 'json',
					type: 'post',
					timeout: 10000,
					headers: {
						"token": oldToken
					},
					success: function(data, type, xhr) {
						bannerObj = {};
						bannerObj.bannerList = eval("(" + data.data.banner + ")");
						bannerObj.url = serverimgUrl;
						var html = template('banner-detail', bannerObj);
						document.getElementById('banner').innerHTML = html;
						plus.nativeUI.closeWaiting(); //关闭等待框
						//轮播图,获得slider插件对象
						var gallery = mui('.mui-slider');
						gallery.slider({
							interval: 5000 //自动轮播周期，若为0则不自动播放，默认为0；
						});
					},
					error: function(xhr, type, errorThrown) {
						console.log('响应失败  !');
					}
				});
				//banner跳转
				window.bannerGo = function(url, name) {
					if(url != '#') {
						openview({
							view: "../bannerTpl.html",
							id: "bannerTpl",
							extrasobj: {
								bannerUrl: url,
								bannerName: name
							}
						})
					}
				}
				//进入列表
				window.goList = function(pid) {
					event.stopPropagation();
					//					getsecid(pid);
					openview({
						view: "loveBuyList.html",
						extrasobj: {
							pid: pid
						}
					})
				}
			});
		</script>
		<script type="text/javascript">
			//天天特价  discountGoods, 领嗨豆  getHIdou, 团购  groupBuying, 本地生活 localLife, 跨境优品   loveToGogoods, 电影 movie,
			//充值缴费   payment,  为民服务  serveForPeople,  购物中心 shopCenter, 注册  signUp, 特色馆 specialBar
			mui.plusReady(function() {
				var startTime, endTime, stayTime, flagback = 0;
				startTime = new Date().getTime();
				var old_back = mui.back;
				//改写返回键返回的函数，返回时传页面停留时间 
				mui.back = function() {
					endTime = new Date().getTime(); //返回时间
					stayTime = Math.ceil((endTime - startTime) / 1000);
					console.log('跨境优品' + stayTime);
					plus.statistic.eventDuration("loveToGogoods", stayTime);
					//计算事件，计算出返回时在该页面停留的时间差值，除以六万获得停留分钟数，发送给友盟后台
					old_back();
				}
				plus.webview.currentWebview().addEventListener("popGesture", function() {
					flagback++;
					if(flagback == 1) {
						endTime = new Date().getTime();
						stayTime = Math.ceil((endTime - startTime) / 1000);
						plus.statistic.eventDuration("loveToGogoods", stayTime);
						//计算事件，计算出苹果右滑返回后在该页面停留的时间差值，除以六万获得停留分钟数，发送给友盟后台
					}
				}, false);
			});
		</script>
	</body>

</html>