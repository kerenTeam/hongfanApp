<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>商品列表</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/jquery.flexslider-min.js"></script>
		<script src=" ../../js/hmt.js" type="text/javascript"></script>
		<script src="../../js/other.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/app.js" type="text/javascript" ></script>
		
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js" type="text/javascript" ></script>
		<style type="text/css">
			.mui-bar{
				height: 50px;
				box-shadow: none;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			#main{
				margin-top: 50px;
			}
			
			/*这一页*/
			.grade-eject, .Category-eject, .Sort-eject{
				height: 80px;
			}
			div.screening>ul>li{
				border-left: 1px solid #eee !important;
			}
			div.screening>ul,dl.list dt, dl.list dd,dl.list{
				border-bottom: 1px solid #eee !important;
			}
			/*div.screening>ul:after,dl.list dt:after, dl.list dd:after,dl.list:after{
				content: '';
				position: absolute;
				bottom: 0;
				display: none;
				height: 1px;
				background-color: rgba(0,0,0,0.1);
				-webkit-transform: scaleY(0.5);
			}*/
			.dealcard .title, .cinemacard .title{
				color: #999;
				font-size: 12px !important;
			}
			.dealcard .strong, .dealcard .strong{
				color: #999;
				font-size: 20px !important;
				line-height: 30px;
			}
			.dealcard .title, .dealcard .price{
				height: 30px;
				margin: 5px 0;
			}
			.right{
				text-align: right;
			}
			.middle{
				text-align: center;
			}
			.strong-color{
				color: #f53c42 !important;
			}
			.Lgray{
				font-size: 12px !important;
				color: #999 !important;
				margin-top: 14px;
			}
			.mui-badge-blue, .mui-badge-primary{
				background-color: #fff;
				border: 1px solid #999;
				color: #999 !important;
			}
			.dealcard .title span{
				top: 0;
				left: 0;
				position: relative;
			}
			.bage{
				width: 100%;
			}
			dl.list .dd-padding, dl.list dt, dl.list dd>.react {
				padding: 10px;
				margin: 10px 0;
			}
			.dealcard .dealcard-brand, .cinemacard .cinemacard-brand{
				font-size: 16px;
			}
			.dealcard .dealcard-brand{
				width: 100%;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				display: block;
			}
			.dealcard .title span, .dealcard .price span {
				font-size: .1rem;
			}
			.dealcard .dealcard-img{
				width: 30%;
				height: auto !important;
				max-height: 106px !important;
				margin-top: -10px;
				border-radius: 0 !important;
			}
			.dealcard .dealcard-block-right {
				padding-left: 10px;
				float: right;
				width: 70%;
				max-height: 106px;
				overflow: hidden;
			}
			.imgbox{
				background-image: none;
			}
			.dealcard-img img {
				max-width: 100%;
				max-height: 106px;
			}
			.moreone{
				line-height: 50px;
			}
			dl.list .db>.react{
				padding: 0;
				margin: 0;
			}
			dl.list .db{
				height: 50px;
			}
			.grade-eject>ul>li, .Category-eject>ul>li, .Sort-eject>ul>li{
				line-height: 40px;
			}
			.Regional{
				background-image: none !important; 
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav hasManyCity hasManyCitytwo">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize fl fanhui"></a>
		    <div class="header-tit">
				商品列表
			</div>
		</header>
		<div class="screening">
		    <ul>
		        <li class="Brand">综合</li>
		        <li class="Regional" onclick="order('sales','asc')">销量</li>
		        <li class="Sort">价格</li>
		    </ul>
		</div>
		<div class="Category-eject">
		    <ul class="Category-w" id="Categorytw">
		        <li onclick="order('create_time','asc')">新品</li>
		        <li onclick="order('comments','asc')">评价</li>
		    </ul>
		</div>
		<!--<div class="grade-eject">
		    <ul class="grade-w" id="gradew">
		        <li onclick="order('sales','asc')">从高到低</li>
		    </ul>
		</div>-->
		<div class="Sort-eject Sort-height">
		    <ul class="Sort-Sort" id="Sort-Sort">
		        <li onclick="order('price','desc')">从低到高</li>
		        <li onclick="order('price','asc')">从高到低</li>
		    </ul>
		</div>
		<div id="container">		
			<div id="main">
				<div class="guess-like">
					<dl class="list" id="goodsList">
						<dd class="db">
							<a class="react " href="javascript:;">
								<div class="moreone">加载更多</div>
							</a>
						</dd>
					</dl>
				</div>
			</div>
		</div>
		
		<!--模板渲染数据-->
		<script id="goodsList-detail" type="text/html">
			<%if(list.length==0){%>
				<div style="font-size:14px;color:gray;padding: 10px;text-align: center;">暂无数据,看看别的吧</div>
			<%}else{%>
				<% for(var i=0;i<list.length;i++){ %>
				<dd class="goodsItem">
					<a class="react" onclick="goInfo(<%= list[i].goods_id %>)">
						<div class="dealcard">
							<div class="dealcard-img imgbox">
								<img src="<%= list[i].thumb %>"/>
							</div>
							<div class="dealcard-block-right">
								<div class="dealcard-brand single-line"><%= list[i].title %></div>
								<div class="title text-block bage">
									<!--<span class="mui-badge mui-badge-primary">64G</span>
									<span class="mui-badge mui-badge-primary">128G</span>
									<span class="mui-badge mui-badge-primary">64G</span>-->
								</div>
								<div class="price mui-row">
									<div class="mui-col-sm-4 mui-col-xs-4">
										<span class="strong-color">￥</span>
										<span class="strong"><%= list[i].price %></span>
									</div>
									<span class="mui-col-sm-4 mui-col-xs-4 middle Lgray">评价<%= list[i].comments %>条</span>
									<span class="mui-col-sm-4 mui-col-xs-4 right Lgray">已售<%= list[i].sales %></span>
								</div>
							</div>
						</div>
					</a>
				</dd>
			<% } %>
			<%}%>
			
		</script>
	</body>

	<script type="text/javascript">
		mui.init();
		mui.plusReady(function(){
			
			//获取缓存
			var oldToken = plus.storage.getItem('oldToken');
			//获取页面传值 商品分类id
			var goodcatId = plus.webview.currentWebview().goodscatId; 
			//alert(goodcatId)
//			var myToken = plus.storage.getItem('oldToken');
//			if(plus.storage.getItem('myToken')){
//				Sstate = true;//如果存在myToken则是登录状态
//				var oldToken = plus.storage.getItem('oldToken');
//				console.log(oldToken);
//			}
			
			//数据渲染
			mui.ajax(serverUrl+'/api/mall/mallgooodslist',{
				data:{currentPage:1,numsPerPage:3,categoryid:goodcatId,recommend:1,storeId:0,brand:'',keyword:'',order_type:'sales',desc:'desc'},
				dataType:'json',
				type:'post',
				timeout:1000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){ 
					 //alert(JSON.stringify(data));
					if(data.errno!=1000){
						
					var objdata = {};
					objdata.list = data.data.return.data;
					var html=template("goodsList-detail",objdata);
					document.getElementById("goodsList").innerHTML=html;
					}else{
						var objdata = {};
					objdata.list = [];
					var html=template("goodsList-detail",objdata);
					document.getElementById("goodsList").innerHTML=html;
					}
				},
				error:function(xhr,type,errorThrown){
					console.log('响应失败  !');
				}
			});
			
			//按照选择排序
			window.order = function(orderType,sequence){
				mui.ajax(serverUrl+'/api/mall/mallgooodslist',{
					data:{currentPage:1,numsPerPage:3,categoryid:goodcatId,recommend:1,storeId:0,brand:'',keyword:'',order_type:orderType,desc:sequence},
					dataType:'json',
					type:'post',
					timeout:1000,
					headers:{"token":oldToken},	 
					success:function(data,type,xhr){ 
//						alert(JSON.stringify(data));
						if(data.errno!=1000){
						
					var objdata = {};
					objdata.list = data.data.return.data;
					var html=template("goodsList-detail",objdata);
					document.getElementById("goodsList").innerHTML=html;
					}else{
						var objdata = {};
					objdata.list =  [];
					var html=template("goodsList-detail",objdata);
					document.getElementById("goodsList").innerHTML=html;
					}
					},
					error:function(xhr,type,errorThrown){
						console.log('响应失败  !');
					}
				});
				$('.Category-eject').removeClass('grade-w-roll');
				$('.Sort-eject').removeClass('grade-w-roll');
				$('.grade-eject').removeClass('grade-w-roll');
			}
			
			//跳转详情
			window.goInfo =  function(goodsId){ 
				 openview({
				 	view:"mall-detail.html",
				 	extrasobj:{goodsId:goodsId}
				 })
			}
			
		})();
		
		
	</script>

</html>