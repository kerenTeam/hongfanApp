<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>答人榜</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />   
		<link rel="stylesheet" type="text/css" href="../../css/common.css"> 
		<link href="../../css/mui.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/config.css"/> 
	</head>
	<style type="text/css"> 
		.baocun{text-align:right;}
		.baocun img{margin:0 9pt;width:12%;vertical-align:middle;}
		.search{height:60px;background-color:#f3f3f3;}
		.searchBox{position:relative;margin:auto;width:76%;height:100%;}
		.searchBox img:first-child{width:100%;max-height:50px;}
		.searchBox .searchIcon,.searchBox img:first-child{position:absolute;top:50%;z-index:1;-webkit-transform:translateY(-50%);}
		.searchBox .searchIcon{left:10px;width:13px;}
		.follow{position:relative;padding:18px 15px 15px;}
		.follow,.followA{background-color:#fff;}
		.followA{padding:5px 15px 0;padding-left: 20px;}
		.follow:after{position:absolute;right:10px;bottom:0;left:10px;height:1px;background:#cacaca;content:'';-webkit-transform:scaleY(.3);}
		.follow:last-child:after{height:0;}
		.fchidl{display:flex;align-items:center;justify-content:space-between;}
		.Avator{margin-right:15px;width:40px;height:40px;}
		.userAvator{margin-right:15px;width:2rem;height:2rem;}
		.userAvator,.userAvator2{border-radius:50%;}
		.userAvator2{margin-right:15px;width:1.5rem;height:1.5rem;}
		.fchidl>div{display:flex;vertical-align:middle;text-align:left;font-size:15px;align-items:center;}
		.text{color:#999;}
		.diyButton{padding:5px 9pt;background:url(../../img/answer/bouttonbr.png) no-repeat;background-position:left top;background-size:100% 100%;text-align:center;}
  		.flexrr{display: flex;}
		.QAhead{background-color:#f3f3f3;text-align:center;}
		.QAhead span{position:relative;display:inline-block;margin:0 10px;padding:0 25px;height:38px;color:#343434;font-size:15px;line-height:38px}
		.QAhead span.active{color:#f93a38}
		.QAhead span:after{position:absolute;bottom:0;left:50%;width:0;height:1px;background-color:#f31414;content:""}
		.QAhead span.active:after{left:0!important;width:100%!important;transition:all .3s}
		.listCon{border-bottom:1px solid #ddd}
		.listCon p{padding:10px 0 0}
		.bottomop{display:flex;align-items:center}
		.bottomop img{width:20px}
		.flexr{justify-content:space-between}
		.lookall{margin:10px 0;background:url(../../img/answer/lookall.png) no-repeat;background-position:center;background-size:50%;text-align:center}
		.answerImf img{margin-right:5px;width:3.5rem;height:3.5rem;border-radius:3px}
		#listOldDiv{position: relative;}
	</style>
	<body style="background-color: white;padding-bottom: 0;">
		 
		<header class="mui-bar mui-bar-nav" id="header">
			<a class="goBack mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
			<h1 class="mui-title">答人榜</h1>
			<a href="javascript:;" style="line-height: 50px;color:white;" class="mui-pull-right baocun">
				<img class="" src="../../img/answer/user.png" alt="" />
				<img id="share" src="../../img/answer/share.png" alt="" /> 
			</a> 
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<!--轮播-->
		<div id="main">	
			<div class="search">
				<div class="searchBox">
					<img src="../../img/answer/searchBar.png"/>
					<img class="searchIcon" src="../../img/answer/search.png"/>
					<div style="position: absolute;left: 30px;font-size: 12px;top:50%;-webkit-transform: translateY(-50%);">
						请输入您想找的内容
					</div>
				</div>
			</div>
			<div id="curExport"></div>
			<script type="text/html" id="curExportTpl">
				<%for(var i = 0;i<list.length;i++){%>
					<div class="follow themeAsk" onclick="themeAsk(<%=list[i].id%>)"> 
						<div class="fchidl">
							<div>
								<img src="<%=list[i].icon%>" class="Avator" />
								<div>
									<div><%=list[i].name%></div>
									<div class="text"><%=list[i].description%></div>
								</div>
							</div>
							<div class="butright">
				            	<div class="diyButton activecl goask">
				            		提问	
				            	</div>
				            </div>
						</div> 
					</div>
				<%}%>
			</script> 
		</div>
		<div class="QandA"> 
			<div class="QAhead" style="position: -webkit-sticky; position:sticky; top: 70px;z-index: 99;display: block;width: 100%;">
				<span class="active aClick">最新</span>
				<span class="aClick">已解答</span> 
			</div>
			<div id="listOldDiv">
				<div id="listConW1" class="listSon"><!--我要问 盒子1-->
					<div class="listCon">
						<div class="follow"> <!--问题-->
							<div class="fchidl">
								<div><img src="../../img/send.png" class="userAvator mr25"/><div>wangfei</div></div> 
								<div class="butright"><div class="diyButton activecl goanswer">抢答</div> </div> 
							</div>  
							<p class="ft15 maincl">女 26 体检报告显示的这个胃蛋白酶之前从未有过，是不 是很严重，需要注意什么？</p> 
						 	<div class="bottomop flexr">
						 		<div class="activecl ft14"></div>
								<div class="flexrr">
									<div class="bottomop mr25">
										<img src="../../img/answer/liked.png" class="mr20" alt="" /><span class="activecl ft12">89</span>
									</div> 
									<div class="disablecl ft12">70人回答</div>
								</div>
						 	</div> 
						</div> 

						<div class="followA"> 
							<div class="fchidl">
								<div>
									<img src="../../img/10.png" class="userAvator2 mr25"/>
									<div class="disablecl"> wangfei </div>
								</div> 
							</div>  
							<p class="ft14 disablecl">感觉你要注意的应该只有几项而已</p> 
						</div>
						<div class="followA"> 
							<div class="fchidl">
								<div>
									<img src="../../img/10.png" class="userAvator2 mr25"/>
									<div class="disablecl"> wangfei </div>
								</div> 
							</div>  
							<p class="ft14 disablecl">感觉你要注意的应该只有几项而已</p> 
						</div>
						
						<div class="lookall ft12 disablecl" > 查看全部回答  </div> 
					</div>
					
				</div>
				<div id="listConW2" class="listSon" style="display: none;"><!--我要问 盒子2-->
					<div class="listCon">
						<div class="follow"> <!--问题-->
							<div class="fchidl">
								<div><img src="../../img/send.png" class="userAvator mr25"/><div>wangfei</div></div> 
								<div class="butright"><div class="diyButton activecl goanswer">抢答</div> </div> 
							</div>  
							<p class="ft15 maincl">男  26 体检报告显示的这个胃蛋白酶之前从未有过，是不 是很严重，需要注意什么？</p> 
						 	<div class="bottomop flexr">
						 		<div class="activecl ft14"></div>
								<div class="flexrr">
									<div class="bottomop mr25">
										<img src="../../img/answer/liked.png" class="mr20" alt="" /><span class="activecl ft12">89</span>
									</div> 
									<div class="disablecl ft12">70人回答</div>
								</div>
						 	</div> 
						</div> 

						<div class="followA"> 
							<div class="fchidl">
								<div>
									<img src="../../img/10.png" class="userAvator2 mr25"/>
									<div class="disablecl"> wangfei </div>
								</div> 
							</div>  
							<p class="ft14 disablecl">感觉你要注意的应该只有几项而已</p> 
						</div>
						<div class="followA"> 
							<div class="fchidl">
								<div>
									<img src="../../img/10.png" class="userAvator2 mr25"/>
									<div class="disablecl"> wangfei </div>
								</div> 
							</div>  
							<p class="ft14 disablecl">感觉你要注意的应该只有几项而已</p> 
						</div>
						
						<div class="lookall ft12 disablecl" > 查看全部回答  </div> 
					</div>
					
				</div>
				<script type="text/html" id="listDataS">
					<%for(var i=0;i<dataList.length;i++){%>
						<div class="listCon">
							<div class="follow"> <!--问题-->
								<div class="fchidl">
									<div><img src="../../img/send.png" class="userAvator mr25"/><div>wangfei</div></div> 
									<div class="butright"><div class="diyButton activecl goanswer">抢答</div> </div> 
								</div>  
								<p class="ft15 maincl">男  26 体检报告显示的这个胃蛋白酶之前从未有过，是不 是很严重，需要注意什么？</p> 
							 	<div class="bottomop flexr">
							 		<div class="activecl ft14"></div>
									<div class="flexrr">
										<div class="bottomop mr25">
											<img src="../../img/answer/liked.png" class="mr20" alt="" /><span class="activecl ft12">89</span>
										</div> 
										<div class="disablecl ft12">70人回答</div>
									</div>
							 	</div> 
							</div> 
	
							<div class="followA"> 
								<div class="fchidl">
									<div>
										<img src="../../img/10.png" class="userAvator2 mr25"/>
										<div class="disablecl"> wangfei </div>
									</div> 
								</div>  
								<p class="ft14 disablecl">感觉你要注意的应该只有几项而已</p> 
							</div>
							
							<div class="lookall ft12 disablecl" > 查看全部回答  </div> 
						</div>
					<%}%>	
				</script>
				<div class="upload text-center text-xs gray" id="upload"><img src='../../img/balls.svg' /></div>

				
			</div>
			
		</div>
		
		
	<script type="text/javascript" src="../../js/jquery.min.js"></script>
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/artTemplate-native.js" charset="utf-8"></script>
	<script type="text/javascript">
		/*tab切换*/
		var flag0 = 0,flag1 = 0,//是否   第一次点击
	     	SH0 = 0,SH1  = 0;/*保存的状态栏高度*/
		var listCon = document.getElementsByClassName('QAhead')[0].getElementsByTagName('span');
		var listSon = document.getElementsByClassName('listSon');
		
		[].forEach.call(listCon,function(ele,index){
			ele.onclick = function(){
				if(!ele.className.includes('active')){
					[].forEach.call(listCon,function(ele2,index2){
						ele2.className = '';
					})
					ele.className = 'active aClick';
					[].forEach.call(listSon,function(ele3,index3){
						ele3.style.display = 'none';
					})
					listSon[index].style.display = 'block';
					
					if(index == 0){
						if(flag0==0){
							shopData(index,0);
						}else{
							$(window).scrollTop(SH0);
						}
					}else if(index == 1){
						if(flag1==0){
							shopData(index,1);
						}else{
							$(window).scrollTop(SH1);
						}
					}
				}
			}
		})
		
		//获取问答分类
		mui.plusReady(function(){
			var oldToken = plus.storage.getItem('oldToken'),
		 		cityNum = plus.storage.getItem('cityNum');
			 
				mui.ajax(serverUrl+'/api/faqs/group',{
					type:'get',
					timeout:8000,
					headers:{"token":oldToken,"city":1},	              				
					success:function(data,type,xhr){
						console.log('exppot',data);
						if(data.errno == 0){ 
							if(data.data && data.data.length){
								 var picObj = data.data;  
								 [].forEach.call(picObj,function(ele){
								 	 if(ele.icon && ele.icon!='null'){
										if(JSON.parse(ele.icon)[0].picImg.indexOf('http') == -1){
											ele.icon = serverimgUrl + JSON.parse(ele.icon)[0].picImg;
										}else{
											ele.icon = JSON.parse(ele.icon)[0].picImg;
										}
									}else{
										ele.icon ='../../img/10.png' 
									}
								 }) 
								 $('#curExport').html(template('curExportTpl',{list:picObj}));
	
							}else{
								$('#curExport').html('<div id="addPic" style="text-align: center;padding: 15px;font-size: 13px;color: #888;padding-bottom: 20px;">暂无分类</div>')
							}
						  
						}else{
							console.log(data.errmsg); 
						}
					},
					error:function(xhr,type,errorThrown){
						console.log('获取数据,响应失败');
					}
				});
		})
		
		/*铺数据*/
		shopData(0,0,false);//默认推荐
		
		function shopData(typeNum,gender,refresh){
			var Spagenum = 2; //实到页数
			var Ypagenum = 1; //应到页数
			if(refresh){
				document.getElementById('upload').innerHTML = "<img src='../img/balls.svg' />";
				document.getElementsByClassName("dyCon")[typeNum].innerHTML = '';
			}
			if(typeNum == 0){
				flag0++;
				if(flag0 == 2){
					$(window).scrollTop(280);
				}
			}else if(typeNum == 1){
				flag1++;
				if(flag1 == 1){
					$(window).scrollTop(280);
				}
			}
			mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg' />";
			mui.plusReady(function(){
				var myuserid = plus.storage.getItem('userid'); 
				if(typeNum == 0){
					var dataJson = {
						'numsPerPage':6,
						'currentPage':1,
						'orderType':'DESC',
						'orderField':'create_time',
						'typeId':2
					}
				}else if(typeNum == 1){
					var dataJson = {
						'userId':myuserid,
						'numsPerPage':6,
						'currentPage':1,
						'orderType':'DESC',
						'orderField':'create_time',
						'isFriends':1,
						'typeId':2
					}
				}
				var cityNum = plus.storage.getItem('cityNum'),oldToken = plus.storage.getItem('oldToken');
				mui.ajax(serverUrl + '/api/friends/newslist', {
					data: dataJson,
					dataType: 'json',
					type: 'post',
					timeout: 8000,
					headers: {"token": oldToken,'city': cityNum},
					success: function(data, type, xhr) {
						console.error('交友列表'+typeNum, data);
						if(data.errno == 0) {
							var dataObj = {};
							var nowArray = data.data.data;
							
							dataObj.dataList = data.data.data;
							document.getElementsByClassName("listSon")[typeNum].innerHTML = template("listDataS", dataObj);
							//mui("#upload")[0].innerHTML = "";
							//lazyLoad(true,50);//懒加载
							 
							$(window).scroll(function() {
								if(1==1){//判断是否是 当前显示的盒子
										var scrollTop = $(this).scrollTop();　
										if(typeNum == 0){
											SH0 = $(this).scrollTop();
										}else if(typeNum == 1){
											SH1 = $(this).scrollTop();
										}
										var scrollHeight = $(document).height();
										var windowHeight = $(this).height();　　
										if(scrollTop + windowHeight == scrollHeight) {
											if(Spagenum <= data.data.totalPages && Spagenum == Ypagenum + 1) { //当前页小于等于总页数时请求下一页
												mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg' />";
												Ypagenum++; //满足加载情况,应到页数+1
												console.log('发起请求,实到' + Spagenum + '页');
												console.log('发起请求,应到' + Ypagenum + '页');
												if(typeNum == 0){
													var dataJson = {
														'numsPerPage':6,
														'currentPage':Spagenum,
														'orderType':'DESC',
														'orderField':'create_time',
														'typeId':1
													}
												}else if(typeNum == 1){
													var myuserid = plus.storage.getItem('userid');
													var dataJson = {
														'userId':myuserid,
														'numsPerPage':6,
														'currentPage':Spagenum,
														'orderType':'DESC',
														'orderField':'create_time',
														'isFriends':1,
														'typeId':1
													}
												}
												
												mui.ajax(serverUrl + '/api/friends/newslist', {
													data: dataJson,
													dataType: 'json',
													type: 'post',
													timeout: 8000,
													headers: {"token": oldToken,'city': cityNum},
													success: function(data) {
														console.error('交友列表续'+typeNum, data);
														if(data.errno == 0) {
															var dataObj = {};
															var nowArray = data.data.data;
															
															dataObj.dataList = data.data.data;
															document.getElementsByClassName("listSon")[typeNum].innerHTML += template("listDataS", dataObj);
															//lazyLoad(false,50);//懒加载
														}
														mui("#upload")[0].innerHTML = " ";
														Spagenum++; //加载成功,当前页+1
														console.log('成功+1,实到' + Spagenum);
														console.log('成功+1,应到' + Spagenum);
													},
													error: function(xhr, type, errorThrown) {
														Ypagenum--; //失败是应到-1
														mui.toast("当前网络不好请重试");
														mui("#upload")[0].innerHTML = "";
													}
												});
											} else if(Spagenum == data.data.totalPages + 1) { //当前页不小于等于总页数时请求下一页
												mui("#upload")[0].innerHTML = "到底了";
											}
										} 
								}
							});
							 
						}else{
							mui.toast('当前网络不好,请重试');
						}
					},
					error: function(xhr, type, errorThrown) {
						console.error('交友列表,响应失败');
						mui.toast('当前网络不好,请重试');
					}
				});
				
			})
		}
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
		//搜索
		$('.search').click(function(){
			openview({
				view:'searchQa.html'
			})
		})
		//直接提问
		$('.goask').click(function(){
			event.stopPropagation()
			openview({
				view:'questionInfo.html'
			})
		})
		//主题提问
		function themeAsk(id){
			openview({
				view:'questionInfo.html',
				extrasobj:{groupId:id}
			})
		}
		//点赞
		$('.bottomop img').click(function(){
			event.stopPropagation()
			if($(this).attr('src') == '../../img/answer/liked.png'){
				$(this).attr('src','../../img/answer/unlike.png')
			}else if($(this).attr('src') == '../../img/answer/unlike.png'){
				$(this).attr('src','../../img/answer/liked.png') 
				mui.toast('点赞成功')
			}
		})
		
		//分享
		$('#share').click(function(){
			
		})
		
		//抢答
		$('.goanswer').click(function(){
			event.stopPropagation()
			openview({
				view:'goAnswer.html'
			})
		})
		
		//查看全部
		$('.listCon').click(function(){
			openview({
				view:'answerInfo.html'
			})
		})
	</script>
		
		
		<script type="text/javascript">
		//自定义分享方法	
			var shareWrap0 = document.createElement('div');
			shareWrap0.innerHTML = '<div class="shareWrap"></div>'+
				'<div class="Scontent">'+
					'<h3 class="h3">分享</h3>'+
					'<div class="mui-row">'+
						'<div class="mui-col-sm-3 mui-col-xs-3">'+
							'<img src="../../img/share/weixing.png" class="aClick2"/>'+
							'<br />微信好友'+
						'</div>'+
						'<div class="mui-col-sm-3 mui-col-xs-3 ">'+
							'<img src="../../img/share/pengyouquan.png" class="aClick2"/>'+
							'<br />朋友圈'+
						'</div>'+
						'<div class="mui-col-sm-3 mui-col-xs-3">'+
							'<img src="../../img/share/QQ.png" class="aClick2"/>'+
							'<br />QQ好友'+
						'</div>'+
						'<div class="mui-col-sm-3 mui-col-xs-3">'+
							'<img src="../../img/share/weibo.png" class="aClick2"/>'+
							'<br />新浪微博'+
						'</div>'+
						'<div class="mui-col-sm-3 mui-col-xs-3">'+
							'<img src="../../img/share/fuzhi.png" class="aClick2"/>'+
							'<br />复制链接'+
						'</div>'+
					'</div>'+
					'<h3 id="cancelS" class="h4 fineT aClick2">取消</h3>'+
				'</div>';
			//document.body.appendChild(shareWrap0);
			
//			document.getElementById("share").addEventListener("click", function() {
//			    //分享内容，开发者可自定义
//			    var message = {
//			        title: "MONO", //应用名字
//			        content: "不错过你感兴趣的内容",
//			        href: "http://mmmono.com/", //分享出去后，点击跳转地址
//			        thumbs: ["https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=979572895,2889949287&fm=26&gp=0.jpg"] //分享缩略图
//			    }
//			    //调起分享
//			    plusShare(message, function(res) {
//			        //分享回调函数
//			        if(res) {
//			            plus.nativeUI.toast("分享成功");
//			        } else {
//			            plus.nativeUI.toast("分享失败");
//			        }
//			    })
//			});
			
			
			//分享
			function showSfun(link){
				document.getElementsByClassName('shareWrap')[0].style.zIndex = '999';
				document.getElementsByClassName('shareWrap')[0].style.opacity = '1';
				document.getElementsByClassName('Scontent')[0].style.bottom = '0px';
//				alert(link);
			}
			function hideSfun(){
				document.getElementsByClassName('shareWrap')[0].style.zIndex = '-1';
				document.getElementsByClassName('shareWrap')[0].style.opacity = '0';
				document.getElementsByClassName('Scontent')[0].style.bottom = '-500px';
			}
//			document.getElementById('share').onclick = function(){
//				showSfun('www.baidu.com');
//			}
//			document.getElementById('cancelS').onclick = function(){
//				hideSfun();
//			}
//			document.getElementsByClassName('shareWrap')[0].onclick = function(){
//				hideSfun();
//			}
			
		//调用系统分享方法	
			var shares=null;
			function plusReady(){
				//updateSerivces();
				//shareSystem();
			}
			if(window.plus){
				plusReady();
			}else{
				document.addEventListener('plusready', plusReady, false);
			}
			function updateSerivces(){
				plus.share.getServices(function(s){
					shares={};
					for(var i in s){
						var t=s[i];
						shares[t.id]=t;
					}
				}, function(e){
					outSet('获取分享服务列表失败：'+e.message);
				});
			}
			function shareSystem(){
			plus.share.sendWithSystem({content:'分享内容',href:'http://www.dcloud.io/'}, function(){
				console.log('分享成功');
			}, function(e){
				console.log('分享失败：'+JSON.stringify(e));
			});
		}
			
		</script>
		 
	</body>
	<!--<script src="../../js/plusShare.js" type="text/javascript" charset="utf-8"></script>-->
</html>