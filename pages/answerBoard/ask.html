<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>提问</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes"> 
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css"> 
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />  
		<link rel="stylesheet" type="text/css" href="../../css/config.css"/>

	</head>
	<style type="text/css">
		.baocun img{width:20px}
		.disbg{border:none}
		.uppics{padding:15px}
		.onepic{margin-top:20px}
		.uppics div.onepic img{width:4.5rem;height:4.5rem;display:inline-block;margin:0 5px;border-radius:3px}
		.uppics div.onepic input{width:0;height:0;position:absolute;outline:0}
		.picimg1{width:25px;position:absolute;right:0;top:2px}
		.followA{text-align:center;padding:10px 15px;background-color:#f3f3f3}
		#maskInfo{z-index:99999;position:fixed;top:0;left:0;width:100%;bottom:0;background-color:rgba(0,0,0,.5)}
		.ruleCt{position:absolute;padding-right:15px;background-color:#fff;top:15%;left:7%;width:86%;bottom:15%;padding:15px 5px;border-radius:3px}
		.closemask{position:absolute;bottom:20px;left:50%;-webkit-transform:translateX(-50%)}

	</style>

	<body style="background-color: white;">

		<header class="mui-bar mui-bar-nav" id="header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize back"></a>
			<h1 class="mui-title findUser">提问</h1>
			<a href="javascript:;" style="line-height: 50px;" class="mui-pull-right baocun"><img src="../../img/answer/goanswer/up.png"/></a>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		
		<div id="main">
			<div class="followA ft14 maincl" id="lookRule"> 
				查看问答细则及责任声明				 
			</div> 
			<div class="publishf">  
				<div class="apsan"></div>
				<textarea id="textCon" class="disbg ft14" minlength='4' maxlength='49' rows="3" placeholder="你的问题（5到49字以内）"></textarea>
			</div>
			 
			<div class="uppics clearfix" id="uppics2"> 
				<button type="button" class="mui-btn mui-btn-danger mar10 hipay" >悬赏</button>
				<div class="activecl zhidou ft14" style="display: none;">10HI豆</div>
		        <div class="onepic">
		            <img id="nowpic" src="../../img/answer/goanswer/addpic.png">
		            <p>添加照片</p>
		        </div> 
		    </div> 
		   
			 
		</div>
		 
		 
		<!--遮罩-->
		<div id="maskInfo" style="display: none;">
			<div class="ruleCt" style="padding-bottom: 50px;">
				<div style="overflow-y: scroll;height: 100%;margin-bottom: 50px;">
					<div class="ft16 fttc">问答规则</div>
					<ol class="ft14 disablecl ruleol">
						<li>xxxxxx跑顶顶顶顶顶顶顶顶xx</li>
						<li>xxx大大方方手动阀手动阀手动阀手动阀第三方孙大发大水法士大夫xxxx</li>
						<li>xxxxxx</li>
						<li>xxxxxxxx</li>
					</ol>
					<div class="ft16 fttc">责任声明</div>
					<ol class="ft14 disablecl ruleol">
						<li>xxxxxxxx</li>
						<li>xxxxxxx</li>
						<li>xxxxxx</li>
						<li>xxxxxxxx</li>
						<li>xxxxxxxx</li>
						<li>xxxxxxx</li>
						<li>xxxxxx</li>
						<li>xxxxxxxx</li><li>xxxxxxxx</li>
						<li>xxxxxxx</li>
						<li>xxxxxx</li>
						<li>xxxxxxxx</li><li>xxxxxxxx</li>
						<li>xxxxxxx</li>
						<li>xxxxxx</li>
						<li>xxxxxxxx</li>
					</ol>
				</div>
				<button type="button" class="mui-btn mui-btn-danger mar10 closemask" >我知道了</button>
				
			</div>
		</div>
			 
	</body>
<script type="text/javascript" src="../../js/jquery.min.js"></script>
<script src="../../js/mui.min.js"></script>
<script src="../../js/app.js"></script> 
<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/image-new.js" type="text/javascript" charset="utf-8"></script>
<!--引入模板引擎-->
<script src="../../js/artTemplate-native.js"></script>
<script type="text/javascript">
	//选择图片
	var Apic = [];//图片存放数组 
	var qid;
	$('#lookRule').click(function(){
		$('#maskInfo').fadeIn(200);
	})
	
	$('.ruleCt').click(function(){
		event.stopPropagation()
	})
	$('#maskInfo,.closemask').click(function(){
		event.preventDefault()
		$('#maskInfo').fadeOut(200);
	})
	mui.plusReady(function() {
		qid=plus.webview.currentWebview().qqid;
		
		var hidou = plus.webview.currentWebview().expertHI;
		if(hidou){
			$('.hipay').css('display','none');
			$('.zhidou').css('display','block');
		}
		$('.hipay').click(function(){
			openview({
				view:'reward.html'
			})
		})
		
		mui('#nowpic')[0].addEventListener('tap',function(){
			plus.nativeUI.actionSheet({
					cancel: "取消",
					buttons: [{
						title: "相册选择"
					}, {
						title: '拍照'
					}]
				},
				function(e) {
					if (e.index == 1) { //点击从相册选择
						galleryImgsSelected();
					} else if (e.index == 2) {
						getImage();
					}
				}
			);
		})
		var oldtoken = plus.storage.getItem('oldToken');
		
//		mui.ajax(serverUrl+'/api/news/tags',{//请求answer
//			dataType:'json',
//			type:'post',
//			timeout:10000,
//			headers:{"token":oldtoken},
//			success:function(data,type,xhr){ 
//				console.log('列表',data);
//				if(data.errno==0){
//					var dataobj = {};
//					if(data.data.length){
//						 
//						dataobj.list = data.data;
//						mui('#mainpic')[0].innerHTML = template('infolist',dataobj);
//						console.log(template('infolist',dataobj))
//					} 
//				}else{
//					mui.toast('当前网络不好，请重试！');	
//				}
//				plus.nativeUI.closeWaiting();
//			},
//			error:function(xhr,type,errorThrown){
//				plus.nativeUI.closeWaiting(); 
//				mui.toast('当前网络不好，请重试！');
//				console.log('登录响应失败');
//			}
//		});
		 
		function getImage(){//拍照并保存
			var cmr = plus.camera.getCamera();
			cmr.captureImage( function ( path ) {
				plus.io.resolveLocalFileSystemURL(path,function(entry){ 
					//把拍摄图片的路径转化成 本地文件url
					path = plus.io.convertLocalFileSystemURL(path);
					if(0!=path.indexOf("file://")){
						path="file://"+path;
					} 
		    		var nowpic = Math.random().toString(36).substr(2) + '.jpg';
		    		var endpic = path.split('.')[0]+"/"+nowpic;
		    		console.error(path);
		    		console.error(endpic);
					plus.zip.compressImage({//压缩方法
						src:path,
						dst:endpic,
						overwrite:true,
						quality:30
					},
					function() { 
						showImg(endpic);
						Apic = [];
						Apic.push(endpic); 
					},function(error) {
						mui.toast('图片获取错误，请重试'); 
					}); 
					//无压缩
					//showImg(path);
					//Apic = [];
					//Apic.push(path);
					//plus.gallery.save( path ); 
				});
			}, function ( e ) { 
			}, {filename:"_doc/gallery/",index:1} );
		}
		//var lfs=null;// 保留上次选择图片列表
		function galleryImgsSelected(){//从相册中选择图片
		    plus.gallery.pick( function(e){
		    	lfs=e.files;
		    	for(var i in e.files){
		    		if(0!=e.files[i].indexOf("file://")){
						e.files[i]="file://"+e.files[i];
					} 
		    		var nowpic = Math.random().toString(36).substr(2) + '.jpg';
		    		var endpic = e.files[i].split('.')[0]+"/"+nowpic;
		    		
		    		console.error(e.files[i]);
		    		console.error(endpic);
		    		plus.zip.compressImage({//压缩方法
						src:e.files[i],
						dst:endpic,
						overwrite:true,
						quality:30
					},
					function() {
						showImg(endpic);
						Apic = []; 
						Apic.push(endpic);
					},function(error) {
						mui.toast('图片获取错误，请重试');  
					});
					//无压缩 
			    	//showImg(e.files[i]);
			    	//Apic = []; 
					//Apic.push(e.files[i]);
		    	}
		    }, function ( e ) {  
//		    },{filter:"image",multiple:true,maximum:1,selected:lfs,system:false,onmaxed:function(){//保存选择记录
		    },{filter:"image",multiple:true,maximum:10,system:false,onmaxed:function(){
				plus.nativeUI.alert('只能选择10张图片');  
		    }});
		}
		function showImg(url){//显示图片
			
			if(0!=url.indexOf("file://")){        
				url="file://"+url;  
			} 
			alert(url)
			$('.onepic').prepend('<img style="width：4.5rem;height:4.5rem;display:inline" src="'+url+'"/>')
			$('.onepic p').css('display','none');    
		} 
}); 
	//选择图片结束
	 
	//发送 发布
	mui('.baocun')[0].addEventListener('tap',function(){ 
		 alert(Apic)
	})
</script>

</html>