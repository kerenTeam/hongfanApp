<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>回复</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css"> 
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" href="../../css/reset.css"> 
		<link rel="stylesheet" type="text/css" href="../../css/find.css" />
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/app.js"></script>
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js"></script>
		 <style type="text/css">
		 	#header{
		 		position: fixed!important;
		 		top: 0;
		 		left: 0;
		 	}
		 </style>
	</head>

	<body style="background-color: white;">
 
		<header class="mui-bar mui-bar-nav" id="header">
			<a class="mui-action-back mui-icon mui-icon-close mui-pull-left bigSize"></a>
			 
			<h1 class="mui-title findUser">回复</h1>
			<a href="javascript:;" style="line-height: 50px;color:white;" class="fr baocun">发送</a>
		</header>
		<script src="../../js/statusBar.js"></script>
		<!--状态栏-->
		<!--<div id="container">-->
		<div id="main">
		 <textarea name="" rows="10" cols="" style="font-size: 16px;border: none;" placeholder="写评论"></textarea>

		</div>

	</body>

	<script src="../../js/mui.min.js"></script>
	<script type="text/javascript">
		mui.plusReady(function(){
			
			//自动弹出输入法
		  	var nativeWebview, imm, InputMethodManager;
			var initNativeObjects = function() {
			    if (mui.os.android) {
			        var main = plus.android.runtimeMainActivity();
			        var Context = plus.android.importClass("android.content.Context");
			        InputMethodManager = plus.android.importClass("android.view.inputmethod.InputMethodManager");
			        imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);
			    } else {
			        nativeWebview = plus.webview.currentWebview().nativeInstanceObject();
			    }
			};
			var showSoftInput = function() {
			    if (mui.os.android) {
			        imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);
			    } else {
			        nativeWebview.plusCallMethod({
			            "setKeyboardDisplayRequiresUserAction": false
			        });
			    }
		        //此处可写具体逻辑设置获取焦点的input
		        setTimeout(function() {
			       var inputElem = document.getElementsByTagName('textarea')[0];
	               inputElem.focus(); 
	            }, 0); 
			};
	    	initNativeObjects();
	    	showSoftInput();
			
			
			var oldtoken = plus.storage.getItem('oldToken');
        	var myuserid = plus.storage.getItem('userid');
			var to_user_id = plus.webview.currentWebview().to_user_id;
			var to_commit_id = plus.webview.currentWebview().to_commit_id; 
			var friend_news_id = plus.webview.currentWebview().friend_news_id;
			var p_commit_id = plus.webview.currentWebview().p_commit_id; 
//			console.log("from_user_id:"+myuserid+"to_user_id :"+to_user_id+"friend_news_id："+friend_news_id+"to_commit_id："+to_commit_id+"p_commit_id："+p_commit_id)
		    $(".baocun").on("click",function(){
		    	var content = $("textarea").val();
		    	if(!content){
		    	   mui.toast("还未填写评论哦！")
		    	}else{
		    		plus.nativeUI.showWaiting();
		    		mui.ajax(serverUrl+"/api/news/commit",{
		    			data:{from_user_id:myuserid,content:content,to_user_id:to_user_id,friend_news_id:friend_news_id,to_commit_id:to_commit_id,p_commit_id:p_commit_id},
		        		dataType:'json',
						type:'post',
						timeout:10000,
						headers:{"token":oldtoken},	 
						success:function(data,type,xhr){ 
							console.log(data)
							plus.nativeUI.closeWaiting(); //关闭等待框
							if(data.errno == 0){
								mui.toast("评论成功！")
								var list = plus.webview.getWebviewById("findInfo");
								var list2 = plus.webview.getWebviewById("innerComment")
								mui.fire(list,"refreshCmt");
								mui.fire(list2,"refreshCmt");
								mui.back();
							}
						},
						error:function(xhr,type,errorThrown){
							plus.nativeUI.closeWaiting(); 
							console.log('响应失败  !');
						}
						 
		        	})
		    	}
		    })
		    
		})
	</script>
</html>