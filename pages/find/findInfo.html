<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>发现</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css"> 
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" href="../../css/reset.css"> 
		<!--<link rel="stylesheet" type="text/css" href="../../css/find.css" />-->
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/app.js"></script>
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js"></script>
		<style type="text/css">
		
			.heart {
				background: url(../../img/market/web_heart_animation.png);
				background-position: left;
				background-repeat: no-repeat;
				height: 60px;
				width: 60px;
				cursor: pointer;
				position: absolute;
				left: -14px;
				top: -10px;
				background-size: 2900%;
			}
			
			.innerheart{
				height:56px;
				width:50px;
				display: inline-block;
			    left: -36px;
			    top: -20px; 
			}
			.mui-preview-image.mui-fullscreen {
				position: fixed;
				z-index: 20;
				background-color: #000;
			}
			.mui-preview-header,
			.mui-preview-footer {
				position: absolute;
				width: 100%;
				left: 0;
				z-index: 10;
			}
			.mui-preview-header {
				height: 44px;
				top: 0;
			}
			.mui-preview-footer {
				height: 50px;
				bottom: 0px;
			}
			.mui-preview-header .mui-preview-indicator {
				display: block;
				line-height: 25px;
				color: #fff;
				text-align: center;
				margin: 15px auto 4;
				width: 70px;
				background-color: rgba(0, 0, 0, 0.4);
				border-radius: 12px;
				font-size: 16px;
			}
			.mui-preview-image {
				display: none;
				-webkit-animation-duration: 0.5s;
				animation-duration: 0.5s;
				-webkit-animation-fill-mode: both;
				animation-fill-mode: both;
			}
			.mui-preview-image.mui-preview-in {
				-webkit-animation-name: fadeIn;
				animation-name: fadeIn;
			}
			.mui-preview-image.mui-preview-out {
				background: none;
				-webkit-animation-name: fadeOut;
				animation-name: fadeOut;
			}
			.mui-preview-image.mui-preview-out .mui-preview-header,
			.mui-preview-image.mui-preview-out .mui-preview-footer {
				display: none;
			}
			.mui-zoom-scroller {
				position: absolute;
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-box-align: center;
				-webkit-align-items: center;
				align-items: center;
				-webkit-box-pack: center;
				-webkit-justify-content: center;
				justify-content: center;
				left: 0;
				right: 0;
				bottom: 0;
				top: 0;
				width: 100%;
				height: 100%;
				margin: 0;
				-webkit-backface-visibility: hidden;
			}
			.mui-zoom {
				-webkit-transform-style: preserve-3d;
				transform-style: preserve-3d;
			}
			.mui-slider .mui-slider-group .mui-slider-item img {
				width: auto;
				height: auto;
				max-width: 100%;
				max-height: 100%;
			}
			.mui-android-4-1 .mui-slider .mui-slider-group .mui-slider-item img {
				width: 100%;
			}
			.mui-android-4-1 .mui-slider.mui-preview-image .mui-slider-group .mui-slider-item {
				display: inline-table;
			}
			.mui-android-4-1 .mui-slider.mui-preview-image .mui-zoom-scroller img {
				display: table-cell;
				vertical-align: middle;
			}
			.mui-preview-loading {
				position: absolute;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				display: none;
			}
			.mui-preview-loading.mui-active {
				display: block;
			}
			.mui-preview-loading .mui-spinner-white {
				position: absolute;
				top: 50%;
				left: 50%;
				margin-left: -25px;
				margin-top: -25px;
				height: 50px;
				width: 50px;
			}
			.mui-preview-image img.mui-transitioning {
				-webkit-transition: -webkit-transform 0.5s ease, opacity 0.5s ease;
				transition: transform 0.5s ease, opacity 0.5s ease;
			}
			@-webkit-keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			@keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			@-webkit-keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}
			@keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}
			#main {
				background-color: white!important;
			}
			
			img {
				width: 100%;
			}
			
			.txtinfo {
				background-color: white;
				padding: 15px 15px;
				line-height: 1.4;
				letter-spacing: 1px;
			}
			
			.mark {
				color: coral;
				margin: 0 2px;
			}
			
			.view {
				padding: 5px 15px;
				color: gray;
			}
			.view img{
				width: 13px;
				
			}
			.view span {
				color: lightgray;
				font-size: 15px;
			}
			
			.looker {
				overflow: hidden;
				padding: 8px;
				white-space: nowrap;
			}
			
			.looker li {
				display: inline-block;
				border: 1px solid lightgray;
				border-radius: 50%;
				padding: 1px;
				overflow: hidden;
				width: 0.38rem;
				height: 0.38rem;
				margin: 4px;
				text-align: center;
			}
			
			.looker li.moreLiked {
				color: white;
				line-height: 0.35rem;
				background: lightgray;
			}
			
			.looker li img {
				border-radius: 50%;
				width: 100%;
				height: 100%;
			}
			
			.noComment {
				margin: auto;
				width: 1rem;
				text-align: center;
			}
			
			.noComment p {
				padding: 0.1rem 0 0.2rem;
				font-size: 12px;
			}
			
			.commentNums {
				padding: 15px 0;
				text-align: center;
				background: #EEEEEE;
			}
			
			.oa-contact-cell.mui-table .mui-table-cell {
				padding: 11px 0;
				vertical-align: middle;
			}
			
			.oa-contact-cell {
				position: relative;
				margin: -11px 0;
			}
			
			.oa-contact-avatar {
				width: 35px;
				height: 35px!important;
			}
			
			.oa-contact-avatar img {
				border-radius: 50%;
				height: 35px;
			}
			
			.oa-contact-content {
				width: 100%;
			}
			
			.oa-contact-name {
				font-size: 14px;
				margin-right: 20px;
			}
			
			.oa-contact-name{
				float: left;
			}
			
			.comment .mui-table-view-cell:after {
				height: 0px!important;
				-webkit-transform: none;
				background-color: none;
			}
			
			.cheader {
				position: relative;
			}
			
			.cheader img {
				position: absolute;
				top: 5%;
			}
			
			.oaright {
				position: relative;
				left: 15px;
			}
			
			.oaright:after {
				position: absolute;
				right: 0;
				bottom: 0;
				content: '';
				left: 0;
				height: 1px!important;
				-webkit-transform: scaleY(0.5);
				background-color: #eee;
			}
			.oaright p {
				word-break: break-all;
				color: rgba(0, 0, 0, 0.6);
				font-size: 13px;
				padding-top: 5px;
				line-height: 1.5;
			}
			
			.ifcmt {
				margin-top: 10px;
				padding-bottom: 40px;
			}
			
			.cocmt {
				width: 97%;
				background-color: whitesmoke;
				padding: 5px;
				border-radius: 5px;
				margin: 10px 0;
			}
			
			.cocmt span {
				color: skyblue;
			}
			
			.cocmt p:last-child {
				color: skyblue;
			}
			
			.ctime {
				font-size: 10px;
				color: #C0C0C0;
				margin-top: 5px;
			}
			
			.mui-table-view-cell.mui-active {
				background-color: none!important;
			}
			
			.cmtinput {
				position: fixed;
				bottom: 0;
				left: 0;
				height: 40px;
				display: table;
				width: 100%;
				background-color: whitesmoke;
				z-index: 1;
			}
			
			.cmtinput>div {
				display: table-cell;
			}
			
			.inputmn {
				position: relative;
				background-color: white;
				color: gray;
				width: 80%;
			}
			
			.innerInput {
				margin: 10px!important;
				line-height: 20px;
				border-left: 2px solid palevioletred;
			}
			.inputmn img{
				position: absolute;
				width: 30px;
				top: 50%;
				margin-top: -15px;
				right: 0;
				height: 30px;
			}
			@media (max-width: 340px) {
				.looker li {
					width: 0.32rem;
					height: 0.32rem;
				}
				.looker li:last-child {
					line-height: 0.32rem;
				}
			}
			
			@media (min-width: 400px) {
				.looker li {
					width: 0.42rem;
					height: 0.42rem;
				}
				.looker li:last-child {
					line-height: 0.42rem;
				}
			}
			
			.heart:hover,
			.heart:focus {
				background-position: right;
			}
			
			@-webkit-keyframes heartBlast {
				0% {
					background-position: left;
				}
				100% {
					background-position: right;
				}
			}
			
			@keyframes heartBlast {
				0% {
					background-position: left;
				}
				100% {
					background-position: right;
				}
			}
			
			.heartAnimation {
				display: inline-block;
				-webkit-animation-name: heartBlast;
				animation-name: heartBlast;
				-webkit-animation-duration: .3s;
				animation-duration: .3s;
				-webkit-animation-iteration-count: 1;
				animation-iteration-count: 1;
				-webkit-animation-timing-function: steps(28);
				animation-timing-function: steps(28);
				background-position: right;
			}
			.feed p {
				font-family: "Microsoft YaHei", 'Georgia', Times, Times New Roman, serif;
				font-size: 25px;
			}
			
			.feed {
				margin-bottom: : 20px;
				position: relative;
			}
			
			.likeCount {
				font-size: 12px;
				display: inline-block;
				color: #999999;
				vertical-align: middle!important;
			}
			.findhd {
				color: white;
				display: table;
				position: absolute;
				top: 50%;
				left: 50%;
				-webkit-transform: translate(-50%, -50%);
			}
			
			.findhd>div {
				vertical-align: middle;
				display: table-cell; 
			}
			
			.findUser {
				width: 0.3rem!important;
				height: 0.3rem;
				border-radius: 50%!important;
				margin-right: 5px;
				position: relative;
				/*vertical-align: middle!important;*/
			}
			
			.findUser span {
				/*position: absolute;*/
				color: white;
				font-size: 12px;
				line-height: 0!important;
			}
			
			.ftime {
				margin-top: 4px;
				font-size: 10px;
				vertical-align: middle;
			}
			
			.ftime img {
				width: 0.1rem!important;
				height: 0.1rem!important;
			}
			.cmlist{
				padding: 15px 15px;
			}
		</style>
	</head>

	<body>

	 
		<header class="mui-bar mui-bar-nav" id="header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
			<div class="findhd">
				<div style="vertical-align: middle;"><img src="../../img/10.png" class="findUser" alt="" /></div>
				<div>
					<span class="fname"></span>
				</div>
			</div>
			<a href="javascript:;" style="line-height: 50px;color:white;font-size: 25px;" class="fr baocun">+</a>
		</header>
		<script src="../../js/statusBar.js"></script>
		<!--状态栏-->
		<!--<div id="container">-->
		<div id="main">
			<div id="newsInfo"></div>
			<script type="text/html" id="newsInfoTpl">
				<%if(recommendData.newsinfodata){%>
					<!--<img src="<%=myUrl%><%=recommendData.newsinfodata.pic%>" alt="" data-preview-src="" data-preview-group="1" />-->
					<img src="<%=recommendData.newsinfodata[0].pic%>" alt="" data-preview-src="" data-preview-group="1" />
					<p class="txtinfo">
						<%if(recommendData.tags && recommendData.tags.length){%>
							<%for(var i=0;i<recommendData.tags.length;i++){%>
								<%if(recommendData.tags[i].tagName){%>
									<span class="mark">#<%=recommendData.tags[i].tagName%>#</span>
								<%}%>
							<%}%>
						<%}%> <%=recommendData.newsinfodata[0].content%>
		
					</p>
					 
					<div class="view"><img src="../../img/serveForPeople/acmap.png" alt="" /> <small style="vertical-align: middle;margin-right: 10px;"><%=recommendData.newsinfodata[0].fix%></small> <img src="../../img/eye.svg" alt="" /> <small style="vertical-align: middle;"><%=recommendData.liker.length%></small></div>
					<!--查看列表-->
					<%if(recommendData.liker && recommendData.liker.length){%>
						<ul class="looker">
							<%if(recommendData.liker.length > 6){%>
								<%for(var j=0;j<6;j++){%>
									<%if(recommendData.liker[j].avatar){%>
										<li><img src="<%=myUrl%><%=recommendData.liker[j].avatar[0].picImg%>" data-id="<%=recommendData.liker[j].user_id%>" alt="" /></li>
									<%}else{%>
										<li><img src="../../img/10.png" alt="" data-id="<%=recommendData.liker[j].user_id%>" /></li>
									<%}%>
								<%}%>
								<li data-id="<%=recommendData.newsinfodata[0].userid%>" class="moreLiked"><%=recommendData.liker.length%></li>
							<%}else{%>
								<%for(var j=0;j<recommendData.liker.length;j++){%>
									<%if(recommendData.liker[j].avatar){%>
										<li><img src="<%=myUrl%><%=recommendData.liker[j].avatar[0].picImg%>" data-id="<%=recommendData.liker[j].user_id%>" alt="" /></li>
									<%}else{%>
										<li><img src="../../img/10.png" data-id="<%=recommendData.liker[j].user_id%>" alt="" /></li>
									<%}%>
									<%}%>
							<%}%> 
						</ul>
					<%}%>
					<!--评论输入框-->
					<div class="cmtinput">
						<div class="inputmn"> 
								<div class="innerInput orp" data-friend_news_id="<%=recommendData.newsinfodata[0].news_id%>" data-to_user_id="<%=recommendData.newsinfodata[0].user_id%>">发射评论~</div>
								<img src="../../img/keyboard.svg" alt="" />
						</div>
						<div class="feed" id="feed0">
							<div class="heart " id="like0" data-id="<%=recommendData.newsinfodata[0].user_id%>" rel="like"></div>
							<!--<div class="heart heartAnimation" id="like0" data-id="<%=recommendData.newsinfodata.user_id%>" style="display: none;" rel="unlike"></div>-->
							<div class="likeCount" style="visibility: hidden;" id="likeCount0">0</div>
						</div>
		
						<div class="sharef" style="position: relative;" onclick="share()">
							<img src="../../img/market/sharef.png" style="width: 20px;position: absolute;top: 10px;right: 10px;" />
						</div>
					</div>
				<%}%> 
			</script>
			
			
			<div class="ifcmt">
				
				<div id="cmtAll"></div>
				<script type="text/html" id="cmtTpl">
					<%if(!cmtData.commit.length){%>
						<!--未评论-->
						<p class="commentNums">评论 0</p>
						<div class="noComment">
							<img src="../../img/nocmt.png" alt="" />
							<p>快抢沙发吧</p>
						</div>
					<%}else{%>
							<!--有评论-->
				<div class="comment">
					
					<p class="commentNums">评论 <%=cmtData.commit.length%></p>
					
						<ul class="mui-table-view-striped mui-table-view-condensed">
							<%for(var i =cmtData.commit.length-1;i>=0;i--){%>
								<%if(cmtData.commit[i].to_user_id == 0){%>
									<li class="mui-table-view-cell cmlist" data-fromUserId="<%=cmtData.commit[i].from_user_id%>" data-commitId="<%=cmtData.commit[i].id%>">
										<div class="mui-slider-cell">
											<div class="oa-contact-cell mui-table">
												<div class="oa-contact-avatar mui-table-cell cheader"> 
													<%if(cmtData.commit[i].avatar){%>
													 <img src="<%=myUrl%><%=cmtData.commit[i].avatar[0].picImg%>" onclick="gocmterPage('<%=cmtData.commit[i].from_user_id%>')"/>
													<%}else{%>
														<img src="../../img/10.png" onclick="gocmterPage('<%=cmtData.commit[i].from_user_id%>')"/>
														<%}%>
												</div>
												<div class="oa-contact-content mui-table-cell oaright">
													<div class="mui-clearfix">
														<h4 class="oa-contact-name"><%=cmtData.commit[i].nickname%></h4>
														<span class="mui-pull-right orp" data-friend_news_id="<%=cmtData.commit[i].friend_news_id%>" data-to_user_id="<%=cmtData.commit[i].from_user_id%>" data-to_commit_id="<%=cmtData.commit[i].id%>"><img src="../../img/market/repeat.svg" style="width: 15px;margin:0 15px 0 10px;"/></span>
														<div class="feed mui-pull-right" id="feed<%=i+1%>">
																	<%if(cmtData.commit[i].isLike == 1){%>
																		<!--红心状态-->
																		<div class="heart innerheart heartAnimation" id="like<%=i+1%>" data-id="<%=cmtData.commit[i].id%>" rel="unlike"></div>
																	<%}else{%>
																		<div class="heart innerheart" id="like<%=i+1%>" data-id="<%=cmtData.commit[i].id%>" rel="like"></div>
																		<%}%> 
															<div class="likeCount" id="likeCount<%=i+1%>">
																<%if(cmtData.commit[i].likeNums){%>
																     <%=cmtData.commit[i].likeNums%>
																<%}%>
															</div>
														</div>
													</div>
			
													<div class="oa-contact-position mui-h6 ctime"><%=cmtData.commit[i].create_time_as%></div>
													<p class="oa-contact-email mui-h6">
														<%=cmtData.commit[i].content%>
													</p>
													<!--评论的回复-->
													<div class="othersCmt"></div>
												</div>
											</div>
										</div>
									</li>
									<%}%> 
							<%}%>
						</ul>
					 
				</div>
			
						
						<%}%>
				</script>
                <script type="text/html" id="otherCmtTpl">
                	
						<%if(cmtData.length!=0){%>
						    <div class="cocmt" data-cmtid="<%=cmtData[0].to_commit_id%>">
						    	<%if(cmtData.length>4){%>
		                		  	<%for(var i=4;i>=0;i--){%>  
										<p><span class="ccname"><%=cmtData[i].nickname%>:</span><%=cmtData[i].content%></p> 
									<%}%> 
								<%}else{%>
									<%for(var i=cmtData.length-1;i>=0;i--){%>  
										<p><span class="ccname"><%=cmtData[i].nickname%>:</span><%=cmtData[i].content%></p> 
									<%}%> 
								<%}%>
								<p>共<%=cmtData.length%>条回复</p>		
							</div>
						<%}%>
						 
                </script>
			</div>

			
	 

		</div>

	</body>

	<script src="../../js/mui.min.js"></script>
	<script src="../../js/mui.zoom.js"></script>
	<script src="../../js/mui.previewimage.js"></script>
	<script type="text/javascript">
	   
		
		
		//关注
		$(".baocun").on("tap",function(){
			if(plus.storage.getItem('myToken')){
				$(this).html('<span class="mui-icon mui-icon-checkmarkempty"></span>')
				mui.toast("已关注");
				$(this).fadeOut(400);
				setTimeout(function(){
					$(this).remove();
				},200)
			}else{
				mui.toast('请登录');
				openview({
					view:'../login.html'
				});
			}
			
		}) 
		mui.plusReady(function(){
			 
			var oldtoken = plus.storage.getItem('oldToken');
			var newsId = plus.webview.currentWebview().newsId;
			var news_userId = plus.webview.currentWebview().userId;
			var avtar = plus.webview.currentWebview().avtar;
			var nickName = plus.webview.currentWebview().nickName;
			var myuserid = plus.storage.getItem('userid'); 
			
			window.addEventListener('refreshCmt',function(event){ 
				getCmt(); 
			});
			
			if(avtar){ 
				$(".findUser").attr("src",avtar)
			}
			if(nickName){
				$(".fname").html(nickName)
			}
			//发布者主页
			$(".findUser").click(function(){
				 if(news_userId == myuserid){
					openview({
						view: "../centerPage.html",
						id:"centerPage",
						extrasobj: {
							userId: news_userId
						}
					})
				}else{
					openview({
						view: "../othersPage.html",
						id:"othersPage",
						extrasobj: {
							userId: news_userId
						}
					})
				}
			})
			//帖子详情
			mui.ajax(serverUrl+"/api/news/newsinfo",{
    			data:{newsid:newsId},
        		dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldtoken},	 
				success:function(data,type,xhr){
					
					if(data.errno == 0) { 
						if(data.data){ 
							var dataobj = data.data; 
							if(dataobj.liker){
								for(var i=0;i<dataobj.liker.length;i++){
									if(dataobj.liker[i].avatar){
										dataobj.liker[i].avatar = JSON.parse(dataobj.liker[i].avatar)
									}
									 
								}
							}   
							var recommendObj = {};
							recommendObj.myUrl = serverimgUrl;
							recommendObj.recommendData = dataobj;
							document.getElementById("newsInfo").innerHTML = template("newsInfoTpl",recommendObj);
							if(dataobj.liker){
								for(var i=0;i<dataobj.liker.length;i++){
									if(dataobj.liker[i].user_id == myuserid){
										$("#like0").addClass("heartAnimation").attr("rel","unlike");
										break;
									}
									 
								}
							} 
							
							
							//查看者  主页
							$(".looker img").click(function(){
								openview({
									view: "../othersPage.html",
									extrasobj: {
										userId: $(this).attr("data-id")
									}
								})
							}) 
		
							$(".moreLiked").click(function(){
								openview({
									view: "othersLiked.html",
									extrasobj: {
										newsId: newsId
									}
								})
							})
							getCmt();
							
							//点赞 
							$('.cmtinput .heart').on("click",function(){
								if(plus.storage.getItem('myToken')){
									var A=$(this).attr("id"); 
									var B=A.split("like"); 
									var messageID=B[1];
									var C=parseInt($("#likeCount"+messageID).html()); 
									$(this).css("background-position","")
									var likedUserid= $(this).attr("data-id");
									var D=$(this).attr("rel");
									if(D === 'like') {
										$("#likeCount"+messageID).html(C+1);
										$(this).addClass("heartAnimation").attr("rel","unlike"); 
										
										//点赞帖子   
											likeThis(newsId,likedUserid,myuserid,oldtoken) 
									}
									else{  
										$("#likeCount"+messageID).html(C-1);
										$(this).removeClass("heartAnimation").attr("rel","like");
										$(this).css("background-position","left");
										//取消点赞
										likeThis(newsId,likedUserid,myuserid,oldtoken)
									}
								}else{
									mui.toast('请登录');
									openview({
										view:'../login.html'
									});
								}
								
								
								
								
							});
							
							
							//回复跳转
							$(".orp").click(function(){ 
								//被评人id
								var to_user_id = 0; 
								var to_commit_id = ''
								//帖子id
								var friend_news_id = $(this).attr("data-friend_news_id") ;
								if(plus.storage.getItem('myToken')){
									mui.openWindow({
									    url:"repComment.html",
									    id:"repComment",
									    show:{ 
									      aniShow:"slide-in-bottom",//页面显示动画，默认为”slide-in-right“；
									      duration:"300"//页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
									    },
									     waiting:{
									      autoShow:false,//自动显示等待框，默认为true
									    },
									    extras:{
									    	to_user_id:to_user_id,friend_news_id:friend_news_id,to_commit_id:to_commit_id
									    }
									})
								}else{
									mui.toast('请登录');
									openview({
										view:'../login.html'
									});
								}
								
							})
							
						}
		 
					} 
					plus.nativeUI.closeWaiting(); //关闭等待框
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting(); 
					console.log('响应失败  !');
				}
				 
        	})
			
			function getCmt(){
				//取得评论信息 用于news详细 和评论详细
				mui.ajax(serverUrl+"/api/news/newscommit",{
	    			data:{newsid:newsId,userid:myuserid},
	        		dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"token":oldtoken},	 
					success:function(data,type,xhr){ 
						if(data.errno == 0) { 
							if(data.data){ 
								var dataobj = data.data;
								for(var i=0;i<dataobj.commit.length;i++){
									dataobj.commit[i].news_userid = news_userId; 
									if(!dataobj.commit[i].nickname){
										dataobj.commit[i].nickname = "匿名"
									}else{
										 
										if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(dataobj.commit[i].nickname)){
											dataobj.commit[i].nickname = dataobj.commit[i].nickname.substring(0,3)+"****"+dataobj.commit[i].nickname.substring(7,11)
										}
									}
									
									if(dataobj.commit[i].avatar){
										dataobj.commit[i].avatar = JSON.parse(dataobj.commit[i].avatar)
									}
									
									dataobj.commit[i].create_time_as = formatDate(dataobj.commit[i].create_time_as, "yyyy.MM.dd hh:mm:ss")
									for(var j=0;j<dataobj.likeNums.length;j++){
										if(dataobj.likeNums[j].field == dataobj.commit[i].id){
											dataobj.commit[i].likeNums = dataobj.likeNums[j].count 
										}
									}
									for(var m=0;m<dataobj.My_favorite_comments.length;m++){
										if(dataobj.My_favorite_comments[m].commit_id == dataobj.commit[i].id && dataobj.My_favorite_comments[m].commit_like_user_id == myuserid){
											dataobj.commit[i].isLike = 1; 
										}
									} 
								} 
								var commentObj = {};
								commentObj.myUrl = serverimgUrl;
								commentObj.cmtData = dataobj;
								document.getElementById("cmtAll").innerHTML = template("cmtTpl", commentObj);  
								
								var cmlist = document.getElementsByClassName("cmlist");
								for(var t=0;t<cmlist.length;t++){
									var fuserid = cmlist[t].getAttribute("data-fromUserId"); 
									var cucommitid = cmlist[t].getAttribute("data-commitId"); 
									    //取得评论的评论 
										getCmtcmt(t,fuserid,cucommitid)
								} 
								
								//点赞 
								$('.comment .heart').on("click",function(){
									if(plus.storage.getItem('myToken')){
										var A=$(this).attr("id"); 
										var B=A.split("like"); 
										var messageID=B[1];
										var C=parseInt($("#likeCount"+messageID).html());
										if(!C){
											C=0;
										}
										$(this).css("background-position","")
										var commitid= $(this).attr("data-id"); 
										var D=$(this).attr("rel");
										if(D === 'like') {
											$("#likeCount"+messageID).html(C+1);
											$(this).addClass("heartAnimation").attr("rel","unlike"); 
											
											//点赞评论 
											likeCmt(commitid,myuserid,oldtoken) 
										}
										else{  
											
											//取消点赞评论
											likeCmt(commitid,myuserid,oldtoken) 
											
											var nowLm = C-1;
											if(nowLm == 0){
												nowLm ='';
											}
											$("#likeCount"+messageID).html(nowLm);
											$(this).removeClass("heartAnimation").attr("rel","like");
											$(this).css("background-position","left");
											
										}
									}else{
										mui.toast('请登录');
										openview({
											view:'../login.html'
										});
									}
									
									
								});
				                
							}
			 
						}else{
							document.getElementById("cmtAll").innerHTML = '<p class="commentNums">评论 0</p><div class="noComment"><img src="../../img/nocmt.png" alt="" /><p>快抢沙发吧</p></div>'; 
							
						}
						
						
						
						plus.nativeUI.closeWaiting(); //关闭等待框
					},
					error:function(xhr,type,errorThrown){
						plus.nativeUI.closeWaiting(); 
						console.log('响应失败  !');
					}
					 
	        	})
			}
			 
			function getCmtcmt(t,fuserid,cucommitid){
				var newDataObj = [];
				mui.ajax(serverUrl+"/api/news/newscommit",{
	    			data:{newsid:newsId,userid:myuserid},
	        		dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"token":oldtoken},	 
					success:function(data,type,xhr){
						if(data.errno == 0) { 
							if(data.data){
								var dataobj = data.data; 
								for(var i=0;i<dataobj.commit.length;i++){ 
									dataobj.commit[i].news_userid = news_userId; 
									if(!dataobj.commit[i].nickname){
										dataobj.commit[i].nickname = "匿名"
									}else{ 
										if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(dataobj.commit[i].nickname)){
											dataobj.commit[i].nickname = dataobj.commit[i].nickname.substring(0,3)+"****"+dataobj.commit[i].nickname.substring(7,11)
										}
									} 
									//if((dataobj.commit[i].p_commit_id && dataobj.commit[i].p_commit_id == cucommitid) || dataobj.commit[i].to_commit_id == cucommitid){
									if((dataobj.commit[i].to_user_id == fuserid && dataobj.commit[i].to_commit_id == cucommitid) || (dataobj.commit[i].p_commit_id && dataobj.commit[i].p_commit_id == fuserid)){
									  
										newDataObj.push(dataobj.commit[i])
									}
								}  
								var commentObj = {};
								commentObj.myUrl = serverimgUrl;
								commentObj.cmtData = newDataObj;
								document.getElementsByClassName("othersCmt")[t].innerHTML = template("otherCmtTpl", commentObj);
								
								//回复跳转
								$(".orp").click(function(){ 
									//被评人id
									var to_user_id = $(this).attr("data-to_user_id") 
									//被评论的评论id
									var to_commit_id = $(this).attr("data-to_commit_id")  
									//帖子id
									var friend_news_id = $(this).attr("data-friend_news_id")
									mui.openWindow({
									    url:"repComment.html",
									    id:"repComment",
									    show:{ 
									      aniShow:"slide-in-bottom",//页面显示动画，默认为”slide-in-right“；
									      duration:"300"//页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
									    },
									     waiting:{
									      autoShow:false,//自动显示等待框，默认为true
									    },
									    extras:{
									    	to_user_id:to_user_id,friend_news_id:friend_news_id,to_commit_id:to_commit_id
									    }
									})
								})
								
							 	//内部评论
								$(".cocmt").click(function() { 
									event.stopPropagation(); 
									openview({
										view: "innerComment.html",
										id:"innerComment",
										extrasobj: {
											innercmtid: $(this).attr("data-cmtid")
										}
									})
								}) 
							}
			 
						} 
						
						
						
						plus.nativeUI.closeWaiting(); //关闭等待框
					},
					error:function(xhr,type,errorThrown){
						plus.nativeUI.closeWaiting(); 
						console.log('响应失败  !');
					}
					 
	        	})
			}
		
		
		    //评论者 主页
		    window.gocmterPage = function(userId){
		    	event.stopPropagation()
		    	if(userId == myuserid){
		    		openview({
						view: "../centerPage.html",
						id:"centerPage",
						extrasobj: {
							userId: userId
						}
					})
		    	}else{
		    		openview({
						view: "../othersPage.html",
						id:"othersPage",
						extrasobj: {
							userId: userId
						}
					})
		    	}
				
			}
		})
		
		mui.previewImage();
	</script>

</html>