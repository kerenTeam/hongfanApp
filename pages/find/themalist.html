<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>专题</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css"> 
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" href="../../css/reset.css"> 
		
		<style type="text/css">
			 
			 .fTxt{
			 	font-size: 0.11rem;
			 	padding: 5px;
			 	color: rgba(0,0,0,0.8);
			 	height: 0.32rem;
			 	letter-spacing: 1px;
			 	line-height: 1.2;
			 	/*超出两行省略*/
			 	display: -webkit-box;
				-webkit-box-orient: vertical;
				-webkit-line-clamp: 2;
				overflow: hidden;

			 }
			 .findUser{
			 	padding: 5px;
			 }
			 .findUser img{
			 	width: 0.3rem!important;
			 	height: 0.3rem;
			 	border-radius: 50%!important;
			 	margin-right: 5px;
			 	/*vertical-align: middle!important;*/
			 } 
			 .findUser span{
			 	color: rgba(0,0,0,0.6);
			 	line-height: 0.3rem;
			 }
			 .jointheame{
				text-align: center;
				position: fixed;
				bottom: 2%;
				background: coral;
				font-size: 0.12rem;
				color: white;
				width: calc(0.12rem + 25px + 14px);
				padding: 7px 0;
				border-radius: 50%;
				left: 50%;
				-webkit-transform: translateX(-50%);
				z-index: 1;
			}
			.jointheame img{
				width: 25px;
				margin: auto;
				display: block;
			}
			 #mainpic {
			 	/*background-color: rgba(255,255,255,0.7);*/
			 	-webkit-column-count: 2;
			 	-moz-column-count: 2;
			 	column-count: 2;
			 	-moz-column-gap: 10px;
			 	-webkit-column-gap: 10px;
			 	column-gap:10px;
			 	padding: 10px;
			 }
			 
			 .boxf {
			 	-webkit-column-break-inside: avoid;
			 	border:none; 
			 	margin-bottom: 10px;
			 	cursor: pointer;
			 	background-color: #fff;
			 	border-radius: 2px;
			 }
			 
			 .boxf img {
			 	width: 100%;
			 	vertical-align: top;
			 	border-radius: 2px;
			 }
			 
			 @media (min-width: 600px) {
			 	#mainpic {
			 		-webkit-column-count: 2;
			 		-moz-column-count: 2;
			 		column-count: 2;
			 	}
			 }
			 
			 @media (min-width: 1000px) {
			 	#mainpic {
			 		-webkit-column-count: 3;
			 		-moz-column-count: 3;
			 		column-count:3;
			 	}
			 }
			 .theameContent{
			 	/*position: fixed;*/
			 	top: 0;
			 	
			 }
			 #toppic{
			 	width: 100%;
			 }
			 .contentinfo{
			 	line-height: 2;
			 	padding: 10px;
			 	background: white;
			 }
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-transparent">
			<a id="leftbtn" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 id="centertitle" class="mui-title"></h1>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="nulldiv" style="padding-top: 50%;text-align:center;font-size: 14px;color: #999;display: none;">
			<img style="width: 30%;margin-bottom: 5%; " src="../../img/unllfabu.svg"/>
			<br />
			没有可用信息
		</div>
		<div class="theameContent">
			<img src="" id="toppic" alt="" />
			<div class="contentinfo"></div>
		</div>
		<div id="main" style="margin-top: 10px;">
			
	 		<div id="mainpic" style="display: block;">
	 		 
			</div>
			<script type="text/html" id="infolist"> 
				<% for(var i=0,leni=list.length; i<leni; i++){%>
					<div class="boxf" onclick="findInfo('<%=list[i].user_id%>','<%=list[i].news_id%>','<%=list[i].avatar%>','<%=list[i].nickname%>')">
						<div class="pic"> 
							<% if(list[i].pic.indexOf('http')>-1){%>
								<img src="<%= list[i].pic%>" data="<%= list[i].pic%>" onerror="this.src = '../../img/zhaoxiangji.svg'">
							<% }else{%>
								<img src="<%= url+list[i].pic%>" data="<%= url+list[i].pic%>" onerror="this.src = '../../img/zhaoxiangji.svg'"><!--<img src="../../img/market/m1.jpg">-->
							<% }%>	
							
							<p class="fTxt"><%= list[i].content%></p>
							<div class="findUser">
								<img src="<%= list[i].avatar%>" data="<%= list[i].avatar%>" onerror="this.src = '../../img/zhaoxiangji.svg'" /><span><%= list[i].nickname%></span> 
							</div>
						</div>
					</div>
				<% }%>	
			</script> 
			<div class="jointheame">
				<img src="../../img/market/addtheme.svg"/>
				发布
			</div>
		</div>	
	</body>
<script type="text/javascript" src="../../js/jquery.min.js"></script>  
<script src="../../js/mui.min.js"></script> 
<script src="../../js/app.js"></script>
<!--引入模板引擎-->
<script src="../../js/artTemplate-native.js"></script>	
<script type="text/javascript">
	
	mui.plusReady(function(){
		var oldtoken = plus.storage.getItem('oldToken');
		var myuserid = plus.storage.getItem('userid');
		var q_id = plus.webview.currentWebview().qid;
		plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});
		document.getElementsByClassName("jointheame")[0].onclick = function(){
			console.log(q_id)
			openview({
				view:"../publish.html",
				id:"publish",
				extrasobj:{qqid:q_id}
			})
		}
		//请求专题详情api/news/activityinfo
		mui.ajax(serverUrl+'/api/news/activityinfo',{//请求id列表
			data:{"q_id":q_id},
			dataType:'json',
			type:'post',
			timeout:10000,
			headers:{"token":oldtoken},
			success:function(data,type,xhr){ 
				console.log('内容 ',data);
				
				if(data.errno==0){
					var dataobj = {};
					 if(data.data.pic){
					 	$("#toppic").attr('src',serverimgUrl+data.data.pic);
					 	var detailsdom = parseDom(data.data.described);
					 	var detailsimg = detailsdom.getElementsByTagName('img');
							mui.each(detailsimg, function(index, element) {
								console.log(element.src.split('pages/find')[1]);
								element.src = serverimgUrl + element.src.split('pages/find')[1];
								console.log(element.src);
								element.onerror = function() {
									element.src = '../img/market/nodata.svg';
								}
							})
						$('.contentinfo').append(detailsdom)
					 	
					 }
				}else{
					mui.toast('当前网络不好，请重试！');	
				}
				plus.nativeUI.closeWaiting();
			},
			error:function(xhr,type,errorThrown){
				mui('#nulldiv')[0].style.display = 'block';
				mui.toast('当前网络不好，请重试！');
				console.log('登录响应失败');
			}
		});
		
		
		
		mui.ajax(serverUrl+'/api/news/actnewslist',{//请求id列表
			data:{"q_id":q_id},
			dataType:'json',
			type:'post',
			timeout:10000,
			headers:{"token":oldtoken},
			success:function(data,type,xhr){ 
				console.log('列表',data);
				if(data.errno==0){
					var dataobj = {};
					if(data.data.length){
						mui.each(data.data,function (index,element) {
							if(element.pic){
								if(element.pic.indexOf('http') == -1){
									if(element.pic.indexOf('picImg') > -1)
									element.pic = JSON.parse(element.pic)[0].picImg;
									console.log(element.pic);  

								}
							} 
							if(element.avatar.indexOf("[")!=-1){
								element.avatar =serverimgUrl + JSON.parse(element.avatar)[0].picImg;
							}
						})
						dataobj.list = data.data;
						dataobj.url = serverimgUrl;
						mui('#mainpic')[0].innerHTML += template('infolist',dataobj);
					}else{
//						mui('#nulldiv')[0].style.display = 'block';
					}
				}else{
//					mui('#nulldiv')[0].style.display = 'block';
					mui.toast('当前网络不好，请重试！');	
				}
				plus.nativeUI.closeWaiting();
			},
			error:function(xhr,type,errorThrown){
				plus.nativeUI.closeWaiting();
				mui('#nulldiv')[0].style.display = 'block';
				mui.toast('当前网络不好，请重试！');
				console.log('登录响应失败');
			}
		});
	})	
	
	function findInfo(userid,newsid,avtar,nickname){ 
		openview({
			view: "findInfo.html",
			id:"findInfo",
			extrasobj: {
				userId: userid,newsId:newsid,avtar:avtar,nickName:nickname
			}
		})
	}
 	function parseDom(arg) { //节点转换方法
				　　
		var objE = document.createElement("div");　　
		objE.innerHTML = arg;　　
		return objE;
	};s
</script>
</html> 