<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>赞的</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css"> 
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" href="../../css/reset.css"> 
		
		<style type="text/css">
			 
			 .fTxt{
			 	font-size: 0.11rem;
			 	padding: 5px;
			 	color: rgba(0,0,0,0.8);
			 	height: 0.32rem;
			 	letter-spacing: 1px;
			 	line-height: 1.2;
			 	/*超出两行省略*/
			 	display: -webkit-box;
				-webkit-box-orient: vertical;
				-webkit-line-clamp: 2;
				overflow: hidden;

			 }
			 .findUser{
			 	padding: 5px;
			 }
			 .findUser img{
			 	width: 0.3rem!important;
			 	height: 0.3rem;
			 	border-radius: 50%!important;
			 	margin-right: 5px;
			 	/*vertical-align: middle!important;*/
			 } 
			 .findUser span{
			 	color: rgba(0,0,0,0.6);
			 	line-height: 0.3rem;
			 }
			 #mainpic {
			 	/*background-color: rgba(255,255,255,0.7);*/
			 	-webkit-column-count: 2;
			 	-moz-column-count: 2;
			 	column-count: 2;
			 	-moz-column-gap: 10px;
			 	-webkit-column-gap: 10px;
			 	column-gap:10px;
			 	padding: 10px;
			 }
			 
			 .boxf {
			 	-webkit-column-break-inside: avoid;
			 	border:none; 
			 	margin-bottom: 10px;
			 	cursor: pointer;
			 	background-color: #fff;
			 	border-radius: 2px;
			 }
			 
			 .boxf img {
			 	width: 100%;
			 	vertical-align: top;
			 	border-radius: 2px;
			 }
			 
			 @media (min-width: 600px) {
			 	#mainpic {
			 		-webkit-column-count: 5;
			 		-moz-column-count: 5;
			 		column-count: 5;
			 	}
			 }
			 
			 @media (min-width: 1000px) {
			 	#mainpic {
			 		-webkit-column-count: 7;
			 		-moz-column-count: 7;
			 		column-count: 7;
			 	}
			 }
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" id="header"> 
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">我赞过的</h1>
		    <!--<a href="javascript:;" style="line-height: 50px;color:white;" class="fr baocun">发布</a>-->
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="nulldiv" style="padding-top: 50%;text-align:center;font-size: 14px;color: #999;display: none;">
			<img style="width: 30%;margin-bottom: 5%; " src="../../img/unllfabu.svg"/>
			<br />
			没有可用信息
		</div>
		<div id="main">
	 		<div id="mainpic" style="display: none;">
				<!--<div class="boxf" onclick="findInfo()">
					<div class="pic">
						<img src="../../img/market/m1.jpg">
						<p class="fTxt">
							美容彩妆会场，惺惺惜惺惺想
						</p>
						<div class="findUser">
							<img src="../../img/market/market-food.jpg" alt="" /><span>gun's N rose</span> 
						</div>
					</div>
				</div>-->
			</div>
			<script type="text/html" id="infolist"> 
				<div class="boxf" onclick="findInfo('<%=user_id%>','<%=news_id%>','<%= Purl+avatar%>','<%=nickname%>')">
					<div class="pic">
						<% if(pic){%>
							
							<% if(pic.indexOf('http')>-1){%>
								<img src="<%= pic%>" onerror="this.src ='../img/zhaoxiangji.svg'"/>
							<% }else{%> 
								<!--<img src="<%= %>" onerror="this.src ='../img/zhaoxiangji.svg'"/>-->
								<img src="<%= Purl+pic%>" alt="<%= Purl+pic%>" onerror="this.src ='../../img/zhaoxiangji.svg',this.style.height = '100%'"/>
							<% }%>	
						<% }else{%>
							<img src="../../img/market/market-food.jpg" alt="" />
						<% }%>	
						
						<p class="fTxt">
							<%= content%>
						</p>
						<div class="findUser">
							<%if(avatar){%>
								<img src="<%= Purl+avatar%>" alt="" />
							<%}else{ %>
								<img src="../../img/market/market-food.jpg" alt="" />
							<%} %>	
							
							<span><%= nickname%></span> 
						</div>
					</div>
				</div>
			</script>
		</div>	
	</body>
<script type="text/javascript" src="../../js/jquery.min.js"></script>  
<script src="../../js/mui.min.js"></script> 
<script src="../../js/app.js"></script>
<!--引入模板引擎-->
<script src="../../js/artTemplate-native.js"></script>	
<script type="text/javascript">
	mui.plusReady(function(){
		var oldtoken = plus.storage.getItem('oldToken');
		var myuserid = plus.storage.getItem('userid');
		plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});
		mui.ajax(serverUrl+'/api/news/newslike',{//请求id列表
				data:{"userid":myuserid},
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldtoken},
				success:function(data,type,xhr){
					console.log('我的喜欢返回',data);
					if(data.errno==0){
						if (data.data.mylikenews.length) {//请求id列表
							var idArray = [];
							mui.each(data.data.mylikenews,function (index,element) {
								idArray.push(element.newsid);
							})
							console.log(idArray);
							var numload = 0;
							mui.each(idArray,function (index,element) {//遍历详情
								console.log('我是遍历'+element);
								mui.ajax(serverUrl+'/api/news/newsinfo',{
									data:{newsid:element}, 
									dataType:'json',
									type:'post',
									timeout:10000,
									headers:{"token":oldtoken},	 
									success:function(data,type,xhr){
										numload++;
										console.log('我是请求成功');
										if(data.data.newsinfodata.length){
											var dataobj = data.data.newsinfodata[0]; 
											console.log('数据',dataobj);
											if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(dataobj.nickname)){
												dataobj.nickname = dataobj.nickname.substring(0,3)+"****"+dataobj.nickname.substring(7,11)
											}
											if(dataobj.pic && dataobj.pic!="undefined" && dataobj.pic.indexOf('picImg')>-1) {
												dataobj.pic = JSON.parse(dataobj.pic)[0].picImg;
											} 
											dataobj.Purl = serverimgUrl;
											dataobj.avatar = JSON.parse(dataobj.avatar)[0].picImg;
											var html=template("infolist",dataobj);
											document.getElementById("mainpic").innerHTML += html;
										} 

										
										console.log(numload);
										
										if(numload == idArray.length){//铺完后关闭loading
											console.log('我是最后一次');
											mui('#mainpic')[0].style.display = 'block';
											var time1 = setTimeout(function(){
												plus.nativeUI.closeWaiting();
											},500)
										} 
									},
									error:function(xhr,type,errorThrown){
										numload++;
										if(numload == idArray.length){//铺完后关闭loading
											console.log('我是最后一次')
											mui('#mainpic')[0].style.display = 'block';
											var time1 = setTimeout(function(){
												plus.nativeUI.closeWaiting();
											},500)
										} 
										mui.toast('一条加载失败,请重试');
									}
								});
							})
						} else{//没有数据
							mui('#nulldiv')[0].style.display = 'block';
						}
					}else{
						plus.nativeUI.closeWaiting();
						mui('#nulldiv')[0].style.display = 'block';
						mui.toast('当前网络不好，请重试！');	
					}
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();
					mui('#nulldiv')[0].style.display = 'block';
					mui.toast('当前网络不好，请重试！');
					console.log('登录响应失败');
				}
			});
	})	
	
	function findInfo(userid, newsid, avtar, nickname){ 
		openview({
			view: "findInfo.html",
			id:"findInfo",
			extrasobj: {
				userId: userid,
				newsId: newsid,
				avtar: avtar,
				nickName: nickname
			}
		})
	}
 
</script>
</html> 