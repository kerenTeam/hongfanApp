<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>被赞</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no"> 
		<link rel="stylesheet" type="text/css" href="../../css/common.css"> 
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" href="../../css/reset.css">  
	</head>
	<style type="text/css">
            .userAvator{  
				width: 0.4rem;  
				height: 0.4rem;  
				border-radius: 50%;
				margin-right: 10px;
			}
			 .follow{
				position: relative;
				background-color: white;
				text-align: center;
				display: flex;
				align-items: center;
				padding:10px 15px;
				justify-content: space-between;
			} 
			 
			 .follow:after{
			 	position: absolute;
			 	content: '';
			 	height: 1px;
			 	left: 10px;
			 	right: 10px;
				-webkit-transform: scaleY(.3);
				background: #CACACA;
				bottom: 0;
			 }
			 .follow:last-child:after{
			 	position: absolute;
			 	content: '';
			 	height: 0px;
			 	left: 10px;
			 	right: 10px;
				-webkit-transform: scaleY(.3);
				background: #CACACA;
				bottom: 0;
			 }
			.fllmg{ 
				height: 0.45rem;
				width: 0.45rem; 
			}
			
			.fchidl{
				font-size: 0.12rem;
				/*color: darkgray;*/
			}
			.fchidl img{
				/*vertical-align: middle;*/
			}
			.fchidl>div{
				vertical-align: middle;
				display: inline-block;
			    font-size: 0.11rem;	
			    text-align: left; 
			 }
		 .fchidl>div span{
		 	color: cadetblue;
		 	font-size: 0.11rem;
		 }
		 .fchidl>div small{
		 	color: #C0C0C0; 
		 	position: absolute;
		 	right: 10px;
		 	bottom: 10px;
		 }
	</style>

	<body>

		<header class="mui-bar mui-bar-nav">
		    <a class="headbar mui-action-back mui-icon mui-icon-left-nav mui-pull-left normalSize"></a>
		    <h1 class="mui-title" id="confirmbtn1">被赞</h1> 
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		
		<div id="nulldiv" style="padding-top: 50%;text-align:center;font-size: 14px;color: #999;display: none;">
			<img style="width: 30%;margin-bottom: 5%; " src="../../img/unllfabu.svg"/>
			<br />
			还没收到赞
		</div>
		<div id="main">
			<!--<div class="follow"> 
				<div class="fchidl">
					<img src="../../img/market/ag.jpeg" class="userAvator" />
					<div> 到底发生的<br><br><span>赞了</span> 你的帖子  <small>2017-01-21 08:12</small></div>
				</div>
				<img src="../../img/market/feg3.png" class="fllmg" alt="" />
			</div>-->
		</div>
		<script type="text/html" id="infolist"> 
			<% for(var i=0; i<mynewsliker.length; i++){%>
				<% for(var j=0; j<likerInfo.length; j++){%>
					<%if(mynewsliker[i].like_user_id == likerInfo[j].user_id){%> 
						<div class="follow" onclick="opendetaile('<%=mynewsliker[i].userid%>','<%=mynewsliker[i].newsid%>','<%= myavater%>','<%=nickname%>')"> 
							<div class="fchidl">
								<%if(likerInfo[j].avatar){ %>
									<img src="<%= url+likerInfo[j].avatar%>" class="userAvator" />
								<%}else{ %>
									<img src="../../img/market/ag.jpeg" class="userAvator" />
								<%} %>	
								<div> <%= likerInfo[j].nickname%><br><br><span>赞了</span> 你的帖子  <small><%= mynewsliker[i].create_time.split('T')[0]%></small></div>
							</div> 
							<!--<img src="../../img/market/feg3.png" class="fllmg" alt="" />-->
						</div>
						<% break; %>
					<%}%>	
				<% }%>
			<% }%>	
		</script>
		
		 
	</body>
<script type="text/javascript" src="../../js/jquery.min.js"></script>
<script src="../../js/mui.min.js"></script>
<script src="../../js/app.js"></script>
<script src="../../js/artTemplate-native.js"></script>
<script type="text/javascript">
	mui.plusReady(function(){
		var oldtoken = plus.storage.getItem('oldToken');
		var myuserid = plus.storage.getItem('userid');
		plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});
		mui.ajax(serverUrl+'/api/news/newslike',{
				data:{"userid":myuserid},
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldtoken},
				success:function(data,type,xhr){
					console.log('赞返回',data);
					if(data.errno==0){
						if (data.data.mynewsliker.mynewsliker.length) {
							var dataobj = {};
							dataobj.url = serverimgUrl;
							dataobj.mynewsliker = data.data.mynewsliker.mynewsliker;
							mui.each(data.data.mynewsliker.likerInfo,function (index,element) {
								if(element.avatar && element.avatar.indexOf('picImg')>-1){
									element.avatar = JSON.parse(element.avatar)[0].picImg;
								}else if(element.avatar){
									element.avatar = element.avatar;
								}
								if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(element.nickname)){
									element.nickname = element.nickname.substring(0,3)+"****"+element.nickname.substring(7,11)
								}
								
							})
							console.log(data.data.mynewsliker.likerInfo);
							dataobj.likerInfo = data.data.mynewsliker.likerInfo; 
							mui.ajax(serverUrl+'/api/useraccount/userinfo',{
								data:{"userid":myuserid},
								type:'post',
								timeout:10000,
								headers:{"token":oldtoken},	              				
								success:function(data,type,xhr){
									console.log('获取用户数据返回'+JSON.stringify(data));
									if(data.errno == 0){
										//头像
										 
										if(data.data[0].avatar && data.data[0].avatar.indexOf("[{")!=-1){
											var myavater = serverimgUrl + JSON.parse(data.data[0].avatar)[0].picImg;
										}
										//昵称
										if(data.data[0].nickname != ' '){ 
											if(data.data[0].nickname.indexOf('null') == -1){
												nickname = data.data[0].nickname;
											}else{
												nickname = data.data[0].nickname.substring(0,3)+"****"+data.data[0].nickname.substring(7,11);
											}
										}else{
											nickname = data.data[0].nickname.substring(0,3)+"****"+data.data[0].nickname.substring(7,11);
										}
										 
										dataobj.myavater = myavater;
										dataobj.nickname = nickname;
										var html=template("infolist",dataobj);
										document.getElementById("main").innerHTML = html;
									}else{
										mui.toast('获取用户信息失败'); 
										console.log(data.errmsg);
									}
								},
								error:function(xhr,type,errorThrown){
									console.log('获取用户数据,响应失败');
								}
							});
							
						} else{//没有数据
							mui('#nulldiv')[0].style.display = 'block';
						}
						plus.nativeUI.closeWaiting();
					}else{
						plus.nativeUI.closeWaiting();
						mui('#nulldiv')[0].style.display = 'block';
						mui.toast('当前网络不好，请重试！');	
					}
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();
					mui('#nulldiv')[0].style.display = 'block';
					mui.toast('当前网络不好，请重试！');
					console.log('登录响应失败');
				}
			});
	})
	function opendetaile(user, newsid, avtar, nickname){ 
		openview({
			view:'findInfo.html',
			id:"findInfo",
			extrasobj:{
				userId: user,
				newsId: newsid,
				avtar: avtar,
				nickName: nickname}
		});
	}

	</script>
</html>