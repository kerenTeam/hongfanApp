<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>消息</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../css/common.css"> 
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<link rel="stylesheet" href="../css/reset.css"> 
		<link rel="stylesheet" href="../css/fontello.css"> 
		<script type="text/javascript" src="../js/jquery.min.js"></script>  
		<script src="../js/mui.min.js"></script> 
		<script src="../js/app.js"></script>
		<!--引入模板引擎-->
		<script src="../js/artTemplate-native.js"></script>
		<style type="text/css">
			 #main{
			 	background: white;
			 }
			.message{
				position: relative;
				display: flex;
				padding: 15px 0;
				align-items: center;
			}
			.message:after{
				position: absolute;
				content: '';
				height: 1px;
				background: #CCCCCC;
				left: 0.7rem;
				bottom: 0;
				right: 0;
				-webkit-transform: scaleY(0.3);
			}
			.demo-icon{ 
			    font-size: 20px; 
			    position: relative;
			    top: -14px;
			}
			html{background-color: #fff;}
			.message .msgIcon{
				flex-basis:0.7rem;
				text-align: center;
				position: relative;
			}
			.msgIcon b{
			    position: absolute;
			    height: 7px;
			    width: 7px;
			    background-color: red;
			    border-radius: 50%;
			    display: none; 
			}
			.message img{ 
				width: 0.22rem;
			}
			.message .mui-icon{
			 	padding-right: 10px;
			 	color: tomato;
			}
			.msgtxt{
			 	 /*padding-left: 5px;*/
			 	 flex-grow : 1
			 } 
			 .mui-bar-tab a{
			 	color: #666;
				display: table-cell;
				vertical-align: bottom;
				text-align: center;
			}
			
			</style>
		</head> 
	
		<body>
			<header class="mui-bar mui-bar-nav" id="header"> 
			    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
			    <h1 class="mui-title findUser">消息</h1>
			    <!--<a href="javascript:;" style="line-height: 50px;color:white;font-size: 25px;" class="fr baocun">+</a>-->
			</header>
			<script src="../js/statusBar.js"></script>
			<!--状态栏-->
			<!--<div id="container">-->
			<div id="main"> 
				<div class="message msgcmt">
				 	<div class="msgIcon"><img src="../img/center/comments.svg"/> <b class="reddian1"></b> </div>
				 	<div class="msgtxt"><span style="vertical-align: middle;">评论</span></div>
				 	<!--<span class="mui-badge mui-badge-danger">5</span>-->
				 	<span class="mui-icon mui-icon-arrowright"></span>
				</div>
				<div class="message msglike">
				 	<div class="msgIcon"><img src="../img/center/like.svg"/> <b class="reddian1"></b></div>
				 	<div class="msgtxt"><span style="vertical-align: middle;">赞的</span></div>
				 	<!--<span class="mui-badge mui-badge-danger">1</span>-->
				 	<span class="mui-icon mui-icon-arrowright"></span>
				</div>
				<div class="message msgchat">
				 	<div class="msgIcon"><img src="../img/center/chat.svg"/> <b class="reddian1"></b></div>
				 	<div class="msgtxt"><span style="vertical-align: middle;">私信</span></div>
				 	<!--<span class="mui-badge mui-badge-danger">1</span>-->
				 	<span id="" class="mui-icon mui-icon-arrowright"></span>
				</div> 
			<!--底部导航-->
			 
			<nav class="mui-bar mui-bar-tab">
				<a onclick="gopage('Follow')">
					<!--<span class="mui-icon mui-icon-eye"></span>-->
					<i class="demo-icon icon-heart"></i>
					<!--<span class="mui-tab-label">关注</span>-->
				</a>
				<a onclick="gopage('find')">
					<!--<span class="mui-icon mui-icon-pengyouquan"></span>-->
					<i class="demo-icon icon-search"></i>
					<!--<span class="mui-tab-label">广场</span>-->
				</a>
				<a onclick="gopage('publish')">
					<!--<span class="mui-icon mui-icon-camera"></span>-->
					<i class="demo-icon icon-camera"></i> 
					<!--<span class="mui-tab-label">消息</span>-->
				</a>
				<a class="subActive" style="position: relative;">
					<!--<span class="mui-icon mui-icon-chat">-->
						<i class="demo-icon icon-comment"></i>
	                	<!--<span class="mui-badge mui-badge-danger">6</span>-->
	                	<b id="redDot4" class="redDot" style="position: absolute;"></b>
				</a>
				<a onclick="gopage('centerPage')">
					<!--<span class="mui-icon mui-icon-person"></span>-->
					<i class="demo-icon icon-user"></i>
					<!--<span class="mui-tab-label">个人主页</span>-->
				</a>
			</nav>
		</div>	
			
	</body>
    <script type="text/javascript">
    	var falg = false; 
    	document.addEventListener('clearRed', function() {
			document.getElementsByClassName('redDot')[0].style.display = 'none';
		})
    	document.addEventListener('clearRedS', function() {
			mui('.reddian1')[2].style.display = 'none'; 
		})
    	showRedfun();//显示底部小红点
    	mui.plusReady(function(){//显示分类小红点
    		var oldtoken = plus.storage.getItem('oldToken');
			var myuserid = plus.storage.getItem('userid');
    		if(plus.storage.getItem('commentH')){//显示评论小红点 
	    		mui('.reddian1')[0].style.display = 'inline-block'; 
	    	}else{
	    		mui.ajax(serverUrl+'/api/news/message',{ 
					data:{"userid":myuserid},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"token":oldtoken},
					success:function(data){
						if(data.data && data.data.length){
							mui.each(data.data,function (index,element) {
			 					if(element.read_state){//有评论未读
			 						plus.storage.setItem("commentH",'yes');//私信标杆
			 						document.getElementsByClassName('redDot')[0].style.display = 'inline-block';
			 						mui('.reddian1')[0].style.display = 'inline-block'; 
			 						return false;
			 					}
							})
						}
					}
				});
	    	}
    		if(plus.storage.getItem('likeH')){//显示赞小红点 
	    		mui('.reddian1')[1].style.display = 'inline-block'; 
	    	}else{
	    		mui.ajax(serverUrl+'/api/news/newslike',{
					data:{"userid":myuserid},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"token":oldtoken},
					success:function(data){ 
						console.log(data);
						if(data.errno == 0 && data.data.mynewsliker && data.data.mynewsliker.mynewsliker.length){
							mui.each(data.data.mynewsliker.mynewsliker,function (index,element) {
								console.log(1)
			 					if(element.read_state){//有评论未读 
			 						plus.storage.setItem("likeH",'yes');//私信标杆
			 						document.getElementsByClassName('redDot')[0].style.display = 'inline-block';
			 						mui('.reddian1')[1].style.display = 'inline-block'; 
			 						return false;
			 					}
							})
						}
					}
				});
	    	}
    		if(plus.storage.getItem('PletterH')){//显示私信小红点 
	    		mui('.reddian1')[2].style.display = 'inline-block'; 
	    	}else{
	    		mui.ajax(serverUrl+'/api/news/hasnewmsg',{
					data:{"userid":myuserid},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"token":oldtoken},
					success:function(data){
						if(data.data && data.data.length){
							mui.each(data.data,function (index,element) {
			 					if(element.isnew){//有私信未读
			 						plus.storage.setItem("PletterH",'yes');//私信标杆
			 						document.getElementsByClassName('redDot')[0].style.display = 'inline-block';
			 						mui('.reddian1')[2].style.display = 'inline-block'; 
			 						return false;
			 					}
							})
						}
					}
				});
	    	}
    	})
    	
    	
    	//安卓返回键
//	    mui.init({
//	        beforeback: function(){
//	             backindex();
//	            return false; 
//	        }
//	    });
        function backindex(){ 
	    	falg = true;
	        //获得主页面的webview 
	        var appIndex = plus.webview.getLaunchWebview();
	        var mainweb = plus.webview.getWebviewById('main.html');
	        //触发主页面的gohome事件
	        mui.fire(appIndex,'gohome',{hrefid:'defaultTab'});
	        plus.webview.show(appIndex,"fade-in",500);
	        plus.webview.show(mainweb,"fade-in",500); 
	        if(plus.webview.getWebviewById('Follow')){
	        	plus.webview.getWebviewById('Follow').close();
	        }
	        if(plus.webview.getWebviewById('message')){
	        	plus.webview.getWebviewById('message').close();
	        }
	        if(plus.webview.getWebviewById('centerPage')){
	        	plus.webview.getWebviewById('centerPage').close();
	        }
	        if(plus.webview.getWebviewById('find')){
	        	plus.webview.getWebviewById('find').close();
	        }
	    	plus.webview.currentWebview().close();
	        
	    }
        //导航切换
	  	function gopage(page){ 
	  		event.preventDefault();
	  		function fotrue(){
		  		if(plus.webview.getWebviewById(page)){
		        	plus.webview.show(page,"fade-in",300);
		        	plus.webview.currentWebview().hide();
		        }else{
		        	openview({
						view:page+'.html',
						id:page
					});
		        }
	  		}
	  		if(page == 'find'){
	  			fotrue();
	  		}else{
	  			if(plus.storage.getItem('myToken')){
	  				fotrue();
	  			}else{
	  				mui.toast('请登录');
					openview({
						view:'login.html'
					});
	  			}
	  		}
	  	}
 
	 
	    $(".msgcmt").click(function(){
	    	mui('.reddian1')[0].style.display = 'none'; 
	    	openview({
				view: "find/cmted.html",
				extrasobj: {
					userId: 1
				}
			})
	    }) 
	    $(".msglike").click(function(){ 
	    	mui('.reddian1')[1].style.display = 'none';
	    	openview({
				view: "find/liked.html",
				extrasobj: {
					userId: 1
				}
			})
	    }) 
	    $(".msgchat").click(function(){ 
	    	openview({
				view: "find/response.html"
			})
	    })
    </script>
</html> 