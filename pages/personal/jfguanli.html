<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>积分管理</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/hmt.js" type="text/javascript"></script>
		<script src="../../js/mui.min.js" type="text/javascript"></script>
		<script src="../../js/app.js" type="text/javascript"></script>
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js" type="text/javascript"></script>
		<style type="text/css">
			.account .top{
				background-color: #932427 !important;
			}
		</style>
	</head>
	<body>
		<header class="hasManyCity hasManyCitytwo" id="header">
			<a class="fl fanhui mui-action-back"><i class="iconfont icon-fanhui"></i></a>
			<div class="header-tit">
				积分管理
			</div>		
		</header>
	    <!--header end-->
	    <div id="container">		
			<div id="main">
			    <div class="warp warpthree clearfloat">
			    	<div class="account clearfloat">
			    		<div class="top clearfloat">
			    			<ul>
			    				<li class="box-s">操作时间</li>
			    				<li style="text-align: left;">操作详情</li>
			    				<li style="text-align: right;padding-right: 10px;">操作积分</li>
			    			</ul>
			    		</div>
			    		<div class="list clearfloat box-s" id="operationList">
			    			
			    		</div>	    		
			    	</div>
			    </div>
			</div>
		</div>
		
		<!--模板铺数据-->
		<script id="operationList-detail" type="text/html">
			<% for(var i=0;i<scoreList.length;i++){ %>
				<div class="shang clearfloat">
					<ul>
	    				<li class="box-s"><%= scoreList[i].create_time.split('T')[0] %></li>
	    				<li style="text-align: left;"><%= scoreList[i].notice %></li>
	    				<li style="text-align: right;"><%= scoreList[i].intergral_float %></li>
	    			</ul>
				</div>
			<% } %>
			<div class="bottom clearfloat">
				<span class="fl" id="thisTime"></span>
				<p class="fr">剩余积分：<span id="userScore"></span></p>
			</div>
		</script>
	</body>
	<!--模板引擎获取数据-->
	<script type="text/javascript" charset="utf-8">
      	mui.init();
		mui.plusReady(function(){
			//判断是否登录并获取缓存token
			if(plus.storage.getItem('myToken')){
				var oldToken = plus.storage.getItem('oldToken');
			}else{
				mui.toast('请登录！');
				openview({
					view:'../login.html'
				})
			}
			var myuserid = plus.storage.getItem('userid');
			console.log(oldToken);
			//积分列表
			mui.ajax(serverUrl+'/api/useraccount/userinfo',{
				data:{"userid":myuserid},
				type:'post',
				timeout:10000,
				headers:{"token":oldToken},	              				
				success:function(data,type,xhr){
//					alert(JSON.stringify(data.data));
					var scoreObj = {};
					scoreObj.scoreList = data.data;
					var html = template('operationList-detail', scoreObj);
					document.getElementById('operationList').innerHTML = html;
					
					//获取当前时间
					var date = new Date();
					var time = date.getFullYear() + '-' + date.getMonth() + '-' + date.getDate() + ' ' + date.getHours() + ':' + date.getMinutes();
					$('#thisTime').html(time);
//					alert(time);
				},
				error:function(xhr,type,errorThrown){
					alert('响应失败  !');
				}
			});

			//积分余额
			mui.ajax(serverUrl+'/api/useraccount/userinfo',{
				data:{"userid":myuserid},
				type:'post',
				timeout:10000,
				headers:{"token":oldToken},	              				
				success:function(data,type,xhr){
					$('#userScore').html(data.data[0].intergral);
				},
				error:function(xhr,type,errorThrown){
					alert('响应失败  !');
				}
			});
			
			
			
		})
    </script>
</html>

