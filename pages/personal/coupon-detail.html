<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>优惠券详情</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/mui.min.js" type="text/javascript"></script>
		<script src="../../js/app.js" type="text/javascript"></script>
		<script src="../../js/artTemplate-native.js" type="text/javascript"></script>
		<style type="text/css">
			.member .list .top .zuo{
				width: 100%;
				border-radius: 0;
				height: auto;
				-webkit-border-radius: 0;
			}
			.member .list .top .zuo img{
				max-height: none;
				max-width: 100%;
			}
			.member .list{
				height: inherit;
			}
			.member .list .top p.tit {
				font-size: 17px;
				margin-left: 5%;
			}
			.second{
				padding-top: 10px !important;
			}
			.member .list .bottom{
				border-top: 1px solid #efeff4;
			}
			.title{
				text-align: center;
				line-height: 35px;
				position: relative;
			}
			.limit{
				text-align: left;
				padding-left: 10%;
				line-height: 20px;
				margin: 12px 0;
			}
			.limit p{
				font-size: 13px !important;
			}
			.bage{
			    display: inline-block;
			    border: 1px solid #EC971F;
			    line-height: 10px;
			    font-size: 10px !important;
			    padding: 3px 5px;
			    border-radius: 11px;
			    color: #EC971F;
			    position: absolute;
				top: 0;
				right: 10px;
			}
			.mui-bar-nav{box-shadow: none !important;}
			body{background-color: #f3f3f3;}
			.member{padding: 8%;}
			.member .list{background: url(../../img/center/youhuijuankuang.png) 0 0 no-repeat;background-size: 100% 100%; }
			.mui-content-padded {
			    margin: 8%;margin-top: 0;
			}
			.h3div{font-size: 17px;color: #333;margin-top: 5%;}
			.limit, .limit p{color: #666;}
			.zhuangtai{color: #999; width: 80px;margin: 0 auto;text-align: center;padding: 8px 0;background: url(../../img/center/shixiao.png) 0 0 no-repeat;background-size: 100% 100%;margin-bottom: 5%; }
			.keyong{color: #555;}
		</style>
	</head>
	<body>
	<!--header star-->
	<header class="mui-bar mui-bar-nav fineB">
	    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
	    <h1 class="mui-title">优惠券详情</h1>  
	</header>
	<script src="../../js/statusBar.js"></script><!--状态栏-->
    <!--header end-->
    <div id="container">
		<div id="main">
			<!--<div class="member clearfloat box-s" id="memberList">
				<div class="list clearfloat fl box-s">
					<div class="title">
						<p class="bage">去哪儿网</p>
						<h3>20元活动券</h3>
						<div class="limit">
							<p>使用条件：满100减20</p>
							<p>可用时间：2015-5-15到2017-5-30</p>
						</div>
					</div>
					<div class="top clearfloat box-s">
						<div class="zuo clearfloat fl">
							<img src="../../img/tou.png"/>
						</div>
					</div>
				</div>
			</div>-->
		</div>
	</div>
		
		<!--渲染数据-->
		<script type="text/html" id="main-detail">
			<div class="member clearfloat box-s" id="memberList">
				<div class="list clearfloat fl box-s">
					<div class="title">
						 
						<div class="limit">
							<p>
								使用条件：
								<% if(couponList.title!=null && couponList.title!=' '){ %>
									<%= couponList.title %>
								<% }else{ %>
									通用
								<% } %>
							</p>
							有效时间：<%= couponList.begin_date %>到<%= couponList.end_date %>
						</div>
					</div>
					<div class="top clearfloat box-s">
						<div class="zuo clearfloat fl">
							<div class="qrcode mui-content-padded" id="svgdiv">
								<img src="" data-preview-src="" data-preview-group="1"  />
							</div>
						</div>
					</div>
					<% if(couponList.state == 1){ %>
						<p class="zhuangtai keyong">可使用</p>
					<% }else{ %>
						<p class="shixiao zhuangtai">已失效</p>
					<% } %>
				</div>
				
			</div>
		</script>
	</body>
	<script type="text/javascript" charset="utf-8">
		mui.plusReady(function(){
			//获取缓存
			//铺数据
			plus.nativeUI.showWaiting();
			
			var cityNum = plus.storage.getItem('cityNum'),
				couponId = plus.webview.currentWebview().couponId,
				myuserid = plus.storage.getItem('userid'),
				oldToken = plus.storage.getItem('oldToken');
			showData();
			function showData(){
			 	mui.ajax(serverUrl+'/api/index/couponlist',{
					data:{userId:myuserid,type:5},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers: {"token": oldToken,'city': cityNum},	 
					success:function(data,type,xhr){
						console.log('列表',data);				
						var dateObj={}; 
						if(data.data && data.data.length){
							for(var i = 0;i < data.data.length;i++){
								if(data.data[i].id == couponId){
									var coupon = {};
									coupon.couponList = data.data[i]; 
									var html = template('main-detail',coupon);
									document.getElementById('main').innerHTML = html;
									mui('#svgdiv')[0].innerHTML = data.data[i].qrcode;
		
								}
							}
							 
						} 
						plus.nativeUI.closeWaiting();
					},
					error:function(xhr,type,errorThrown){
						plus.nativeUI.closeWaiting();
						mui.toast('响应失败')
						console.log('响应失败  !');
					}
				});	
			}
			 
		})
    </script>
</html>
