<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>新增地址</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../js/jquery.flexslider-min.js"></script>
		<script src="../../js/hmt.js" type="text/javascript"></script>
		<script src="../../js/mui.min.js" type="text/javascript"></script>
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js" type="text/javascript"></script>
		<style type="text/css">
			.data ul li i{
				position: absolute;
				right: 10px;
			}
			.data ul li .shuru{
				margin-bottom: 0;
			}
			.chooseAd{
				text-align: left !important;
			}
			.mui-bar-nav{
				box-shadow: none;
			}
			.mui-bar{
				height: 50px;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			.hasManyCitytwo .baocun{
				font-size: 0.12rem;
			}
			#main{
				margin-top: 50px;
			}
			.toggle--off{
				background-color: #f53c42 !important;
			}
		</style>
	</head>
	<body>
		<!--header star-->
		<header class="mui-bar mui-bar-nav hasManyCity hasManyCitytwo">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize fl fanhui"></a>
		    <div class="header-tit">
				新增地址
			</div>
			<a href="#" class="fr baocun">保存</a>
		</header>
		<div id="container">
		    <div id="main" class="mui-clearfix add-address">
		    	<div id="thisAddLi"></div>
		    	<div class="plist clearfloat data">
					<ul>
						<li class="clearfloat">
							<a href="#">
								<p class="fl">收货人</p>
								<input type="text" class="fr shuru" name="" id="" value="" placeholder="请输入昵称" />
							</a>
						</li>
						<li class="clearfloat">
							<a href="#">
								<p class="fl">联系电话</p>
								<input type="text" class="fr shuru" name="" id="" value="" placeholder="请输入手机号码" />
							</a>
						</li>
						<li class="clearfloat">
							<a href="javascript:;" id="mapAddress">
								<p class="fl">所在地区</p>
								<input type="text" class="fr shuru chooseAd" name="" id="" disabled="disabled"/>
								<i class="fr iconfont icon-jiantou1"></i>
							</a>
						</li>
					</ul>
				</div>
				<textarea name="" rows="4" cols="" placeholder="请填写详细地址，不少于5个字" class="textare box-s"></textarea>
		    	<div class="address-btn clearfloat">
		    		<span class="szwmr fl">设为默认</span>
		    		<a href="#" class="toggle toggle--on fr"></a>
		    	</div>
		    </div>
		</div>
	</body>
	<script type="text/javascript" charset="utf-8">
      	mui.init();
			mui.plusReady(function(){
				//点击添加地址跳转
				var jiantou1 = document.getElementsByClassName('icon-jiantou1')[0];
				jiantou1.addEventListener('tap',function(){
					var url = "mMap.html";
					window.open(url);
				});
				var longitude,longitude;
				//地图定位
				var watchId;
				function geoInf( position ) {
					var str = "";
					str += "地址："+position.addresses+"\n";//获取地址信息
					str += "坐标类型："+position.coordsType+"\n";
					var timeflag = position.timestamp;//获取到地理位置信息的时间戳；一个毫秒数；
					str += "时间戳："+timeflag+"\n";
					var codns = position.coords;//获取地理坐标信息；
					var lat = codns.latitude;//获取到当前位置的纬度；
					str += "纬度："+lat+"\n";
					var longt = codns.longitude;//获取到当前位置的经度
					str += "经度："+longt+"\n";
					var alt = codns.altitude;//获取到当前位置的海拔信息；
					str += "海拔："+alt+"\n";
					var accu = codns.accuracy;//地理坐标信息精确度信息；
					str += "精确度："+accu+"\n";
					var altAcc = codns.altitudeAccuracy;//获取海拔信息的精确度；
					str += "海拔精确度："+altAcc+"\n";
					var head = codns.heading;//获取设备的移动方向；
					str += "移动方向："+head+"\n";
					var sped = codns.speed;//获取设备的移动速度；
					str += "移动速度："+sped;
					console.log(JSON.stringify(position));
					//outLine( str );
					//alert(position.addresses);
					longitude=(position.coords.longitude).toFixed(6);
					latitude=(position.coords.latitude).toFixed(6);
//					 alert("当前位置的纬度："+latitude+" 经度："+longitude);
					//alert(position.addresses)
//					$('#mapAddress input').val(position.addresses)
				}
				// 通过定位模块获取位置信息 
				function getGeocode(){
					//outSet( "获取定位位置信息:" );
					plus.geolocation.getCurrentPosition( geoInf, function ( e ) {
						outSet( "获取定位位置信息失败："+e.message );
					},{geocode:true,provider:'amap'});
				}
				getGeocode();
//				window.addEventListener('refreshmapstorage',function(event){ 
//					ismapStorage();
//				})
//				ismapStorage();
//				function ismapStorage(){
//					var mapStorage = JSON.parse(plus.storage.getItem('$mapStorage') || '[]'); 
//						 if(mapStorage.length==0){ 
//						 	getGeocode();
//						 } 
//						 else{
//						 	$('#mapAddress').html(mapStorage[0].adraddress)
//						 	plus.storage.removeItem('$mapStorage'); 
//						 }
//				}
				$('#mapAddress').click(function(){
					//alert('点击:'+latitude+" "+longitude);
					console.log(latitude+" "+longitude);
					if(latitude!=0){
						mui.openWindow({
							url: encodeURI('mMap.html?keywords=写字楼,学校,小区&center='+longitude+','+latitude+'&key=8f29aefac8547821425571df8852f64b'),
							id: 'mMap',
							show: {
								aniShow:'pop-in',
								},
								styles: {
									popGesture: 'hide',
									top:0,
								},
								waiting: {
									autoShow: false
								}
							})
					}
				})
			})
    </script>
	<!--默认按钮-->
	<script type="text/javascript">
	$('.toggle').click(function(e){
		var toggle = this;
		e.preventDefault();
		$(toggle).toggleClass('toggle--on').toggleClass('toggle--off').addClass('toggle--moving');
		setTimeout(function(){
			$(toggle).removeClass('toggle--moving');
		}, 200)
	});
	</script>
</html>
