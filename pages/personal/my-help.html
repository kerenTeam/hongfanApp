<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>我的帮帮团</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script> 
		<script src="../../js/hmt.js" type="text/javascript"></script>
		<script src="../../js/mui.min.js" type="text/javascript"></script>
		<style type="text/css">
			.notice .tab-hd,.orderbh,dl.list dt, dl.list dd,dl.list{
				border-bottom: 1px solid #eee;
			}
			.notice .tab-bd .tab-pal{
				border-top: 1px solid #eee;
				
			}
			.notice .tab-bd .tab-pal dl{
				background-color: #efeff4;
			}
			dl.list dt, dl.list dd, dl.list{
				margin-bottom: 4%;
				background-color: #fff;
			}
			dl.listtwo dd>.react{
				background-color:#fff;
				border-bottom: 1px solid #efeff4;
			}
			dl.listtwo dd{
				padding: 0;
				margin: 10px;
				/*box-shadow: 0px 0px 6px #ccc;*/
			}
			.poi-name{
				width: 100%;
				overflow: hidden;
				display: inline-block;
				line-height: 22px;
				color: #666;
				text-overflow: -o-ellipsis-lastline;
				text-overflow: ellipsis;
				display: -webkit-box;
				-webkit-line-clamp: 3;
				-webkit-box-orient: vertical;
				
			}
			.react{
				height: 105px !important;
			}
			.dealcard .dealcard-img{
				height: 70px;
				overflow: hidden;
			}
			.dealcard .dealcard-brand, .cinemacard .cinemacard-brandP,.dealcard .title span, .dealcard .price span{
				font-size: 14px;
			}
			.dealcard .dealcard-brand{
				height: 90px;
			}
			.dealcard .price{
				height: inherit;
				line-height: 30px;
			}
			.dealcard .price p{
				color: #333;
			}
			.state{
				color: #999 !important;
				font-size: 11px !important;
				line-height: 40px;
				text-align: right;
			}
			.list{
				background-color: #efeff4 !important;
			}
			dl.listtwo dd>.react {
				padding: .2rem .12rem .2rem .15rem;
			}
			.imgbox{
				width: 40px;
				height: 40px;
				border-radius: 50%;
			}
			.state_bottom{
				font-size: 11px;
				line-height: 35px;
				color: #999;
			}
			.state_bottom span{
				color: #ff5601;
			}
			.state_right{
				text-align: right;
			}
			.name{
				line-height: 40px;
			}
		 
		</style>
	</head>
	<body>
		<header class="hasManyCity hasManyCitytwo" id="header">
			<a class="fl fanhui mui-action-back"><i class="iconfont icon-fanhui"></i></a>
			<div class="header-tit">
				我的帮帮团
			</div>		
			<a href="javascript:;" class="fr baocun" onclick="help()">帮我</a>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="main" style="padding-top: 5px !important;">
			<div id="helpList"></div>
			<script type="text/html" id="helpTpl">
				<dl class="list listtwo list-in">						
					<%for(var i=0;i<data.length;i++){%>
						<dd onclick="helpRecord('<%=data[i].id%>')">
							<a class="react">
								<div class="dealcard dealcardtwo clearfloat">
									<!--<div class="mui-row">
									    <div class="mui-col-sm-2 mui-col-xs-2">
									    	<%if(data[i].headPic==null){%>
									    		<img src="../../img/10.png" class="imgbox">
									    		<%}else{%>
									    			<img src="<%=data[i].headPic%>" class="imgbox">
									    			<%}%>
									    	
									    </div>
									    <div class="mui-col-sm-8 mui-col-xs-8 name">
									    	<%=data[i].name%>
									    </div>
									    <div class="mui-col-sm-2 mui-col-xs-2 state">
									    	
									    </div>
									</div>-->
									<div class="dealcard-brand dealcard-brandtwo single-line">
										<p class="poi-name">提问：<%=data[i].title%></p>
										<p class="poi-name">内容：<span><%=data[i].content%></span></p>
										<!--<p class="state">显示中</p>-->
										<div class="mui-row state_bottom">
									        <div class="mui-col-sm-6 mui-col-xs-6">
								             	<%if(data[i].state==0){%>
										    		<span class="mui-badge" style="color: white">暂无回复</span>
										    	<%}else{%> 
										    		<span class="mui-badge mui-badge-danger" style="color: white">查看回复</span>
										    	<%}%>                       
									        </div>
									        <div class="mui-col-sm-6 mui-col-xs-6 state_right">
									                                     发布于<%=data[i].create_time%>
									        </div>
									    </div>
									</div>		
								</div>
							</a>
						</dd>
					<%}%>
					
				</dl>
			</script>
			
		</div>
	</body>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="../../js/artTemplate-native.js"></script>
	<script type="text/javascript">
		function help(){
			openview({
				view:'../serveForPeople/around.html'
			})
		}
		function helpRecord(id){
			openview({
				view:'my-answer.html',
				extrasobj:{publishId:id}
			})
		}
		
		mui.plusReady(function(){
			plus.nativeUI.showWaiting('加载中...',{width:'100px',height:'80px'});
			var myuserid = plus.storage.getItem('userid');
			var orderId = plus.webview.currentWebview().orderId;
			var oldtoken = plus.storage.getItem('oldToken');
			//添加刷新监听
			document.addEventListener('refreshHelp', function() {
				Refresh();
//				alert("刷新");
				console.log('刷新数据');
			})
			Refresh();
			function Refresh(){
				plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
				mui.ajax(serverUrl+'/api/localservice/myhelprequest',{
					data:{userid:myuserid},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"token":oldtoken},	 
					success:function(data,type,xhr){ 
						plus.nativeUI.closeWaiting();
						console.log(JSON.stringify(data.data)) ;
				       if(data.errno===0){
				       	if(data.data.length!=0){
				       		for(var t=0;t<data.data.length;t++){ 
				       			if(data.data[t].create_time !=null){
				       				data.data[t].create_time = data.data[t].create_time.substring(0,10)+" "+data.data[t].create_time.substring(11,16); 
				       			}else{
				       				data.data[t].create_time='';
				       			}
				       		
				       		} 
				       		var helpListb = {};
					       		helpListb.data= data.data; 
					        document.getElementById("helpList").innerHTML = template("helpTpl",helpListb); 
				       	}else{
				       		document.getElementById("helpList").innerHTML ='<img src="../../img/serveForPeople/publish.svg" style="margin: auto;display: block;width: 1rem;margin-top:1rem ;" alt="" /><span style="display:block;text-align: center;padding: 20px;">暂无帮帮团发布</span>'
				       	}
					        
				       }
					},
					error:function(xhr,type,errorThrown){
						plus.nativeUI.closeWaiting()
						console.log('响应失败  !');
					}
				});
			};
			
			
		})
		
	</script>
</html>
