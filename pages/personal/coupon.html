<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>优惠券</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<!--<script type="text/javascript" src="../../js/jquery.flexslider-min.js"></script>-->
		<script src="../../js/hmt.js" type="text/javascript"></script>
		<script src="../../js/mui.min.js" type="text/javascript"></script>
		<script src="../../js/app.js" type="text/javascript"></script>
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js" type="text/javascript"></script>
		<style type="text/css">
			.coupons .list .right {
				padding: 4% 0 5% 3%;
			}
		</style>
	</head>
	<body>
		<!--header star-->
		<header class="hasManyCity hasManyCitytwo" id="header">
			<a class="fl fanhui mui-action-back"><i class="iconfont icon-fanhui"></i></a>
			<div class="header-tit">
				优惠券
			</div>		
		</header>
	    <!--header end-->
	    <div id="container">		
			<div id="main">
				<div class="notice" style="margin:0 auto">
					<div class="tab-hd">
						<ul class="tab-nav">
						  <li>全部</li>
						  <li>未使用</li>
						  <li>已使用</li>
						</ul>
					</div>
					<div class="tab-bd">
						<div class="tab-pal">
							<div class="coupons clearfloat box-s" id="allC"></div>
						</div>
						<script type="text/html" id="allC-detail">
							<% for(var i=0;i<allLi.length;i++){ %>
								<div class="list clearfloat fl">
									<% if(allLi[i].user_coupon_state == 1){ %>
										<div class="left clearfloat fl">
											<% if(allLi[i].type_id == 2){ %>
												<%= allLi[i].discount*10 %><span>折</span>
											<% }else if(allLi[i].type_id == 1){ %>
												<span>¥</span><%= allLi[i].coupon_amount %>
											<% }else{ %>
												<%= allLi[i].coupon_amount %>
											<% } %>
										</div>
									<% }else{ %>
										<div class="left leftwo clearfloat fl">
											<% if(allLi[i].type_id == 2){ %>
												<%= allLi[i].discount*10 %><span>折</span>
											<% }else{ %>
												<span>¥</span><%= allLi[i].coupon_amount %>
											<% } %>
										</div>
									<% } %>
									<div class="right clearfloat fl box-s">
										<p class="tit">
											<%= allLi[i].name %>
										</p>
										<p class="time">
											有效时间：<%= allLi[i].create_time.split('T')[0] %>到<%= allLi[i].vaild_date %>
										</p>
									</div>
								</div>
							<% } %>
						</script>
						<!--<div class="tab-pal">
							<div class="coupons clearfloat box-s">
								<div class="list clearfloat fl">
									<div class="left clearfloat fl">
										<span>¥</span>10
									</div>
									<div class="right clearfloat fl box-s">
										<p class="tit">
											单笔订单满100元使用
										</p>
										<p class="time">
											有效时间：2016.11.01-2016.11.30
										</p>
										<p class="time">
											有效时间：2016.11.01-2016.11.30
										</p>
									</div>
								</div>
								<div class="list clearfloat fl">
									<div class="left clearfloat fl">
										<span>¥</span>10
									</div>
									<div class="right clearfloat fl box-s">
										<p class="tit">
											单笔订单满100元使用
										</p>
										<p class="time">
											有效时间：2016.11.01-2016.11.30
										</p>
									</div>
								</div>
							</div>
						</div>-->
						<div class="tab-pal">
							<div class="coupons clearfloat box-s">
								<div class="list clearfloat fl">
									<div class="left leftwo clearfloat fl">
										<span>¥</span>10
									</div>
									<div class="right clearfloat fl box-s">
										<p class="tit">
											单笔订单满100元使用
										</p>
										<p class="time">
											有效时间：2016.11.01-2016.11.30
										</p>
									</div>
								</div>
							</div>
						</div>	
					</div>
				</div>
			</div>
		</div>
		<script src="../../js/jquery.SuperSlide.2.1.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			jQuery(".notice").slide({ titCell:".tab-hd li", mainCell:".tab-bd",delayTime:0 });
		</script>
		
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function(){
				//判断是否登录并获取缓存token
				if(plus.storage.getItem('myToken')){
					var oldToken = plus.storage.getItem('oldToken');
				}else{
					mui.toast('请登录！');
					openview({
						view:'../login.html'
					})
				}
				var userId = plus.storage.getItem("userid");
	
				mui.ajax(serverUrl+'/api/useraccount/mycoupon',{
					data:{userid : userId},
					dataType:'json',
					type:'post',
					timeout:1000,
					headers:{"token":oldToken},	 
					success:function(data,type,xhr){
						alert(JSON.stringify(data.data));
						alert(JSON.parse(data.data[2].salerule));
						var data.data[2].salerule = eval("("+ data.data[2].salerule +"")
						var allC = {};
						allC.allLi = data.data;
						var html = template('allC-detail',allC);
						document.getElementById('allC').innerHTML = html;
						
					},
					error:function(xhr,type,errorThrown){
						alert('响应失败  !');
					}
				});
			})();
			
			
		</script>
	</body>
</html>
