<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>优惠券</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<!--<script type="text/javascript" src="../../js/jquery.flexslider-min.js"></script>-->
		<script src="../../js/hmt.js" type="text/javascript"></script>
		<script src="../../js/mui.min.js" type="text/javascript"></script>
		<script src="../../js/app.js" type="text/javascript"></script>
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js" type="text/javascript"></script>
		<style type="text/css">
			.coupons .list .right {
				padding: 4% 0 5% 3%;
			}
			
			/*图片预览*/
			.mui-preview-image.mui-fullscreen {
				position: fixed;
				z-index: 20;
				background-color: #000;
			}
			.mui-preview-header,
			.mui-preview-footer {
				position: absolute;
				width: 100%;
				left: 0;
				z-index: 10;
			}
			.mui-preview-header {
				height: 44px;
				top: 0;
			}
			.mui-preview-footer {
				height: 50px;
				bottom: 0px;
			}
			.mui-preview-header .mui-preview-indicator {
				display: block;
				line-height: 25px;
				color: #fff;
				text-align: center;
				margin: 15px auto 4;
				width: 70px;
				background-color: rgba(0, 0, 0, 0.4);
				border-radius: 12px;
				font-size: 16px;
			}
			.mui-preview-image {
				display: none;
				-webkit-animation-duration: 0.5s;
				animation-duration: 0.5s;
				-webkit-animation-fill-mode: both;
				animation-fill-mode: both;
			}
			.mui-preview-image.mui-preview-in {
				-webkit-animation-name: fadeIn;
				animation-name: fadeIn;
			}
			.mui-preview-image.mui-preview-out {
				background: none;
				-webkit-animation-name: fadeOut;
				animation-name: fadeOut;
			}
			.mui-preview-image.mui-preview-out .mui-preview-header,
			.mui-preview-image.mui-preview-out .mui-preview-footer {
				display: none;
			}
			.mui-zoom-scroller {
				position: absolute;
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-box-align: center;
				-webkit-align-items: center;
				align-items: center;
				-webkit-box-pack: center;
				-webkit-justify-content: center;
				justify-content: center;
				left: 0;
				right: 0;
				bottom: 0;
				top: 0;
				width: 100%;
				height: 100%;
				margin: 0;
				-webkit-backface-visibility: hidden;
			}
			.mui-zoom {
				-webkit-transform-style: preserve-3d;
				transform-style: preserve-3d;
			}
			.mui-slider .mui-slider-group .mui-slider-item img {
				width: auto;
				height: auto;
				max-width: 100%;
				max-height: 100%;
			}
			.mui-android-4-1 .mui-slider .mui-slider-group .mui-slider-item img {
				width: 100%;
			}
			.mui-android-4-1 .mui-slider.mui-preview-image .mui-slider-group .mui-slider-item {
				display: inline-table;
			}
			.mui-android-4-1 .mui-slider.mui-preview-image .mui-zoom-scroller img {
				display: table-cell;
				vertical-align: middle;
			}
			.mui-preview-loading {
				position: absolute;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				display: none;
			}
			.mui-preview-loading.mui-active {
				display: block;
			}
			.mui-preview-loading .mui-spinner-white {
				position: absolute;
				top: 50%;
				left: 50%;
				margin-left: -25px;
				margin-top: -25px;
				height: 50px;
				width: 50px;
			}
			.mui-preview-image img.mui-transitioning {
				-webkit-transition: -webkit-transform 0.5s ease, opacity 0.5s ease;
				transition: transform 0.5s ease, opacity 0.5s ease;
			}
			@-webkit-keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			@keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			@-webkit-keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}
			@keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}
			p img {
				max-width: 100%;
				height: auto;
			}
			
			
			/*修改*/
			.fl{
				position: relative;
			}
			.qrcode{
				position: absolute;
				right: 0;
				top: 0;
				width: 40px;
				height: 40px;
				overflow: hidden;
			}
			.qrcode img{
				width: 100%;
			}
		</style>
	</head>
	<body>
		<!--header star-->
		<header class="hasManyCity hasManyCitytwo" id="header">
			<a class="fl fanhui mui-action-back"><i class="iconfont icon-fanhui"></i></a>
			<div class="header-tit">
				优惠券
			</div>		
		</header>
	    <!--header end-->
	    <div id="container">		
			<div id="main">
				<div class="notice" style="margin:0 auto">
					<div class="tab-hd">
						<ul class="tab-nav">
						  <li>全部</li>
						  <li>未使用</li>
						  <li>已使用</li>
						</ul>
					</div>
					<div class="tab-bd">
						<div class="tab-pal">
							<div class="coupons clearfloat box-s" id="allC"></div>
						</div>
						<div class="tab-pal">
							<div class="coupons clearfloat box-s" id="ableC"></div>
						</div>	
						<div class="tab-pal">
							<div class="coupons clearfloat box-s" id="disableC"></div>
						</div>
						<!--全部-->
						<script type="text/html" id="allC-detail">
							<% for(var i=0;i<allLi.length;i++){ %>
								<div class="list clearfloat fl">
									<% if(allLi[i].user_coupon_state == 1){ %>
										<div class="left clearfloat fl">
											<% if(allLi[i].type_id == 2){ %>
												<%= allLi[i].discount*10 %><span>折</span>
											<% }else if(allLi[i].type_id == 1){ %>
												<span>¥</span><%= allLi[i].coupon_amount %>
											<% }else{ %>
												<%= allLi[i].coupon_amount %>
											<% } %>
										</div>
									<% }else{ %>
										<div class="left leftwo clearfloat fl">
											<% if(allLi[i].type_id == 2){ %>
												<%= allLi[i].discount*10 %><span>折</span>
											<% }else{ %>
												<span>¥</span><%= allLi[i].coupon_amount %>
											<% } %>
										</div>
									<% } %>
									<div class="right clearfloat fl box-s">
										<p class="tit">
											<%= allLi[i].name %>
										</p>
										<% if(allLi[i].type_id == 3){ %>
											<p class="time">
												<% if(allLi[i].salerule!=null && allLi[i].salerule!=''){ %>
													满<%= allLi[i].salerule.rule1 %>可使用活动券抵扣<%= allLi[i].salerule.rule2 %>
												<%} %>
											</p>
										<% }else{ %>
											<p class="time">&nbsp;</p>
										<% } %>
										<p class="time">
											有效时间：<%= allLi[i].create_time.split('T')[0] %>到<%= allLi[i].vaild_date %>
										</p>
									</div>
									<div class="qrcode mui-content-padded">
										<img src="<%= allLi[i].qrcode %>" data-preview-src="" data-preview-group="1" />
									</div>
								</div>
							<% } %>
						</script>
						<!--未使用-->
						<script type="text/html" id="ableC-detail">
							<% for(var i=0;i<allLi.length;i++){ %>
								<% if(allLi[i].user_coupon_state == 1){ %>
									<div class="list clearfloat fl">
										<div class="left clearfloat fl">
											<% if(allLi[i].type_id == 2){ %>
												<%= allLi[i].discount*10 %><span>折</span>
											<% }else if(allLi[i].type_id == 1){ %>
												<span>¥</span><%= allLi[i].coupon_amount %>
											<% }else{ %>
												<%= allLi[i].coupon_amount %>
											<% } %>
										</div>
										<div class="right clearfloat fl box-s">
											<p class="tit">
												<%= allLi[i].name %>
											</p>
											<% if(allLi[i].type_id == 3){ %>
												<p class="time">
													<% if(allLi[i].salerule!=null && allLi[i].salerule!=''){ %>
														满<%= allLi[i].salerule.rule1 %>可使用活动券抵扣<%= allLi[i].salerule.rule2 %>
													<%} %>
												</p>
											<% }else{ %>
												<p class="time">&nbsp;</p>
											<% } %>
											<p class="time">
												有效时间：<%= allLi[i].create_time.split('T')[0] %>到<%= allLi[i].vaild_date %>
											</p>
										</div>
										<div class="qrcode mui-content-padded">
											<img src="<%= allLi[i].qrcode %>" data-preview-src="" data-preview-group="1" />
										</div>
									</div>
								<% } %>
							<% } %>
						</script>
						<!--已使用-->
						<script type="text/html" id="disableC-detail">
							<% for(var i=0;i<allLi.length;i++){ %>
								<% if(allLi[i].user_coupon_state == 0){ %>
									<div class="list clearfloat fl">
										<div class="left  leftwo clearfloat fl">
											<% if(allLi[i].type_id == 2){ %>
												<%= allLi[i].discount*10 %><span>折</span>
											<% }else if(allLi[i].type_id == 1){ %>
												<span>¥</span><%= allLi[i].coupon_amount %>
											<% }else{ %>
												<%= allLi[i].coupon_amount %>
											<% } %>
										</div>
										<div class="right clearfloat fl box-s">
											<p class="tit">
												<%= allLi[i].name %>
											</p>
											<% if(allLi[i].type_id == 3){ %>
												<p class="time">
													<% if(allLi[i].salerule!=null && allLi[i].salerule!=''){ %>
														满<%= allLi[i].salerule.rule1 %>可使用活动券抵扣<%= allLi[i].salerule.rule2 %>
													<%} %>
												</p>
											<% }else{ %>
												<p class="time">&nbsp;</p>
											<% } %>
											<p class="time">
												有效时间：<%= allLi[i].create_time.split('T')[0] %>到<%= allLi[i].vaild_date %>
											</p>
										</div>
										<div class="qrcode mui-content-padded">
											<img src="../../img/21.jpg" data-preview-src="" data-preview-group="1" />
										</div>
									</div>
								<% } %>
							<% } %>
						</script>
						<!--<div class="tab-pal">
							<div class="coupons clearfloat box-s">
								<div class="list clearfloat fl">
									<div class="left leftwo clearfloat fl">
										<span>¥</span>10
									</div>
									<div class="right clearfloat fl box-s">
										<p class="tit">
											单笔订单满100元使用
										</p>
										<p class="time">
											有效时间：2016.11.01-2016.11.30
										</p>
									</div>
									<div class="qrcode mui-content-padded">
										<img src="../../img/12.png" data-preview-src="" data-preview-group="1" />
									</div>
								</div>
							</div>
						</div>	-->
					</div>
				</div>
			</div>
		</div>
		<script src="../../js/jquery.SuperSlide.2.1.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			jQuery(".notice").slide({ titCell:".tab-hd li", mainCell:".tab-bd",delayTime:0 });
		</script>
		<!--图片预览-->
		<script src="../../js/mui.zoom.js"></script>
		<script src="../../js/mui.previewimage.js"></script>
		<script>
			mui.previewImage();
		</script>
		
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function(){
				//判断是否登录并获取缓存token
				if(plus.storage.getItem('myToken')){
					var oldToken = plus.storage.getItem('oldToken');
				}else{
					mui.toast('请登录！');
					openview({
						view:'../login.html'
					})
				}
				var userId = plus.storage.getItem("userid");
	
				mui.ajax(serverUrl+'/api/useraccount/mycoupon',{
					data:{userid : userId},
					dataType:'json',
					type:'post',
					timeout:1000,
					headers:{"token":oldToken},	 
					success:function(data,type,xhr){
//						alert(JSON.stringify(data.data));
//						alert(eval("("+ data.data[2].salerule +")").rule[0]);
						for(var m=0; m < data.data; m++){ 
							alert(1)
							if(data.data[m].salerule==null){
							 	data.data[m].salerule=null;
							}else{	
								data.data[m].salerule.rule1= eval("("+ data.data[m].salerule +")").rule[0];
								data.data[m].salerule.rule2= eval("("+data.data[m].salerule+")").rule[1];
							}
							 
						}   
//						var data.data[2].salerule = eval("("+ data.data[2].salerule +"")
						var allC = {};
						allC.allLi = data.data;
						var html = template('allC-detail',allC);
						document.getElementById('allC').innerHTML = html;
						var html2 = template('ableC-detail',allC);
						document.getElementById('ableC').innerHTML = html2;
						var html3 = template('disableC-detail',allC);
						document.getElementById('disableC').innerHTML = html3;
						
					},
					error:function(xhr,type,errorThrown){
						alert('响应失败  !');
					}
				});
			})();
			
			
		</script>
	</body>
</html>
