<html>
	<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
			<title>活动报名</title>
			<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
			<meta name="apple-mobile-web-app-capable" content="yes">
			<meta name="apple-touch-fullscreen" content="yes">
			<meta name="apple-mobile-web-app-status-bar-style" content="black">
			<meta name="format-detection" content="telephone=no">
			<meta name="format-detection" content="address=no">
			<link rel="stylesheet" type="text/css" href="../../css/common.css">
			<link rel="stylesheet" type="text/css" href="../../css/index.css">
			<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
			<link rel="stylesheet" href="../../css/reset.css">
			<!--<link href="../../css/mui.picker.min.css" rel="stylesheet" />-->
			<!--<link href="../../css/mui.poppicker.css" rel="stylesheet" />-->
			<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
			<script type="text/javascript" src="../../js/jquery.min.js"></script>
			<!--<script src="../../js/mui.picker.min.js"></script>-->
			<!--<script src="../../js/mui.poppicker.js"></script>-->
			<script src="../../js/binaryajax.js" ></script>
			<script src="../../js/canvasResize.js" ></script>
			<script src="../../js/exif.js" ></script>
			<style>
			.Ynull{
				text-align: right;
				width:-moz-calc(100% - 0.5rem)!important;
				width:-webkit-calc(100% - 0.5rem)!important;
				width: calc(100% - 0.5rem)!important;
			}
			.czhi span{
				width: 0.45rem!important;
				text-align: center;
			}
			</style>
	</head>
	<body>
		<!--header star-->
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title" id="header">活动报名</h1>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<div id="main">
	    	<span class="recharge clearfloat">
	    		<div class="czhi clearfloat box-s">
	    			<span>姓名</span> <input type="text" id="Bname" class="Ynull fr" value=""/>
	    		</div>
	    		<div class="czhi clearfloat box-s">
	    			<span>电话</span> <input type="text" id="Bphone" class="Ynull fr" value=""/>
	    		</div> 
	    		<div class="czhi clearfloat box-s">
	    			<span>性别</span> <input type="text" id="Bclass" class="Ynull" value=""/>
	    		</div>
	    		<div class="czhi clearfloat box-s">
	    			<span>年龄</span> <input type="number" id="Bage" class="Ynull fr" min="20" max="50" value=""/>
	    		</div>
	    			<p style="color: #333;padding-left: 0.25rem;padding-top: 10px;">报名费：<span id="Bprice" ></span></p> 
	    	</div>	    	
		    <div class="renting-footer renting-footertwo clearfloat" id="footer">
				<ul>
					<li id="Releasebtn">立即报名</li>
				</ul>
			</div>
	 
		</div>
	</body>
</html>
<script src="../../js/app.js"></script> 
<script type="text/javascript" >
 
	//上传部分
	var reg_phone = /^1((3|4|5|8|7){1}\d{1}|70)\d{8}$/;//手机号正则
	mui.plusReady(function(){
		var oldtoken = plus.storage.getItem('oldToken');
		var myuserid = plus.storage.getItem('userid');
		var apprenticeId = plus.webview.currentWebview().apprenticeId;
		var apprenticeFee = plus.webview.currentWebview().apprenticeFee;
		console.log(oldtoken);
		if(apprenticeFee > 0){
			document.getElementById('Bprice').innerHTML = apprenticeFee;
		}else{
			document.getElementById('Bprice').innerHTML = "免费";
		}
//		alert(apprenticeFee);
	
		mui('#Releasebtn')[0].onclick = function(){ 
			//获取所需data
			var name = mui('#Bname')[0].value;
			var mobileno = mui('#Bphone')[0].value;
			var gender = mui('#Bclass')[0].value;
			var age = mui('#Bage')[0].value;
			var price = document.getElementById('Bprice').value;
			
			var Ynulls = mui('.Ynull');
			
			if(mui('#Bname')[0].value==''){
				mui.toast('请输入您的姓名');
				mui('#Bname')[0].focus();
			}
			else if(!reg_phone.test(mui('#Bphone')[0].value)){
				mui.toast('请输入正确的手机号');
				mui('#Bphone')[0].focus();
			}
			else if(mui('#Bclass')[0].value!='男' && mui('#Bclass')[0].value!='女'){
				mui.toast('请输入正确的性别');
				mui('#Bclass')[0].focus();
			}
			else if(mui('#Bage')[0].value==''){
				mui.toast('请输入您的年龄');
				mui('#Bage')[0].focus();
			}
			else{
				if(apprenticeFee !== "免费"){ 
					plus.nativeUI.showWaiting()
				//铺数据
				var oldToken = plus.storage.getItem('oldToken');
				console.log(oldToken);
				mui.ajax(serverUrl+'/api/localservice/activityjoin',{
					data:{id:apprenticeId,userid:myuserid,name:name,gender:gender,mobileno:mobileno,age:age},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"token":oldToken},	 
					success:function(data,type,xhr){ 
						
					 
						
						var uuid = data.data.uuid;
						var activityid = data.data.activityid; 
						plus.nativeUI.showWaiting('提交中 ...',{width:'100px',height:'80px'});//显示等待框
						if(data.errno==0){ 
							plus.nativeUI.closeWaiting();
							 
							
							openview({
								view:'../market/activityPay.html',
								id:"activityPay",
								extrasobj:{orderid:uuid,price:apprenticeFee,activityId:activityid}
							})
						//	plus.webview.currentWebview().close();
							
						}
					},
					error:function(xhr,type,errorThrown){
						
							plus.nativeUI.closeWaiting();
						 alert('网络不好请重试  !');
					}
				});		
			}else{
				//铺数据
					var oldToken = plus.storage.getItem('oldToken');
						console.log(oldToken);
						mui.ajax(serverUrl+'/api/localservice/activityjoin',{
							data:{id:apprenticeId,userid:myuserid,name:name,gender:gender,mobileno:mobileno,age:age},
							dataType:'json',
							type:'post',
							timeout:10000,
							headers:{"token":oldToken},	 
							success:function(data,type,xhr){
								
								//alert(JSON.stringify(data));
								plus.nativeUI.showWaiting('提交中 ...',{width:'100px',height:'80px'});//显示等待框
								if(data.errno==0){
									mui.toast('报名成功');
									plus.webview.currentWebview().close();
									plus.nativeUI.closeWaiting();
								}
							},
							error:function(xhr,type,errorThrown){
								alert('网络不好请重试  !');
							}
						});		
					}
					}
			
		}
	})
</script>